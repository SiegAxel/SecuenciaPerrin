"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[8372],{8372:(zg,zu,H)=>{H.r(zu),H.d(zu,{AdminPageModule:()=>xv});var v=H(6814),q=H(95),C=H(7027),lt=H(2946),R=H(5861),p=H(5879),Lo=H(2115),dp=H(3309),Yr=H(7696),fp=H(4017),Fe=H(1180),Re=H(8326),Pt=H(7217),Wu=(H(8290),H(8645)),lr=H(2096),us=H(5592),Jr=H(2459),cs=H(3019),ls=H(3093),It=H(4664),oe=H(7398),Ge=H(4552);class Ku extends Wu.x{constructor(e=1/0,t=1/0,r=Ge.l){super(),this._bufferSize=e,this._windowTime=t,this._timestampProvider=r,this._buffer=[],this._infiniteTimeWindow=!0,this._infiniteTimeWindow=t===1/0,this._bufferSize=Math.max(1,e),this._windowTime=Math.max(1,t)}next(e){const{isStopped:t,_buffer:r,_infiniteTimeWindow:i,_timestampProvider:s,_windowTime:a}=this;t||(r.push(e),!i&&r.push(s.now()+a)),this._trimBuffer(),super.next(e)}_subscribe(e){this._throwIfClosed(),this._trimBuffer();const t=this._innerSubscribe(e),{_infiniteTimeWindow:r,_buffer:i}=this,s=i.slice();for(let a=0;a<s.length&&!e.closed;a+=r?1:2)e.next(s[a]);return this._checkFinalizedStatuses(e),t}_trimBuffer(){const{_bufferSize:e,_timestampProvider:t,_buffer:r,_infiniteTimeWindow:i}=this,s=(i?1:2)*e;if(e<1/0&&s<r.length&&r.splice(0,r.length-s),!i){const a=t.now();let h=0;for(let d=1;d<r.length&&r[d]<=a;d+=2)h=d;h&&r.splice(0,h+1)}}}var hr=H(3020);function hs(n,e,t){let r,i=!1;return n&&"object"==typeof n?({bufferSize:r=1/0,windowTime:e=1/0,refCount:i=!1,scheduler:t}=n):r=null!=n?n:1/0,(0,hr.B)({connector:()=>new Ku(r,e,t),resetOnError:!0,resetOnComplete:!1,resetOnRefCountZero:i})}var N=H(1374),Rt=H(4674);function ht(n,e){return(0,Rt.m)(e)?(0,It.w)(()=>n,e):(0,It.w)(()=>n)}var xn=H(5137),Xr=H(2181);H(7142);const ju=new p.OlP("angularfire2.auth.use-emulator"),dr=new p.OlP("angularfire2.auth.settings"),ds=new p.OlP("angularfire2.auth.tenant-id"),Fo=new p.OlP("angularfire2.auth.langugage-code"),$u=new p.OlP("angularfire2.auth.use-device-language"),Hu=new p.OlP("angularfire.auth.persistence"),de=(n,e,t,r,i,s,a,h)=>(0,Pt.cc)(`${n.name}.auth`,"AngularFireAuth",n.name,()=>{const d=e.runOutsideAngular(()=>n.auth());if(t&&d.useEmulator(...t),r&&(d.tenantId=r),d.languageCode=i,s&&d.useDeviceLanguage(),a)for(const[m,g]of Object.entries(a))d.settings[m]=g;return h&&d.setPersistence(h),d},[t,r,i,s,a,h]);let ge=(()=>{var n;class e{constructor(r,i,s,a,h,d,m,g,y,T,w,k){(0,Fe.Z)(this,"authState",void 0),(0,Fe.Z)(this,"idToken",void 0),(0,Fe.Z)(this,"user",void 0),(0,Fe.Z)(this,"idTokenResult",void 0),(0,Fe.Z)(this,"credential",void 0);const D=new Wu.x,V=(0,lr.of)(void 0).pipe((0,ls.Q)(h.outsideAngular),(0,It.w)(()=>a.runOutsideAngular(()=>Promise.resolve().then(H.bind(H,8290)))),(0,oe.U)(()=>(0,Pt.on)(r,a,i)),(0,oe.U)(G=>de(G,a,d,g,y,T,m,w)),hs({bufferSize:1,refCount:!1}));if((0,v.PM)(s))this.authState=this.user=this.idToken=this.idTokenResult=this.credential=(0,lr.of)(null);else{V.pipe((0,N.P)()).subscribe();const G=V.pipe((0,It.w)(W=>W.getRedirectResult().then(ee=>ee,()=>null)),Re.iC,hs({bufferSize:1,refCount:!1})),$=V.pipe((0,It.w)(W=>new us.y(ee=>({unsubscribe:a.runOutsideAngular(()=>W.onAuthStateChanged(X=>ee.next(X),X=>ee.error(X),()=>ee.complete()))})))),j=V.pipe((0,It.w)(W=>new us.y(ee=>({unsubscribe:a.runOutsideAngular(()=>W.onIdTokenChanged(X=>ee.next(X),X=>ee.error(X),()=>ee.complete()))}))));this.authState=G.pipe(ht($),(0,xn.R)(h.outsideAngular),(0,ls.Q)(h.insideAngular)),this.user=G.pipe(ht(j),(0,xn.R)(h.outsideAngular),(0,ls.Q)(h.insideAngular)),this.idToken=this.user.pipe((0,It.w)(W=>W?(0,Jr.D)(W.getIdToken()):(0,lr.of)(null))),this.idTokenResult=this.user.pipe((0,It.w)(W=>W?(0,Jr.D)(W.getIdTokenResult()):(0,lr.of)(null))),this.credential=(0,cs.T)(G,D,this.authState.pipe((0,Xr.h)(W=>!W))).pipe((0,oe.U)(W=>null!=W&&W.user?W:null),(0,xn.R)(h.outsideAngular),(0,ls.Q)(h.insideAngular))}return(0,Pt.pX)(this,V,a,{spy:{apply:(G,$,j)=>{(G.startsWith("signIn")||G.startsWith("createUser"))&&j.then(W=>D.next(W))}}})}}return n=e,(0,Fe.Z)(e,"\u0275fac",function(r){return new(r||n)(p.LFG(Pt.Dh),p.LFG(Pt.xv,8),p.LFG(p.Lbi),p.LFG(p.R0b),p.LFG(Re.HU),p.LFG(ju,8),p.LFG(dr,8),p.LFG(ds,8),p.LFG(Fo,8),p.LFG($u,8),p.LFG(Hu,8),p.LFG(Re.Rf,8))}),(0,Fe.Z)(e,"\u0275prov",p.Yz7({token:n,factory:n.\u0275fac,providedIn:"any"})),e})();var Yu=H(6321),ei=H(7921),zt=H(9360),Uo=H(8251);function fs(){return(0,zt.e)((n,e)=>{let t,r=!1;n.subscribe((0,Uo.x)(e,i=>{const s=t;t=i,r&&e.next([s,i]),r=!0}))})}var F,qo=H(6699),sh=H(3997),ti=H(3106),ni=H(534),Bo=H(4537),vt=H(7879),ce=H(9058),Zo=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},dt={},Go=Go||{},Q=Zo||self;function ps(n){var e=typeof n;return"array"==(e="object"!=e?e:n?Array.isArray(n)?"array":e:"null")||"object"==e&&"number"==typeof n.length}function kn(n){var e=typeof n;return"object"==e&&null!=n||"function"==e}var ri="closure_uid_"+(1e9*Math.random()>>>0),ii=0;function pp(n,e,t){return n.call.apply(n.bind,arguments)}function ah(n,e,t){if(!n)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var i=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(i,r),n.apply(e,i)}}return function(){return n.apply(e,arguments)}}function Ue(n,e,t){return(Ue=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?pp:ah).apply(null,arguments)}function fr(n,e){var t=Array.prototype.slice.call(arguments,1);return function(){var r=t.slice();return r.push.apply(r,arguments),n.apply(this,r)}}function Se(n,e){function t(){}t.prototype=e.prototype,n.$=e.prototype,n.prototype=new t,n.prototype.constructor=n,n.ac=function(r,i,s){for(var a=Array(arguments.length-2),h=2;h<arguments.length;h++)a[h-2]=arguments[h];return e.prototype[i].apply(r,a)}}function nn(){this.s=this.s,this.o=this.o}nn.prototype.s=!1,nn.prototype.sa=function(){!this.s&&(this.s=!0,this.N(),0)&&function oh(n){Object.prototype.hasOwnProperty.call(n,ri)&&n[ri]||(n[ri]=++ii)}(this)},nn.prototype.N=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const ms=Array.prototype.indexOf?function(n,e){return Array.prototype.indexOf.call(n,e,void 0)}:function(n,e){if("string"==typeof n)return"string"!=typeof e||1!=e.length?-1:n.indexOf(e,0);for(let t=0;t<n.length;t++)if(t in n&&n[t]===e)return t;return-1};function zo(n){const e=n.length;if(0<e){const t=Array(e);for(let r=0;r<e;r++)t[r]=n[r];return t}return[]}function Ju(n,e){for(let t=1;t<arguments.length;t++){const r=arguments[t];if(ps(r)){const i=n.length||0,s=r.length||0;n.length=i+s;for(let a=0;a<s;a++)n[i+a]=r[a]}else n.push(r)}}function ze(n,e){this.type=n,this.g=this.target=e,this.defaultPrevented=!1}ze.prototype.h=function(){this.defaultPrevented=!0};var si=function(){if(!Q.addEventListener||!Object.defineProperty)return!1;var n=!1,e=Object.defineProperty({},"passive",{get:function(){n=!0}});try{Q.addEventListener("test",()=>{},e),Q.removeEventListener("test",()=>{},e)}catch{}return n}();function Nn(n){return/^[\s\xa0]*$/.test(n)}function gs(){var n=Q.navigator;return n&&(n=n.userAgent)?n:""}function ft(n){return-1!=gs().indexOf(n)}function Wo(n){return Wo[" "](n),n}Wo[" "]=function(){};var ec,n,ch=ft("Opera"),rn=ft("Trident")||ft("MSIE"),pr=ft("Edge"),St=pr||rn,sn=ft("Gecko")&&!(-1!=gs().toLowerCase().indexOf("webkit")&&!ft("Edge"))&&!(ft("Trident")||ft("MSIE"))&&!ft("Edge"),Xu=-1!=gs().toLowerCase().indexOf("webkit")&&!ft("Edge");function Xe(){var n=Q.document;return n?n.documentMode:void 0}e:{var on="",Kt=(n=gs(),sn?/rv:([^\);]+)(\)|;)/.exec(n):pr?/Edge\/([\d\.]+)/.exec(n):rn?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(n):Xu?/WebKit\/(\S+)/.exec(n):ch?/(?:Version)[ \/]?(\S+)/.exec(n):void 0);if(Kt&&(on=Kt?Kt[1]:""),rn){var an=Xe();if(null!=an&&an>parseFloat(on)){ec=String(an);break e}}ec=on}var jo=Q.document&&rn&&(Xe()||parseInt(ec,10))||void 0;function mr(n,e){if(ze.call(this,n?n.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,n){var t=this.type=n.type,r=n.changedTouches&&n.changedTouches.length?n.changedTouches[0]:null;if(this.target=n.target||n.srcElement,this.g=e,e=n.relatedTarget){if(sn){e:{try{Wo(e.nodeName);var i=!0;break e}catch{}i=!1}i||(e=null)}}else"mouseover"==t?e=n.fromElement:"mouseout"==t&&(e=n.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==n.clientX?n.clientX:n.pageX,this.clientY=void 0!==n.clientY?n.clientY:n.pageY,this.screenX=n.screenX||0,this.screenY=n.screenY||0),this.button=n.button,this.key=n.key||"",this.ctrlKey=n.ctrlKey,this.altKey=n.altKey,this.shiftKey=n.shiftKey,this.metaKey=n.metaKey,this.pointerId=n.pointerId||0,this.pointerType="string"==typeof n.pointerType?n.pointerType:tc[n.pointerType]||"",this.state=n.state,this.i=n,n.defaultPrevented&&mr.$.h.call(this)}}Se(mr,ze);var tc={2:"touch",3:"pen",4:"mouse"};mr.prototype.h=function(){mr.$.h.call(this);var n=this.i;n.preventDefault?n.preventDefault():n.returnValue=!1};var jt="closure_listenable_"+(1e6*Math.random()|0),nc=0;function rc(n,e,t,r,i){this.listener=n,this.proxy=null,this.src=e,this.type=t,this.capture=!!r,this.la=i,this.key=++nc,this.fa=this.ia=!1}function $t(n){n.fa=!0,n.listener=null,n.proxy=null,n.src=null,n.la=null}function $o(n,e,t){for(const r in n)e.call(t,n[r],r,n)}function ic(n){const e={};for(const t in n)e[t]=n[t];return e}const Ho="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function sc(n,e){let t,r;for(let i=1;i<arguments.length;i++){for(t in r=arguments[i],r)n[t]=r[t];for(let s=0;s<Ho.length;s++)t=Ho[s],Object.prototype.hasOwnProperty.call(r,t)&&(n[t]=r[t])}}function oi(n){this.src=n,this.g={},this.h=0}function Qo(n,e){var t=e.type;if(t in n.g){var s,r=n.g[t],i=ms(r,e);(s=0<=i)&&Array.prototype.splice.call(r,i,1),s&&($t(e),0==n.g[t].length&&(delete n.g[t],n.h--))}}function Yo(n,e,t,r){for(var i=0;i<n.length;++i){var s=n[i];if(!s.fa&&s.listener==e&&s.capture==!!t&&s.la==r)return i}return-1}oi.prototype.add=function(n,e,t,r,i){var s=n.toString();(n=this.g[s])||(n=this.g[s]=[],this.h++);var a=Yo(n,e,r,i);return-1<a?(e=n[a],t||(e.ia=!1)):((e=new rc(e,this.src,s,!!r,i)).ia=t,n.push(e)),e};var ai="closure_lm_"+(1e6*Math.random()|0),Jo={};function oc(n,e,t,r,i){if(r&&r.once)return Xo(n,e,t,r,i);if(Array.isArray(e)){for(var s=0;s<e.length;s++)oc(n,e[s],t,r,i);return null}return t=ys(t),n&&n[jt]?n.O(e,t,kn(r)?!!r.capture:!!r,i):ac(n,e,t,!1,r,i)}function ac(n,e,t,r,i,s){if(!e)throw Error("Invalid event type");var a=kn(i)?!!i.capture:!!i,h=ta(n);if(h||(n[ai]=h=new oi(n)),(t=h.add(e,t,r,a,s)).proxy)return t;if(r=function _e(){const e=hh;return function n(t){return e.call(n.src,n.listener,t)}}(),t.proxy=r,r.src=n,r.listener=t,n.addEventListener)si||(i=a),void 0===i&&(i=!1),n.addEventListener(e.toString(),r,i);else if(n.attachEvent)n.attachEvent(ea(e.toString()),r);else{if(!n.addListener||!n.removeListener)throw Error("addEventListener and attachEvent are unavailable.");n.addListener(r)}return t}function Xo(n,e,t,r,i){if(Array.isArray(e)){for(var s=0;s<e.length;s++)Xo(n,e[s],t,r,i);return null}return t=ys(t),n&&n[jt]?n.P(e,t,kn(r)?!!r.capture:!!r,i):ac(n,e,t,!0,r,i)}function uc(n,e,t,r,i){if(Array.isArray(e))for(var s=0;s<e.length;s++)uc(n,e[s],t,r,i);else r=kn(r)?!!r.capture:!!r,t=ys(t),n&&n[jt]?(n=n.i,(e=String(e).toString())in n.g&&-1<(t=Yo(s=n.g[e],t,r,i))&&($t(s[t]),Array.prototype.splice.call(s,t,1),0==s.length&&(delete n.g[e],n.h--))):n&&(n=ta(n))&&(e=n.g[e.toString()],n=-1,e&&(n=Yo(e,t,r,i)),(t=-1<n?e[n]:null)&&ui(t))}function ui(n){if("number"!=typeof n&&n&&!n.fa){var e=n.src;if(e&&e[jt])Qo(e.i,n);else{var t=n.type,r=n.proxy;e.removeEventListener?e.removeEventListener(t,r,n.capture):e.detachEvent?e.detachEvent(ea(t),r):e.addListener&&e.removeListener&&e.removeListener(r),(t=ta(e))?(Qo(t,n),0==t.h&&(t.src=null,e[ai]=null)):$t(n)}}}function ea(n){return n in Jo?Jo[n]:Jo[n]="on"+n}function hh(n,e){if(n.fa)n=!0;else{e=new mr(e,this);var t=n.listener,r=n.la||n.src;n.ia&&ui(n),n=t.call(r,e)}return n}function ta(n){return(n=n[ai])instanceof oi?n:null}var na="__closure_events_fn_"+(1e9*Math.random()>>>0);function ys(n){return"function"==typeof n?n:(n[na]||(n[na]=function(e){return n.handleEvent(e)}),n[na])}function Ne(){nn.call(this),this.i=new oi(this),this.S=this,this.J=null}function Ve(n,e){var t,r=n.J;if(r)for(t=[];r;r=r.J)t.push(r);if(n=n.S,r=e.type||e,"string"==typeof e)e=new ze(e,n);else if(e instanceof ze)e.target=e.target||n;else{var i=e;sc(e=new ze(r,n),i)}if(i=!0,t)for(var s=t.length-1;0<=s;s--){var a=e.g=t[s];i=Vn(a,r,!0,e)&&i}if(i=Vn(a=e.g=n,r,!0,e)&&i,i=Vn(a,r,!1,e)&&i,t)for(s=0;s<t.length;s++)i=Vn(a=e.g=t[s],r,!1,e)&&i}function Vn(n,e,t,r){if(!(e=n.i.g[String(e)]))return!0;e=e.concat();for(var i=!0,s=0;s<e.length;++s){var a=e[s];if(a&&!a.fa&&a.capture==t){var h=a.listener,d=a.la||a.src;a.ia&&Qo(n.i,a),i=!1!==h.call(d,r)&&i}}return i&&!r.defaultPrevented}Se(Ne,nn),Ne.prototype[jt]=!0,Ne.prototype.removeEventListener=function(n,e,t,r){uc(this,n,e,t,r)},Ne.prototype.N=function(){if(Ne.$.N.call(this),this.i){var e,n=this.i;for(e in n.g){for(var t=n.g[e],r=0;r<t.length;r++)$t(t[r]);delete n.g[e],n.h--}}this.J=null},Ne.prototype.O=function(n,e,t,r){return this.i.add(String(n),e,!1,t,r)},Ne.prototype.P=function(n,e,t,r){return this.i.add(String(n),e,!0,t,r)};var ci=Q.JSON.stringify;function ra(){var n=un;let e=null;return n.g&&(e=n.g,n.g=n.g.next,n.g||(n.h=null),e.next=null),e}var cc=new class dh{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}(()=>new lc,n=>n.reset());class lc{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}function hc(n){var e=1;n=n.split(":");const t=[];for(;0<e&&n.length;)t.push(n.shift()),e--;return n.length&&t.push(n.join(":")),t}function ph(n){Q.setTimeout(()=>{throw n},0)}let gr,li=!1,un=new class fh{constructor(){this.h=this.g=null}add(e,t){const r=cc.get();r.set(e,t),this.h?this.h.next=r:this.g=r,this.h=r}},ia=()=>{const n=Q.Promise.resolve(void 0);gr=()=>{n.then(sa)}};var sa=()=>{for(var n;n=ra();){try{n.h.call(n.g)}catch(t){ph(t)}var e=cc;e.j(n),100>e.h&&(e.h++,n.next=e.g,e.g=n)}li=!1};function hi(n,e){Ne.call(this),this.h=n||1,this.g=e||Q,this.j=Ue(this.qb,this),this.l=Date.now()}function di(n){n.ga=!1,n.T&&(n.g.clearTimeout(n.T),n.T=null)}function oa(n,e,t){if("function"==typeof n)t&&(n=Ue(n,t));else{if(!n||"function"!=typeof n.handleEvent)throw Error("Invalid listener argument");n=Ue(n.handleEvent,n)}return 2147483647<Number(e)?-1:Q.setTimeout(n,e||0)}function Is(n){n.g=oa(()=>{n.g=null,n.i&&(n.i=!1,Is(n))},n.j);const e=n.h;n.h=null,n.m.apply(null,e)}Se(hi,Ne),(F=hi.prototype).ga=!1,F.T=null,F.qb=function(){if(this.ga){var n=Date.now()-this.l;0<n&&n<.8*this.h?this.T=this.g.setTimeout(this.j,this.h-n):(this.T&&(this.g.clearTimeout(this.T),this.T=null),Ve(this,"tick"),this.ga&&(di(this),this.start()))}},F.start=function(){this.ga=!0,this.T||(this.T=this.g.setTimeout(this.j,this.h),this.l=Date.now())},F.N=function(){hi.$.N.call(this),di(this),delete this.g};class mh extends nn{constructor(e,t){super(),this.m=e,this.j=t,this.h=null,this.i=!1,this.g=null}l(e){this.h=arguments,this.g?this.i=!0:Is(this)}N(){super.N(),this.g&&(Q.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Dn(n){nn.call(this),this.h=n,this.g={}}Se(Dn,nn);var fi=[];function vs(n,e,t,r){Array.isArray(t)||(t&&(fi[0]=t.toString()),t=fi);for(var i=0;i<t.length;i++){var s=oc(e,t[i],r||n.handleEvent,!1,n.h||n);if(!s)break;n.g[s.key]=s}}function dc(n){$o(n.g,function(e,t){this.g.hasOwnProperty(t)&&ui(e)},n),n.g={}}function _r(){this.g=!0}function yr(n,e,t,r){n.info(function(){return"XMLHTTP TEXT ("+e+"): "+function _h(n,e){if(!n.g)return e;if(!e)return null;try{var t=JSON.parse(e);if(t)for(n=0;n<t.length;n++)if(Array.isArray(t[n])){var r=t[n];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var s=i[0];if("noop"!=s&&"stop"!=s&&"close"!=s)for(var a=1;a<i.length;a++)i[a]=""}}}return ci(t)}catch{return e}}(n,t)+(r?" "+r:"")})}Dn.prototype.N=function(){Dn.$.N.call(this),dc(this)},Dn.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},_r.prototype.Ea=function(){this.g=!1},_r.prototype.info=function(){};var Ht={},fc=null;function Ir(){return fc=fc||new Ne}function pc(n){ze.call(this,Ht.Ta,n)}function On(n){const e=Ir();Ve(e,new pc(e))}function vr(n,e){ze.call(this,Ht.STAT_EVENT,n),this.stat=e}function ve(n){const e=Ir();Ve(e,new vr(e,n))}function Ts(n,e){ze.call(this,Ht.Ua,n),this.size=e}function pi(n,e){if("function"!=typeof n)throw Error("Fn must not be null and must be a function");return Q.setTimeout(function(){n()},e)}Ht.Ta="serverreachability",Se(pc,ze),Ht.STAT_EVENT="statevent",Se(vr,ze),Ht.Ua="timingevent",Se(Ts,ze);var rt={NO_ERROR:0,rb:1,Eb:2,Db:3,yb:4,Cb:5,Fb:6,Qa:7,TIMEOUT:8,Ib:9},mc={wb:"complete",Sb:"success",Ra:"error",Qa:"abort",Kb:"ready",Lb:"readystatechange",TIMEOUT:"timeout",Gb:"incrementaldata",Jb:"progress",zb:"downloadprogress",$b:"uploadprogress"};function mi(){}function Es(){}mi.prototype.h=null;var la,gi={OPEN:"a",vb:"b",Ra:"c",Hb:"d"};function _i(){ze.call(this,"d")}function ca(){ze.call(this,"c")}function Tr(){}function Tt(n,e,t,r){this.l=n,this.j=e,this.m=t,this.W=r||1,this.U=new Dn(this),this.P=yh,this.V=new hi(n=St?125:void 0),this.I=null,this.i=!1,this.s=this.A=this.v=this.L=this.G=this.Y=this.B=null,this.F=[],this.g=null,this.C=0,this.o=this.u=null,this.ca=-1,this.J=!1,this.O=0,this.M=null,this.ba=this.K=this.aa=this.S=!1,this.h=new _c}function _c(){this.i=null,this.g="",this.h=!1}Se(_i,ze),Se(ca,ze),Se(Tr,mi),Tr.prototype.g=function(){return new XMLHttpRequest},Tr.prototype.i=function(){return{}},la=new Tr;var yh=45e3,Mn={},ha={};function yi(n,e,t){n.L=1,n.v=wr(Et(e)),n.s=t,n.S=!0,Ct(n,null)}function Ct(n,e){n.G=Date.now(),Er(n),n.A=Et(n.v);var t=n.A,r=n.W;Array.isArray(r)||(r=[String(r)]),_a(t.i,"t",r),n.C=0,t=n.l.J,n.h=new _c,n.g=Dc(n.l,t?e:null,!n.s),0<n.O&&(n.M=new mh(Ue(n.Pa,n,n.g),n.O)),vs(n.U,n.g,"readystatechange",n.nb),e=n.I?ic(n.I):{},n.s?(n.u||(n.u="POST"),e["Content-Type"]="application/x-www-form-urlencoded",n.g.ha(n.A,n.u,n.s,e)):(n.u="GET",n.g.ha(n.A,n.u,null,e)),On(),function gh(n,e,t,r,i,s){n.info(function(){if(n.g)if(s)for(var a="",h=s.split("&"),d=0;d<h.length;d++){var m=h[d].split("=");if(1<m.length){var g=m[0];m=m[1];var y=g.split("_");a=2<=y.length&&"type"==y[1]?a+(g+"=")+m+"&":a+(g+"=redacted&")}}else a=null;else a=s;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+e+"\n"+t+"\n"+a})}(n.j,n.u,n.A,n.m,n.W,n.s)}function Ln(n){return!!n.g&&"GET"==n.u&&2!=n.L&&n.l.Ha}function Fn(n,e,t){let i,r=!0;for(;!n.J&&n.C<t.length;){if(i=yc(n,t),i==ha){4==e&&(n.o=4,ve(14),r=!1),yr(n.j,n.m,null,"[Incomplete Response]");break}if(i==Mn){n.o=4,ve(15),yr(n.j,n.m,t,"[Invalid Chunk]"),r=!1;break}yr(n.j,n.m,i,null),Ar(n,i)}Ln(n)&&i!=ha&&i!=Mn&&(n.h.g="",n.C=0),4!=e||0!=t.length||n.h.h||(n.o=1,ve(16),r=!1),n.i=n.i&&r,r?0<t.length&&!n.ba&&(n.ba=!0,(e=n.l).g==n&&e.ca&&!e.M&&(e.l.info("Great, no buffering proxy detected. Bytes received: "+t.length),Ca(e),e.M=!0,ve(11))):(yr(n.j,n.m,t,"[Invalid Chunked Response]"),Un(n),bt(n))}function yc(n,e){var t=n.C,r=e.indexOf("\n",t);return-1==r?ha:(t=Number(e.substring(t,r)),isNaN(t)?Mn:(r+=1)+t>e.length?ha:(e=e.slice(r,r+t),n.C=r+t,e))}function Er(n){n.Y=Date.now()+n.P,da(n,n.P)}function da(n,e){if(null!=n.B)throw Error("WatchDog timer not null");n.B=pi(Ue(n.lb,n),e)}function As(n){n.B&&(Q.clearTimeout(n.B),n.B=null)}function bt(n){0==n.l.H||n.J||Ph(n.l,n)}function Un(n){As(n);var e=n.M;e&&"function"==typeof e.sa&&e.sa(),n.M=null,di(n.V),dc(n.U),n.g&&(e=n.g,n.g=null,e.abort(),e.sa())}function Ar(n,e){try{var t=n.l;if(0!=t.H&&(t.g==n||vi(t.i,n)))if(!n.K&&vi(t.i,n)&&3==t.H){try{var r=t.Ja.g.parse(e)}catch{r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0]){e:if(!t.u){if(t.g){if(!(t.g.G+3e3<n.G))break e;Us(t),Fs(t)}Sa(t),ve(18)}}else t.Fa=i[1],0<t.Fa-t.V&&37500>i[2]&&t.G&&0==t.A&&!t.v&&(t.v=pi(Ue(t.ib,t),6e3));if(1>=Cs(t.i)&&t.oa){try{t.oa()}catch{}t.oa=void 0}}else Sr(t,11)}else if((n.K||t.g==n)&&Us(t),!Nn(e))for(i=t.Ja.g.parse(e),e=0;e<i.length;e++){let m=i[e];if(t.V=m[0],m=m[1],2==t.H)if("c"==m[0]){t.K=m[1],t.pa=m[2];const g=m[3];null!=g&&(t.ra=g,t.l.info("VER="+t.ra));const y=m[4];null!=y&&(t.Ga=y,t.l.info("SVER="+t.Ga));const T=m[5];null!=T&&"number"==typeof T&&0<T&&(t.L=r=1.5*T,t.l.info("backChannelRequestTimeoutMs_="+r)),r=t;const w=n.g;if(w){const k=w.g?w.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(k){var s=r.i;s.g||-1==k.indexOf("spdy")&&-1==k.indexOf("quic")&&-1==k.indexOf("h2")||(s.j=s.l,s.g=new Set,s.h&&(Rr(s,s.h),s.h=null))}if(r.F){const D=w.g?w.g.getResponseHeader("X-HTTP-Session-Id"):null;D&&(r.Da=D,fe(r.I,r.F,D))}}t.H=3,t.h&&t.h.Ba(),t.ca&&(t.S=Date.now()-n.G,t.l.info("Handshake RTT: "+t.S+"ms"));var a=n;if((r=t).wa=Vc(r,r.J?r.pa:null,r.Y),a.K){bs(r.i,a);var h=a,d=r.L;d&&h.setTimeout(d),h.B&&(As(h),Er(h)),r.g=a}else kc(r);0<t.j.length&&Pi(t)}else"stop"!=m[0]&&"close"!=m[0]||Sr(t,7);else 3==t.H&&("stop"==m[0]||"close"==m[0]?"stop"==m[0]?Sr(t,7):wi(t):"noop"!=m[0]&&t.h&&t.h.Aa(m),t.A=0)}On()}catch{}}function ws(n,e){if(n.forEach&&"function"==typeof n.forEach)n.forEach(e,void 0);else if(ps(n)||"string"==typeof n)Array.prototype.forEach.call(n,e,void 0);else for(var t=function vc(n){if(n.ta&&"function"==typeof n.ta)return n.ta();if(!n.Z||"function"!=typeof n.Z){if(typeof Map<"u"&&n instanceof Map)return Array.from(n.keys());if(!(typeof Set<"u"&&n instanceof Set)){if(ps(n)||"string"==typeof n){var e=[];n=n.length;for(var t=0;t<n;t++)e.push(t);return e}e=[],t=0;for(const r in n)e[t++]=r;return e}}}(n),r=function Ic(n){if(n.Z&&"function"==typeof n.Z)return n.Z();if(typeof Map<"u"&&n instanceof Map||typeof Set<"u"&&n instanceof Set)return Array.from(n.values());if("string"==typeof n)return n.split("");if(ps(n)){for(var e=[],t=n.length,r=0;r<t;r++)e.push(n[r]);return e}for(r in e=[],t=0,n)e[t++]=n[r];return e}(n),i=r.length,s=0;s<i;s++)e.call(void 0,r[s],t&&t[s],n)}(F=Tt.prototype).setTimeout=function(n){this.P=n},F.nb=function(n){n=n.target;const e=this.M;e&&3==kt(n)?e.l():this.Pa(n)},F.Pa=function(n){try{if(n==this.g)e:{const g=kt(this.g);var e=this.g.Ia();if(this.g.da(),!(3>g)&&(3!=g||St||this.g&&(this.h.h||this.g.ja()||Ms(this.g)))){this.J||4!=g||7==e||On(),As(this);var t=this.g.da();this.ca=t;t:if(Ln(this)){var r=Ms(this.g);n="";var i=r.length,s=4==kt(this.g);if(!this.h.i){if(typeof TextDecoder>"u"){Un(this),bt(this);var a="";break t}this.h.i=new Q.TextDecoder}for(e=0;e<i;e++)this.h.h=!0,n+=this.h.i.decode(r[e],{stream:s&&e==i-1});r.splice(0,i),this.h.g+=n,this.C=0,a=this.h.g}else a=this.g.ja();if(this.i=200==t,function aa(n,e,t,r,i,s,a){n.info(function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+e+"\n"+t+"\n"+s+" "+a})}(this.j,this.u,this.A,this.m,this.W,g,t),this.i){if(this.aa&&!this.K){t:{if(this.g){var h,d=this.g;if((h=d.g?d.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!Nn(h)){var m=h;break t}}m=null}if(!(t=m)){this.i=!1,this.o=3,ve(12),Un(this),bt(this);break e}yr(this.j,this.m,t,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Ar(this,t)}this.S?(Fn(this,g,a),St&&this.i&&3==g&&(vs(this.U,this.V,"tick",this.mb),this.V.start())):(yr(this.j,this.m,a,null),Ar(this,a)),4==g&&Un(this),this.i&&!this.J&&(4==g?Ph(this.l,this):(this.i=!1,Er(this)))}else(function wh(n){const e={};n=(n.g&&2<=kt(n)&&n.g.getAllResponseHeaders()||"").split("\r\n");for(let r=0;r<n.length;r++){if(Nn(n[r]))continue;var t=hc(n[r]);const i=t[0];if("string"!=typeof(t=t[1]))continue;t=t.trim();const s=e[i]||[];e[i]=s,s.push(t)}!function lh(n,e){for(const t in n)e.call(void 0,n[t],t,n)}(e,function(r){return r.join(", ")})})(this.g),400==t&&0<a.indexOf("Unknown SID")?(this.o=3,ve(12)):(this.o=0,ve(13)),Un(this),bt(this)}}}catch{}},F.mb=function(){if(this.g){var n=kt(this.g),e=this.g.ja();this.C<e.length&&(As(this),Fn(this,n,e),this.i&&4!=n&&Er(this))}},F.cancel=function(){this.J=!0,Un(this)},F.lb=function(){this.B=null;const n=Date.now();0<=n-this.Y?(function ua(n,e){n.info(function(){return"TIMEOUT: "+e})}(this.j,this.A),2!=this.L&&(On(),ve(17)),Un(this),this.o=2,bt(this)):da(this,this.Y-n)};var it=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function qn(n){if(this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,n instanceof qn){this.h=n.h,Bn(this,n.j),this.s=n.s,this.g=n.g,Ii(this,n.m),this.l=n.l;var e=n.i,t=new cn;t.i=e.i,e.g&&(t.g=new Map(e.g),t.h=e.h),fa(this,t),this.o=n.o}else n&&(e=String(n).match(it))?(this.h=!1,Bn(this,e[1]||"",!0),this.s=Zn(e[2]||""),this.g=Zn(e[3]||"",!0),Ii(this,e[4]),this.l=Zn(e[5]||"",!0),fa(this,e[6]||"",!0),this.o=Zn(e[7]||"")):(this.h=!1,this.i=new cn(null,this.h))}function Et(n){return new qn(n)}function Bn(n,e,t){n.j=t?Zn(e,!0):e,n.j&&(n.j=n.j.replace(/:$/,""))}function Ii(n,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);n.m=e}else n.m=null}function fa(n,e,t){e instanceof cn?(n.i=e,function Ih(n,e){e&&!n.j&&(xt(n),n.i=null,n.g.forEach(function(t,r){var i=r.toLowerCase();r!=i&&(ga(this,r),_a(this,i,t))},n)),n.j=e}(n.i,n.h)):(t||(e=Gn(e,Ac)),n.i=new cn(e,n.h))}function fe(n,e,t){n.i.set(e,t)}function wr(n){return fe(n,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),n}function Zn(n,e){return n?e?decodeURI(n.replace(/%25/g,"%2525")):decodeURIComponent(n):""}function Gn(n,e,t){return"string"==typeof n?(n=encodeURI(n).replace(e,Ps),t&&(n=n.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),n):null}function Ps(n){return"%"+((n=n.charCodeAt(0))>>4&15).toString(16)+(15&n).toString(16)}qn.prototype.toString=function(){var n=[],e=this.j;e&&n.push(Gn(e,Rs,!0),":");var t=this.g;return(t||"file"==e)&&(n.push("//"),(e=this.s)&&n.push(Gn(e,Rs,!0),"@"),n.push(encodeURIComponent(String(t)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(t=this.m)&&n.push(":",String(t))),(t=this.l)&&(this.g&&"/"!=t.charAt(0)&&n.push("/"),n.push(Gn(t,"/"==t.charAt(0)?pa:Ec,!0))),(t=this.i.toString())&&n.push("?",t),(t=this.o)&&n.push("#",Gn(t,ma)),n.join("")};var Rs=/[#\/\?@]/g,Ec=/[#\?:]/g,pa=/[#\?]/g,Ac=/[#\?@]/g,ma=/#/g;function cn(n,e){this.h=this.g=null,this.i=n||null,this.j=!!e}function xt(n){n.g||(n.g=new Map,n.h=0,n.i&&function Tc(n,e){if(n){n=n.split("&");for(var t=0;t<n.length;t++){var r=n[t].indexOf("="),i=null;if(0<=r){var s=n[t].substring(0,r);i=n[t].substring(r+1)}else s=n[t];e(s,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(n.i,function(e,t){n.add(decodeURIComponent(e.replace(/\+/g," ")),t)}))}function ga(n,e){xt(n),e=ln(n,e),n.g.has(e)&&(n.i=null,n.h-=n.g.get(e).length,n.g.delete(e))}function Ss(n,e){return xt(n),e=ln(n,e),n.g.has(e)}function _a(n,e,t){ga(n,e),0<t.length&&(n.i=null,n.g.set(ln(n,e),zo(t)),n.h+=t.length)}function ln(n,e){return e=String(e),n.j&&(e=e.toLowerCase()),e}function wc(n){this.l=n||Ia,n=Q.PerformanceNavigationTiming?0<(n=Q.performance.getEntriesByType("navigation")).length&&("hq"==n[0].nextHopProtocol||"h2"==n[0].nextHopProtocol):!!(Q.g&&Q.g.Ka&&Q.g.Ka()&&Q.g.Ka().dc),this.j=n?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}(F=cn.prototype).add=function(n,e){xt(this),this.i=null,n=ln(this,n);var t=this.g.get(n);return t||this.g.set(n,t=[]),t.push(e),this.h+=1,this},F.forEach=function(n,e){xt(this),this.g.forEach(function(t,r){t.forEach(function(i){n.call(e,i,r,this)},this)},this)},F.ta=function(){xt(this);const n=Array.from(this.g.values()),e=Array.from(this.g.keys()),t=[];for(let r=0;r<e.length;r++){const i=n[r];for(let s=0;s<i.length;s++)t.push(e[r])}return t},F.Z=function(n){xt(this);let e=[];if("string"==typeof n)Ss(this,n)&&(e=e.concat(this.g.get(ln(this,n))));else{n=Array.from(this.g.values());for(let t=0;t<n.length;t++)e=e.concat(n[t])}return e},F.set=function(n,e){return xt(this),this.i=null,Ss(this,n=ln(this,n))&&(this.h-=this.g.get(n).length),this.g.set(n,[e]),this.h+=1,this},F.get=function(n,e){return n&&0<(n=this.Z(n)).length?String(n[0]):e},F.toString=function(){if(this.i)return this.i;if(!this.g)return"";const n=[],e=Array.from(this.g.keys());for(var t=0;t<e.length;t++){var r=e[t];const s=encodeURIComponent(String(r)),a=this.Z(r);for(r=0;r<a.length;r++){var i=s;""!==a[r]&&(i+="="+encodeURIComponent(String(a[r]))),n.push(i)}}return this.i=n.join("&")};var Ia=10;function Pr(n){return!!n.h||!!n.g&&n.g.size>=n.j}function Cs(n){return n.h?1:n.g?n.g.size:0}function vi(n,e){return n.h?n.h==e:!!n.g&&n.g.has(e)}function Rr(n,e){n.g?n.g.add(e):n.h=e}function bs(n,e){n.h&&n.h==e?n.h=null:n.g&&n.g.has(e)&&n.g.delete(e)}function xs(n){if(null!=n.h)return n.i.concat(n.h.F);if(null!=n.g&&0!==n.g.size){let e=n.i;for(const t of n.g.values())e=e.concat(t.F);return e}return zo(n.i)}wc.prototype.cancel=function(){if(this.i=xs(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const n of this.g.values())n.cancel();this.g.clear()}};var vh=class{stringify(n){return Q.JSON.stringify(n,void 0)}parse(n){return Q.JSON.parse(n,void 0)}};function va(){this.g=new vh}function Th(n,e,t){const r=t||"";try{ws(n,function(i,s){let a=i;kn(i)&&(a=ci(i)),e.push(r+s+"="+encodeURIComponent(a))})}catch(i){throw e.push(r+"type="+encodeURIComponent("_badmap")),i}}function ks(n,e,t,r,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(r)}catch{}}function zn(n){this.l=n.ec||null,this.j=n.ob||!1}function Ti(n,e){Ne.call(this),this.F=n,this.u=e,this.m=void 0,this.readyState=Ei,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}Se(zn,mi),zn.prototype.g=function(){return new Ti(this.l,this.j)},zn.prototype.i=function(n){return function(){return n}}({}),Se(Ti,Ne);var Ei=0;function Pc(n){n.j.read().then(n.Xa.bind(n)).catch(n.ka.bind(n))}function Wn(n){n.readyState=4,n.l=null,n.j=null,n.A=null,Ai(n)}function Ai(n){n.onreadystatechange&&n.onreadystatechange.call(n)}(F=Ti.prototype).open=function(n,e){if(this.readyState!=Ei)throw this.abort(),Error("Error reopening a connection");this.C=n,this.B=e,this.readyState=1,Ai(this)},F.send=function(n){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const e={headers:this.v,method:this.C,credentials:this.m,cache:void 0};n&&(e.body=n),(this.F||Q).fetch(new Request(this.B,e)).then(this.$a.bind(this),this.ka.bind(this))},F.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,Wn(this)),this.readyState=Ei},F.$a=function(n){if(this.g&&(this.l=n,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=n.headers,this.readyState=2,Ai(this)),this.g&&(this.readyState=3,Ai(this),this.g)))if("arraybuffer"===this.responseType)n.arrayBuffer().then(this.Ya.bind(this),this.ka.bind(this));else if(typeof Q.ReadableStream<"u"&&"body"in n){if(this.j=n.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;Pc(this)}else n.text().then(this.Za.bind(this),this.ka.bind(this))},F.Xa=function(n){if(this.g){if(this.u&&n.value)this.response.push(n.value);else if(!this.u){var e=n.value?n.value:new Uint8Array(0);(e=this.A.decode(e,{stream:!n.done}))&&(this.response=this.responseText+=e)}n.done?Wn(this):Ai(this),3==this.readyState&&Pc(this)}},F.Za=function(n){this.g&&(this.response=this.responseText=n,Wn(this))},F.Ya=function(n){this.g&&(this.response=n,Wn(this))},F.ka=function(){this.g&&Wn(this)},F.setRequestHeader=function(n,e){this.v.append(n,e)},F.getResponseHeader=function(n){return this.h&&this.h.get(n.toLowerCase())||""},F.getAllResponseHeaders=function(){if(!this.h)return"";const n=[],e=this.h.entries();for(var t=e.next();!t.done;)n.push((t=t.value)[0]+": "+t[1]),t=e.next();return n.join("\r\n")},Object.defineProperty(Ti.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(n){this.m=n?"include":"same-origin"}});var Ea=Q.JSON.parse;function Ee(n){Ne.call(this),this.headers=new Map,this.u=n||null,this.h=!1,this.C=this.g=null,this.I="",this.m=0,this.j="",this.l=this.G=this.v=this.F=!1,this.B=0,this.A=null,this.K=Rc,this.L=this.M=!1}Se(Ee,Ne);var Rc="",Aa=/^https?$/i,Eh=["POST","PUT"];function Ns(n,e){n.h=!1,n.g&&(n.l=!0,n.g.abort(),n.l=!1),n.j=e,n.m=5,Sc(n),Ds(n)}function Sc(n){n.F||(n.F=!0,Ve(n,"complete"),Ve(n,"error"))}function Vs(n){if(n.h&&typeof Go<"u"&&(!n.C[1]||4!=kt(n)||2!=n.da()))if(n.v&&4==kt(n))oa(n.La,0,n);else if(Ve(n,"readystatechange"),4==kt(n)){n.h=!1;try{const a=n.da();e:switch(a){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var e=!0;break e;default:e=!1}var t;if(!(t=e)){var r;if(r=0===a){var i=String(n.I).match(it)[1]||null;!i&&Q.self&&Q.self.location&&(i=Q.self.location.protocol.slice(0,-1)),r=!Aa.test(i?i.toLowerCase():"")}t=r}if(t)Ve(n,"complete"),Ve(n,"success");else{n.m=6;try{var s=2<kt(n)?n.g.statusText:""}catch{s=""}n.j=s+" ["+n.da()+"]",Sc(n)}}finally{Ds(n)}}}function Ds(n,e){if(n.g){Os(n);const t=n.g,r=n.C[0]?()=>{}:null;n.g=null,n.C=null,e||Ve(n,"ready");try{t.onreadystatechange=r}catch{}}}function Os(n){n.g&&n.L&&(n.g.ontimeout=null),n.A&&(Q.clearTimeout(n.A),n.A=null)}function kt(n){return n.g?n.g.readyState:0}function Ms(n){try{if(!n.g)return null;if("response"in n.g)return n.g.response;switch(n.K){case Rc:case"text":return n.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in n.g)return n.g.mozResponseArrayBuffer}return null}catch{return null}}function Ls(n){let e="";return $o(n,function(t,r){e+=r,e+=":",e+=t,e+="\r\n"}),e}function wa(n,e,t){e:{for(r in t){var r=!1;break e}r=!0}r||(t=Ls(t),"string"==typeof n?null!=t&&encodeURIComponent(String(t)):fe(n,e,t))}function Kn(n,e,t){return t&&t.internalChannelParams&&t.internalChannelParams[n]||e}function Cc(n){this.Ga=0,this.j=[],this.l=new _r,this.pa=this.wa=this.I=this.Y=this.g=this.Da=this.F=this.na=this.o=this.U=this.s=null,this.fb=this.W=0,this.cb=Kn("failFast",!1,n),this.G=this.v=this.u=this.m=this.h=null,this.aa=!0,this.Fa=this.V=-1,this.ba=this.A=this.C=0,this.ab=Kn("baseRetryDelayMs",5e3,n),this.hb=Kn("retryDelaySeedMs",1e4,n),this.eb=Kn("forwardChannelMaxRetries",2,n),this.xa=Kn("forwardChannelRequestTimeoutMs",2e4,n),this.va=n&&n.xmlHttpFactory||void 0,this.Ha=n&&n.useFetchStreams||!1,this.L=void 0,this.J=n&&n.supportsCrossDomainXhr||!1,this.K="",this.i=new wc(n&&n.concurrentRequestLimit),this.Ja=new va,this.P=n&&n.fastHandshake||!1,this.O=n&&n.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.bb=n&&n.bc||!1,n&&n.Ea&&this.l.Ea(),n&&n.forceLongPolling&&(this.aa=!1),this.ca=!this.P&&this.aa&&n&&n.detectBufferingProxy||!1,this.qa=void 0,n&&n.longPollingTimeout&&0<n.longPollingTimeout&&(this.qa=n.longPollingTimeout),this.oa=void 0,this.S=0,this.M=!1,this.ma=this.B=null}function wi(n){if(bc(n),3==n.H){var e=n.W++,t=Et(n.I);if(fe(t,"SID",n.K),fe(t,"RID",e),fe(t,"TYPE","terminate"),Nt(n,t),(e=new Tt(n,n.l,e)).L=2,e.v=wr(Et(t)),t=!1,Q.navigator&&Q.navigator.sendBeacon)try{t=Q.navigator.sendBeacon(e.v.toString(),"")}catch{}!t&&Q.Image&&((new Image).src=e.v,t=!0),t||(e.g=Dc(e.l,null),e.g.ha(e.v)),e.G=Date.now(),Er(e)}qs(n)}function Fs(n){n.g&&(Ca(n),n.g.cancel(),n.g=null)}function bc(n){Fs(n),n.u&&(Q.clearTimeout(n.u),n.u=null),Us(n),n.i.cancel(),n.m&&("number"==typeof n.m&&Q.clearTimeout(n.m),n.m=null)}function Pi(n){if(!Pr(n.i)&&!n.m){n.m=!0;var e=n.Na;gr||ia(),li||(gr(),li=!0),un.add(e,n),n.C=0}}function xc(n,e){var t;t=e?e.m:n.W++;const r=Et(n.I);fe(r,"SID",n.K),fe(r,"RID",t),fe(r,"AID",n.V),Nt(n,r),n.o&&n.s&&wa(r,n.o,n.s),t=new Tt(n,n.l,t,n.C+1),null===n.o&&(t.I=n.s),e&&(n.j=e.F.concat(n.j)),e=Ra(n,t,1e3),t.setTimeout(Math.round(.5*n.xa)+Math.round(.5*n.xa*Math.random())),Rr(n.i,t),yi(t,r,e)}function Nt(n,e){n.na&&$o(n.na,function(t,r){fe(e,r,t)}),n.h&&ws({},function(t,r){fe(e,r,t)})}function Ra(n,e,t){t=Math.min(n.j.length,t);var r=n.h?Ue(n.h.Va,n.h,n):null;e:{var i=n.j;let s=-1;for(;;){const a=["count="+t];-1==s?0<t?(s=i[0].g,a.push("ofs="+s)):s=0:a.push("ofs="+s);let h=!0;for(let d=0;d<t;d++){let m=i[d].g;const g=i[d].map;if(m-=s,0>m)s=Math.max(0,i[d].g-100),h=!1;else try{Th(g,a,"req"+m+"_")}catch{r&&r(g)}}if(h){r=a.join("&");break e}}}return n=n.j.splice(0,t),e.F=n,r}function kc(n){if(!n.g&&!n.u){n.ba=1;var e=n.Ma;gr||ia(),li||(gr(),li=!0),un.add(e,n),n.A=0}}function Sa(n){return!(n.g||n.u||3<=n.A||(n.ba++,n.u=pi(Ue(n.Ma,n),Rh(n,n.A)),n.A++,0))}function Ca(n){null!=n.B&&(Q.clearTimeout(n.B),n.B=null)}function Nc(n){n.g=new Tt(n,n.l,"rpc",n.ba),null===n.o&&(n.g.I=n.s),n.g.O=0;var e=Et(n.wa);fe(e,"RID","rpc"),fe(e,"SID",n.K),fe(e,"AID",n.V),fe(e,"CI",n.G?"0":"1"),!n.G&&n.qa&&fe(e,"TO",n.qa),fe(e,"TYPE","xmlhttp"),Nt(n,e),n.o&&n.s&&wa(e,n.o,n.s),n.L&&n.g.setTimeout(n.L);var t=n.g;n=n.pa,t.L=1,t.v=wr(Et(e)),t.s=null,t.S=!0,Ct(t,n)}function Us(n){null!=n.v&&(Q.clearTimeout(n.v),n.v=null)}function Ph(n,e){var t=null;if(n.g==e){Us(n),Ca(n),n.g=null;var r=2}else{if(!vi(n.i,e))return;t=e.F,bs(n.i,e),r=1}if(0!=n.H)if(e.i)if(1==r){t=e.s?e.s.length:0,e=Date.now()-e.G;var i=n.C;Ve(r=Ir(),new Ts(r,t)),Pi(n)}else kc(n);else if(3==(i=e.o)||0==i&&0<e.ca||!(1==r&&function Pa(n,e){return!(Cs(n.i)>=n.i.j-(n.m?1:0)||(n.m?(n.j=e.F.concat(n.j),0):1==n.H||2==n.H||n.C>=(n.cb?0:n.eb)||(n.m=pi(Ue(n.Na,n,e),Rh(n,n.C)),n.C++,0)))}(n,e)||2==r&&Sa(n)))switch(t&&0<t.length&&(e=n.i,e.i=e.i.concat(t)),i){case 1:Sr(n,5);break;case 4:Sr(n,10);break;case 3:Sr(n,6);break;default:Sr(n,2)}}function Rh(n,e){let t=n.ab+Math.floor(Math.random()*n.hb);return n.isActive()||(t*=2),t*e}function Sr(n,e){if(n.l.info("Error code "+e),2==e){var t=null;n.h&&(t=null);var r=Ue(n.pb,n);t||(t=new qn("//www.google.com/images/cleardot.gif"),Q.location&&"http"==Q.location.protocol||Bn(t,"https"),wr(t)),function Ta(n,e){const t=new _r;if(Q.Image){const r=new Image;r.onload=fr(ks,t,r,"TestLoadImage: loaded",!0,e),r.onerror=fr(ks,t,r,"TestLoadImage: error",!1,e),r.onabort=fr(ks,t,r,"TestLoadImage: abort",!1,e),r.ontimeout=fr(ks,t,r,"TestLoadImage: timeout",!1,e),Q.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=n}else e(!1)}(t.toString(),r)}else ve(2);n.H=0,n.h&&n.h.za(e),qs(n),bc(n)}function qs(n){if(n.H=0,n.ma=[],n.h){const e=xs(n.i);(0!=e.length||0!=n.j.length)&&(Ju(n.ma,e),Ju(n.ma,n.j),n.i.i.length=0,zo(n.j),n.j.length=0),n.h.ya()}}function Vc(n,e,t){var r=t instanceof qn?Et(t):new qn(t);if(""!=r.g)e&&(r.g=e+"."+r.g),Ii(r,r.m);else{var i=Q.location;r=i.protocol,e=e?e+"."+i.hostname:i.hostname,i=+i.port;var s=new qn(null);r&&Bn(s,r),e&&(s.g=e),i&&Ii(s,i),t&&(s.l=t),r=s}return e=n.Da,(t=n.F)&&e&&fe(r,t,e),fe(r,"VER",n.ra),Nt(n,r),r}function Dc(n,e,t){if(e&&!n.J)throw Error("Can't create secondary domain capable XhrIo object.");return(e=new Ee(t&&n.Ha&&!n.va?new zn({ob:!0}):n.va)).Oa(n.J),e}function Sh(){}function ba(){if(rn&&!(10<=Number(jo)))throw Error("Environmental error: no available transport.")}function pt(n,e){Ne.call(this),this.g=new Cc(e),this.l=n,this.h=e&&e.messageUrlParams||null,n=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(n?n["X-Client-Protocol"]="webchannel":n={"X-Client-Protocol":"webchannel"}),this.g.s=n,n=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(n?n["X-WebChannel-Content-Type"]=e.messageContentType:n={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.Ca&&(n?n["X-WebChannel-Client-Profile"]=e.Ca:n={"X-WebChannel-Client-Profile":e.Ca}),this.g.U=n,(n=e&&e.cc)&&!Nn(n)&&(this.g.o=n),this.A=e&&e.supportsCrossDomainXhr||!1,this.v=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!Nn(e)&&(this.g.F=e,null!==(n=this.h)&&e in n&&e in(n=this.h)&&delete n[e]),this.j=new hn(this)}function Ch(n){_i.call(this),n.__headers__&&(this.headers=n.__headers__,this.statusCode=n.__status__,delete n.__headers__,delete n.__status__);var e=n.__sm__;if(e){e:{for(const t in e){n=t;break e}n=void 0}(this.i=n)&&(n=this.i,e=null!==e&&n in e?e[n]:void 0),this.data=e}else this.data=n}function bh(){ca.call(this),this.status=1}function hn(n){this.g=n}function st(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.m=Array(this.blockSize),this.i=this.h=0,this.reset()}function xa(n,e,t){t||(t=0);var r=Array(16);if("string"==typeof e)for(var i=0;16>i;++i)r[i]=e.charCodeAt(t++)|e.charCodeAt(t++)<<8|e.charCodeAt(t++)<<16|e.charCodeAt(t++)<<24;else for(i=0;16>i;++i)r[i]=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24;var s=n.g[3],a=(e=n.g[0])+(s^(t=n.g[1])&((i=n.g[2])^s))+r[0]+3614090360&4294967295;a=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=t+(a<<7&4294967295|a>>>25))+((a=s+(i^e&(t^i))+r[1]+3905402710&4294967295)<<12&4294967295|a>>>20))+((a=i+(t^s&(e^t))+r[2]+606105819&4294967295)<<17&4294967295|a>>>15))+((a=t+(e^i&(s^e))+r[3]+3250441966&4294967295)<<22&4294967295|a>>>10))+((a=e+(s^t&(i^s))+r[4]+4118548399&4294967295)<<7&4294967295|a>>>25))+((a=s+(i^e&(t^i))+r[5]+1200080426&4294967295)<<12&4294967295|a>>>20))+((a=i+(t^s&(e^t))+r[6]+2821735955&4294967295)<<17&4294967295|a>>>15))+((a=t+(e^i&(s^e))+r[7]+4249261313&4294967295)<<22&4294967295|a>>>10))+((a=e+(s^t&(i^s))+r[8]+1770035416&4294967295)<<7&4294967295|a>>>25))+((a=s+(i^e&(t^i))+r[9]+2336552879&4294967295)<<12&4294967295|a>>>20))+((a=i+(t^s&(e^t))+r[10]+4294925233&4294967295)<<17&4294967295|a>>>15))+((a=t+(e^i&(s^e))+r[11]+2304563134&4294967295)<<22&4294967295|a>>>10))+((a=e+(s^t&(i^s))+r[12]+1804603682&4294967295)<<7&4294967295|a>>>25))+((a=s+(i^e&(t^i))+r[13]+4254626195&4294967295)<<12&4294967295|a>>>20))+((a=i+(t^s&(e^t))+r[14]+2792965006&4294967295)<<17&4294967295|a>>>15))+((a=t+(e^i&(s^e))+r[15]+1236535329&4294967295)<<22&4294967295|a>>>10))+((a=e+(i^s&(t^i))+r[1]+4129170786&4294967295)<<5&4294967295|a>>>27))+((a=s+(t^i&(e^t))+r[6]+3225465664&4294967295)<<9&4294967295|a>>>23))+((a=i+(e^t&(s^e))+r[11]+643717713&4294967295)<<14&4294967295|a>>>18))+((a=t+(s^e&(i^s))+r[0]+3921069994&4294967295)<<20&4294967295|a>>>12))+((a=e+(i^s&(t^i))+r[5]+3593408605&4294967295)<<5&4294967295|a>>>27))+((a=s+(t^i&(e^t))+r[10]+38016083&4294967295)<<9&4294967295|a>>>23))+((a=i+(e^t&(s^e))+r[15]+3634488961&4294967295)<<14&4294967295|a>>>18))+((a=t+(s^e&(i^s))+r[4]+3889429448&4294967295)<<20&4294967295|a>>>12))+((a=e+(i^s&(t^i))+r[9]+568446438&4294967295)<<5&4294967295|a>>>27))+((a=s+(t^i&(e^t))+r[14]+3275163606&4294967295)<<9&4294967295|a>>>23))+((a=i+(e^t&(s^e))+r[3]+4107603335&4294967295)<<14&4294967295|a>>>18))+((a=t+(s^e&(i^s))+r[8]+1163531501&4294967295)<<20&4294967295|a>>>12))+((a=e+(i^s&(t^i))+r[13]+2850285829&4294967295)<<5&4294967295|a>>>27))+((a=s+(t^i&(e^t))+r[2]+4243563512&4294967295)<<9&4294967295|a>>>23))+((a=i+(e^t&(s^e))+r[7]+1735328473&4294967295)<<14&4294967295|a>>>18))+((a=t+(s^e&(i^s))+r[12]+2368359562&4294967295)<<20&4294967295|a>>>12))+((a=e+(t^i^s)+r[5]+4294588738&4294967295)<<4&4294967295|a>>>28))+((a=s+(e^t^i)+r[8]+2272392833&4294967295)<<11&4294967295|a>>>21))+((a=i+(s^e^t)+r[11]+1839030562&4294967295)<<16&4294967295|a>>>16))+((a=t+(i^s^e)+r[14]+4259657740&4294967295)<<23&4294967295|a>>>9))+((a=e+(t^i^s)+r[1]+2763975236&4294967295)<<4&4294967295|a>>>28))+((a=s+(e^t^i)+r[4]+1272893353&4294967295)<<11&4294967295|a>>>21))+((a=i+(s^e^t)+r[7]+4139469664&4294967295)<<16&4294967295|a>>>16))+((a=t+(i^s^e)+r[10]+3200236656&4294967295)<<23&4294967295|a>>>9))+((a=e+(t^i^s)+r[13]+681279174&4294967295)<<4&4294967295|a>>>28))+((a=s+(e^t^i)+r[0]+3936430074&4294967295)<<11&4294967295|a>>>21))+((a=i+(s^e^t)+r[3]+3572445317&4294967295)<<16&4294967295|a>>>16))+((a=t+(i^s^e)+r[6]+76029189&4294967295)<<23&4294967295|a>>>9))+((a=e+(t^i^s)+r[9]+3654602809&4294967295)<<4&4294967295|a>>>28))+((a=s+(e^t^i)+r[12]+3873151461&4294967295)<<11&4294967295|a>>>21))+((a=i+(s^e^t)+r[15]+530742520&4294967295)<<16&4294967295|a>>>16))+((a=t+(i^s^e)+r[2]+3299628645&4294967295)<<23&4294967295|a>>>9))+((a=e+(i^(t|~s))+r[0]+4096336452&4294967295)<<6&4294967295|a>>>26))+((a=s+(t^(e|~i))+r[7]+1126891415&4294967295)<<10&4294967295|a>>>22))+((a=i+(e^(s|~t))+r[14]+2878612391&4294967295)<<15&4294967295|a>>>17))+((a=t+(s^(i|~e))+r[5]+4237533241&4294967295)<<21&4294967295|a>>>11))+((a=e+(i^(t|~s))+r[12]+1700485571&4294967295)<<6&4294967295|a>>>26))+((a=s+(t^(e|~i))+r[3]+2399980690&4294967295)<<10&4294967295|a>>>22))+((a=i+(e^(s|~t))+r[10]+4293915773&4294967295)<<15&4294967295|a>>>17))+((a=t+(s^(i|~e))+r[1]+2240044497&4294967295)<<21&4294967295|a>>>11))+((a=e+(i^(t|~s))+r[8]+1873313359&4294967295)<<6&4294967295|a>>>26))+((a=s+(t^(e|~i))+r[15]+4264355552&4294967295)<<10&4294967295|a>>>22))+((a=i+(e^(s|~t))+r[6]+2734768916&4294967295)<<15&4294967295|a>>>17))+((a=t+(s^(i|~e))+r[13]+1309151649&4294967295)<<21&4294967295|a>>>11))+((s=(e=t+((a=e+(i^(t|~s))+r[4]+4149444226&4294967295)<<6&4294967295|a>>>26))+((a=s+(t^(e|~i))+r[11]+3174756917&4294967295)<<10&4294967295|a>>>22))^((i=s+((a=i+(e^(s|~t))+r[2]+718787259&4294967295)<<15&4294967295|a>>>17))|~e))+r[9]+3951481745&4294967295,n.g[0]=n.g[0]+e&4294967295,n.g[1]=n.g[1]+(i+(a<<21&4294967295|a>>>11))&4294967295,n.g[2]=n.g[2]+i&4294967295,n.g[3]=n.g[3]+s&4294967295}function ae(n,e){this.h=e;for(var t=[],r=!0,i=n.length-1;0<=i;i--){var s=0|n[i];r&&s==e||(t[i]=s,r=!1)}this.g=t}(F=Ee.prototype).Oa=function(n){this.M=n},F.ha=function(n,e,t,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.I+"; newUri="+n);e=e?e.toUpperCase():"GET",this.I=n,this.j="",this.m=0,this.F=!1,this.h=!0,this.g=this.u?this.u.g():la.g(),this.C=function gc(n){return n.h||(n.h=n.i())}(this.u?this.u:la),this.g.onreadystatechange=Ue(this.La,this);try{this.G=!0,this.g.open(e,String(n),!0),this.G=!1}catch(s){return void Ns(this,s)}if(n=t||"",t=new Map(this.headers),r)if(Object.getPrototypeOf(r)===Object.prototype)for(var i in r)t.set(i,r[i]);else{if("function"!=typeof r.keys||"function"!=typeof r.get)throw Error("Unknown input type for opt_headers: "+String(r));for(const s of r.keys())t.set(s,r.get(s))}r=Array.from(t.keys()).find(s=>"content-type"==s.toLowerCase()),i=Q.FormData&&n instanceof Q.FormData,!(0<=ms(Eh,e))||r||i||t.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[s,a]of t)this.g.setRequestHeader(s,a);this.K&&(this.g.responseType=this.K),"withCredentials"in this.g&&this.g.withCredentials!==this.M&&(this.g.withCredentials=this.M);try{Os(this),0<this.B&&((this.L=function Ah(n){return rn&&"number"==typeof n.timeout&&void 0!==n.ontimeout}(this.g))?(this.g.timeout=this.B,this.g.ontimeout=Ue(this.ua,this)):this.A=oa(this.ua,this.B,this)),this.v=!0,this.g.send(n),this.v=!1}catch(s){Ns(this,s)}},F.ua=function(){typeof Go<"u"&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,Ve(this,"timeout"),this.abort(8))},F.abort=function(n){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=n||7,Ve(this,"complete"),Ve(this,"abort"),Ds(this))},F.N=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),Ds(this,!0)),Ee.$.N.call(this)},F.La=function(){this.s||(this.G||this.v||this.l?Vs(this):this.kb())},F.kb=function(){Vs(this)},F.isActive=function(){return!!this.g},F.da=function(){try{return 2<kt(this)?this.g.status:-1}catch{return-1}},F.ja=function(){try{return this.g?this.g.responseText:""}catch{return""}},F.Wa=function(n){if(this.g){var e=this.g.responseText;return n&&0==e.indexOf(n)&&(e=e.substring(n.length)),Ea(e)}},F.Ia=function(){return this.m},F.Sa=function(){return"string"==typeof this.j?this.j:String(this.j)},(F=Cc.prototype).ra=8,F.H=1,F.Na=function(n){if(this.m)if(this.m=null,1==this.H){if(!n){this.W=Math.floor(1e5*Math.random()),n=this.W++;const i=new Tt(this,this.l,n);let s=this.s;if(this.U&&(s?(s=ic(s),sc(s,this.U)):s=this.U),null!==this.o||this.O||(i.I=s,s=null),this.P)e:{for(var e=0,t=0;t<this.j.length;t++){var r=this.j[t];if(void 0===(r="__data__"in r.map&&"string"==typeof(r=r.map.__data__)?r.length:void 0))break;if(4096<(e+=r)){e=t;break e}if(4096===e||t===this.j.length-1){e=t+1;break e}}e=1e3}else e=1e3;e=Ra(this,i,e),fe(t=Et(this.I),"RID",n),fe(t,"CVER",22),this.F&&fe(t,"X-HTTP-Session-Id",this.F),Nt(this,t),s&&(this.O?e="headers="+encodeURIComponent(String(Ls(s)))+"&"+e:this.o&&wa(t,this.o,s)),Rr(this.i,i),this.bb&&fe(t,"TYPE","init"),this.P?(fe(t,"$req",e),fe(t,"SID","null"),i.aa=!0,yi(i,t,null)):yi(i,t,e),this.H=2}}else 3==this.H&&(n?xc(this,n):0==this.j.length||Pr(this.i)||xc(this))},F.Ma=function(){if(this.u=null,Nc(this),this.ca&&!(this.M||null==this.g||0>=this.S)){var n=2*this.S;this.l.info("BP detection timer enabled: "+n),this.B=pi(Ue(this.jb,this),n)}},F.jb=function(){this.B&&(this.B=null,this.l.info("BP detection timeout reached."),this.l.info("Buffering proxy detected and switch to long-polling!"),this.G=!1,this.M=!0,ve(10),Fs(this),Nc(this))},F.ib=function(){null!=this.v&&(this.v=null,Fs(this),Sa(this),ve(19))},F.pb=function(n){n?(this.l.info("Successfully pinged google.com"),ve(2)):(this.l.info("Failed to ping google.com"),ve(1))},F.isActive=function(){return!!this.h&&this.h.isActive(this)},(F=Sh.prototype).Ba=function(){},F.Aa=function(){},F.za=function(){},F.ya=function(){},F.isActive=function(){return!0},F.Va=function(){},ba.prototype.g=function(n,e){return new pt(n,e)},Se(pt,Ne),pt.prototype.m=function(){this.g.h=this.j,this.A&&(this.g.J=!0);var n=this.g,e=this.l,t=this.h||void 0;ve(0),n.Y=e,n.na=t||{},n.G=n.aa,n.I=Vc(n,null,n.Y),Pi(n)},pt.prototype.close=function(){wi(this.g)},pt.prototype.u=function(n){var e=this.g;if("string"==typeof n){var t={};t.__data__=n,n=t}else this.v&&((t={}).__data__=ci(n),n=t);e.j.push(new class{constructor(n,e){this.g=n,this.map=e}}(e.fb++,n)),3==e.H&&Pi(e)},pt.prototype.N=function(){this.g.h=null,delete this.j,wi(this.g),delete this.g,pt.$.N.call(this)},Se(Ch,_i),Se(bh,ca),Se(hn,Sh),hn.prototype.Ba=function(){Ve(this.g,"a")},hn.prototype.Aa=function(n){Ve(this.g,new Ch(n))},hn.prototype.za=function(n){Ve(this.g,new bh)},hn.prototype.ya=function(){Ve(this.g,"b")},Se(st,function jn(){this.blockSize=-1}),st.prototype.reset=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.i=this.h=0},st.prototype.j=function(n,e){void 0===e&&(e=n.length);for(var t=e-this.blockSize,r=this.m,i=this.h,s=0;s<e;){if(0==i)for(;s<=t;)xa(this,n,s),s+=this.blockSize;if("string"==typeof n){for(;s<e;)if(r[i++]=n.charCodeAt(s++),i==this.blockSize){xa(this,r),i=0;break}}else for(;s<e;)if(r[i++]=n[s++],i==this.blockSize){xa(this,r),i=0;break}}this.h=i,this.i+=e},st.prototype.l=function(){var n=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);n[0]=128;for(var e=1;e<n.length-8;++e)n[e]=0;var t=8*this.i;for(e=n.length-8;e<n.length;++e)n[e]=255&t,t/=256;for(this.j(n),n=Array(16),e=t=0;4>e;++e)for(var r=0;32>r;r+=8)n[t++]=this.g[e]>>>r&255;return n};var xh={};function Oc(n){return-128<=n&&128>n?function uh(n,e){var t=xh;return Object.prototype.hasOwnProperty.call(t,n)?t[n]:t[n]=e(n)}(n,function(e){return new ae([0|e],0>e?-1:0)}):new ae([0|n],0>n?-1:0)}function Vt(n){if(isNaN(n)||!isFinite(n))return dn;if(0>n)return We(Vt(-n));for(var e=[],t=1,r=0;n>=t;r++)e[r]=n/t|0,t*=Ri;return new ae(e,0)}var Ri=4294967296,dn=Oc(0),ka=Oc(1),Si=Oc(16777216);function Dt(n){if(0!=n.h)return!1;for(var e=0;e<n.g.length;e++)if(0!=n.g[e])return!1;return!0}function mt(n){return-1==n.h}function We(n){for(var e=n.g.length,t=[],r=0;r<e;r++)t[r]=~n.g[r];return new ae(t,~n.h).add(ka)}function Bs(n,e){return n.add(We(e))}function Na(n,e){for(;(65535&n[e])!=n[e];)n[e+1]+=n[e]>>>16,n[e]&=65535,e++}function fn(n,e){this.g=n,this.h=e}function Va(n,e){if(Dt(e))throw Error("division by zero");if(Dt(n))return new fn(dn,dn);if(mt(n))return e=Va(We(n),e),new fn(We(e.g),We(e.h));if(mt(e))return e=Va(n,We(e)),new fn(We(e.g),e.h);if(30<n.g.length){if(mt(n)||mt(e))throw Error("slowDivide_ only works with positive integers.");for(var t=ka,r=e;0>=r.X(n);)t=Qt(t),r=Qt(r);var i=Cr(t,1),s=Cr(r,1);for(r=Cr(r,2),t=Cr(t,2);!Dt(r);){var a=s.add(r);0>=a.X(n)&&(i=i.add(t),s=a),r=Cr(r,1),t=Cr(t,1)}return e=Bs(n,i.R(e)),new fn(i,e)}for(i=dn;0<=n.X(e);){for(t=Math.max(1,Math.floor(n.ea()/e.ea())),r=48>=(r=Math.ceil(Math.log(t)/Math.LN2))?1:Math.pow(2,r-48),a=(s=Vt(t)).R(e);mt(a)||0<a.X(n);)a=(s=Vt(t-=r)).R(e);Dt(s)&&(s=ka),i=i.add(s),n=Bs(n,a)}return new fn(i,n)}function Qt(n){for(var e=n.g.length+1,t=[],r=0;r<e;r++)t[r]=n.D(r)<<1|n.D(r-1)>>>31;return new ae(t,n.h)}function Cr(n,e){var t=e>>5;e%=32;for(var r=n.g.length-t,i=[],s=0;s<r;s++)i[s]=0<e?n.D(s+t)>>>e|n.D(s+t+1)<<32-e:n.D(s+t);return new ae(i,n.h)}(F=ae.prototype).ea=function(){if(mt(this))return-We(this).ea();for(var n=0,e=1,t=0;t<this.g.length;t++){var r=this.D(t);n+=(0<=r?r:Ri+r)*e,e*=Ri}return n},F.toString=function(n){if(2>(n=n||10)||36<n)throw Error("radix out of range: "+n);if(Dt(this))return"0";if(mt(this))return"-"+We(this).toString(n);for(var e=Vt(Math.pow(n,6)),t=this,r="";;){var i=Va(t,e).g,s=((0<(t=Bs(t,i.R(e))).g.length?t.g[0]:t.h)>>>0).toString(n);if(Dt(t=i))return s+r;for(;6>s.length;)s="0"+s;r=s+r}},F.D=function(n){return 0>n?0:n<this.g.length?this.g[n]:this.h},F.X=function(n){return mt(n=Bs(this,n))?-1:Dt(n)?0:1},F.abs=function(){return mt(this)?We(this):this},F.add=function(n){for(var e=Math.max(this.g.length,n.g.length),t=[],r=0,i=0;i<=e;i++){var s=r+(65535&this.D(i))+(65535&n.D(i)),a=(s>>>16)+(this.D(i)>>>16)+(n.D(i)>>>16);r=a>>>16,t[i]=(a&=65535)<<16|(s&=65535)}return new ae(t,-2147483648&t[t.length-1]?-1:0)},F.R=function(n){if(Dt(this)||Dt(n))return dn;if(mt(this))return mt(n)?We(this).R(We(n)):We(We(this).R(n));if(mt(n))return We(this.R(We(n)));if(0>this.X(Si)&&0>n.X(Si))return Vt(this.ea()*n.ea());for(var e=this.g.length+n.g.length,t=[],r=0;r<2*e;r++)t[r]=0;for(r=0;r<this.g.length;r++)for(var i=0;i<n.g.length;i++){var s=this.D(r)>>>16,a=65535&this.D(r),h=n.D(i)>>>16,d=65535&n.D(i);t[2*r+2*i]+=a*d,Na(t,2*r+2*i),t[2*r+2*i+1]+=s*d,Na(t,2*r+2*i+1),t[2*r+2*i+1]+=a*h,Na(t,2*r+2*i+1),t[2*r+2*i+2]+=s*h,Na(t,2*r+2*i+2)}for(r=0;r<e;r++)t[r]=t[2*r+1]<<16|t[2*r];for(r=e;r<2*e;r++)t[r]=0;return new ae(t,0)},F.gb=function(n){return Va(this,n).h},F.and=function(n){for(var e=Math.max(this.g.length,n.g.length),t=[],r=0;r<e;r++)t[r]=this.D(r)&n.D(r);return new ae(t,this.h&n.h)},F.or=function(n){for(var e=Math.max(this.g.length,n.g.length),t=[],r=0;r<e;r++)t[r]=this.D(r)|n.D(r);return new ae(t,this.h|n.h)},F.xor=function(n){for(var e=Math.max(this.g.length,n.g.length),t=[],r=0;r<e;r++)t[r]=this.D(r)^n.D(r);return new ae(t,this.h^n.h)},ba.prototype.createWebChannel=ba.prototype.g,pt.prototype.send=pt.prototype.u,pt.prototype.open=pt.prototype.m,pt.prototype.close=pt.prototype.close,rt.NO_ERROR=0,rt.TIMEOUT=8,rt.HTTP_ERROR=6,mc.COMPLETE="complete",Es.EventType=gi,gi.OPEN="a",gi.CLOSE="b",gi.ERROR="c",gi.MESSAGE="d",Ne.prototype.listen=Ne.prototype.O,Ee.prototype.listenOnce=Ee.prototype.P,Ee.prototype.getLastError=Ee.prototype.Sa,Ee.prototype.getLastErrorCode=Ee.prototype.Ia,Ee.prototype.getStatus=Ee.prototype.da,Ee.prototype.getResponseJson=Ee.prototype.Wa,Ee.prototype.getResponseText=Ee.prototype.ja,Ee.prototype.send=Ee.prototype.ha,Ee.prototype.setWithCredentials=Ee.prototype.Oa,st.prototype.digest=st.prototype.l,st.prototype.reset=st.prototype.reset,st.prototype.update=st.prototype.j,ae.prototype.add=ae.prototype.add,ae.prototype.multiply=ae.prototype.R,ae.prototype.modulo=ae.prototype.gb,ae.prototype.compare=ae.prototype.X,ae.prototype.toNumber=ae.prototype.ea,ae.prototype.toString=ae.prototype.toString,ae.prototype.getBits=ae.prototype.D,ae.fromNumber=Vt,ae.fromString=function Mc(n,e){if(0==n.length)throw Error("number format error: empty string");if(2>(e=e||10)||36<e)throw Error("radix out of range: "+e);if("-"==n.charAt(0))return We(Mc(n.substring(1),e));if(0<=n.indexOf("-"))throw Error('number format error: interior "-" character');for(var t=Vt(Math.pow(e,8)),r=dn,i=0;i<n.length;i+=8){var s=Math.min(8,n.length-i),a=parseInt(n.substring(i,i+s),e);8>s?(s=Vt(Math.pow(e,s)),r=r.R(s).add(Vt(a))):r=(r=r.R(t)).add(Vt(a))}return r};var kh=dt.createWebChannelTransport=function(){return new ba},Ci=dt.getStatEventTarget=function(){return Ir()},Da=dt.ErrorCode=rt,be=dt.EventType=mc,Nh=dt.Event=Ht,Zs=dt.Stat={xb:0,Ab:1,Bb:2,Ub:3,Zb:4,Wb:5,Xb:6,Vb:7,Tb:8,Yb:9,PROXY:10,NOPROXY:11,Rb:12,Nb:13,Ob:14,Mb:15,Pb:16,Qb:17,tb:18,sb:19,ub:20},Vh=dt.FetchXmlHttpFactory=zn,br=dt.WebChannel=Es,Dh=dt.XhrIo=Ee,Oh=dt.Md5=st,$n=dt.Integer=ae;const Lc="@firebase/firestore";class Ce{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}Ce.UNAUTHENTICATED=new Ce(null),Ce.GOOGLE_CREDENTIALS=new Ce("google-credentials-uid"),Ce.FIRST_PARTY=new Ce("first-party-uid"),Ce.MOCK_USER=new Ce("mock-user");let Hn="10.5.2";const gt=new vt.Yd("@firebase/firestore");function Yt(){return gt.logLevel}function x(n,...e){if(gt.logLevel<=vt.in.DEBUG){const t=e.map(Oa);gt.debug(`Firestore (${Hn}): ${n}`,...t)}}function Ae(n,...e){if(gt.logLevel<=vt.in.ERROR){const t=e.map(Oa);gt.error(`Firestore (${Hn}): ${n}`,...t)}}function je(n,...e){if(gt.logLevel<=vt.in.WARN){const t=e.map(Oa);gt.warn(`Firestore (${Hn}): ${n}`,...t)}}function Oa(n){if("string"==typeof n)return n;try{return JSON.stringify(n)}catch{return n}}function B(n="Unexpected state"){const e=`FIRESTORE (${Hn}) INTERNAL ASSERTION FAILED: `+n;throw Ae(e),new Error(e)}function z(n,e){n||B()}function M(n,e){return n}const P={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class b extends ce.ZR{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class De{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class Fc{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class Fh{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(Ce.UNAUTHENTICATED))}shutdown(){}}class Uh{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class qh{constructor(e){this.t=e,this.currentUser=Ce.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){var r=this;let i=this.i;const s=m=>this.i!==i?(i=this.i,t(m)):Promise.resolve();let a=new De;this.o=()=>{this.i++,this.currentUser=this.u(),a.resolve(),a=new De,e.enqueueRetryable(()=>s(this.currentUser))};const h=()=>{const m=a;e.enqueueRetryable((0,R.Z)(function*(){yield m.promise,yield s(r.currentUser)}))},d=m=>{x("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=m,this.auth.addAuthTokenListener(this.o),h()};this.t.onInit(m=>d(m)),setTimeout(()=>{if(!this.auth){const m=this.t.getImmediate({optional:!0});m?d(m):(x("FirebaseAuthCredentialsProvider","Auth not yet detected"),a.resolve(),a=new De)}},0),h()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(r=>this.i!==e?(x("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(z("string"==typeof r.accessToken),new Fc(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const e=this.auth&&this.auth.getUid();return z(null===e||"string"==typeof e),new Ce(e)}}class Gs{constructor(e,t,r){this.l=e,this.h=t,this.P=r,this.type="FirstParty",this.user=Ce.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);const e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class Bh{constructor(e,t,r){this.l=e,this.h=t,this.P=r}getToken(){return Promise.resolve(new Gs(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable(()=>t(Ce.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class Uc{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class Zh{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,t){const r=s=>{null!=s.error&&x("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);const a=s.token!==this.R;return this.R=s.token,x("FirebaseAppCheckTokenProvider",`Received ${a?"new":"existing"} token.`),a?t(s.token):Promise.resolve()};this.o=s=>{e.enqueueRetryable(()=>r(s))};const i=s=>{x("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.appCheck.addTokenListener(this.o)};this.A.onInit(s=>i(s)),setTimeout(()=>{if(!this.appCheck){const s=this.A.getImmediate({optional:!0});s?i(s):x("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(z("string"==typeof t.token),this.R=t.token,new Uc(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}function Gh(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(t);else for(let r=0;r<n;r++)t[r]=Math.floor(256*Math.random());return t}class Bc{static newId(){const t=62*Math.floor(256/62);let r="";for(;r.length<20;){const i=Gh(40);for(let s=0;s<i.length;++s)r.length<20&&i[s]<t&&(r+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(i[s]%62))}return r}}function Y(n,e){return n<e?-1:n>e?1:0}function xr(n,e,t){return n.length===e.length&&n.every((r,i)=>t(r,e[i]))}function Zc(n){return n+"\0"}class pe{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new b(P.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new b(P.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new b(P.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new b(P.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return pe.fromMillis(Date.now())}static fromDate(e){return pe.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),r=Math.floor(1e6*(e-1e3*t));return new pe(t,r)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?Y(this.nanoseconds,e.nanoseconds):Y(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){return String(this.seconds- -62135596800).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class K{constructor(e){this.timestamp=e}static fromTimestamp(e){return new K(e)}static min(){return new K(new pe(0,0))}static max(){return new K(new pe(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class bi{constructor(e,t,r){void 0===t?t=0:t>e.length&&B(),void 0===r?r=e.length-t:r>e.length-t&&B(),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return 0===bi.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof bi?e.forEach(r=>{t.push(r)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return this.construct(this.segments,this.offset+(e=void 0===e?1:e),this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const r=Math.min(e.length,t.length);for(let i=0;i<r;i++){const s=e.get(i),a=t.get(i);if(s<a)return-1;if(s>a)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class ie extends bi{construct(e,t,r){return new ie(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...e){const t=[];for(const r of e){if(r.indexOf("//")>=0)throw new b(P.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(i=>i.length>0))}return new ie(t)}static emptyPath(){return new ie([])}}const Ma=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class me extends bi{construct(e,t,r){return new me(e,t,r)}static isValidIdentifier(e){return Ma.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),me.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new me(["__name__"])}static fromServerFormat(e){const t=[];let r="",i=0;const s=()=>{if(0===r.length)throw new b(P.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""};let a=!1;for(;i<e.length;){const h=e[i];if("\\"===h){if(i+1===e.length)throw new b(P.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const d=e[i+1];if("\\"!==d&&"."!==d&&"`"!==d)throw new b(P.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=d,i+=2}else"`"===h?(a=!a,i++):"."!==h||a?(r+=h,i++):(s(),i++)}if(s(),a)throw new b(P.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new me(t)}static emptyPath(){return new me([])}}class O{constructor(e){this.path=e}static fromPath(e){return new O(ie.fromString(e))}static fromName(e){return new O(ie.fromString(e).popFirst(5))}static empty(){return new O(ie.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===ie.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return ie.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new O(new ie(e.slice()))}}class kr{constructor(e,t,r,i){this.indexId=e,this.collectionGroup=t,this.fields=r,this.indexState=i}}function xi(n){return n.fields.find(e=>2===e.kind)}function Qn(n){return n.fields.filter(e=>2!==e.kind)}kr.UNKNOWN_ID=-1;class Ot{constructor(e,t){this.fieldPath=e,this.kind=t}}class Nr{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new Nr(0,Oe.min())}}function zs(n,e){const t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,i=K.fromTimestamp(1e9===r?new pe(t+1,0):new pe(t,r));return new Oe(i,O.empty(),e)}function Vr(n){return new Oe(n.readTime,n.key,-1)}class Oe{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new Oe(K.min(),O.empty(),-1)}static max(){return new Oe(K.max(),O.empty(),-1)}}function ki(n,e){let t=n.readTime.compareTo(e.readTime);return 0!==t?t:(t=O.comparator(n.documentKey,e.documentKey),0!==t?t:Y(n.largestBatchId,e.largestBatchId))}const Gc="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class zc{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}function pn(n){return Ni.apply(this,arguments)}function Ni(){return Ni=(0,R.Z)(function*(n){if(n.code!==P.FAILED_PRECONDITION||n.message!==Gc)throw n;x("LocalStore","Unexpectedly lost primary lease")}),Ni.apply(this,arguments)}class A{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&B(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new A((r,i)=>{this.nextCallback=s=>{this.wrapSuccess(e,s).next(r,i)},this.catchCallback=s=>{this.wrapFailure(t,s).next(r,i)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof A?t:A.resolve(t)}catch(t){return A.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):A.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):A.reject(t)}static resolve(e){return new A((t,r)=>{t(e)})}static reject(e){return new A((t,r)=>{r(e)})}static waitFor(e){return new A((t,r)=>{let i=0,s=0,a=!1;e.forEach(h=>{++i,h.next(()=>{++s,a&&s===i&&t()},d=>r(d))}),a=!0,s===i&&t()})}static or(e){let t=A.resolve(!1);for(const r of e)t=t.next(i=>i?A.resolve(i):r());return t}static forEach(e,t){const r=[];return e.forEach((i,s)=>{r.push(t.call(this,i,s))}),this.waitFor(r)}static mapArray(e,t){return new A((r,i)=>{const s=e.length,a=new Array(s);let h=0;for(let d=0;d<s;d++){const m=d;t(e[m]).next(g=>{a[m]=g,++h,h===s&&r(a)},g=>i(g))}})}static doWhile(e,t){return new A((r,i)=>{const s=()=>{!0===e()?t().next(()=>{s()},i):r()};s()})}}class Ws{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.V=new De,this.transaction.oncomplete=()=>{this.V.resolve()},this.transaction.onabort=()=>{t.error?this.V.reject(new Vi(e,t.error)):this.V.resolve()},this.transaction.onerror=r=>{const i=qa(r.target.error);this.V.reject(new Vi(e,i))}}static open(e,t,r,i){try{return new Ws(t,e.transaction(i,r))}catch(s){throw new Vi(t,s)}}get m(){return this.V.promise}abort(e){e&&this.V.reject(e),this.aborted||(x("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}g(){const e=this.transaction;this.aborted||"function"!=typeof e.commit||e.commit()}store(e){const t=this.transaction.objectStore(e);return new zh(t)}}class At{constructor(e,t,r){this.name=e,this.version=t,this.p=r,12.2===At.S((0,ce.z$)())&&Ae("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return x("SimpleDb","Removing database:",e),Jt(window.indexedDB.deleteDatabase(e)).toPromise()}static D(){if(!(0,ce.hl)())return!1;if(At.C())return!0;const e=(0,ce.z$)(),t=At.S(e),r=0<t&&t<10,i=At.v(e),s=0<i&&i<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||s)}static C(){var e;return typeof process<"u"&&"YES"===(null===(e=process.env)||void 0===e?void 0:e.F)}static M(e,t){return e.store(t)}static S(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),r=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(r)}static v(e){const t=e.match(/Android ([\d.]+)/i),r=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(r)}O(e){var t=this;return(0,R.Z)(function*(){return t.db||(x("SimpleDb","Opening database:",t.name),t.db=yield new Promise((r,i)=>{const s=indexedDB.open(t.name,t.version);s.onsuccess=a=>{r(a.target.result)},s.onblocked=()=>{i(new Vi(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},s.onerror=a=>{const h=a.target.error;i("VersionError"===h.name?new b(P.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh."):"InvalidStateError"===h.name?new b(P.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+h):new Vi(e,h))},s.onupgradeneeded=a=>{x("SimpleDb",'Database "'+t.name+'" requires upgrade from version:',a.oldVersion),t.p.N(a.target.result,s.transaction,a.oldVersion,t.version).next(()=>{x("SimpleDb","Database upgrade to version "+t.version+" complete")})}})),t.B&&(t.db.onversionchange=r=>t.B(r)),t.db})()}L(e){this.B=e,this.db&&(this.db.onversionchange=t=>e(t))}runTransaction(e,t,r,i){var s=this;return(0,R.Z)(function*(){const a="readonly"===t;let h=0;for(;;){++h;try{s.db=yield s.O(e);const d=Ws.open(s.db,e,a?"readonly":"readwrite",r),m=i(d).next(g=>(d.g(),g)).catch(g=>(d.abort(g),A.reject(g))).toPromise();return m.catch(()=>{}),yield d.m,m}catch(d){const m=d,g="FirebaseError"!==m.name&&h<3;if(x("SimpleDb","Transaction failed with error:",m.message,"Retrying:",g),s.close(),!g)return Promise.reject(m)}}})()}close(){this.db&&this.db.close(),this.db=void 0}}class Ua{constructor(e){this.k=e,this.q=!1,this.K=null}get isDone(){return this.q}get $(){return this.K}set cursor(e){this.k=e}done(){this.q=!0}U(e){this.K=e}delete(){return Jt(this.k.delete())}}class Vi extends b{constructor(e,t){super(P.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function Mt(n){return"IndexedDbTransactionError"===n.name}class zh{constructor(e){this.store=e}put(e,t){let r;return void 0!==t?(x("SimpleDb","PUT",this.store.name,e,t),r=this.store.put(t,e)):(x("SimpleDb","PUT",this.store.name,"<auto-key>",e),r=this.store.put(e)),Jt(r)}add(e){return x("SimpleDb","ADD",this.store.name,e,e),Jt(this.store.add(e))}get(e){return Jt(this.store.get(e)).next(t=>(void 0===t&&(t=null),x("SimpleDb","GET",this.store.name,e,t),t))}delete(e){return x("SimpleDb","DELETE",this.store.name,e),Jt(this.store.delete(e))}count(){return x("SimpleDb","COUNT",this.store.name),Jt(this.store.count())}W(e,t){const r=this.options(e,t);if(r.index||"function"!=typeof this.store.getAll){const i=this.cursor(r),s=[];return this.G(i,(a,h)=>{s.push(h)}).next(()=>s)}{const i=this.store.getAll(r.range);return new A((s,a)=>{i.onerror=h=>{a(h.target.error)},i.onsuccess=h=>{s(h.target.result)}})}}j(e,t){const r=this.store.getAll(e,null===t?void 0:t);return new A((i,s)=>{r.onerror=a=>{s(a.target.error)},r.onsuccess=a=>{i(a.target.result)}})}H(e,t){x("SimpleDb","DELETE ALL",this.store.name);const r=this.options(e,t);r.J=!1;const i=this.cursor(r);return this.G(i,(s,a,h)=>h.delete())}Y(e,t){let r;t?r=e:(r={},t=e);const i=this.cursor(r);return this.G(i,t)}Z(e){const t=this.cursor({});return new A((r,i)=>{t.onerror=s=>{const a=qa(s.target.error);i(a)},t.onsuccess=s=>{const a=s.target.result;a?e(a.primaryKey,a.value).next(h=>{h?a.continue():r()}):r()}})}G(e,t){const r=[];return new A((i,s)=>{e.onerror=a=>{s(a.target.error)},e.onsuccess=a=>{const h=a.target.result;if(!h)return void i();const d=new Ua(h),m=t(h.primaryKey,h.value,d);if(m instanceof A){const g=m.catch(y=>(d.done(),A.reject(y)));r.push(g)}d.isDone?i():null===d.$?h.continue():h.continue(d.$)}}).next(()=>A.waitFor(r))}options(e,t){let r;return void 0!==e&&("string"==typeof e?r=e:t=e),{index:r,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const r=this.store.index(e.index);return e.J?r.openKeyCursor(e.range,t):r.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function Jt(n){return new A((e,t)=>{n.onsuccess=r=>{e(r.target.result)},n.onerror=r=>{const i=qa(r.target.error);t(i)}})}let Ks=!1;function qa(n){const e=At.S((0,ce.z$)());if(e>=12.2&&e<13){const t="An internal error was encountered in the Indexed Database server";if(n.message.indexOf(t)>=0){const r=new b("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return Ks||(Ks=!0,setTimeout(()=>{throw r},0)),r}}return n}class Di{constructor(e,t){this.asyncQueue=e,this.X=t,this.task=null}start(){this.ee(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return null!==this.task}ee(e){var t=this;x("IndexBackiller",`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,(0,R.Z)(function*(){t.task=null;try{x("IndexBackiller",`Documents written: ${yield t.X.te()}`)}catch(r){Mt(r)?x("IndexBackiller","Ignoring IndexedDB error during index backfill: ",r):yield pn(r)}yield t.ee(6e4)}))}}class Wh{constructor(e,t){this.localStore=e,this.persistence=t}te(e=50){var t=this;return(0,R.Z)(function*(){return t.persistence.runTransaction("Backfill Indexes","readwrite-primary",r=>t.ne(r,e))})()}ne(e,t){const r=new Set;let i=t,s=!0;return A.doWhile(()=>!0===s&&i>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(a=>{if(null!==a&&!r.has(a))return x("IndexBackiller",`Processing collection: ${a}`),this.re(e,a,i).next(h=>{i-=h,r.add(a)});s=!1})).next(()=>t-i)}re(e,t,r){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(i=>this.localStore.localDocuments.getNextDocuments(e,t,i,r).next(s=>{const a=s.changes;return this.localStore.indexManager.updateIndexEntries(e,a).next(()=>this.ie(i,s)).next(h=>(x("IndexBackiller",`Updating offset: ${h}`),this.localStore.indexManager.updateCollectionGroup(e,t,h))).next(()=>a.size)}))}ie(e,t){let r=e;return t.changes.forEach((i,s)=>{const a=Vr(s);ki(a,r)>0&&(r=a)}),new Oe(r.readTime,r.documentKey,Math.max(t.batchId,e.largestBatchId))}}let ot=(()=>{class n{constructor(t,r){this.previousValue=t,r&&(r.sequenceNumberHandler=i=>this.se(i),this.oe=i=>r.writeSequenceNumber(i))}se(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){const t=++this.previousValue;return this.oe&&this.oe(t),t}}return n._e=-1,n})();function Yn(n){return null==n}function Jn(n){return 0===n&&1/n==-1/0}function js(n){return"number"==typeof n&&Number.isInteger(n)&&!Jn(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}function $e(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=Za(e)),e=Ba(n.get(t),e);return Za(e)}function Ba(n,e){let t=e;const r=n.length;for(let i=0;i<r;i++){const s=n.charAt(i);switch(s){case"\0":t+="\x01\x10";break;case"\x01":t+="\x01\x11";break;default:t+=s}}return t}function Za(n){return n+"\x01\x01"}function wt(n){const e=n.length;if(z(e>=2),2===e)return z("\x01"===n.charAt(0)&&"\x01"===n.charAt(1)),ie.emptyPath();const t=e-2,r=[];let i="";for(let s=0;s<e;){const a=n.indexOf("\x01",s);switch((a<0||a>t)&&B(),n.charAt(a+1)){case"\x01":const h=n.substring(s,a);let d;0===i.length?d=h:(i+=h,d=i,i=""),r.push(d);break;case"\x10":i+=n.substring(s,a),i+="\0";break;case"\x11":i+=n.substring(s,a+1);break;default:B()}s=a+2}return new ie(r)}const Wc=["userId","batchId"];function $s(n,e){return[n,$e(e)]}function Hs(n,e,t){return[n,$e(e),t]}const Kh={},jh=["prefixPath","collectionGroup","readTime","documentId"],Ga=["prefixPath","collectionGroup","documentId"],$h=["collectionGroup","readTime","prefixPath","documentId"],Hh=["canonicalId","targetId"],za=["targetId","path"],Qh=["path","targetId"],Wa=["collectionId","parent"],Qs=["indexId","uid"],Ka=["uid","sequenceNumber"],Kc=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],ja=["indexId","uid","orderedDocumentKey"],Yh=["userId","collectionPath","documentId"],jc=["userId","collectionPath","largestBatchId"],$c=["userId","collectionGroup","largestBatchId"],$a=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],Jh=[...$a,"documentOverlays"],Ha=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],Ys=Ha,Xh=[...Ys,"indexConfiguration","indexState","indexEntries"];class Qa extends zc{constructor(e,t){super(),this.ae=e,this.currentSequenceNumber=t}}function qe(n,e){const t=M(n);return At.M(t.ae,e)}function Js(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function mn(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function Hc(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}class le{constructor(e,t){this.comparator=e,this.root=t||xe.EMPTY}insert(e,t){return new le(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,xe.BLACK,null,null))}remove(e){return new le(this.comparator,this.root.remove(e,this.comparator).copy(null,null,xe.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const r=this.comparator(e,t.key);if(0===r)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){const i=this.comparator(e,r.key);if(0===i)return t+r.left.size;i<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){const e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Xs(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Xs(this.root,e,this.comparator,!1)}getReverseIterator(){return new Xs(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Xs(this.root,e,this.comparator,!0)}}class Xs{constructor(e,t,r,i){this.isReverse=i,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=t?r(e.key,t):1,t&&i&&(s*=-1),s<0)e=this.isReverse?e.left:e.right;else{if(0===s){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class xe{constructor(e,t,r,i,s){this.key=e,this.value=t,this.color=null!=r?r:xe.RED,this.left=null!=i?i:xe.EMPTY,this.right=null!=s?s:xe.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,i,s){return new xe(null!=e?e:this.key,null!=t?t:this.value,null!=r?r:this.color,null!=i?i:this.left,null!=s?s:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let i=this;const s=r(e,i.key);return i=s<0?i.copy(null,null,null,i.left.insert(e,t,r),null):0===s?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,r)),i.fixUp()}removeMin(){if(this.left.isEmpty())return xe.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,i=this;if(t(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,t),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),0===t(e,i.key)){if(i.right.isEmpty())return xe.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,t))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,xe.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,xe.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw B();const e=this.left.check();if(e!==this.right.check())throw B();return e+(this.isRed()?0:1)}}xe.EMPTY=null,xe.RED=!0,xe.BLACK=!1,xe.EMPTY=new class{constructor(){this.size=0}get key(){throw B()}get value(){throw B()}get color(){throw B()}get left(){throw B()}get right(){throw B()}copy(e,t,r,i,s){return this}insert(e,t,r){return new xe(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class ue{constructor(e){this.comparator=e,this.data=new le(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const i=r.getNext();if(this.comparator(i.key,e[1])>=0)return;t(i.key)}}forEachWhile(e,t){let r;for(r=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new Qc(this.data.getIterator())}getIteratorFrom(e){return new Qc(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(r=>{t=t.add(r)}),t}isEqual(e){if(!(e instanceof ue)||this.size!==e.size)return!1;const t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){const i=t.getNext().key,s=r.getNext().key;if(0!==this.comparator(i,s))return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new ue(this.comparator);return t.data=e,t}}class Qc{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function Dr(n){return n.hasNext()?n.getNext():void 0}class et{constructor(e){this.fields=e,e.sort(me.comparator)}static empty(){return new et([])}unionWith(e){let t=new ue(me.comparator);for(const r of this.fields)t=t.add(r);for(const r of e)t=t.add(r);return new et(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return xr(this.fields,e.fields,(t,r)=>t.isEqual(r))}}class Yc extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class Me{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(i){try{return atob(i)}catch(s){throw typeof DOMException<"u"&&s instanceof DOMException?new Yc("Invalid base64 string: "+s):s}}(e);return new Me(t)}static fromUint8Array(e){const t=function(i){let s="";for(let a=0;a<i.length;++a)s+=String.fromCharCode(i[a]);return s}(e);return new Me(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return btoa(this.binaryString)}toUint8Array(){return function(t){const r=new Uint8Array(t.length);for(let i=0;i<t.length;i++)r[i]=t.charCodeAt(i);return r}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return Y(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Me.EMPTY_BYTE_STRING=new Me("");const td=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Lt(n){if(z(!!n),"string"==typeof n){let e=0;const t=td.exec(n);if(z(!!t),t[1]){let i=t[1];i=(i+"000000000").substr(0,9),e=Number(i)}const r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:we(n.seconds),nanos:we(n.nanos)}}function we(n){return"number"==typeof n?n:"string"==typeof n?Number(n):0}function Xt(n){return"string"==typeof n?Me.fromBase64String(n):Me.fromUint8Array(n)}function eo(n){var e,t;return"server_timestamp"===(null===(t=((null===(e=null==n?void 0:n.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===t?void 0:t.stringValue)}function to(n){const e=n.mapValue.fields.__previous_value__;return eo(e)?to(e):e}function Oi(n){const e=Lt(n.mapValue.fields.__local_write_time__.timestampValue);return new pe(e.seconds,e.nanos)}class Jc{constructor(e,t,r,i,s,a,h,d,m){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=i,this.ssl=s,this.forceLongPolling=a,this.autoDetectLongPolling=h,this.longPollingOptions=d,this.useFetchStreams=m}}class gn{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new gn("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(e){return e instanceof gn&&e.projectId===this.projectId&&e.database===this.database}}const _n={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},no={nullValue:"NULL_VALUE"};function yn(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?eo(n)?4:Ja(n)?9007199254740991:10:B()}function Ft(n,e){if(n===e)return!0;const t=yn(n);if(t!==yn(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return Oi(n).isEqual(Oi(e));case 3:return function(i,s){if("string"==typeof i.timestampValue&&"string"==typeof s.timestampValue&&i.timestampValue.length===s.timestampValue.length)return i.timestampValue===s.timestampValue;const a=Lt(i.timestampValue),h=Lt(s.timestampValue);return a.seconds===h.seconds&&a.nanos===h.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return s=e,Xt(n.bytesValue).isEqual(Xt(s.bytesValue));case 7:return n.referenceValue===e.referenceValue;case 8:return function(i,s){return we(i.geoPointValue.latitude)===we(s.geoPointValue.latitude)&&we(i.geoPointValue.longitude)===we(s.geoPointValue.longitude)}(n,e);case 2:return function(i,s){if("integerValue"in i&&"integerValue"in s)return we(i.integerValue)===we(s.integerValue);if("doubleValue"in i&&"doubleValue"in s){const a=we(i.doubleValue),h=we(s.doubleValue);return a===h?Jn(a)===Jn(h):isNaN(a)&&isNaN(h)}return!1}(n,e);case 9:return xr(n.arrayValue.values||[],e.arrayValue.values||[],Ft);case 10:return function(i,s){const a=i.mapValue.fields||{},h=s.mapValue.fields||{};if(Js(a)!==Js(h))return!1;for(const d in a)if(a.hasOwnProperty(d)&&(void 0===h[d]||!Ft(a[d],h[d])))return!1;return!0}(n,e);default:return B()}var s}function Xn(n,e){return void 0!==(n.values||[]).find(t=>Ft(t,e))}function Ut(n,e){if(n===e)return 0;const t=yn(n),r=yn(e);if(t!==r)return Y(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return Y(n.booleanValue,e.booleanValue);case 2:return function(s,a){const h=we(s.integerValue||s.doubleValue),d=we(a.integerValue||a.doubleValue);return h<d?-1:h>d?1:h===d?0:isNaN(h)?isNaN(d)?0:-1:1}(n,e);case 3:return Xc(n.timestampValue,e.timestampValue);case 4:return Xc(Oi(n),Oi(e));case 5:return Y(n.stringValue,e.stringValue);case 6:return function(s,a){const h=Xt(s),d=Xt(a);return h.compareTo(d)}(n.bytesValue,e.bytesValue);case 7:return function(s,a){const h=s.split("/"),d=a.split("/");for(let m=0;m<h.length&&m<d.length;m++){const g=Y(h[m],d[m]);if(0!==g)return g}return Y(h.length,d.length)}(n.referenceValue,e.referenceValue);case 8:return function(s,a){const h=Y(we(s.latitude),we(a.latitude));return 0!==h?h:Y(we(s.longitude),we(a.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return function(s,a){const h=s.values||[],d=a.values||[];for(let m=0;m<h.length&&m<d.length;++m){const g=Ut(h[m],d[m]);if(g)return g}return Y(h.length,d.length)}(n.arrayValue,e.arrayValue);case 10:return function(s,a){if(s===_n.mapValue&&a===_n.mapValue)return 0;if(s===_n.mapValue)return 1;if(a===_n.mapValue)return-1;const h=s.fields||{},d=Object.keys(h),m=a.fields||{},g=Object.keys(m);d.sort(),g.sort();for(let y=0;y<d.length&&y<g.length;++y){const T=Y(d[y],g[y]);if(0!==T)return T;const w=Ut(h[d[y]],m[g[y]]);if(0!==w)return w}return Y(d.length,g.length)}(n.mapValue,e.mapValue);default:throw B()}}function Xc(n,e){if("string"==typeof n&&"string"==typeof e&&n.length===e.length)return Y(n,e);const t=Lt(n),r=Lt(e),i=Y(t.seconds,r.seconds);return 0!==i?i:Y(t.nanos,r.nanos)}function In(n){return Ya(n)}function Ya(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(t){const r=Lt(t);return`time(${r.seconds},${r.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?Xt(n.bytesValue).toBase64():"referenceValue"in n?O.fromName(n.referenceValue).toString():"geoPointValue"in n?function(t){return`geo(${t.latitude},${t.longitude})`}(n.geoPointValue):"arrayValue"in n?function(t){let r="[",i=!0;for(const s of t.values||[])i?i=!1:r+=",",r+=Ya(s);return r+"]"}(n.arrayValue):"mapValue"in n?function(t){const r=Object.keys(t.fields||{}).sort();let i="{",s=!0;for(const a of r)s?s=!1:i+=",",i+=`${a}:${Ya(t.fields[a])}`;return i+"}"}(n.mapValue):B()}function er(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function Li(n){return!!n&&"integerValue"in n}function Fi(n){return!!n&&"arrayValue"in n}function nd(n){return!!n&&"nullValue"in n}function ro(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function Ui(n){return!!n&&"mapValue"in n}function vn(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&"object"==typeof n.timestampValue)return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){const e={mapValue:{fields:{}}};return mn(n.mapValue.fields,(t,r)=>e.mapValue.fields[t]=vn(r)),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=vn(n.arrayValue.values[t]);return e}return Object.assign({},n)}function Ja(n){return"__max__"===(((n.mapValue||{}).fields||{}).__type__||{}).stringValue}function el(n){return"nullValue"in n?no:"booleanValue"in n?{booleanValue:!1}:"integerValue"in n||"doubleValue"in n?{doubleValue:NaN}:"timestampValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in n?{stringValue:""}:"bytesValue"in n?{bytesValue:""}:"referenceValue"in n?er(gn.empty(),O.empty()):"geoPointValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in n?{arrayValue:{}}:"mapValue"in n?{mapValue:{}}:B()}function rd(n){return"nullValue"in n?{booleanValue:!1}:"booleanValue"in n?{doubleValue:NaN}:"integerValue"in n||"doubleValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in n?{stringValue:""}:"stringValue"in n?{bytesValue:""}:"bytesValue"in n?er(gn.empty(),O.empty()):"referenceValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in n?{arrayValue:{}}:"arrayValue"in n?{mapValue:{}}:"mapValue"in n?_n:B()}function tl(n,e){const t=Ut(n.value,e.value);return 0!==t?t:n.inclusive&&!e.inclusive?-1:!n.inclusive&&e.inclusive?1:0}function nl(n,e){const t=Ut(n.value,e.value);return 0!==t?t:n.inclusive&&!e.inclusive?1:!n.inclusive&&e.inclusive?-1:0}class Ke{constructor(e){this.value=e}static empty(){return new Ke({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!Ui(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=vn(t)}setAll(e){let t=me.emptyPath(),r={},i=[];e.forEach((a,h)=>{if(!t.isImmediateParentOf(h)){const d=this.getFieldsMap(t);this.applyChanges(d,r,i),r={},i=[],t=h.popLast()}a?r[h.lastSegment()]=vn(a):i.push(h.lastSegment())});const s=this.getFieldsMap(t);this.applyChanges(s,r,i)}delete(e){const t=this.field(e.popLast());Ui(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Ft(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let i=t.mapValue.fields[e.get(r)];Ui(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=i),t=i}return t.mapValue.fields}applyChanges(e,t,r){mn(t,(i,s)=>e[i]=s);for(const i of r)delete e[i]}clone(){return new Ke(vn(this.value))}}function rl(n){const e=[];return mn(n.fields,(t,r)=>{const i=new me([t]);if(Ui(r)){const s=rl(r.mapValue).fields;if(0===s.length)e.push(i);else for(const a of s)e.push(i.child(a))}else e.push(i)}),new et(e)}class he{constructor(e,t,r,i,s,a,h){this.key=e,this.documentType=t,this.version=r,this.readTime=i,this.createTime=s,this.data=a,this.documentState=h}static newInvalidDocument(e){return new he(e,0,K.min(),K.min(),K.min(),Ke.empty(),0)}static newFoundDocument(e,t,r,i){return new he(e,1,t,K.min(),r,i,0)}static newNoDocument(e,t){return new he(e,2,t,K.min(),K.min(),Ke.empty(),0)}static newUnknownDocument(e,t){return new he(e,3,t,K.min(),K.min(),Ke.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(K.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Ke.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Ke.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=K.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof he&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new he(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class Tn{constructor(e,t){this.position=e,this.inclusive=t}}function id(n,e,t){let r=0;for(let i=0;i<n.position.length;i++){const s=e[i],a=n.position[i];if(r=s.field.isKeyField()?O.comparator(O.fromName(a.referenceValue),t.key):Ut(a,t.data.field(s.field)),"desc"===s.dir&&(r*=-1),0!==r)break}return r}function En(n,e){if(null===n)return null===e;if(null===e||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!Ft(n.position[t],e.position[t]))return!1;return!0}class qi{constructor(e,t="asc"){this.field=e,this.dir=t}}function sd(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}class io{}class te extends io{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,r):new od(e,t,r):"array-contains"===t?new nu(e,r):"in"===t?new al(e,r):"not-in"===t?new cd(e,r):"array-contains-any"===t?new ru(e,r):new te(e,t,r)}static createKeyFieldInFilter(e,t,r){return"in"===t?new ad(e,r):new ud(e,r)}matches(e){const t=e.data.field(this.field);return"!="===this.op?null!==t&&this.matchesComparison(Ut(t,this.value)):null!==t&&yn(this.value)===yn(t)&&this.matchesComparison(Ut(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return B()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class se extends io{constructor(e,t){super(),this.filters=e,this.op=t,this.ue=null}static create(e,t){return new se(e,t)}matches(e){return Or(this)?void 0===this.filters.find(t=>!t.matches(e)):void 0!==this.filters.find(t=>t.matches(e))}getFlattenedFilters(){return null!==this.ue||(this.ue=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.ue}getFilters(){return Object.assign([],this.filters)}}function Or(n){return"and"===n.op}function Xa(n){return"or"===n.op}function Bi(n){return il(n)&&Or(n)}function il(n){for(const e of n.filters)if(e instanceof se)return!1;return!0}function eu(n){if(n instanceof te)return n.field.canonicalString()+n.op.toString()+In(n.value);if(Bi(n))return n.filters.map(e=>eu(e)).join(",");{const e=n.filters.map(t=>eu(t)).join(",");return`${n.op}(${e})`}}function so(n,e){return n instanceof te?(r=n,(i=e)instanceof te&&r.op===i.op&&r.field.isEqual(i.field)&&Ft(r.value,i.value)):n instanceof se?function(r,i){return i instanceof se&&r.op===i.op&&r.filters.length===i.filters.length&&r.filters.reduce((s,a,h)=>s&&so(a,i.filters[h]),!0)}(n,e):void B();var r,i}function sl(n,e){const t=n.filters.concat(e);return se.create(t,n.op)}function ol(n){return n instanceof te?`${(t=n).field.canonicalString()} ${t.op} ${In(t.value)}`:n instanceof se?function(t){return t.op.toString()+" {"+t.getFilters().map(ol).join(" ,")+"}"}(n):"Filter";var t}class od extends te{constructor(e,t,r){super(e,t,r),this.key=O.fromName(r.referenceValue)}matches(e){const t=O.comparator(e.key,this.key);return this.matchesComparison(t)}}class ad extends te{constructor(e,t){super(e,"in",t),this.keys=tu(0,t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class ud extends te{constructor(e,t){super(e,"not-in",t),this.keys=tu(0,t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function tu(n,e){var t;return((null===(t=e.arrayValue)||void 0===t?void 0:t.values)||[]).map(r=>O.fromName(r.referenceValue))}class nu extends te{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return Fi(t)&&Xn(t.arrayValue,this.value)}}class al extends te{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return null!==t&&Xn(this.value.arrayValue,t)}}class cd extends te{constructor(e,t){super(e,"not-in",t)}matches(e){if(Xn(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return null!==t&&!Xn(this.value.arrayValue,t)}}class ru extends te{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!Fi(t)||!t.arrayValue.values)&&t.arrayValue.values.some(r=>Xn(this.value.arrayValue,r))}}class iu{constructor(e,t=null,r=[],i=[],s=null,a=null,h=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=i,this.limit=s,this.startAt=a,this.endAt=h,this.ce=null}}function su(n,e=null,t=[],r=[],i=null,s=null,a=null){return new iu(n,e,t,r,i,s,a)}function tr(n){const e=M(n);if(null===e.ce){let t=e.path.canonicalString();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(r=>eu(r)).join(","),t+="|ob:",t+=e.orderBy.map(r=>{return(s=r).field.canonicalString()+s.dir;var s}).join(","),Yn(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(r=>In(r)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(r=>In(r)).join(",")),e.ce=t}return e.ce}function An(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!sd(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!so(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!En(n.startAt,e.startAt)&&En(n.endAt,e.endAt)}function oo(n){return O.isDocumentKey(n.path)&&null===n.collectionGroup&&0===n.filters.length}function ao(n,e){return n.filters.filter(t=>t instanceof te&&t.field.isEqual(e))}function ul(n,e,t){let r=no,i=!0;for(const s of ao(n,e)){let a=no,h=!0;switch(s.op){case"<":case"<=":a=el(s.value);break;case"==":case"in":case">=":a=s.value;break;case">":a=s.value,h=!1;break;case"!=":case"not-in":a=no}tl({value:r,inclusive:i},{value:a,inclusive:h})<0&&(r=a,i=h)}if(null!==t)for(let s=0;s<n.orderBy.length;++s)if(n.orderBy[s].field.isEqual(e)){const a=t.position[s];tl({value:r,inclusive:i},{value:a,inclusive:t.inclusive})<0&&(r=a,i=t.inclusive);break}return{value:r,inclusive:i}}function ou(n,e,t){let r=_n,i=!0;for(const s of ao(n,e)){let a=_n,h=!0;switch(s.op){case">=":case">":a=rd(s.value),h=!1;break;case"==":case"in":case"<=":a=s.value;break;case"<":a=s.value,h=!1;break;case"!=":case"not-in":a=_n}nl({value:r,inclusive:i},{value:a,inclusive:h})>0&&(r=a,i=h)}if(null!==t)for(let s=0;s<n.orderBy.length;++s)if(n.orderBy[s].field.isEqual(e)){const a=t.position[s];nl({value:r,inclusive:i},{value:a,inclusive:t.inclusive})>0&&(r=a,i=t.inclusive);break}return{value:r,inclusive:i}}class en{constructor(e,t=null,r=[],i=[],s=null,a="F",h=null,d=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=i,this.limit=s,this.limitType=a,this.startAt=h,this.endAt=d,this.le=null,this.he=null,this.Pe=null}}function cl(n,e,t,r,i,s,a,h){return new en(n,e,t,r,i,s,a,h)}function Mr(n){return new en(n)}function ll(n){return 0===n.filters.length&&null===n.limit&&null==n.startAt&&null==n.endAt&&(0===n.explicitOrderBy.length||1===n.explicitOrderBy.length&&n.explicitOrderBy[0].field.isKeyField())}function nr(n){return null!==n.collectionGroup}function Lr(n){const e=M(n);if(null===e.le){e.le=[];const t=new Set;for(const s of e.explicitOrderBy)e.le.push(s),t.add(s.field.canonicalString());const r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(a){let h=new ue(me.comparator);return a.filters.forEach(d=>{d.getFlattenedFilters().forEach(m=>{m.isInequality()&&(h=h.add(m.field))})}),h})(e).forEach(s=>{t.has(s.canonicalString())||s.isKeyField()||e.le.push(new qi(s,r))}),t.has(me.keyField().canonicalString())||e.le.push(new qi(me.keyField(),r))}return e.le}function He(n){const e=M(n);return e.he||(e.he=function hl(n,e){if("F"===n.limitType)return su(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(i=>new qi(i.field,"desc"===i.dir?"asc":"desc"));const t=n.endAt?new Tn(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new Tn(n.startAt.position,n.startAt.inclusive):null;return su(n.path,n.collectionGroup,e,n.filters,n.limit,t,r)}}(e,Lr(n))),e.he}function au(n,e){const t=n.filters.concat([e]);return new en(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function uo(n,e,t){return new en(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function Zi(n,e){return An(He(n),He(e))&&n.limitType===e.limitType}function uu(n){return`${tr(He(n))}|lt:${n.limitType}`}function wn(n){return`Query(target=${function(t){let r=t.path.canonicalString();return null!==t.collectionGroup&&(r+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(r+=`, filters: [${t.filters.map(i=>ol(i)).join(", ")}]`),Yn(t.limit)||(r+=", limit: "+t.limit),t.orderBy.length>0&&(r+=`, orderBy: [${t.orderBy.map(i=>{return`${(a=i).field.canonicalString()} (${a.dir})`;var a}).join(", ")}]`),t.startAt&&(r+=", startAt: ",r+=t.startAt.inclusive?"b:":"a:",r+=t.startAt.position.map(i=>In(i)).join(",")),t.endAt&&(r+=", endAt: ",r+=t.endAt.inclusive?"a:":"b:",r+=t.endAt.position.map(i=>In(i)).join(",")),`Target(${r})`}(He(n))}; limitType=${n.limitType})`}function rr(n,e){return e.isFoundDocument()&&function(r,i){const s=i.key.path;return null!==r.collectionGroup?i.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(s):O.isDocumentKey(r.path)?r.path.isEqual(s):r.path.isImmediateParentOf(s)}(n,e)&&function(r,i){for(const s of Lr(r))if(!s.field.isKeyField()&&null===i.data.field(s.field))return!1;return!0}(n,e)&&function(r,i){for(const s of r.filters)if(!s.matches(i))return!1;return!0}(n,e)&&(i=e,!((r=n).startAt&&!function(a,h,d){const m=id(a,h,d);return a.inclusive?m<=0:m<0}(r.startAt,Lr(r),i)||r.endAt&&!function(a,h,d){const m=id(a,h,d);return a.inclusive?m>=0:m>0}(r.endAt,Lr(r),i)));var r,i}function cu(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function dl(n){return(e,t)=>{let r=!1;for(const i of Lr(n)){const s=lu(i,e,t);if(0!==s)return s;r=r||i.field.isKeyField()}return 0}}function lu(n,e,t){const r=n.field.isKeyField()?O.comparator(e.key,t.key):function(s,a,h){const d=a.data.field(s),m=h.data.field(s);return null!==d&&null!==m?Ut(d,m):B()}(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return B()}}class tn{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),r=this.inner[t];if(void 0!==r)for(const[i,s]of r)if(this.equalsFn(i,e))return s}has(e){return void 0!==this.get(e)}set(e,t){const r=this.mapKeyFn(e),i=this.inner[r];if(void 0===i)return this.inner[r]=[[e,t]],void this.innerSize++;for(let s=0;s<i.length;s++)if(this.equalsFn(i[s][0],e))return void(i[s]=[e,t]);i.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),r=this.inner[t];if(void 0===r)return!1;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return 1===r.length?delete this.inner[t]:r.splice(i,1),this.innerSize--,!0;return!1}forEach(e){mn(this.inner,(t,r)=>{for(const[i,s]of r)e(i,s)})}isEmpty(){return Hc(this.inner)}size(){return this.innerSize}}const at=new le(O.comparator);function Be(){return at}const hu=new le(O.comparator);function Gi(...n){let e=hu;for(const t of n)e=e.insert(t.key,t);return e}function co(n){let e=hu;return n.forEach((t,r)=>e=e.insert(t,r.overlayedDocument)),e}function _t(){return Fr()}function fl(){return Fr()}function Fr(){return new tn(n=>n.toString(),(n,e)=>n.isEqual(e))}const ld=new le(O.comparator),Pn=new ue(O.comparator);function J(...n){let e=Pn;for(const t of n)e=e.add(t);return e}const hd=new ue(Y);function du(){return hd}function pl(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Jn(e)?"-0":e}}function fu(n){return{integerValue:""+n}}function Ye(n,e){return js(e)?fu(e):pl(n,e)}class Ur{constructor(){this._=void 0}}function pu(n,e,t){return n instanceof Bt?function(i,s){const a={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return s&&eo(s)&&(s=to(s)),s&&(a.fields.__previous_value__=s),{mapValue:a}}(t,e):n instanceof Rn?mu(n,e):n instanceof ir?lo(n,e):function(i,s){const a=qt(i,s),h=ml(a)+ml(i.Ie);return Li(a)&&Li(i.Ie)?fu(h):pl(i.serializer,h)}(n,e)}function dd(n,e,t){return n instanceof Rn?mu(n,e):n instanceof ir?lo(n,e):t}function qt(n,e){return n instanceof qr?Li(r=e)||(s=r)&&"doubleValue"in s?e:{integerValue:0}:null;var r,s}class Bt extends Ur{}class Rn extends Ur{constructor(e){super(),this.elements=e}}function mu(n,e){const t=gl(e);for(const r of n.elements)t.some(i=>Ft(i,r))||t.push(r);return{arrayValue:{values:t}}}class ir extends Ur{constructor(e){super(),this.elements=e}}function lo(n,e){let t=gl(e);for(const r of n.elements)t=t.filter(i=>!Ft(i,r));return{arrayValue:{values:t}}}class qr extends Ur{constructor(e,t){super(),this.serializer=e,this.Ie=t}}function ml(n){return we(n.integerValue||n.doubleValue)}function gl(n){return Fi(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}class zi{constructor(e,t){this.field=e,this.transform=t}}class o{constructor(e,t){this.version=e,this.transformResults=t}}class u{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new u}static exists(e){return new u(void 0,e)}static updateTime(e){return new u(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function l(n,e){return void 0!==n.updateTime?e.isFoundDocument()&&e.version.isEqual(n.updateTime):void 0===n.exists||n.exists===e.isFoundDocument()}class f{}function _(n,e){if(!n.hasLocalMutations||e&&0===e.fields.length)return null;if(null===e)return n.isNoDocument()?new sr(n.key,u.none()):new Z(n.key,n.data,u.none());{const t=n.data,r=Ke.empty();let i=new ue(me.comparator);for(let s of e.fields)if(!i.has(s)){let a=t.field(s);null===a&&s.length>1&&(s=s.popLast(),a=t.field(s)),null===a?r.delete(s):r.set(s,a),i=i.add(s)}return new U(n.key,r,new et(i.toArray()),u.none())}}function I(n,e,t){n instanceof Z?function(i,s,a){const h=i.value.clone(),d=yt(i.fieldTransforms,s,a.transformResults);h.setAll(d),s.convertToFoundDocument(a.version,h).setHasCommittedMutations()}(n,e,t):n instanceof U?function(i,s,a){if(!l(i.precondition,s))return void s.convertToUnknownDocument(a.version);const h=yt(i.fieldTransforms,s,a.transformResults),d=s.data;d.setAll(ye(i)),d.setAll(h),s.convertToFoundDocument(a.version,d).setHasCommittedMutations()}(n,e,t):e.convertToNoDocument(t.version).setHasCommittedMutations()}function E(n,e,t,r){return n instanceof Z?function(s,a,h,d){if(!l(s.precondition,a))return h;const m=s.value.clone(),g=Wi(s.fieldTransforms,d,a);return m.setAll(g),a.convertToFoundDocument(a.version,m).setHasLocalMutations(),null}(n,e,t,r):n instanceof U?function(s,a,h,d){if(!l(s.precondition,a))return h;const m=Wi(s.fieldTransforms,d,a),g=a.data;return g.setAll(ye(s)),g.setAll(m),a.convertToFoundDocument(a.version,g).setHasLocalMutations(),null===h?null:h.unionWith(s.fieldMask.fields).unionWith(s.fieldTransforms.map(y=>y.field))}(n,e,t,r):(h=t,l(n.precondition,a=e)?(a.convertToNoDocument(a.version).setHasLocalMutations(),null):h);var a,h}function S(n,e){let t=null;for(const r of n.fieldTransforms){const i=e.data.field(r.field),s=qt(r.transform,i||null);null!=s&&(null===t&&(t=Ke.empty()),t.set(r.field,s))}return t||null}function L(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&(i=e.fieldTransforms,!!(void 0===(r=n.fieldTransforms)&&void 0===i||r&&i&&xr(r,i,(s,a)=>function c(n,e){return n.field.isEqual(e.field)&&(i=e.transform,(r=n.transform)instanceof Rn&&i instanceof Rn||r instanceof ir&&i instanceof ir?xr(r.elements,i.elements,Ft):r instanceof qr&&i instanceof qr?Ft(r.Ie,i.Ie):r instanceof Bt&&i instanceof Bt);var r,i}(s,a))))&&(0===n.type?n.value.isEqual(e.value):1!==n.type||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask));var r,i}class Z extends f{constructor(e,t,r,i=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}}class U extends f{constructor(e,t,r,i,s=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=i,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}}function ye(n){const e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){const r=n.data.field(t);e.set(t,r)}}),e}function yt(n,e,t){const r=new Map;z(n.length===t.length);for(let i=0;i<t.length;i++){const s=n[i],a=s.transform,h=e.data.field(s.field);r.set(s.field,dd(a,h,t[i]))}return r}function Wi(n,e,t){const r=new Map;for(const i of n){const s=i.transform,a=t.data.field(i.field);r.set(i.field,pu(s,a,e))}return r}class sr extends f{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Ki extends f{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class ho{constructor(e,t,r,i){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=i}applyToRemoteDocument(e,t){const r=t.mutationResults;for(let i=0;i<this.mutations.length;i++){const s=this.mutations[i];s.key.isEqual(e.key)&&I(s,e,r[i])}}applyToLocalView(e,t){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(t=E(r,e,t,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(t=E(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const r=fl();return this.mutations.forEach(i=>{const s=e.get(i.key),a=s.overlayedDocument;let h=this.applyToLocalView(a,s.mutatedFields);h=t.has(i.key)?null:h;const d=_(a,h);null!==d&&r.set(i.key,d),a.isValidDocument()||a.convertToNoDocument(K.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),J())}isEqual(e){return this.batchId===e.batchId&&xr(this.mutations,e.mutations,(t,r)=>L(t,r))&&xr(this.baseMutations,e.baseMutations,(t,r)=>L(t,r))}}class fo{constructor(e,t,r,i){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=i}static from(e,t,r){z(e.mutations.length===r.length);let i=ld;const s=e.mutations;for(let a=0;a<s.length;a++)i=i.insert(s[a].key,r[a].version);return new fo(e,t,r,i)}}class ji{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class yl{constructor(e,t){this.count=e,this.unchangedNames=t}}var Pe,ne;function Il(n){switch(n){default:return B();case P.CANCELLED:case P.UNKNOWN:case P.DEADLINE_EXCEEDED:case P.RESOURCE_EXHAUSTED:case P.INTERNAL:case P.UNAVAILABLE:case P.UNAUTHENTICATED:return!1;case P.INVALID_ARGUMENT:case P.NOT_FOUND:case P.ALREADY_EXISTS:case P.PERMISSION_DENIED:case P.FAILED_PRECONDITION:case P.ABORTED:case P.OUT_OF_RANGE:case P.UNIMPLEMENTED:case P.DATA_LOSS:return!0}}function po(n){if(void 0===n)return Ae("GRPC error has no .code"),P.UNKNOWN;switch(n){case Pe.OK:return P.OK;case Pe.CANCELLED:return P.CANCELLED;case Pe.UNKNOWN:return P.UNKNOWN;case Pe.DEADLINE_EXCEEDED:return P.DEADLINE_EXCEEDED;case Pe.RESOURCE_EXHAUSTED:return P.RESOURCE_EXHAUSTED;case Pe.INTERNAL:return P.INTERNAL;case Pe.UNAVAILABLE:return P.UNAVAILABLE;case Pe.UNAUTHENTICATED:return P.UNAUTHENTICATED;case Pe.INVALID_ARGUMENT:return P.INVALID_ARGUMENT;case Pe.NOT_FOUND:return P.NOT_FOUND;case Pe.ALREADY_EXISTS:return P.ALREADY_EXISTS;case Pe.PERMISSION_DENIED:return P.PERMISSION_DENIED;case Pe.FAILED_PRECONDITION:return P.FAILED_PRECONDITION;case Pe.ABORTED:return P.ABORTED;case Pe.OUT_OF_RANGE:return P.OUT_OF_RANGE;case Pe.UNIMPLEMENTED:return P.UNIMPLEMENTED;case Pe.DATA_LOSS:return P.DATA_LOSS;default:return B()}}(ne=Pe||(Pe={}))[ne.OK=0]="OK",ne[ne.CANCELLED=1]="CANCELLED",ne[ne.UNKNOWN=2]="UNKNOWN",ne[ne.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",ne[ne.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",ne[ne.NOT_FOUND=5]="NOT_FOUND",ne[ne.ALREADY_EXISTS=6]="ALREADY_EXISTS",ne[ne.PERMISSION_DENIED=7]="PERMISSION_DENIED",ne[ne.UNAUTHENTICATED=16]="UNAUTHENTICATED",ne[ne.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",ne[ne.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",ne[ne.ABORTED=10]="ABORTED",ne[ne.OUT_OF_RANGE=11]="OUT_OF_RANGE",ne[ne.UNIMPLEMENTED=12]="UNIMPLEMENTED",ne[ne.INTERNAL=13]="INTERNAL",ne[ne.UNAVAILABLE=14]="UNAVAILABLE",ne[ne.DATA_LOSS=15]="DATA_LOSS";function mp(){return new TextEncoder}const Wg=new $n([4294967295,4294967295],0);function gp(n){const e=mp().encode(n),t=new Oh;return t.update(e),new Uint8Array(t.digest())}function _p(n){const e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),i=e.getUint32(8,!0),s=e.getUint32(12,!0);return[new $n([t,r],0),new $n([i,s],0)]}class fd{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new gu(`Invalid padding: ${t}`);if(r<0)throw new gu(`Invalid hash count: ${r}`);if(e.length>0&&0===this.hashCount)throw new gu(`Invalid hash count: ${r}`);if(0===e.length&&0!==t)throw new gu(`Invalid padding when bitmap length is 0: ${t}`);this.Te=8*e.length-t,this.Ee=$n.fromNumber(this.Te)}de(e,t,r){let i=e.add(t.multiply($n.fromNumber(r)));return 1===i.compare(Wg)&&(i=new $n([i.getBits(0),i.getBits(1)],0)),i.modulo(this.Ee).toNumber()}Ae(e){return 0!=(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(0===this.Te)return!1;const t=gp(e),[r,i]=_p(t);for(let s=0;s<this.hashCount;s++){const a=this.de(r,i,s);if(!this.Ae(a))return!1}return!0}static create(e,t,r){const i=e%8==0?0:8-e%8,s=new Uint8Array(Math.ceil(e/8)),a=new fd(s,i,t);return r.forEach(h=>a.insert(h)),a}insert(e){if(0===this.Te)return;const t=gp(e),[r,i]=_p(t);for(let s=0;s<this.hashCount;s++){const a=this.de(r,i,s);this.Re(a)}}Re(e){const t=Math.floor(e/8);this.bitmap[t]|=1<<e%8}}class gu extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class _u{constructor(e,t,r,i,s){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=i,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,t,r){const i=new Map;return i.set(e,yu.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new _u(K.min(),i,new le(Y),Be(),J())}}class yu{constructor(e,t,r,i,s){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=i,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new yu(r,t,J(),J(),J())}}class vl{constructor(e,t,r,i){this.Ve=e,this.removedTargetIds=t,this.key=r,this.me=i}}class yp{constructor(e,t){this.targetId=e,this.fe=t}}class Ip{constructor(e,t,r=Me.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=i}}class vp{constructor(){this.ge=0,this.pe=Ep(),this.ye=Me.EMPTY_BYTE_STRING,this.we=!1,this.Se=!0}get current(){return this.we}get resumeToken(){return this.ye}get be(){return 0!==this.ge}get De(){return this.Se}Ce(e){e.approximateByteSize()>0&&(this.Se=!0,this.ye=e)}ve(){let e=J(),t=J(),r=J();return this.pe.forEach((i,s)=>{switch(s){case 0:e=e.add(i);break;case 2:t=t.add(i);break;case 1:r=r.add(i);break;default:B()}}),new yu(this.ye,this.we,e,t,r)}Fe(){this.Se=!1,this.pe=Ep()}Me(e,t){this.Se=!0,this.pe=this.pe.insert(e,t)}xe(e){this.Se=!0,this.pe=this.pe.remove(e)}Oe(){this.ge+=1}Ne(){this.ge-=1}Be(){this.Se=!0,this.we=!0}}class Kg{constructor(e){this.Le=e,this.ke=new Map,this.qe=Be(),this.Qe=Tp(),this.Ke=new le(Y)}$e(e){for(const t of e.Ve)e.me&&e.me.isFoundDocument()?this.Ue(t,e.me):this.We(t,e.key,e.me);for(const t of e.removedTargetIds)this.We(t,e.key,e.me)}Ge(e){this.forEachTarget(e,t=>{const r=this.ze(t);switch(e.state){case 0:this.je(t)&&r.Ce(e.resumeToken);break;case 1:r.Ne(),r.be||r.Fe(),r.Ce(e.resumeToken);break;case 2:r.Ne(),r.be||this.removeTarget(t);break;case 3:this.je(t)&&(r.Be(),r.Ce(e.resumeToken));break;case 4:this.je(t)&&(this.He(t),r.Ce(e.resumeToken));break;default:B()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.ke.forEach((r,i)=>{this.je(i)&&t(i)})}Je(e){const t=e.targetId,r=e.fe.count,i=this.Ye(t);if(i){const s=i.target;if(oo(s))if(0===r){const a=new O(s.path);this.We(t,a,he.newNoDocument(a,K.min()))}else z(1===r);else{const a=this.Ze(t);if(a!==r){const h=this.Xe(e),d=h?this.et(h,e,a):1;0!==d&&(this.He(t),this.Ke=this.Ke.insert(t,2===d?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch"))}}}}Xe(e){const t=e.fe.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:r="",padding:i=0},hashCount:s=0}=t;let a,h;try{a=Xt(r).toUint8Array()}catch(d){if(d instanceof Yc)return je("Decoding the base64 bloom filter in existence filter failed ("+d.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw d}try{h=new fd(a,i,s)}catch(d){return je(d instanceof gu?"BloomFilter error: ":"Applying bloom filter failed: ",d),null}return 0===h.Te?null:h}et(e,t,r){return t.fe.count===r-this.rt(e,t.targetId)?0:2}rt(e,t){const r=this.Le.getRemoteKeysForTarget(t);let i=0;return r.forEach(s=>{const a=this.Le.nt(),h=`projects/${a.projectId}/databases/${a.database}/documents/${s.path.canonicalString()}`;e.mightContain(h)||(this.We(t,s,null),i++)}),i}it(e){const t=new Map;this.ke.forEach((s,a)=>{const h=this.Ye(a);if(h){if(s.current&&oo(h.target)){const d=new O(h.target.path);null!==this.qe.get(d)||this.st(a,d)||this.We(a,d,he.newNoDocument(d,e))}s.De&&(t.set(a,s.ve()),s.Fe())}});let r=J();this.Qe.forEach((s,a)=>{let h=!0;a.forEachWhile(d=>{const m=this.Ye(d);return!m||"TargetPurposeLimboResolution"===m.purpose||(h=!1,!1)}),h&&(r=r.add(s))}),this.qe.forEach((s,a)=>a.setReadTime(e));const i=new _u(e,t,this.Ke,this.qe,r);return this.qe=Be(),this.Qe=Tp(),this.Ke=new le(Y),i}Ue(e,t){if(!this.je(e))return;const r=this.st(e,t.key)?2:0;this.ze(e).Me(t.key,r),this.qe=this.qe.insert(t.key,t),this.Qe=this.Qe.insert(t.key,this.ot(t.key).add(e))}We(e,t,r){if(!this.je(e))return;const i=this.ze(e);this.st(e,t)?i.Me(t,1):i.xe(t),this.Qe=this.Qe.insert(t,this.ot(t).delete(e)),r&&(this.qe=this.qe.insert(t,r))}removeTarget(e){this.ke.delete(e)}Ze(e){const t=this.ze(e).ve();return this.Le.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Oe(e){this.ze(e).Oe()}ze(e){let t=this.ke.get(e);return t||(t=new vp,this.ke.set(e,t)),t}ot(e){let t=this.Qe.get(e);return t||(t=new ue(Y),this.Qe=this.Qe.insert(e,t)),t}je(e){const t=null!==this.Ye(e);return t||x("WatchChangeAggregator","Detected inactive target",e),t}Ye(e){const t=this.ke.get(e);return t&&t.be?null:this.Le._t(e)}He(e){this.ke.set(e,new vp),this.Le.getRemoteKeysForTarget(e).forEach(t=>{this.We(e,t,null)})}st(e,t){return this.Le.getRemoteKeysForTarget(e).has(t)}}function Tp(){return new le(O.comparator)}function Ep(){return new le(O.comparator)}const jg={asc:"ASCENDING",desc:"DESCENDING"},$g={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},Hg={and:"AND",or:"OR"};class Qg{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function pd(n,e){return n.useProto3Json||Yn(e)?e:{value:e}}function go(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function Ap(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function Yg(n,e){return go(n,e.toTimestamp())}function Le(n){return z(!!n),K.fromTimestamp(function(t){const r=Lt(t);return new pe(r.seconds,r.nanos)}(n))}function md(n,e){return(r=n,new ie(["projects",r.projectId,"databases",r.database])).child("documents").child(e).canonicalString();var r}function wp(n){const e=ie.fromString(n);return z(Vp(e)),e}function Iu(n,e){return md(n.databaseId,e.path)}function Sn(n,e){const t=wp(e);if(t.get(1)!==n.databaseId.projectId)throw new b(P.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new b(P.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new O(Rp(t))}function gd(n,e){return md(n.databaseId,e)}function Pp(n){const e=wp(n);return 4===e.length?ie.emptyPath():Rp(e)}function vu(n){return new ie(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function Rp(n){return z(n.length>4&&"documents"===n.get(4)),n.popFirst(5)}function Sp(n,e,t){return{name:Iu(n,e),fields:t.value.mapValue.fields}}function Cp(n,e,t){const r=Sn(n,e.name),i=Le(e.updateTime),s=e.createTime?Le(e.createTime):K.min(),a=new Ke({mapValue:{fields:e.fields}}),h=he.newFoundDocument(r,i,s,a);return t&&h.setHasCommittedMutations(),t?h.setHasCommittedMutations():h}function Tu(n,e){let t;if(e instanceof Z)t={update:Sp(n,e.key,e.value)};else if(e instanceof sr)t={delete:Iu(n,e.key)};else if(e instanceof U)t={update:Sp(n,e.key,e.data),updateMask:s_(e.fieldMask)};else{if(!(e instanceof Ki))return B();t={verify:Iu(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(r=>function(s,a){const h=a.transform;if(h instanceof Bt)return{fieldPath:a.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(h instanceof Rn)return{fieldPath:a.field.canonicalString(),appendMissingElements:{values:h.elements}};if(h instanceof ir)return{fieldPath:a.field.canonicalString(),removeAllFromArray:{values:h.elements}};if(h instanceof qr)return{fieldPath:a.field.canonicalString(),increment:h.Ie};throw B()}(0,r))),e.precondition.isNone||(t.currentDocument=void 0!==(s=e.precondition).updateTime?{updateTime:Yg(n,s.updateTime)}:void 0!==s.exists?{exists:s.exists}:B()),t;var s}function _d(n,e){const t=e.currentDocument?void 0!==(s=e.currentDocument).updateTime?u.updateTime(Le(s.updateTime)):void 0!==s.exists?u.exists(s.exists):u.none():u.none(),r=e.updateTransforms?e.updateTransforms.map(i=>function(a,h){let d=null;"setToServerValue"in h?(z("REQUEST_TIME"===h.setToServerValue),d=new Bt):"appendMissingElements"in h?d=new Rn(h.appendMissingElements.values||[]):"removeAllFromArray"in h?d=new ir(h.removeAllFromArray.values||[]):"increment"in h?d=new qr(a,h.increment):B();const m=me.fromServerFormat(h.fieldPath);return new zi(m,d)}(n,i)):[];var s;if(e.update){const i=Sn(n,e.update.name),s=new Ke({mapValue:{fields:e.update.fields}});if(e.updateMask){const a=new et((e.updateMask.fieldPaths||[]).map(g=>me.fromServerFormat(g)));return new U(i,s,a,t,r)}return new Z(i,s,t,r)}if(e.delete){const i=Sn(n,e.delete);return new sr(i,t)}if(e.verify){const i=Sn(n,e.verify);return new Ki(i,t)}return B()}function bp(n,e){return{documents:[gd(n,e.path)]}}function yd(n,e){const t={structuredQuery:{}},r=e.path;null!==e.collectionGroup?(t.parent=gd(n,r),t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(t.parent=gd(n,r.popLast()),t.structuredQuery.from=[{collectionId:r.lastSegment()}]);const i=function(d){if(0!==d.length)return Np(se.create(d,"and"))}(e.filters);i&&(t.structuredQuery.where=i);const s=function(d){if(0!==d.length)return d.map(m=>{return{field:Br((y=m).field),direction:n_(y.dir)};var y})}(e.orderBy);s&&(t.structuredQuery.orderBy=s);const a=pd(n,e.limit);return null!==a&&(t.structuredQuery.limit=a),e.startAt&&(t.structuredQuery.startAt={before:(d=e.startAt).inclusive,values:d.position}),e.endAt&&(t.structuredQuery.endAt=function(d){return{before:!d.inclusive,values:d.position}}(e.endAt)),t;var d}function xp(n){let e=Pp(n.parent);const t=n.structuredQuery,r=t.from?t.from.length:0;let i=null;if(r>0){z(1===r);const g=t.from[0];g.allDescendants?i=g.collectionId:e=e.child(g.collectionId)}let s=[];t.where&&(s=function(y){const T=kp(y);return T instanceof se&&Bi(T)?T.getFilters():[T]}(t.where));let a=[];t.orderBy&&(a=t.orderBy.map(T=>{return new qi(_o((k=T).field),function(V){switch(V){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(k.direction));var k}));let h=null;t.limit&&(h=function(y){let T;return T="object"==typeof y?y.value:y,Yn(T)?null:T}(t.limit));let d=null;var y;t.startAt&&(d=new Tn((y=t.startAt).values||[],!!y.before));let m=null;return t.endAt&&(m=function(y){return new Tn(y.values||[],!y.before)}(t.endAt)),cl(e,i,a,s,h,"F",d,m)}function kp(n){return void 0!==n.unaryFilter?function(t){switch(t.unaryFilter.op){case"IS_NAN":const r=_o(t.unaryFilter.field);return te.create(r,"==",{doubleValue:NaN});case"IS_NULL":const i=_o(t.unaryFilter.field);return te.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const s=_o(t.unaryFilter.field);return te.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const a=_o(t.unaryFilter.field);return te.create(a,"!=",{nullValue:"NULL_VALUE"});default:return B()}}(n):void 0!==n.fieldFilter?te.create(_o((t=n).fieldFilter.field),function(i){switch(i){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return B()}}(t.fieldFilter.op),t.fieldFilter.value):void 0!==n.compositeFilter?function(t){return se.create(t.compositeFilter.filters.map(r=>kp(r)),function(i){switch(i){case"AND":return"and";case"OR":return"or";default:return B()}}(t.compositeFilter.op))}(n):B();var t}function n_(n){return jg[n]}function r_(n){return $g[n]}function i_(n){return Hg[n]}function Br(n){return{fieldPath:n.canonicalString()}}function _o(n){return me.fromServerFormat(n.fieldPath)}function Np(n){return n instanceof te?function(t){if("=="===t.op){if(ro(t.value))return{unaryFilter:{field:Br(t.field),op:"IS_NAN"}};if(nd(t.value))return{unaryFilter:{field:Br(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(ro(t.value))return{unaryFilter:{field:Br(t.field),op:"IS_NOT_NAN"}};if(nd(t.value))return{unaryFilter:{field:Br(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Br(t.field),op:r_(t.op),value:t.value}}}(n):n instanceof se?function(t){const r=t.getFilters().map(i=>Np(i));return 1===r.length?r[0]:{compositeFilter:{op:i_(t.op),filters:r}}}(n):B()}function s_(n){const e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function Vp(n){return n.length>=4&&"projects"===n.get(0)&&"databases"===n.get(2)}class or{constructor(e,t,r,i,s=K.min(),a=K.min(),h=Me.EMPTY_BYTE_STRING,d=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=i,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=a,this.resumeToken=h,this.expectedCount=d}withSequenceNumber(e){return new or(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new or(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new or(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new or(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class Dp{constructor(e){this.ut=e}}function Op(n,e){const t=e.key,r={prefixPath:t.getCollectionPath().popLast().toArray(),collectionGroup:t.collectionGroup,documentId:t.path.lastSegment(),readTime:Tl(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())r.document={name:Iu(s=n.ut,(a=e).key),fields:a.data.value.mapValue.fields,updateTime:go(s,a.version.toTimestamp()),createTime:go(s,a.createTime.toTimestamp())};else if(e.isNoDocument())r.noDocument={path:t.path.toArray(),readTime:$i(e.version)};else{if(!e.isUnknownDocument())return B();r.unknownDocument={path:t.path.toArray(),version:$i(e.version)}}var s,a;return r}function Tl(n){const e=n.toTimestamp();return[e.seconds,e.nanoseconds]}function $i(n){const e=n.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function Hi(n){const e=new pe(n.seconds,n.nanoseconds);return K.fromTimestamp(e)}function Qi(n,e){const t=(e.baseMutations||[]).map(s=>_d(n.ut,s));for(let s=0;s<e.mutations.length-1;++s)s+1<e.mutations.length&&void 0!==e.mutations[s+1].transform&&(e.mutations[s].updateTransforms=e.mutations[s+1].transform.fieldTransforms,e.mutations.splice(s+1,1),++s);const r=e.mutations.map(s=>_d(n.ut,s)),i=pe.fromMillis(e.localWriteTimeMs);return new ho(e.batchId,i,t,r)}function Eu(n){const e=Hi(n.readTime),t=void 0!==n.lastLimboFreeSnapshotVersion?Hi(n.lastLimboFreeSnapshotVersion):K.min();let r;return r=void 0!==n.query.documents?(z(1===(s=n.query).documents.length),He(Mr(Pp(s.documents[0])))):function(s){return He(xp(s))}(n.query),new or(r,n.targetId,"TargetPurposeListen",n.lastListenSequenceNumber,e,t,Me.fromBase64String(n.resumeToken));var s}function Mp(n,e){const t=$i(e.snapshotVersion),r=$i(e.lastLimboFreeSnapshotVersion);let i;i=oo(e.target)?bp(n.ut,e.target):yd(n.ut,e.target);const s=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:tr(e.target),readTime:t,resumeToken:s,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:i}}function Id(n){const e=xp({parent:n.parent,structuredQuery:n.structuredQuery});return"LAST"===n.limitType?uo(e,e.limit,"L"):e}function vd(n,e){return new ji(e.largestBatchId,_d(n.ut,e.overlayMutation))}function Lp(n,e){const t=e.path.lastSegment();return[n,$e(e.path.popLast()),t]}function Fp(n,e,t,r){return{indexId:n,uid:e.uid||"",sequenceNumber:t,readTime:$i(r.readTime),documentKey:$e(r.documentKey.path),largestBatchId:r.largestBatchId}}class a_{getBundleMetadata(e,t){return Up(e).get(t).next(r=>{if(r)return{id:(s=r).bundleId,createTime:Hi(s.createTime),version:s.version};var s})}saveBundleMetadata(e,t){return Up(e).put({bundleId:(i=t).id,createTime:$i(Le(i.createTime)),version:i.version});var i}getNamedQuery(e,t){return qp(e).get(t).next(r=>{if(r)return{name:(s=r).name,query:Id(s.bundledQuery),readTime:Hi(s.readTime)};var s})}saveNamedQuery(e,t){return qp(e).put({name:(i=t).name,readTime:$i(Le(i.readTime)),bundledQuery:i.bundledQuery});var i}}function Up(n){return qe(n,"bundles")}function qp(n){return qe(n,"namedQueries")}class El{constructor(e,t){this.serializer=e,this.userId=t}static ct(e,t){return new El(e,t.uid||"")}getOverlay(e,t){return Au(e).get(Lp(this.userId,t)).next(r=>r?vd(this.serializer,r):null)}getOverlays(e,t){const r=_t();return A.forEach(t,i=>this.getOverlay(e,i).next(s=>{null!==s&&r.set(i,s)})).next(()=>r)}saveOverlays(e,t,r){const i=[];return r.forEach((s,a)=>{const h=new ji(t,a);i.push(this.lt(e,h))}),A.waitFor(i)}removeOverlaysForBatchId(e,t,r){const i=new Set;t.forEach(a=>i.add($e(a.getCollectionPath())));const s=[];return i.forEach(a=>{const h=IDBKeyRange.bound([this.userId,a,r],[this.userId,a,r+1],!1,!0);s.push(Au(e).H("collectionPathOverlayIndex",h))}),A.waitFor(s)}getOverlaysForCollection(e,t,r){const i=_t(),s=$e(t),a=IDBKeyRange.bound([this.userId,s,r],[this.userId,s,Number.POSITIVE_INFINITY],!0);return Au(e).W("collectionPathOverlayIndex",a).next(h=>{for(const d of h){const m=vd(this.serializer,d);i.set(m.getKey(),m)}return i})}getOverlaysForCollectionGroup(e,t,r,i){const s=_t();let a;const h=IDBKeyRange.bound([this.userId,t,r],[this.userId,t,Number.POSITIVE_INFINITY],!0);return Au(e).Y({index:"collectionGroupOverlayIndex",range:h},(d,m,g)=>{const y=vd(this.serializer,m);s.size()<i||y.largestBatchId===a?(s.set(y.getKey(),y),a=y.largestBatchId):g.done()}).next(()=>s)}lt(e,t){return Au(e).put(function(i,s,a){const[h,d,m]=Lp(s,a.mutation.key);return{userId:s,collectionPath:d,documentId:m,collectionGroup:a.mutation.key.getCollectionGroup(),largestBatchId:a.largestBatchId,overlayMutation:Tu(i.ut,a.mutation)}}(this.serializer,this.userId,t))}}function Au(n){return qe(n,"documentOverlays")}class Yi{constructor(){}ht(e,t){this.Pt(e,t),t.It()}Pt(e,t){if("nullValue"in e)this.Tt(t,5);else if("booleanValue"in e)this.Tt(t,10),t.Et(e.booleanValue?1:0);else if("integerValue"in e)this.Tt(t,15),t.Et(we(e.integerValue));else if("doubleValue"in e){const r=we(e.doubleValue);isNaN(r)?this.Tt(t,13):(this.Tt(t,15),Jn(r)?t.Et(0):t.Et(r))}else if("timestampValue"in e){const r=e.timestampValue;this.Tt(t,20),"string"==typeof r?t.dt(r):(t.dt(`${r.seconds||""}`),t.Et(r.nanos||0))}else if("stringValue"in e)this.At(e.stringValue,t),this.Rt(t);else if("bytesValue"in e)this.Tt(t,30),t.Vt(Xt(e.bytesValue)),this.Rt(t);else if("referenceValue"in e)this.ft(e.referenceValue,t);else if("geoPointValue"in e){const r=e.geoPointValue;this.Tt(t,45),t.Et(r.latitude||0),t.Et(r.longitude||0)}else"mapValue"in e?Ja(e)?this.Tt(t,Number.MAX_SAFE_INTEGER):(this.gt(e.mapValue,t),this.Rt(t)):"arrayValue"in e?(this.yt(e.arrayValue,t),this.Rt(t)):B()}At(e,t){this.Tt(t,25),this.wt(e,t)}wt(e,t){t.dt(e)}gt(e,t){const r=e.fields||{};this.Tt(t,55);for(const i of Object.keys(r))this.At(i,t),this.Pt(r[i],t)}yt(e,t){const r=e.values||[];this.Tt(t,50);for(const i of r)this.Pt(i,t)}ft(e,t){this.Tt(t,37),O.fromName(e).path.forEach(r=>{this.Tt(t,60),this.wt(r,t)})}Tt(e,t){e.Et(t)}Rt(e){e.Et(2)}}function u_(n){if(0===n)return 8;let e=0;return!(n>>4)&&(e+=4,n<<=4),!(n>>6)&&(e+=2,n<<=2),!(n>>7)&&(e+=1),e}function Bp(n){const e=64-function(r){let i=0;for(let s=0;s<8;++s){const a=u_(255&r[s]);if(i+=a,8!==a)break}return i}(n);return Math.ceil(e/8)}Yi.St=new Yi;class c_{constructor(){this.buffer=new Uint8Array(1024),this.position=0}bt(e){const t=e[Symbol.iterator]();let r=t.next();for(;!r.done;)this.Dt(r.value),r=t.next();this.Ct()}vt(e){const t=e[Symbol.iterator]();let r=t.next();for(;!r.done;)this.Ft(r.value),r=t.next();this.Mt()}xt(e){for(const t of e){const r=t.charCodeAt(0);if(r<128)this.Dt(r);else if(r<2048)this.Dt(960|r>>>6),this.Dt(128|63&r);else if(t<"\ud800"||"\udbff"<t)this.Dt(480|r>>>12),this.Dt(128|63&r>>>6),this.Dt(128|63&r);else{const i=t.codePointAt(0);this.Dt(240|i>>>18),this.Dt(128|63&i>>>12),this.Dt(128|63&i>>>6),this.Dt(128|63&i)}}this.Ct()}Ot(e){for(const t of e){const r=t.charCodeAt(0);if(r<128)this.Ft(r);else if(r<2048)this.Ft(960|r>>>6),this.Ft(128|63&r);else if(t<"\ud800"||"\udbff"<t)this.Ft(480|r>>>12),this.Ft(128|63&r>>>6),this.Ft(128|63&r);else{const i=t.codePointAt(0);this.Ft(240|i>>>18),this.Ft(128|63&i>>>12),this.Ft(128|63&i>>>6),this.Ft(128|63&i)}}this.Mt()}Nt(e){const t=this.Bt(e),r=Bp(t);this.Lt(1+r),this.buffer[this.position++]=255&r;for(let i=t.length-r;i<t.length;++i)this.buffer[this.position++]=255&t[i]}kt(e){const t=this.Bt(e),r=Bp(t);this.Lt(1+r),this.buffer[this.position++]=~(255&r);for(let i=t.length-r;i<t.length;++i)this.buffer[this.position++]=~(255&t[i])}qt(){this.Qt(255),this.Qt(255)}Kt(){this.$t(255),this.$t(255)}reset(){this.position=0}seed(e){this.Lt(e.length),this.buffer.set(e,this.position),this.position+=e.length}Ut(){return this.buffer.slice(0,this.position)}Bt(e){const t=function(s){const a=new DataView(new ArrayBuffer(8));return a.setFloat64(0,s,!1),new Uint8Array(a.buffer)}(e),r=0!=(128&t[0]);t[0]^=r?255:128;for(let i=1;i<t.length;++i)t[i]^=r?255:0;return t}Dt(e){const t=255&e;0===t?(this.Qt(0),this.Qt(255)):255===t?(this.Qt(255),this.Qt(0)):this.Qt(t)}Ft(e){const t=255&e;0===t?(this.$t(0),this.$t(255)):255===t?(this.$t(255),this.$t(0)):this.$t(e)}Ct(){this.Qt(0),this.Qt(1)}Mt(){this.$t(0),this.$t(1)}Qt(e){this.Lt(1),this.buffer[this.position++]=e}$t(e){this.Lt(1),this.buffer[this.position++]=~e}Lt(e){const t=e+this.position;if(t<=this.buffer.length)return;let r=2*this.buffer.length;r<t&&(r=t);const i=new Uint8Array(r);i.set(this.buffer),this.buffer=i}}class l_{constructor(e){this.Wt=e}Vt(e){this.Wt.bt(e)}dt(e){this.Wt.xt(e)}Et(e){this.Wt.Nt(e)}It(){this.Wt.qt()}}class h_{constructor(e){this.Wt=e}Vt(e){this.Wt.vt(e)}dt(e){this.Wt.Ot(e)}Et(e){this.Wt.kt(e)}It(){this.Wt.Kt()}}class wu{constructor(){this.Wt=new c_,this.Gt=new l_(this.Wt),this.zt=new h_(this.Wt)}seed(e){this.Wt.seed(e)}jt(e){return 0===e?this.Gt:this.zt}Ut(){return this.Wt.Ut()}reset(){this.Wt.reset()}}class Ji{constructor(e,t,r,i){this.indexId=e,this.documentKey=t,this.arrayValue=r,this.directionalValue=i}Ht(){const e=this.directionalValue.length,t=0===e||255===this.directionalValue[e-1]?e+1:e,r=new Uint8Array(t);return r.set(this.directionalValue,0),t!==e?r.set([0],this.directionalValue.length):++r[r.length-1],new Ji(this.indexId,this.documentKey,this.arrayValue,r)}}function Zr(n,e){let t=n.indexId-e.indexId;return 0!==t?t:(t=Zp(n.arrayValue,e.arrayValue),0!==t?t:(t=Zp(n.directionalValue,e.directionalValue),0!==t?t:O.comparator(n.documentKey,e.documentKey)))}function Zp(n,e){for(let t=0;t<n.length&&t<e.length;++t){const r=n[t]-e[t];if(0!==r)return r}return n.length-e.length}class Gp{constructor(e){this.Jt=new ue((t,r)=>me.comparator(t.field,r.field)),this.collectionId=null!=e.collectionGroup?e.collectionGroup:e.path.lastSegment(),this.Yt=e.orderBy,this.Zt=[];for(const t of e.filters){const r=t;r.isInequality()?this.Jt=this.Jt.add(r):this.Zt.push(r)}}get Xt(){return this.Jt.size>1}en(e){if(z(e.collectionGroup===this.collectionId),this.Xt)return!1;const t=xi(e);if(void 0!==t&&!this.tn(t))return!1;const r=Qn(e);let i=new Set,s=0,a=0;for(;s<r.length&&this.tn(r[s]);++s)i=i.add(r[s].fieldPath.canonicalString());if(s===r.length)return!0;if(this.Jt.size>0){const h=this.Jt.getIterator().getNext();if(!i.has(h.field.canonicalString())){const d=r[s];if(!this.nn(h,d)||!this.rn(this.Yt[a++],d))return!1}++s}for(;s<r.length;++s)if(a>=this.Yt.length||!this.rn(this.Yt[a++],r[s]))return!1;return!0}sn(){if(this.Xt)return null;let e=new ue(me.comparator);const t=[];for(const r of this.Zt)if(!r.field.isKeyField())if("array-contains"===r.op||"array-contains-any"===r.op)t.push(new Ot(r.field,2));else{if(e.has(r.field))continue;e=e.add(r.field),t.push(new Ot(r.field,0))}for(const r of this.Yt)r.field.isKeyField()||e.has(r.field)||(e=e.add(r.field),t.push(new Ot(r.field,"asc"===r.dir?0:1)));return new kr(kr.UNKNOWN_ID,this.collectionId,t,Nr.empty())}tn(e){for(const t of this.Zt)if(this.nn(t,e))return!0;return!1}nn(e,t){return!(void 0===e||!e.field.isEqual(t.fieldPath))&&2===t.kind==("array-contains"===e.op||"array-contains-any"===e.op)}rn(e,t){return!!e.field.isEqual(t.fieldPath)&&(0===t.kind&&"asc"===e.dir||1===t.kind&&"desc"===e.dir)}}function zp(n){var e,t;if(z(n instanceof te||n instanceof se),n instanceof te){if(n instanceof al){const i=(null===(t=null===(e=n.value.arrayValue)||void 0===e?void 0:e.values)||void 0===t?void 0:t.map(s=>te.create(n.field,"==",s)))||[];return se.create(i,"or")}return n}const r=n.filters.map(i=>zp(i));return se.create(r,n.op)}function d_(n){if(0===n.getFilters().length)return[];const e=Ad(zp(n));return z(Wp(e)),Td(e)||Ed(e)?[e]:e.getFilters()}function Td(n){return n instanceof te}function Ed(n){return n instanceof se&&Bi(n)}function Wp(n){return Td(n)||Ed(n)||function(t){if(t instanceof se&&Xa(t)){for(const r of t.getFilters())if(!Td(r)&&!Ed(r))return!1;return!0}return!1}(n)}function Ad(n){if(z(n instanceof te||n instanceof se),n instanceof te)return n;if(1===n.filters.length)return Ad(n.filters[0]);const e=n.filters.map(r=>Ad(r));let t=se.create(e,n.op);return t=Al(t),Wp(t)?t:(z(t instanceof se),z(Or(t)),z(t.filters.length>1),t.filters.reduce((r,i)=>wd(r,i)))}function wd(n,e){let t;return z(n instanceof te||n instanceof se),z(e instanceof te||e instanceof se),t=n instanceof te?e instanceof te?se.create([n,e],"and"):Kp(n,e):e instanceof te?Kp(e,n):function(i,s){if(z(i.filters.length>0&&s.filters.length>0),Or(i)&&Or(s))return sl(i,s.getFilters());const a=Xa(i)?i:s,h=Xa(i)?s:i,d=a.filters.map(m=>wd(m,h));return se.create(d,"or")}(n,e),Al(t)}function Kp(n,e){if(Or(e))return sl(e,n.getFilters());{const t=e.filters.map(r=>wd(n,r));return se.create(t,"or")}}function Al(n){if(z(n instanceof te||n instanceof se),n instanceof te)return n;const e=n.getFilters();if(1===e.length)return Al(e[0]);if(il(n))return n;const t=e.map(i=>Al(i)),r=[];return t.forEach(i=>{i instanceof te?r.push(i):i instanceof se&&(i.op===n.op?r.push(...i.filters):r.push(i))}),1===r.length?r[0]:se.create(r,n.op)}class f_{constructor(){this.on=new Pd}addToCollectionParentIndex(e,t){return this.on.add(t),A.resolve()}getCollectionParents(e,t){return A.resolve(this.on.getEntries(t))}addFieldIndex(e,t){return A.resolve()}deleteFieldIndex(e,t){return A.resolve()}deleteAllFieldIndexes(e){return A.resolve()}createTargetIndexes(e,t){return A.resolve()}getDocumentsMatchingTarget(e,t){return A.resolve(null)}getIndexType(e,t){return A.resolve(0)}getFieldIndexes(e,t){return A.resolve([])}getNextCollectionGroupToUpdate(e){return A.resolve(null)}getMinOffset(e,t){return A.resolve(Oe.min())}getMinOffsetFromCollectionGroup(e,t){return A.resolve(Oe.min())}updateCollectionGroup(e,t,r){return A.resolve()}updateIndexEntries(e,t){return A.resolve()}}class Pd{constructor(){this.index={}}add(e){const t=e.lastSegment(),r=e.popLast(),i=this.index[t]||new ue(ie.comparator),s=!i.has(r);return this.index[t]=i.add(r),s}has(e){const t=e.lastSegment(),r=e.popLast(),i=this.index[t];return i&&i.has(r)}getEntries(e){return(this.index[e]||new ue(ie.comparator)).toArray()}}const wl=new Uint8Array(0);class p_{constructor(e,t){this.user=e,this.databaseId=t,this._n=new Pd,this.an=new tn(r=>tr(r),(r,i)=>An(r,i)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this._n.has(t)){const r=t.lastSegment(),i=t.popLast();e.addOnCommittedListener(()=>{this._n.add(t)});const s={collectionId:r,parent:$e(i)};return jp(e).put(s)}return A.resolve()}getCollectionParents(e,t){const r=[],i=IDBKeyRange.bound([t,""],[Zc(t),""],!1,!0);return jp(e).W(i).next(s=>{for(const a of s){if(a.collectionId!==t)break;r.push(wt(a.parent))}return r})}addFieldIndex(e,t){const r=Pu(e),i={indexId:(h=t).indexId,collectionGroup:h.collectionGroup,fields:h.fields.map(d=>[d.fieldPath.canonicalString(),d.kind])};var h;delete i.indexId;const s=r.add(i);if(t.indexState){const a=Io(e);return s.next(h=>{a.put(Fp(h,this.user,t.indexState.sequenceNumber,t.indexState.offset))})}return s.next()}deleteFieldIndex(e,t){const r=Pu(e),i=Io(e),s=yo(e);return r.delete(t.indexId).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>s.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){const t=Pu(e),r=yo(e),i=Io(e);return t.H().next(()=>r.H()).next(()=>i.H())}createTargetIndexes(e,t){return A.forEach(this.un(t),r=>this.getIndexType(e,r).next(i=>{if(0===i||1===i){const s=new Gp(r).sn();if(null!=s)return this.addFieldIndex(e,s)}}))}getDocumentsMatchingTarget(e,t){const r=yo(e);let i=!0;const s=new Map;return A.forEach(this.un(t),a=>this.cn(e,a).next(h=>{i&&(i=!!h),s.set(a,h)})).next(()=>{if(i){let a=J();const h=[];return A.forEach(s,(d,m)=>{var j;x("IndexedDbIndexManager",`Using index ${j=d,`id=${j.indexId}|cg=${j.collectionGroup}|f=${j.fields.map(W=>`${W.fieldPath}:${W.kind}`).join(",")}`} to execute ${tr(t)}`);const g=function(j,W){const ee=xi(W);if(void 0===ee)return null;for(const X of ao(j,ee.fieldPath))switch(X.op){case"array-contains-any":return X.value.arrayValue.values||[];case"array-contains":return[X.value]}return null}(m,d),y=function(j,W){const ee=new Map;for(const X of Qn(W))for(const Ze of ao(j,X.fieldPath))switch(Ze.op){case"==":case"in":ee.set(X.fieldPath.canonicalString(),Ze.value);break;case"not-in":case"!=":return ee.set(X.fieldPath.canonicalString(),Ze.value),Array.from(ee.values())}return null}(m,d),T=function(j,W){const ee=[];let X=!0;for(const Ze of Qn(W)){const Gt=0===Ze.kind?ul(j,Ze.fieldPath,j.startAt):ou(j,Ze.fieldPath,j.startAt);ee.push(Gt.value),X&&(X=Gt.inclusive)}return new Tn(ee,X)}(m,d),w=function(j,W){const ee=[];let X=!0;for(const Ze of Qn(W)){const Gt=0===Ze.kind?ou(j,Ze.fieldPath,j.endAt):ul(j,Ze.fieldPath,j.endAt);ee.push(Gt.value),X&&(X=Gt.inclusive)}return new Tn(ee,X)}(m,d),k=this.ln(d,m,T),D=this.ln(d,m,w),V=this.hn(d,m,y),G=this.Pn(d.indexId,g,k,T.inclusive,D,w.inclusive,V);return A.forEach(G,$=>r.j($,t.limit).next(j=>{j.forEach(W=>{const ee=O.fromSegments(W.documentKey);a.has(ee)||(a=a.add(ee),h.push(ee))})}))}).next(()=>h)}return A.resolve(null)})}un(e){let t=this.an.get(e);return t||(t=0===e.filters.length?[e]:d_(se.create(e.filters,"and")).map(r=>su(e.path,e.collectionGroup,e.orderBy,r.getFilters(),e.limit,e.startAt,e.endAt)),this.an.set(e,t),t)}Pn(e,t,r,i,s,a,h){const d=(null!=t?t.length:1)*Math.max(r.length,s.length),m=d/(null!=t?t.length:1),g=[];for(let y=0;y<d;++y){const T=t?this.In(t[y/m]):wl,w=this.Tn(e,T,r[y%m],i),k=this.En(e,T,s[y%m],a),D=h.map(V=>this.Tn(e,T,V,!0));g.push(...this.createRange(w,k,D))}return g}Tn(e,t,r,i){const s=new Ji(e,O.empty(),t,r);return i?s:s.Ht()}En(e,t,r,i){const s=new Ji(e,O.empty(),t,r);return i?s.Ht():s}cn(e,t){const r=new Gp(t),i=null!=t.collectionGroup?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,i).next(s=>{let a=null;for(const h of s)r.en(h)&&(!a||h.fields.length>a.fields.length)&&(a=h);return a})}getIndexType(e,t){let r=2;const i=this.un(t);return A.forEach(i,s=>this.cn(e,s).next(a=>{a?0!==r&&a.fields.length<function(d){let m=new ue(me.comparator),g=!1;for(const y of d.filters)for(const T of y.getFlattenedFilters())T.field.isKeyField()||("array-contains"===T.op||"array-contains-any"===T.op?g=!0:m=m.add(T.field));for(const y of d.orderBy)y.field.isKeyField()||(m=m.add(y.field));return m.size+(g?1:0)}(s)&&(r=1):r=0})).next(()=>null!==t.limit&&i.length>1&&2===r?1:r)}dn(e,t){const r=new wu;for(const i of Qn(e)){const s=t.data.field(i.fieldPath);if(null==s)return null;const a=r.jt(i.kind);Yi.St.ht(s,a)}return r.Ut()}In(e){const t=new wu;return Yi.St.ht(e,t.jt(0)),t.Ut()}An(e,t){const r=new wu;return Yi.St.ht(er(this.databaseId,t),r.jt(function(s){const a=Qn(s);return 0===a.length?0:a[a.length-1].kind}(e))),r.Ut()}hn(e,t,r){if(null===r)return[];let i=[];i.push(new wu);let s=0;for(const a of Qn(e)){const h=r[s++];for(const d of i)if(this.Rn(t,a.fieldPath)&&Fi(h))i=this.Vn(i,a,h);else{const m=d.jt(a.kind);Yi.St.ht(h,m)}}return this.mn(i)}ln(e,t,r){return this.hn(e,t,r.position)}mn(e){const t=[];for(let r=0;r<e.length;++r)t[r]=e[r].Ut();return t}Vn(e,t,r){const i=[...e],s=[];for(const a of r.arrayValue.values||[])for(const h of i){const d=new wu;d.seed(h.Ut()),Yi.St.ht(a,d.jt(t.kind)),s.push(d)}return s}Rn(e,t){return!!e.filters.find(r=>r instanceof te&&r.field.isEqual(t)&&("in"===r.op||"not-in"===r.op))}getFieldIndexes(e,t){const r=Pu(e),i=Io(e);return(t?r.W("collectionGroupIndex",IDBKeyRange.bound(t,t)):r.W()).next(s=>{const a=[];return A.forEach(s,h=>i.get([h.indexId,this.uid]).next(d=>{a.push(function(g,y){const T=y?new Nr(y.sequenceNumber,new Oe(Hi(y.readTime),new O(wt(y.documentKey)),y.largestBatchId)):Nr.empty(),w=g.fields.map(([k,D])=>new Ot(me.fromServerFormat(k),D));return new kr(g.indexId,g.collectionGroup,w,T)}(h,d))})).next(()=>a)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(t=>0===t.length?null:(t.sort((r,i)=>{const s=r.indexState.sequenceNumber-i.indexState.sequenceNumber;return 0!==s?s:Y(r.collectionGroup,i.collectionGroup)}),t[0].collectionGroup))}updateCollectionGroup(e,t,r){const i=Pu(e),s=Io(e);return this.fn(e).next(a=>i.W("collectionGroupIndex",IDBKeyRange.bound(t,t)).next(h=>A.forEach(h,d=>s.put(Fp(d.indexId,this.user,a,r)))))}updateIndexEntries(e,t){const r=new Map;return A.forEach(t,(i,s)=>{const a=r.get(i.collectionGroup);return(a?A.resolve(a):this.getFieldIndexes(e,i.collectionGroup)).next(h=>(r.set(i.collectionGroup,h),A.forEach(h,d=>this.gn(e,i,d).next(m=>{const g=this.pn(s,d);return m.isEqual(g)?A.resolve():this.yn(e,s,d,m,g)}))))})}wn(e,t,r,i){return yo(e).put({indexId:i.indexId,uid:this.uid,arrayValue:i.arrayValue,directionalValue:i.directionalValue,orderedDocumentKey:this.An(r,t.key),documentKey:t.key.path.toArray()})}Sn(e,t,r,i){return yo(e).delete([i.indexId,this.uid,i.arrayValue,i.directionalValue,this.An(r,t.key),t.key.path.toArray()])}gn(e,t,r){const i=yo(e);let s=new ue(Zr);return i.Y({index:"documentKeyIndex",range:IDBKeyRange.only([r.indexId,this.uid,this.An(r,t)])},(a,h)=>{s=s.add(new Ji(r.indexId,t,h.arrayValue,h.directionalValue))}).next(()=>s)}pn(e,t){let r=new ue(Zr);const i=this.dn(t,e);if(null==i)return r;const s=xi(t);if(null!=s){const a=e.data.field(s.fieldPath);if(Fi(a))for(const h of a.arrayValue.values||[])r=r.add(new Ji(t.indexId,e.key,this.In(h),i))}else r=r.add(new Ji(t.indexId,e.key,wl,i));return r}yn(e,t,r,i,s){x("IndexedDbIndexManager","Updating index entries for document '%s'",t.key);const a=[];return function(d,m,g,y,T){const w=d.getIterator(),k=m.getIterator();let D=Dr(w),V=Dr(k);for(;D||V;){let G=!1,$=!1;if(D&&V){const j=g(D,V);j<0?$=!0:j>0&&(G=!0)}else null!=D?$=!0:G=!0;G?(y(V),V=Dr(k)):$?(T(D),D=Dr(w)):(D=Dr(w),V=Dr(k))}}(i,s,Zr,h=>{a.push(this.wn(e,t,r,h))},h=>{a.push(this.Sn(e,t,r,h))}),A.waitFor(a)}fn(e){let t=1;return Io(e).Y({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(r,i,s)=>{s.done(),t=i.sequenceNumber+1}).next(()=>t)}createRange(e,t,r){r=r.sort((a,h)=>Zr(a,h)).filter((a,h,d)=>!h||0!==Zr(a,d[h-1]));const i=[];i.push(e);for(const a of r){const h=Zr(a,e),d=Zr(a,t);if(0===h)i[0]=e.Ht();else if(h>0&&d<0)i.push(a),i.push(a.Ht());else if(d>0)break}i.push(t);const s=[];for(let a=0;a<i.length;a+=2){if(this.bn(i[a],i[a+1]))return[];s.push(IDBKeyRange.bound([i[a].indexId,this.uid,i[a].arrayValue,i[a].directionalValue,wl,[]],[i[a+1].indexId,this.uid,i[a+1].arrayValue,i[a+1].directionalValue,wl,[]]))}return s}bn(e,t){return Zr(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next($p)}getMinOffset(e,t){return A.mapArray(this.un(t),r=>this.cn(e,r).next(i=>i||B())).next($p)}}function jp(n){return qe(n,"collectionParents")}function yo(n){return qe(n,"indexEntries")}function Pu(n){return qe(n,"indexConfiguration")}function Io(n){return qe(n,"indexState")}function $p(n){z(0!==n.length);let e=n[0].indexState.offset,t=e.largestBatchId;for(let r=1;r<n.length;r++){const i=n[r].indexState.offset;ki(i,e)<0&&(e=i),t<i.largestBatchId&&(t=i.largestBatchId)}return new Oe(e.readTime,e.documentKey,t)}const Hp={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class tt{constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}static withCacheSize(e){return new tt(e,tt.DEFAULT_COLLECTION_PERCENTILE,tt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}function Qp(n,e,t){const r=n.store("mutations"),i=n.store("documentMutations"),s=[],a=IDBKeyRange.only(t.batchId);let h=0;const d=r.Y({range:a},(g,y,T)=>(h++,T.delete()));s.push(d.next(()=>{z(1===h)}));const m=[];for(const g of t.mutations){const y=Hs(e,g.key.path,t.batchId);s.push(i.delete(y)),m.push(g.key)}return A.waitFor(s).next(()=>m)}function Pl(n){if(!n)return 0;let e;if(n.document)e=n.document;else if(n.unknownDocument)e=n.unknownDocument;else{if(!n.noDocument)throw B();e=n.noDocument}return JSON.stringify(e).length}tt.DEFAULT_COLLECTION_PERCENTILE=10,tt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,tt.DEFAULT=new tt(41943040,tt.DEFAULT_COLLECTION_PERCENTILE,tt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),tt.DISABLED=new tt(-1,0,0);class Rl{constructor(e,t,r,i){this.userId=e,this.serializer=t,this.indexManager=r,this.referenceDelegate=i,this.Dn={}}static ct(e,t,r,i){z(""!==e.uid);const s=e.isAuthenticated()?e.uid:"";return new Rl(s,t,r,i)}checkEmpty(e){let t=!0;const r=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Gr(e).Y({index:"userMutationsIndex",range:r},(i,s,a)=>{t=!1,a.done()}).next(()=>t)}addMutationBatch(e,t,r,i){const s=vo(e),a=Gr(e);return a.add({}).next(h=>{z("number"==typeof h);const d=new ho(h,t,r,i),m=function(w,k,D){const V=D.baseMutations.map($=>Tu(w.ut,$)),G=D.mutations.map($=>Tu(w.ut,$));return{userId:k,batchId:D.batchId,localWriteTimeMs:D.localWriteTime.toMillis(),baseMutations:V,mutations:G}}(this.serializer,this.userId,d),g=[];let y=new ue((T,w)=>Y(T.canonicalString(),w.canonicalString()));for(const T of i){const w=Hs(this.userId,T.key.path,h);y=y.add(T.key.path.popLast()),g.push(a.put(m)),g.push(s.put(w,Kh))}return y.forEach(T=>{g.push(this.indexManager.addToCollectionParentIndex(e,T))}),e.addOnCommittedListener(()=>{this.Dn[h]=d.keys()}),A.waitFor(g).next(()=>d)})}lookupMutationBatch(e,t){return Gr(e).get(t).next(r=>r?(z(r.userId===this.userId),Qi(this.serializer,r)):null)}Cn(e,t){return this.Dn[t]?A.resolve(this.Dn[t]):this.lookupMutationBatch(e,t).next(r=>{if(r){const i=r.keys();return this.Dn[t]=i,i}return null})}getNextMutationBatchAfterBatchId(e,t){const r=t+1,i=IDBKeyRange.lowerBound([this.userId,r]);let s=null;return Gr(e).Y({index:"userMutationsIndex",range:i},(a,h,d)=>{h.userId===this.userId&&(z(h.batchId>=r),s=Qi(this.serializer,h)),d.done()}).next(()=>s)}getHighestUnacknowledgedBatchId(e){const t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let r=-1;return Gr(e).Y({index:"userMutationsIndex",range:t,reverse:!0},(i,s,a)=>{r=s.batchId,a.done()}).next(()=>r)}getAllMutationBatches(e){const t=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return Gr(e).W("userMutationsIndex",t).next(r=>r.map(i=>Qi(this.serializer,i)))}getAllMutationBatchesAffectingDocumentKey(e,t){const r=$s(this.userId,t.path),i=IDBKeyRange.lowerBound(r),s=[];return vo(e).Y({range:i},(a,h,d)=>{const[m,g,y]=a,T=wt(g);if(m===this.userId&&t.path.isEqual(T))return Gr(e).get(y).next(w=>{if(!w)throw B();z(w.userId===this.userId),s.push(Qi(this.serializer,w))});d.done()}).next(()=>s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new ue(Y);const i=[];return t.forEach(s=>{const a=$s(this.userId,s.path),h=IDBKeyRange.lowerBound(a),d=vo(e).Y({range:h},(m,g,y)=>{const[T,w,k]=m,D=wt(w);T===this.userId&&s.path.isEqual(D)?r=r.add(k):y.done()});i.push(d)}),A.waitFor(i).next(()=>this.vn(e,r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,i=r.length+1,s=$s(this.userId,r),a=IDBKeyRange.lowerBound(s);let h=new ue(Y);return vo(e).Y({range:a},(d,m,g)=>{const[y,T,w]=d,k=wt(T);y===this.userId&&r.isPrefixOf(k)?k.length===i&&(h=h.add(w)):g.done()}).next(()=>this.vn(e,h))}vn(e,t){const r=[],i=[];return t.forEach(s=>{i.push(Gr(e).get(s).next(a=>{if(null===a)throw B();z(a.userId===this.userId),r.push(Qi(this.serializer,a))}))}),A.waitFor(i).next(()=>r)}removeMutationBatch(e,t){return Qp(e.ae,this.userId,t).next(r=>(e.addOnCommittedListener(()=>{this.Fn(t.batchId)}),A.forEach(r,i=>this.referenceDelegate.markPotentiallyOrphaned(e,i))))}Fn(e){delete this.Dn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return A.resolve();const r=IDBKeyRange.lowerBound([this.userId]),i=[];return vo(e).Y({range:r},(s,a,h)=>{if(s[0]===this.userId){const d=wt(s[1]);i.push(d)}else h.done()}).next(()=>{z(0===i.length)})})}containsKey(e,t){return Yp(e,this.userId,t)}Mn(e){return Jp(e).get(this.userId).next(t=>t||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}}function Yp(n,e,t){const r=$s(e,t.path),i=r[1],s=IDBKeyRange.lowerBound(r);let a=!1;return vo(n).Y({range:s,J:!0},(h,d,m)=>{const[g,y,T]=h;g===e&&y===i&&(a=!0),m.done()}).next(()=>a)}function Gr(n){return qe(n,"mutations")}function vo(n){return qe(n,"documentMutations")}function Jp(n){return qe(n,"mutationQueues")}class Xi{constructor(e){this.xn=e}next(){return this.xn+=2,this.xn}static On(){return new Xi(0)}static Nn(){return new Xi(-1)}}class m_{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.Bn(e).next(t=>{const r=new Xi(t.highestTargetId);return t.highestTargetId=r.next(),this.Ln(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.Bn(e).next(t=>K.fromTimestamp(new pe(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.Bn(e).next(t=>t.highestListenSequenceNumber)}setTargetsMetadata(e,t,r){return this.Bn(e).next(i=>(i.highestListenSequenceNumber=t,r&&(i.lastRemoteSnapshotVersion=r.toTimestamp()),t>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=t),this.Ln(e,i)))}addTargetData(e,t){return this.kn(e,t).next(()=>this.Bn(e).next(r=>(r.targetCount+=1,this.qn(t,r),this.Ln(e,r))))}updateTargetData(e,t){return this.kn(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>To(e).delete(t.targetId)).next(()=>this.Bn(e)).next(r=>(z(r.targetCount>0),r.targetCount-=1,this.Ln(e,r)))}removeTargets(e,t,r){let i=0;const s=[];return To(e).Y((a,h)=>{const d=Eu(h);d.sequenceNumber<=t&&null===r.get(d.targetId)&&(i++,s.push(this.removeTargetData(e,d)))}).next(()=>A.waitFor(s)).next(()=>i)}forEachTarget(e,t){return To(e).Y((r,i)=>{const s=Eu(i);t(s)})}Bn(e){return Xp(e).get("targetGlobalKey").next(t=>(z(null!==t),t))}Ln(e,t){return Xp(e).put("targetGlobalKey",t)}kn(e,t){return To(e).put(Mp(this.serializer,t))}qn(e,t){let r=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,r=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,r=!0),r}getTargetCount(e){return this.Bn(e).next(t=>t.targetCount)}getTargetData(e,t){const r=tr(t),i=IDBKeyRange.bound([r,Number.NEGATIVE_INFINITY],[r,Number.POSITIVE_INFINITY]);let s=null;return To(e).Y({range:i,index:"queryTargetsIndex"},(a,h,d)=>{const m=Eu(h);An(t,m.target)&&(s=m,d.done())}).next(()=>s)}addMatchingKeys(e,t,r){const i=[],s=zr(e);return t.forEach(a=>{const h=$e(a.path);i.push(s.put({targetId:r,path:h})),i.push(this.referenceDelegate.addReference(e,r,a))}),A.waitFor(i)}removeMatchingKeys(e,t,r){const i=zr(e);return A.forEach(t,s=>{const a=$e(s.path);return A.waitFor([i.delete([r,a]),this.referenceDelegate.removeReference(e,r,s)])})}removeMatchingKeysForTargetId(e,t){const r=zr(e),i=IDBKeyRange.bound([t],[t+1],!1,!0);return r.delete(i)}getMatchingKeysForTargetId(e,t){const r=IDBKeyRange.bound([t],[t+1],!1,!0),i=zr(e);let s=J();return i.Y({range:r,J:!0},(a,h,d)=>{const m=wt(a[1]),g=new O(m);s=s.add(g)}).next(()=>s)}containsKey(e,t){const r=$e(t.path),i=IDBKeyRange.bound([r],[Zc(r)],!1,!0);let s=0;return zr(e).Y({index:"documentTargetsIndex",J:!0,range:i},([a,h],d,m)=>{0!==a&&(s++,m.done())}).next(()=>s>0)}_t(e,t){return To(e).get(t).next(r=>r?Eu(r):null)}}function To(n){return qe(n,"targets")}function Xp(n){return qe(n,"targetGlobal")}function zr(n){return qe(n,"targetDocuments")}function em([n,e],[t,r]){const i=Y(n,t);return 0===i?Y(e,r):i}class g_{constructor(e){this.Qn=e,this.buffer=new ue(em),this.Kn=0}$n(){return++this.Kn}Un(e){const t=[e,this.$n()];if(this.buffer.size<this.Qn)this.buffer=this.buffer.add(t);else{const r=this.buffer.last();em(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}}class tm{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.Wn=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.Gn(6e4)}stop(){this.Wn&&(this.Wn.cancel(),this.Wn=null)}get started(){return null!==this.Wn}Gn(e){var t=this;x("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.Wn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,(0,R.Z)(function*(){t.Wn=null;try{yield t.localStore.collectGarbage(t.garbageCollector)}catch(r){Mt(r)?x("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",r):yield pn(r)}yield t.Gn(3e5)}))}}class __{constructor(e,t){this.zn=e,this.params=t}calculateTargetCount(e,t){return this.zn.jn(e).next(r=>Math.floor(t/100*r))}nthSequenceNumber(e,t){if(0===t)return A.resolve(ot._e);const r=new g_(t);return this.zn.forEachTarget(e,i=>r.Un(i.sequenceNumber)).next(()=>this.zn.Hn(e,i=>r.Un(i))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.zn.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.zn.removeOrphanedDocuments(e,t)}collect(e,t){return-1===this.params.cacheSizeCollectionThreshold?(x("LruGarbageCollector","Garbage collection skipped; disabled"),A.resolve(Hp)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(x("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),Hp):this.Jn(e,t))}getCacheSize(e){return this.zn.getCacheSize(e)}Jn(e,t){let r,i,s,a,h,d,m;const g=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(y=>(y>this.params.maximumSequenceNumbersToCollect?(x("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${y}`),i=this.params.maximumSequenceNumbersToCollect):i=y,a=Date.now(),this.nthSequenceNumber(e,i))).next(y=>(r=y,h=Date.now(),this.removeTargets(e,r,t))).next(y=>(s=y,d=Date.now(),this.removeOrphanedDocuments(e,r))).next(y=>(m=Date.now(),Yt()<=vt.in.DEBUG&&x("LruGarbageCollector",`LRU Garbage Collection\n\tCounted targets in ${a-g}ms\n\tDetermined least recently used ${i} in `+(h-a)+`ms\n\tRemoved ${s} targets in `+(d-h)+`ms\n\tRemoved ${y} documents in `+(m-d)+`ms\nTotal Duration: ${m-g}ms`),A.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:s,documentsRemoved:y})))}}class y_{constructor(e,t){this.db=e,this.garbageCollector=function nm(n,e){return new __(n,e)}(this,t)}jn(e){const t=this.Yn(e);return this.db.getTargetCache().getTargetCount(e).next(r=>t.next(i=>r+i))}Yn(e){let t=0;return this.Hn(e,r=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}Hn(e,t){return this.Zn(e,(r,i)=>t(i))}addReference(e,t,r){return Sl(e,r)}removeReference(e,t,r){return Sl(e,r)}removeTargets(e,t,r){return this.db.getTargetCache().removeTargets(e,t,r)}markPotentiallyOrphaned(e,t){return Sl(e,t)}Xn(e,t){return function(i,s){let a=!1;return Jp(i).Z(h=>Yp(i,h,s).next(d=>(d&&(a=!0),A.resolve(!d)))).next(()=>a)}(e,t)}removeOrphanedDocuments(e,t){const r=this.db.getRemoteDocumentCache().newChangeBuffer(),i=[];let s=0;return this.Zn(e,(a,h)=>{if(h<=t){const d=this.Xn(e,a).next(m=>{if(!m)return s++,r.getEntry(e,a).next(()=>(r.removeEntry(a,K.min()),zr(e).delete([0,$e(a.path)])))});i.push(d)}}).next(()=>A.waitFor(i)).next(()=>r.apply(e)).next(()=>s)}removeTarget(e,t){const r=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,r)}updateLimboDocument(e,t){return Sl(e,t)}Zn(e,t){const r=zr(e);let i,s=ot._e;return r.Y({index:"documentTargetsIndex"},([a,h],{path:d,sequenceNumber:m})=>{0===a?(s!==ot._e&&t(new O(wt(i)),s),s=m,i=d):s=ot._e}).next(()=>{s!==ot._e&&t(new O(wt(i)),s)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function Sl(n,e){return zr(n).put((i=n.currentSequenceNumber,{targetId:0,path:$e(e.path),sequenceNumber:i}));var i}class rm{constructor(){this.changes=new tn(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,he.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const r=this.changes.get(t);return void 0!==r?A.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class I_{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,r){return es(e).put(r)}removeEntry(e,t,r){return es(e).delete(function(s,a){const h=s.path.toArray();return[h.slice(0,h.length-2),h[h.length-2],Tl(a),h[h.length-1]]}(t,r))}updateMetadata(e,t){return this.getMetadata(e).next(r=>(r.byteSize+=t,this.er(e,r)))}getEntry(e,t){let r=he.newInvalidDocument(t);return es(e).Y({index:"documentKeyIndex",range:IDBKeyRange.only(Ru(t))},(i,s)=>{r=this.tr(t,s)}).next(()=>r)}nr(e,t){let r={size:0,document:he.newInvalidDocument(t)};return es(e).Y({index:"documentKeyIndex",range:IDBKeyRange.only(Ru(t))},(i,s)=>{r={document:this.tr(t,s),size:Pl(s)}}).next(()=>r)}getEntries(e,t){let r=Be();return this.rr(e,t,(i,s)=>{const a=this.tr(i,s);r=r.insert(i,a)}).next(()=>r)}ir(e,t){let r=Be(),i=new le(O.comparator);return this.rr(e,t,(s,a)=>{const h=this.tr(s,a);r=r.insert(s,h),i=i.insert(s,Pl(a))}).next(()=>({documents:r,sr:i}))}rr(e,t,r){if(t.isEmpty())return A.resolve();let i=new ue(am);t.forEach(d=>i=i.add(d));const s=IDBKeyRange.bound(Ru(i.first()),Ru(i.last())),a=i.getIterator();let h=a.getNext();return es(e).Y({index:"documentKeyIndex",range:s},(d,m,g)=>{const y=O.fromSegments([...m.prefixPath,m.collectionGroup,m.documentId]);for(;h&&am(h,y)<0;)r(h,null),h=a.getNext();h&&h.isEqual(y)&&(r(h,m),h=a.hasNext()?a.getNext():null),h?g.U(Ru(h)):g.done()}).next(()=>{for(;h;)r(h,null),h=a.hasNext()?a.getNext():null})}getDocumentsMatchingQuery(e,t,r,i,s){const a=t.path,h=[a.popLast().toArray(),a.lastSegment(),Tl(r.readTime),r.documentKey.path.isEmpty()?"":r.documentKey.path.lastSegment()],d=[a.popLast().toArray(),a.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return es(e).W(IDBKeyRange.bound(h,d,!0)).next(m=>{null==s||s.incrementDocumentReadCount(m.length);let g=Be();for(const y of m){const T=this.tr(O.fromSegments(y.prefixPath.concat(y.collectionGroup,y.documentId)),y);T.isFoundDocument()&&(rr(t,T)||i.has(T.key))&&(g=g.insert(T.key,T))}return g})}getAllFromCollectionGroup(e,t,r,i){let s=Be();const a=om(t,r),h=om(t,Oe.max());return es(e).Y({index:"collectionGroupIndex",range:IDBKeyRange.bound(a,h,!0)},(d,m,g)=>{const y=this.tr(O.fromSegments(m.prefixPath.concat(m.collectionGroup,m.documentId)),m);s=s.insert(y.key,y),s.size===i&&g.done()}).next(()=>s)}newChangeBuffer(e){return new v_(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(t=>t.byteSize)}getMetadata(e){return sm(e).get("remoteDocumentGlobalKey").next(t=>(z(!!t),t))}er(e,t){return sm(e).put("remoteDocumentGlobalKey",t)}tr(e,t){if(t){const r=function o_(n,e){let t;if(e.document)t=Cp(n.ut,e.document,!!e.hasCommittedMutations);else if(e.noDocument){const r=O.fromSegments(e.noDocument.path),i=Hi(e.noDocument.readTime);t=he.newNoDocument(r,i),e.hasCommittedMutations&&t.setHasCommittedMutations()}else{if(!e.unknownDocument)return B();{const r=O.fromSegments(e.unknownDocument.path),i=Hi(e.unknownDocument.version);t=he.newUnknownDocument(r,i)}}return e.readTime&&t.setReadTime(function(i){const s=new pe(i[0],i[1]);return K.fromTimestamp(s)}(e.readTime)),t}(this.serializer,t);if(!r.isNoDocument()||!r.version.isEqual(K.min()))return r}return he.newInvalidDocument(e)}}function im(n){return new I_(n)}class v_ extends rm{constructor(e,t){super(),this._r=e,this.trackRemovals=t,this.ar=new tn(r=>r.toString(),(r,i)=>r.isEqual(i))}applyChanges(e){const t=[];let r=0,i=new ue((s,a)=>Y(s.canonicalString(),a.canonicalString()));return this.changes.forEach((s,a)=>{const h=this.ar.get(s);if(t.push(this._r.removeEntry(e,s,h.readTime)),a.isValidDocument()){const d=Op(this._r.serializer,a);i=i.add(s.path.popLast());const m=Pl(d);r+=m-h.size,t.push(this._r.addEntry(e,s,d))}else if(r-=h.size,this.trackRemovals){const d=Op(this._r.serializer,a.convertToNoDocument(K.min()));t.push(this._r.addEntry(e,s,d))}}),i.forEach(s=>{t.push(this._r.indexManager.addToCollectionParentIndex(e,s))}),t.push(this._r.updateMetadata(e,r)),A.waitFor(t)}getFromCache(e,t){return this._r.nr(e,t).next(r=>(this.ar.set(t,{size:r.size,readTime:r.document.readTime}),r.document))}getAllFromCache(e,t){return this._r.ir(e,t).next(({documents:r,sr:i})=>(i.forEach((s,a)=>{this.ar.set(s,{size:a,readTime:r.get(s).readTime})}),r))}}function sm(n){return qe(n,"remoteDocumentGlobal")}function es(n){return qe(n,"remoteDocumentsV14")}function Ru(n){const e=n.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function om(n,e){const t=e.documentKey.path.toArray();return[n,Tl(e.readTime),t.slice(0,t.length-2),t.length>0?t[t.length-1]:""]}function am(n,e){const t=n.path.toArray(),r=e.path.toArray();let i=0;for(let s=0;s<t.length-2&&s<r.length-2;++s)if(i=Y(t[s],r[s]),i)return i;return i=Y(t.length,r.length),i||(i=Y(t[t.length-2],r[r.length-2]),i||Y(t[t.length-1],r[r.length-1]))}class T_{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class um{constructor(e,t,r,i){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=i}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(i=>(r=i,this.remoteDocumentCache.getEntry(e,t))).next(i=>(null!==r&&E(r.mutation,i,et.empty(),pe.now()),i))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.getLocalViewOfDocuments(e,r,J()).next(()=>r))}getLocalViewOfDocuments(e,t,r=J()){const i=_t();return this.populateOverlays(e,i,t).next(()=>this.computeViews(e,t,i,r).next(s=>{let a=Gi();return s.forEach((h,d)=>{a=a.insert(h,d.overlayedDocument)}),a}))}getOverlayedDocuments(e,t){const r=_t();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,J()))}populateOverlays(e,t,r){const i=[];return r.forEach(s=>{t.has(s)||i.push(s)}),this.documentOverlayCache.getOverlays(e,i).next(s=>{s.forEach((a,h)=>{t.set(a,h)})})}computeViews(e,t,r,i){let s=Be();const a=Fr(),h=Fr();return t.forEach((d,m)=>{const g=r.get(m.key);i.has(m.key)&&(void 0===g||g.mutation instanceof U)?s=s.insert(m.key,m):void 0!==g?(a.set(m.key,g.mutation.getFieldMask()),E(g.mutation,m,g.mutation.getFieldMask(),pe.now())):a.set(m.key,et.empty())}),this.recalculateAndSaveOverlays(e,s).next(d=>(d.forEach((m,g)=>a.set(m,g)),t.forEach((m,g)=>{var y;return h.set(m,new T_(g,null!==(y=a.get(m))&&void 0!==y?y:null))}),h))}recalculateAndSaveOverlays(e,t){const r=Fr();let i=new le((a,h)=>a-h),s=J();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(a=>{for(const h of a)h.keys().forEach(d=>{const m=t.get(d);if(null===m)return;let g=r.get(d)||et.empty();g=h.applyToLocalView(m,g),r.set(d,g);const y=(i.get(h.batchId)||J()).add(d);i=i.insert(h.batchId,y)})}).next(()=>{const a=[],h=i.getReverseIterator();for(;h.hasNext();){const d=h.getNext(),m=d.key,g=d.value,y=fl();g.forEach(T=>{if(!s.has(T)){const w=_(t.get(T),r.get(T));null!==w&&y.set(T,w),s=s.add(T)}}),a.push(this.documentOverlayCache.saveOverlays(e,m,y))}return A.waitFor(a)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,t,r,i){return O.isDocumentKey((a=t).path)&&null===a.collectionGroup&&0===a.filters.length?this.getDocumentsMatchingDocumentQuery(e,t.path):nr(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,i):this.getDocumentsMatchingCollectionQuery(e,t,r,i);var a}getNextDocuments(e,t,r,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,i).next(s=>{const a=i-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,i-s.size):A.resolve(_t());let h=-1,d=s;return a.next(m=>A.forEach(m,(g,y)=>(h<y.largestBatchId&&(h=y.largestBatchId),s.get(g)?A.resolve():this.remoteDocumentCache.getEntry(e,g).next(T=>{d=d.insert(g,T)}))).next(()=>this.populateOverlays(e,m,s)).next(()=>this.computeViews(e,d,m,J())).next(g=>({batchId:h,changes:co(g)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new O(t)).next(r=>{let i=Gi();return r.isFoundDocument()&&(i=i.insert(r.key,r)),i})}getDocumentsMatchingCollectionGroupQuery(e,t,r,i){const s=t.collectionGroup;let a=Gi();return this.indexManager.getCollectionParents(e,s).next(h=>A.forEach(h,d=>{const m=(y=t,T=d.child(s),new en(T,null,y.explicitOrderBy.slice(),y.filters.slice(),y.limit,y.limitType,y.startAt,y.endAt));var y,T;return this.getDocumentsMatchingCollectionQuery(e,m,r,i).next(g=>{g.forEach((y,T)=>{a=a.insert(y,T)})})}).next(()=>a))}getDocumentsMatchingCollectionQuery(e,t,r,i){let s;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(a=>(s=a,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,s,i))).next(a=>{s.forEach((d,m)=>{const g=m.getKey();null===a.get(g)&&(a=a.insert(g,he.newInvalidDocument(g)))});let h=Gi();return a.forEach((d,m)=>{const g=s.get(d);void 0!==g&&E(g.mutation,m,et.empty(),pe.now()),rr(t,m)&&(h=h.insert(d,m))}),h})}}class E_{constructor(e){this.serializer=e,this.ur=new Map,this.cr=new Map}getBundleMetadata(e,t){return A.resolve(this.ur.get(t))}saveBundleMetadata(e,t){return this.ur.set(t.id,{id:(i=t).id,version:i.version,createTime:Le(i.createTime)}),A.resolve();var i}getNamedQuery(e,t){return A.resolve(this.cr.get(t))}saveNamedQuery(e,t){return this.cr.set(t.name,{name:(i=t).name,query:Id(i.bundledQuery),readTime:Le(i.readTime)}),A.resolve();var i}}class A_{constructor(){this.overlays=new le(O.comparator),this.lr=new Map}getOverlay(e,t){return A.resolve(this.overlays.get(t))}getOverlays(e,t){const r=_t();return A.forEach(t,i=>this.getOverlay(e,i).next(s=>{null!==s&&r.set(i,s)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((i,s)=>{this.lt(e,t,s)}),A.resolve()}removeOverlaysForBatchId(e,t,r){const i=this.lr.get(r);return void 0!==i&&(i.forEach(s=>this.overlays=this.overlays.remove(s)),this.lr.delete(r)),A.resolve()}getOverlaysForCollection(e,t,r){const i=_t(),s=t.length+1,a=new O(t.child("")),h=this.overlays.getIteratorFrom(a);for(;h.hasNext();){const d=h.getNext().value,m=d.getKey();if(!t.isPrefixOf(m.path))break;m.path.length===s&&d.largestBatchId>r&&i.set(d.getKey(),d)}return A.resolve(i)}getOverlaysForCollectionGroup(e,t,r,i){let s=new le((m,g)=>m-g);const a=this.overlays.getIterator();for(;a.hasNext();){const m=a.getNext().value;if(m.getKey().getCollectionGroup()===t&&m.largestBatchId>r){let g=s.get(m.largestBatchId);null===g&&(g=_t(),s=s.insert(m.largestBatchId,g)),g.set(m.getKey(),m)}}const h=_t(),d=s.getIterator();for(;d.hasNext()&&(d.getNext().value.forEach((m,g)=>h.set(m,g)),!(h.size()>=i)););return A.resolve(h)}lt(e,t,r){const i=this.overlays.get(r.key);if(null!==i){const a=this.lr.get(i.largestBatchId).delete(r.key);this.lr.set(i.largestBatchId,a)}this.overlays=this.overlays.insert(r.key,new ji(t,r));let s=this.lr.get(t);void 0===s&&(s=J(),this.lr.set(t,s)),this.lr.set(t,s.add(r.key))}}class Rd{constructor(){this.hr=new ue(Qe.Pr),this.Ir=new ue(Qe.Tr)}isEmpty(){return this.hr.isEmpty()}addReference(e,t){const r=new Qe(e,t);this.hr=this.hr.add(r),this.Ir=this.Ir.add(r)}Er(e,t){e.forEach(r=>this.addReference(r,t))}removeReference(e,t){this.dr(new Qe(e,t))}Ar(e,t){e.forEach(r=>this.removeReference(r,t))}Rr(e){const t=new O(new ie([])),r=new Qe(t,e),i=new Qe(t,e+1),s=[];return this.Ir.forEachInRange([r,i],a=>{this.dr(a),s.push(a.key)}),s}Vr(){this.hr.forEach(e=>this.dr(e))}dr(e){this.hr=this.hr.delete(e),this.Ir=this.Ir.delete(e)}mr(e){const t=new O(new ie([])),r=new Qe(t,e),i=new Qe(t,e+1);let s=J();return this.Ir.forEachInRange([r,i],a=>{s=s.add(a.key)}),s}containsKey(e){const t=new Qe(e,0),r=this.hr.firstAfterOrEqual(t);return null!==r&&e.isEqual(r.key)}}class Qe{constructor(e,t){this.key=e,this.gr=t}static Pr(e,t){return O.comparator(e.key,t.key)||Y(e.gr,t.gr)}static Tr(e,t){return Y(e.gr,t.gr)||O.comparator(e.key,t.key)}}class w_{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.pr=1,this.yr=new ue(Qe.Pr)}checkEmpty(e){return A.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,r,i){const s=this.pr;this.pr++;const a=new ho(s,t,r,i);this.mutationQueue.push(a);for(const h of i)this.yr=this.yr.add(new Qe(h.key,s)),this.indexManager.addToCollectionParentIndex(e,h.key.path.popLast());return A.resolve(a)}lookupMutationBatch(e,t){return A.resolve(this.wr(t))}getNextMutationBatchAfterBatchId(e,t){const i=this.Sr(t+1),s=i<0?0:i;return A.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return A.resolve(0===this.mutationQueue.length?-1:this.pr-1)}getAllMutationBatches(e){return A.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const r=new Qe(t,0),i=new Qe(t,Number.POSITIVE_INFINITY),s=[];return this.yr.forEachInRange([r,i],a=>{const h=this.wr(a.gr);s.push(h)}),A.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new ue(Y);return t.forEach(i=>{const s=new Qe(i,0),a=new Qe(i,Number.POSITIVE_INFINITY);this.yr.forEachInRange([s,a],h=>{r=r.add(h.gr)})}),A.resolve(this.br(r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,i=r.length+1;let s=r;O.isDocumentKey(s)||(s=s.child(""));const a=new Qe(new O(s),0);let h=new ue(Y);return this.yr.forEachWhile(d=>{const m=d.key.path;return!!r.isPrefixOf(m)&&(m.length===i&&(h=h.add(d.gr)),!0)},a),A.resolve(this.br(h))}br(e){const t=[];return e.forEach(r=>{const i=this.wr(r);null!==i&&t.push(i)}),t}removeMutationBatch(e,t){z(0===this.Dr(t.batchId,"removed")),this.mutationQueue.shift();let r=this.yr;return A.forEach(t.mutations,i=>{const s=new Qe(i.key,t.batchId);return r=r.delete(s),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)}).next(()=>{this.yr=r})}Fn(e){}containsKey(e,t){const r=new Qe(t,0),i=this.yr.firstAfterOrEqual(r);return A.resolve(t.isEqual(i&&i.key))}performConsistencyCheck(e){return A.resolve()}Dr(e,t){return this.Sr(e)}Sr(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}wr(e){const t=this.Sr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class P_{constructor(e){this.Cr=e,this.docs=new le(O.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const r=t.key,i=this.docs.get(r),s=i?i.size:0,a=this.Cr(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:a}),this.size+=a-s,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const r=this.docs.get(t);return A.resolve(r?r.document.mutableCopy():he.newInvalidDocument(t))}getEntries(e,t){let r=Be();return t.forEach(i=>{const s=this.docs.get(i);r=r.insert(i,s?s.document.mutableCopy():he.newInvalidDocument(i))}),A.resolve(r)}getDocumentsMatchingQuery(e,t,r,i){let s=Be();const a=t.path,h=new O(a.child("")),d=this.docs.getIteratorFrom(h);for(;d.hasNext();){const{key:m,value:{document:g}}=d.getNext();if(!a.isPrefixOf(m.path))break;m.path.length>a.length+1||ki(Vr(g),r)<=0||(i.has(g.key)||rr(t,g))&&(s=s.insert(g.key,g.mutableCopy()))}return A.resolve(s)}getAllFromCollectionGroup(e,t,r,i){B()}vr(e,t){return A.forEach(this.docs,r=>t(r))}newChangeBuffer(e){return new R_(this)}getSize(e){return A.resolve(this.size)}}class R_ extends rm{constructor(e){super(),this._r=e}applyChanges(e){const t=[];return this.changes.forEach((r,i)=>{i.isValidDocument()?t.push(this._r.addEntry(e,i)):this._r.removeEntry(r)}),A.waitFor(t)}getFromCache(e,t){return this._r.getEntry(e,t)}getAllFromCache(e,t){return this._r.getEntries(e,t)}}class S_{constructor(e){this.persistence=e,this.Fr=new tn(t=>tr(t),An),this.lastRemoteSnapshotVersion=K.min(),this.highestTargetId=0,this.Mr=0,this.Or=new Rd,this.targetCount=0,this.Nr=Xi.On()}forEachTarget(e,t){return this.Fr.forEach((r,i)=>t(i)),A.resolve()}getLastRemoteSnapshotVersion(e){return A.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return A.resolve(this.Mr)}allocateTargetId(e){return this.highestTargetId=this.Nr.next(),A.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.Mr&&(this.Mr=t),A.resolve()}kn(e){this.Fr.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.Nr=new Xi(t),this.highestTargetId=t),e.sequenceNumber>this.Mr&&(this.Mr=e.sequenceNumber)}addTargetData(e,t){return this.kn(t),this.targetCount+=1,A.resolve()}updateTargetData(e,t){return this.kn(t),A.resolve()}removeTargetData(e,t){return this.Fr.delete(t.target),this.Or.Rr(t.targetId),this.targetCount-=1,A.resolve()}removeTargets(e,t,r){let i=0;const s=[];return this.Fr.forEach((a,h)=>{h.sequenceNumber<=t&&null===r.get(h.targetId)&&(this.Fr.delete(a),s.push(this.removeMatchingKeysForTargetId(e,h.targetId)),i++)}),A.waitFor(s).next(()=>i)}getTargetCount(e){return A.resolve(this.targetCount)}getTargetData(e,t){const r=this.Fr.get(t)||null;return A.resolve(r)}addMatchingKeys(e,t,r){return this.Or.Er(t,r),A.resolve()}removeMatchingKeys(e,t,r){this.Or.Ar(t,r);const i=this.persistence.referenceDelegate,s=[];return i&&t.forEach(a=>{s.push(i.markPotentiallyOrphaned(e,a))}),A.waitFor(s)}removeMatchingKeysForTargetId(e,t){return this.Or.Rr(t),A.resolve()}getMatchingKeysForTargetId(e,t){const r=this.Or.mr(t);return A.resolve(r)}containsKey(e,t){return A.resolve(this.Or.containsKey(t))}}class Sd{constructor(e,t){this.Br={},this.overlays={},this.Lr=new ot(0),this.kr=!1,this.kr=!0,this.referenceDelegate=e(this),this.qr=new S_(this),this.indexManager=new f_,this.remoteDocumentCache=new P_(r=>this.referenceDelegate.Qr(r)),this.serializer=new Dp(t),this.Kr=new E_(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.kr=!1,Promise.resolve()}get started(){return this.kr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new A_,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.Br[e.toKey()];return r||(r=new w_(t,this.referenceDelegate),this.Br[e.toKey()]=r),r}getTargetCache(){return this.qr}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Kr}runTransaction(e,t,r){x("MemoryPersistence","Starting transaction:",e);const i=new C_(this.Lr.next());return this.referenceDelegate.$r(),r(i).next(s=>this.referenceDelegate.Ur(i).next(()=>s)).toPromise().then(s=>(i.raiseOnCommittedEvent(),s))}Wr(e,t){return A.or(Object.values(this.Br).map(r=>()=>r.containsKey(e,t)))}}class C_ extends zc{constructor(e){super(),this.currentSequenceNumber=e}}class Cl{constructor(e){this.persistence=e,this.Gr=new Rd,this.zr=null}static jr(e){return new Cl(e)}get Hr(){if(this.zr)return this.zr;throw B()}addReference(e,t,r){return this.Gr.addReference(r,t),this.Hr.delete(r.toString()),A.resolve()}removeReference(e,t,r){return this.Gr.removeReference(r,t),this.Hr.add(r.toString()),A.resolve()}markPotentiallyOrphaned(e,t){return this.Hr.add(t.toString()),A.resolve()}removeTarget(e,t){this.Gr.Rr(t.targetId).forEach(i=>this.Hr.add(i.toString()));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(i=>{i.forEach(s=>this.Hr.add(s.toString()))}).next(()=>r.removeTargetData(e,t))}$r(){this.zr=new Set}Ur(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return A.forEach(this.Hr,r=>{const i=O.fromPath(r);return this.Jr(e,i).next(s=>{s||t.removeEntry(i,K.min())})}).next(()=>(this.zr=null,t.apply(e)))}updateLimboDocument(e,t){return this.Jr(e,t).next(r=>{r?this.Hr.delete(t.toString()):this.Hr.add(t.toString())})}Qr(e){return 0}Jr(e,t){return A.or([()=>A.resolve(this.Gr.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Wr(e,t)])}}class b_{constructor(e){this.serializer=e}N(e,t,r,i){const s=new Ws("createOrUpgrade",t);var d;r<1&&i>=1&&(e.createObjectStore("owner"),(d=e).createObjectStore("mutationQueues",{keyPath:"userId"}),d.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",Wc,{unique:!0}),d.createObjectStore("documentMutations"),cm(e),function(d){d.createObjectStore("remoteDocuments")}(e));let a=A.resolve();return r<3&&i>=3&&(0!==r&&(function(d){d.deleteObjectStore("targetDocuments"),d.deleteObjectStore("targets"),d.deleteObjectStore("targetGlobal")}(e),cm(e)),a=a.next(()=>function(d){const m=d.store("targetGlobal"),g={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:K.min().toTimestamp(),targetCount:0};return m.put("targetGlobalKey",g)}(s))),r<4&&i>=4&&(0!==r&&(a=a.next(()=>function(d,m){return m.store("mutations").W().next(g=>{d.deleteObjectStore("mutations"),d.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",Wc,{unique:!0});const y=m.store("mutations"),T=g.map(w=>y.put(w));return A.waitFor(T)})}(e,s))),a=a.next(()=>{!function(d){d.createObjectStore("clientMetadata",{keyPath:"clientId"})}(e)})),r<5&&i>=5&&(a=a.next(()=>this.Zr(s))),r<6&&i>=6&&(a=a.next(()=>(function(d){d.createObjectStore("remoteDocumentGlobal")}(e),this.Xr(s)))),r<7&&i>=7&&(a=a.next(()=>this.ei(s))),r<8&&i>=8&&(a=a.next(()=>this.ti(e,s))),r<9&&i>=9&&(a=a.next(()=>{!function(d){d.objectStoreNames.contains("remoteDocumentChanges")&&d.deleteObjectStore("remoteDocumentChanges")}(e)})),r<10&&i>=10&&(a=a.next(()=>this.ni(s))),r<11&&i>=11&&(a=a.next(()=>{(function(d){d.createObjectStore("bundles",{keyPath:"bundleId"})})(e),function(d){d.createObjectStore("namedQueries",{keyPath:"name"})}(e)})),r<12&&i>=12&&(a=a.next(()=>{!function(d){const m=d.createObjectStore("documentOverlays",{keyPath:Yh});m.createIndex("collectionPathOverlayIndex",jc,{unique:!1}),m.createIndex("collectionGroupOverlayIndex",$c,{unique:!1})}(e)})),r<13&&i>=13&&(a=a.next(()=>function(d){const m=d.createObjectStore("remoteDocumentsV14",{keyPath:jh});m.createIndex("documentKeyIndex",Ga),m.createIndex("collectionGroupIndex",$h)}(e)).next(()=>this.ri(e,s)).next(()=>e.deleteObjectStore("remoteDocuments"))),r<14&&i>=14&&(a=a.next(()=>this.ii(e,s))),r<15&&i>=15&&(a=a.next(()=>function(d){d.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),d.createObjectStore("indexState",{keyPath:Qs}).createIndex("sequenceNumberIndex",Ka,{unique:!1}),d.createObjectStore("indexEntries",{keyPath:Kc}).createIndex("documentKeyIndex",ja,{unique:!1})}(e))),a}Xr(e){let t=0;return e.store("remoteDocuments").Y((r,i)=>{t+=Pl(i)}).next(()=>{const r={byteSize:t};return e.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",r)})}Zr(e){const t=e.store("mutationQueues"),r=e.store("mutations");return t.W().next(i=>A.forEach(i,s=>{const a=IDBKeyRange.bound([s.userId,-1],[s.userId,s.lastAcknowledgedBatchId]);return r.W("userMutationsIndex",a).next(h=>A.forEach(h,d=>{z(d.userId===s.userId);const m=Qi(this.serializer,d);return Qp(e,s.userId,m).next(()=>{})}))}))}ei(e){const t=e.store("targetDocuments"),r=e.store("remoteDocuments");return e.store("targetGlobal").get("targetGlobalKey").next(i=>{const s=[];return r.Y((a,h)=>{const d=new ie(a),m=[0,$e(d)];s.push(t.get(m).next(g=>g?A.resolve():t.put({targetId:0,path:$e(d),sequenceNumber:i.highestListenSequenceNumber})))}).next(()=>A.waitFor(s))})}ti(e,t){e.createObjectStore("collectionParents",{keyPath:Wa});const r=t.store("collectionParents"),i=new Pd,s=a=>{if(i.add(a)){const h=a.lastSegment(),d=a.popLast();return r.put({collectionId:h,parent:$e(d)})}};return t.store("remoteDocuments").Y({J:!0},(a,h)=>{const d=new ie(a);return s(d.popLast())}).next(()=>t.store("documentMutations").Y({J:!0},([a,h,d],m)=>{const g=wt(h);return s(g.popLast())}))}ni(e){const t=e.store("targets");return t.Y((r,i)=>{const s=Eu(i),a=Mp(this.serializer,s);return t.put(a)})}ri(e,t){const r=t.store("remoteDocuments"),i=[];return r.Y((s,a)=>{const h=t.store("remoteDocumentsV14"),d=(y=a,y.document?new O(ie.fromString(y.document.name).popFirst(5)):y.noDocument?O.fromSegments(y.noDocument.path):y.unknownDocument?O.fromSegments(y.unknownDocument.path):B()).path.toArray(),m={prefixPath:d.slice(0,d.length-2),collectionGroup:d[d.length-2],documentId:d[d.length-1],readTime:a.readTime||[0,0],unknownDocument:a.unknownDocument,noDocument:a.noDocument,document:a.document,hasCommittedMutations:!!a.hasCommittedMutations};var y;i.push(h.put(m))}).next(()=>A.waitFor(i))}ii(e,t){const r=t.store("mutations"),i=im(this.serializer),s=new Sd(Cl.jr,this.serializer.ut);return r.W().next(a=>{const h=new Map;return a.forEach(d=>{var m;let g=null!==(m=h.get(d.userId))&&void 0!==m?m:J();Qi(this.serializer,d).keys().forEach(y=>g=g.add(y)),h.set(d.userId,g)}),A.forEach(h,(d,m)=>{const g=new Ce(m),y=El.ct(this.serializer,g),T=s.getIndexManager(g),w=Rl.ct(g,this.serializer,T,s.referenceDelegate);return new um(i,w,y,T).recalculateAndSaveOverlaysForDocumentKeys(new Qa(t,ot._e),d).next()})})}}function cm(n){n.createObjectStore("targetDocuments",{keyPath:za}).createIndex("documentTargetsIndex",Qh,{unique:!0}),n.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",Hh,{unique:!0}),n.createObjectStore("targetGlobal")}const Cd="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class bd{constructor(e,t,r,i,s,a,h,d,m,g,y=15){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=r,this.si=s,this.window=a,this.document=h,this.oi=m,this._i=g,this.ai=y,this.Lr=null,this.kr=!1,this.isPrimary=!1,this.networkEnabled=!0,this.ui=null,this.inForeground=!1,this.ci=null,this.li=null,this.hi=Number.NEGATIVE_INFINITY,this.Pi=T=>Promise.resolve(),!bd.D())throw new b(P.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new y_(this,i),this.Ii=t+"main",this.serializer=new Dp(d),this.Ti=new At(this.Ii,this.ai,new b_(this.serializer)),this.qr=new m_(this.referenceDelegate,this.serializer),this.remoteDocumentCache=im(this.serializer),this.Kr=new a_,this.window&&this.window.localStorage?this.Ei=this.window.localStorage:(this.Ei=null,!1===g&&Ae("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.di().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new b(P.FAILED_PRECONDITION,Cd);return this.Ai(),this.Ri(),this.Vi(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.qr.getHighestSequenceNumber(e))}).then(e=>{this.Lr=new ot(e,this.oi)}).then(()=>{this.kr=!0}).catch(e=>(this.Ti&&this.Ti.close(),Promise.reject(e)))}mi(e){var t=this;return this.Pi=function(){var r=(0,R.Z)(function*(i){if(t.started)return e(i)});return function(i){return r.apply(this,arguments)}}(),e(this.isPrimary)}setDatabaseDeletedListener(e){this.Ti.L(function(){var t=(0,R.Z)(function*(r){null===r.newVersion&&(yield e())});return function(r){return t.apply(this,arguments)}}())}setNetworkEnabled(e){var t=this;this.networkEnabled!==e&&(this.networkEnabled=e,this.si.enqueueAndForget((0,R.Z)(function*(){t.started&&(yield t.di())})))}di(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>xl(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.fi(e).next(t=>{t||(this.isPrimary=!1,this.si.enqueueRetryable(()=>this.Pi(!1)))})}).next(()=>this.gi(e)).next(t=>this.isPrimary&&!t?this.pi(e).next(()=>!1):!!t&&this.yi(e).next(()=>!0))).catch(e=>{if(Mt(e))return x("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return x("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.si.enqueueRetryable(()=>this.Pi(e)),this.isPrimary=e})}fi(e){return Su(e).get("owner").next(t=>A.resolve(this.wi(t)))}Si(e){return xl(e).delete(this.clientId)}bi(){var e=this;return(0,R.Z)(function*(){if(e.isPrimary&&!e.Di(e.hi,18e5)){e.hi=Date.now();const t=yield e.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",r=>{const i=qe(r,"clientMetadata");return i.W().next(s=>{const a=e.Ci(s,18e5),h=s.filter(d=>-1===a.indexOf(d));return A.forEach(h,d=>i.delete(d.clientId)).next(()=>h)})}).catch(()=>[]);if(e.Ei)for(const r of t)e.Ei.removeItem(e.vi(r.clientId))}})()}Vi(){this.li=this.si.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.di().then(()=>this.bi()).then(()=>this.Vi()))}wi(e){return!!e&&e.ownerId===this.clientId}gi(e){return this._i?A.resolve(!0):Su(e).get("owner").next(t=>{if(null!==t&&this.Di(t.leaseTimestampMs,5e3)&&!this.Fi(t.ownerId)){if(this.wi(t)&&this.networkEnabled)return!0;if(!this.wi(t)){if(!t.allowTabSynchronization)throw new b(P.FAILED_PRECONDITION,Cd);return!1}}return!(!this.networkEnabled||!this.inForeground)||xl(e).W().next(r=>void 0===this.Ci(r,5e3).find(i=>!(this.clientId===i.clientId||!(!this.networkEnabled&&i.networkEnabled||!this.inForeground&&i.inForeground&&this.networkEnabled===i.networkEnabled))))}).next(t=>(this.isPrimary!==t&&x("IndexedDbPersistence",`Client ${t?"is":"is not"} eligible for a primary lease.`),t))}shutdown(){var e=this;return(0,R.Z)(function*(){e.kr=!1,e.Mi(),e.li&&(e.li.cancel(),e.li=null),e.xi(),e.Oi(),yield e.Ti.runTransaction("shutdown","readwrite",["owner","clientMetadata"],t=>{const r=new Qa(t,ot._e);return e.pi(r).next(()=>e.Si(r))}),e.Ti.close(),e.Ni()})()}Ci(e,t){return e.filter(r=>this.Di(r.updateTimeMs,t)&&!this.Fi(r.clientId))}Bi(){return this.runTransaction("getActiveClients","readonly",e=>xl(e).W().next(t=>this.Ci(t,18e5).map(r=>r.clientId)))}get started(){return this.kr}getMutationQueue(e,t){return Rl.ct(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.qr}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new p_(e,this.serializer.ut.databaseId)}getDocumentOverlayCache(e){return El.ct(this.serializer,e)}getBundleCache(){return this.Kr}runTransaction(e,t,r){x("IndexedDbPersistence","Starting transaction:",e);const i="readonly"===t?"readonly":"readwrite",s=15===(d=this.ai)?Xh:14===d?Ys:13===d?Ha:12===d?Jh:11===d?$a:void B();var d;let a;return this.Ti.runTransaction(e,i,s,h=>(a=new Qa(h,this.Lr?this.Lr.next():ot._e),"readwrite-primary"===t?this.fi(a).next(d=>!!d||this.gi(a)).next(d=>{if(!d)throw Ae(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.si.enqueueRetryable(()=>this.Pi(!1)),new b(P.FAILED_PRECONDITION,Gc);return r(a)}).next(d=>this.yi(a).next(()=>d)):this.Li(a).next(()=>r(a)))).then(h=>(a.raiseOnCommittedEvent(),h))}Li(e){return Su(e).get("owner").next(t=>{if(null!==t&&this.Di(t.leaseTimestampMs,5e3)&&!this.Fi(t.ownerId)&&!this.wi(t)&&!(this._i||this.allowTabSynchronization&&t.allowTabSynchronization))throw new b(P.FAILED_PRECONDITION,Cd)})}yi(e){const t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return Su(e).put("owner",t)}static D(){return At.D()}pi(e){const t=Su(e);return t.get("owner").next(r=>this.wi(r)?(x("IndexedDbPersistence","Releasing primary lease."),t.delete("owner")):A.resolve())}Di(e,t){const r=Date.now();return!(e<r-t||e>r&&(Ae(`Detected an update time that is in the future: ${e} > ${r}`),1))}Ai(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.ci=()=>{this.si.enqueueAndForget(()=>(this.inForeground="visible"===this.document.visibilityState,this.di()))},this.document.addEventListener("visibilitychange",this.ci),this.inForeground="visible"===this.document.visibilityState)}xi(){this.ci&&(this.document.removeEventListener("visibilitychange",this.ci),this.ci=null)}Ri(){var e;"function"==typeof(null===(e=this.window)||void 0===e?void 0:e.addEventListener)&&(this.ui=()=>{this.Mi();const t=/(?:Version|Mobile)\/1[456]/;(0,ce.G6)()&&(navigator.appVersion.match(t)||navigator.userAgent.match(t))&&this.si.enterRestrictedMode(!0),this.si.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.ui))}Oi(){this.ui&&(this.window.removeEventListener("pagehide",this.ui),this.ui=null)}Fi(e){var t;try{const r=null!==(null===(t=this.Ei)||void 0===t?void 0:t.getItem(this.vi(e)));return x("IndexedDbPersistence",`Client '${e}' ${r?"is":"is not"} zombied in LocalStorage`),r}catch(r){return Ae("IndexedDbPersistence","Failed to get zombied client id.",r),!1}}Mi(){if(this.Ei)try{this.Ei.setItem(this.vi(this.clientId),String(Date.now()))}catch(e){Ae("Failed to set zombie client id.",e)}}Ni(){if(this.Ei)try{this.Ei.removeItem(this.vi(this.clientId))}catch{}}vi(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function Su(n){return qe(n,"owner")}function xl(n){return qe(n,"clientMetadata")}function xd(n,e){let t=n.projectId;return n.isDefaultDatabase||(t+="."+n.database),"firestore/"+e+"/"+t+"/"}class kd{constructor(e,t,r,i){this.targetId=e,this.fromCache=t,this.ki=r,this.qi=i}static Qi(e,t){let r=J(),i=J();for(const s of t.docChanges)switch(s.type){case 0:r=r.add(s.doc.key);break;case 1:i=i.add(s.doc.key)}return new kd(e,t.fromCache,r,i)}}class x_{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class lm{constructor(){this.Ki=!1,this.$i=!1,this.Ui=100,this.Wi=8}initialize(e,t){this.Gi=e,this.indexManager=t,this.Ki=!0}getDocumentsMatchingQuery(e,t,r,i){const s={result:null};return this.zi(e,t).next(a=>{s.result=a}).next(()=>{if(!s.result)return this.ji(e,t,i,r).next(a=>{s.result=a})}).next(()=>{if(s.result)return;const a=new x_;return this.Hi(e,t,a).next(h=>{if(s.result=h,this.$i)return this.Ji(e,t,a,h.size)})}).next(()=>s.result)}Ji(e,t,r,i){return r.documentReadCount<this.Ui?(Yt()<=vt.in.DEBUG&&x("QueryEngine","SDK will not create cache indexes for query:",wn(t),"since it only creates cache indexes for collection contains","more than or equal to",this.Ui,"documents"),A.resolve()):(Yt()<=vt.in.DEBUG&&x("QueryEngine","Query:",wn(t),"scans",r.documentReadCount,"local documents and returns",i,"documents as results."),r.documentReadCount>this.Wi*i?(Yt()<=vt.in.DEBUG&&x("QueryEngine","The SDK decides to create cache indexes for query:",wn(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,He(t))):A.resolve())}zi(e,t){if(ll(t))return A.resolve(null);let r=He(t);return this.indexManager.getIndexType(e,r).next(i=>0===i?null:(null!==t.limit&&1===i&&(t=uo(t,null,"F"),r=He(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next(s=>{const a=J(...s);return this.Gi.getDocuments(e,a).next(h=>this.indexManager.getMinOffset(e,r).next(d=>{const m=this.Yi(t,h);return this.Zi(t,m,a,d.readTime)?this.zi(e,uo(t,null,"F")):this.Xi(e,m,t,d)}))})))}ji(e,t,r,i){return ll(t)||i.isEqual(K.min())?A.resolve(null):this.Gi.getDocuments(e,r).next(s=>{const a=this.Yi(t,s);return this.Zi(t,a,r,i)?A.resolve(null):(Yt()<=vt.in.DEBUG&&x("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),wn(t)),this.Xi(e,a,t,zs(i,-1)).next(h=>h))})}Yi(e,t){let r=new ue(dl(e));return t.forEach((i,s)=>{rr(e,s)&&(r=r.add(s))}),r}Zi(e,t,r,i){if(null===e.limit)return!1;if(r.size!==t.size)return!0;const s="F"===e.limitType?t.last():t.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(i)>0)}Hi(e,t,r){return Yt()<=vt.in.DEBUG&&x("QueryEngine","Using full collection scan to execute query:",wn(t)),this.Gi.getDocumentsMatchingQuery(e,t,Oe.min(),r)}Xi(e,t,r,i){return this.Gi.getDocumentsMatchingQuery(e,r,i).next(s=>(t.forEach(a=>{s=s.insert(a.key,a)}),s))}}class k_{constructor(e,t,r,i){this.persistence=e,this.es=t,this.serializer=i,this.ts=new le(Y),this.ns=new tn(s=>tr(s),An),this.rs=new Map,this.ss=e.getRemoteDocumentCache(),this.qr=e.getTargetCache(),this.Kr=e.getBundleCache(),this.os(r)}os(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new um(this.ss,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.ss.setIndexManager(this.indexManager),this.es.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.ts))}}function hm(n,e,t,r){return new k_(n,e,t,r)}function dm(n,e){return Nd.apply(this,arguments)}function Nd(){return Nd=(0,R.Z)(function*(n,e){const t=M(n);return yield t.persistence.runTransaction("Handle user change","readonly",r=>{let i;return t.mutationQueue.getAllMutationBatches(r).next(s=>(i=s,t.os(e),t.mutationQueue.getAllMutationBatches(r))).next(s=>{const a=[],h=[];let d=J();for(const m of i){a.push(m.batchId);for(const g of m.mutations)d=d.add(g.key)}for(const m of s){h.push(m.batchId);for(const g of m.mutations)d=d.add(g.key)}return t.localDocuments.getDocuments(r,d).next(m=>({_s:m,removedBatchIds:a,addedBatchIds:h}))})})}),Nd.apply(this,arguments)}function fm(n){const e=M(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.qr.getLastRemoteSnapshotVersion(t))}function pm(n,e,t){let r=J(),i=J();return t.forEach(s=>r=r.add(s)),e.getEntries(n,r).next(s=>{let a=Be();return t.forEach((h,d)=>{const m=s.get(h);d.isFoundDocument()!==m.isFoundDocument()&&(i=i.add(h)),d.isNoDocument()&&d.version.isEqual(K.min())?(e.removeEntry(h,d.readTime),a=a.insert(h,d)):!m.isValidDocument()||d.version.compareTo(m.version)>0||0===d.version.compareTo(m.version)&&m.hasPendingWrites?(e.addEntry(d),a=a.insert(h,d)):x("LocalStore","Ignoring outdated watch update for ",h,". Current version:",m.version," Watch version:",d.version)}),{us:a,cs:i}})}function D_(n,e){const t=M(n);return t.persistence.runTransaction("Get next mutation batch","readonly",r=>(void 0===e&&(e=-1),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function Eo(n,e){const t=M(n);return t.persistence.runTransaction("Allocate target","readwrite",r=>{let i;return t.qr.getTargetData(r,e).next(s=>s?(i=s,A.resolve(i)):t.qr.allocateTargetId(r).next(a=>(i=new or(e,a,"TargetPurposeListen",r.currentSequenceNumber),t.qr.addTargetData(r,i).next(()=>i))))}).then(r=>{const i=t.ts.get(r.targetId);return(null===i||r.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(t.ts=t.ts.insert(r.targetId,r),t.ns.set(e,r.targetId)),r})}function Ao(n,e,t){return Vd.apply(this,arguments)}function Vd(){return Vd=(0,R.Z)(function*(n,e,t){const r=M(n),i=r.ts.get(e),s=t?"readwrite":"readwrite-primary";try{t||(yield r.persistence.runTransaction("Release target",s,a=>r.persistence.referenceDelegate.removeTarget(a,i)))}catch(a){if(!Mt(a))throw a;x("LocalStore",`Failed to update sequence numbers for target ${e}: ${a}`)}r.ts=r.ts.remove(e),r.ns.delete(i.target)}),Vd.apply(this,arguments)}function kl(n,e,t){const r=M(n);let i=K.min(),s=J();return r.persistence.runTransaction("Execute query","readwrite",a=>function(d,m,g){const y=M(d),T=y.ns.get(g);return void 0!==T?A.resolve(y.ts.get(T)):y.qr.getTargetData(m,g)}(r,a,He(e)).next(h=>{if(h)return i=h.lastLimboFreeSnapshotVersion,r.qr.getMatchingKeysForTargetId(a,h.targetId).next(d=>{s=d})}).next(()=>r.es.getDocumentsMatchingQuery(a,e,t?i:K.min(),t?s:J())).next(h=>(_m(r,cu(e),h),{documents:h,ls:s})))}function mm(n,e){const t=M(n),r=M(t.qr),i=t.ts.get(e);return i?Promise.resolve(i.target):t.persistence.runTransaction("Get target data","readonly",s=>r._t(s,e).next(a=>a?a.target:null))}function gm(n,e){const t=M(n),r=t.rs.get(e)||K.min();return t.persistence.runTransaction("Get new document changes","readonly",i=>t.ss.getAllFromCollectionGroup(i,e,zs(r,-1),Number.MAX_SAFE_INTEGER)).then(i=>(_m(t,e,i),i))}function _m(n,e,t){let r=n.rs.get(e)||K.min();t.forEach((i,s)=>{s.readTime.compareTo(r)>0&&(r=s.readTime)}),n.rs.set(e,r)}function Dd(){return Dd=(0,R.Z)(function*(n,e,t,r){const i=M(n);let s=J(),a=Be();for(const m of t){const g=e.hs(m.metadata.name);m.document&&(s=s.add(g));const y=e.Ps(m);y.setReadTime(e.Is(m.metadata.readTime)),a=a.insert(g,y)}const h=i.ss.newChangeBuffer({trackRemovals:!0}),d=yield Eo(i,(g=r,He(Mr(ie.fromString(`__bundle__/docs/${g}`)))));var g;return i.persistence.runTransaction("Apply bundle documents","readwrite",m=>pm(m,h,a).next(g=>(h.apply(m),g)).next(g=>i.qr.removeMatchingKeysForTargetId(m,d.targetId).next(()=>i.qr.addMatchingKeys(m,s,d.targetId)).next(()=>i.localDocuments.getLocalViewOfDocuments(m,g.us,g.cs)).next(()=>g.us)))}),Dd.apply(this,arguments)}function M_(n,e){return Od.apply(this,arguments)}function Od(){return Od=(0,R.Z)(function*(n,e,t=J()){const r=yield Eo(n,He(Id(e.bundledQuery))),i=M(n);return i.persistence.runTransaction("Save named query","readwrite",s=>{const a=Le(e.readTime);if(r.snapshotVersion.compareTo(a)>=0)return i.Kr.saveNamedQuery(s,e);const h=r.withResumeToken(Me.EMPTY_BYTE_STRING,a);return i.ts=i.ts.insert(h.targetId,h),i.qr.updateTargetData(s,h).next(()=>i.qr.removeMatchingKeysForTargetId(s,r.targetId)).next(()=>i.qr.addMatchingKeys(s,t,r.targetId)).next(()=>i.Kr.saveNamedQuery(s,e))})}),Od.apply(this,arguments)}function ym(n,e){return`firestore_clients_${n}_${e}`}function Im(n,e,t){let r=`firestore_mutations_${n}_${t}`;return e.isAuthenticated()&&(r+=`_${e.uid}`),r}function Md(n,e){return`firestore_targets_${n}_${e}`}class Nl{constructor(e,t,r,i){this.user=e,this.batchId=t,this.state=r,this.error=i}static Ts(e,t,r){const i=JSON.parse(r);let s,a="object"==typeof i&&-1!==["pending","acknowledged","rejected"].indexOf(i.state)&&(void 0===i.error||"object"==typeof i.error);return a&&i.error&&(a="string"==typeof i.error.message&&"string"==typeof i.error.code,a&&(s=new b(i.error.code,i.error.message))),a?new Nl(e,t,i.state,s):(Ae("SharedClientState",`Failed to parse mutation state for ID '${t}': ${r}`),null)}Es(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class Cu{constructor(e,t,r){this.targetId=e,this.state=t,this.error=r}static Ts(e,t){const r=JSON.parse(t);let i,s="object"==typeof r&&-1!==["not-current","current","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error);return s&&r.error&&(s="string"==typeof r.error.message&&"string"==typeof r.error.code,s&&(i=new b(r.error.code,r.error.message))),s?new Cu(e,r.state,i):(Ae("SharedClientState",`Failed to parse target state for ID '${e}': ${t}`),null)}Es(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class Vl{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static Ts(e,t){const r=JSON.parse(t);let i="object"==typeof r&&r.activeTargetIds instanceof Array,s=du();for(let a=0;i&&a<r.activeTargetIds.length;++a)i=js(r.activeTargetIds[a]),s=s.add(r.activeTargetIds[a]);return i?new Vl(e,s):(Ae("SharedClientState",`Failed to parse client data for instance '${e}': ${t}`),null)}}class Ld{constructor(e,t){this.clientId=e,this.onlineState=t}static Ts(e){const t=JSON.parse(e);return"object"==typeof t&&-1!==["Unknown","Online","Offline"].indexOf(t.onlineState)&&"string"==typeof t.clientId?new Ld(t.clientId,t.onlineState):(Ae("SharedClientState",`Failed to parse online state: ${e}`),null)}}class Fd{constructor(){this.activeTargetIds=du()}ds(e){this.activeTargetIds=this.activeTargetIds.add(e)}As(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Es(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class Ud{constructor(e,t,r,i,s){this.window=e,this.si=t,this.persistenceKey=r,this.Rs=i,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.Vs=this.fs.bind(this),this.gs=new le(Y),this.started=!1,this.ps=[];const a=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=s,this.ys=ym(this.persistenceKey,this.Rs),this.ws=`firestore_sequence_number_${this.persistenceKey}`,this.gs=this.gs.insert(this.Rs,new Fd),this.Ss=new RegExp(`^firestore_clients_${a}_([^_]*)$`),this.bs=new RegExp(`^firestore_mutations_${a}_(\\d+)(?:_(.*))?$`),this.Ds=new RegExp(`^firestore_targets_${a}_(\\d+)$`),this.Cs=`firestore_online_state_${this.persistenceKey}`,this.vs=function(d){return`firestore_bundle_loaded_v2_${d}`}(this.persistenceKey),this.window.addEventListener("storage",this.Vs)}static D(e){return!(!e||!e.localStorage)}start(){var e=this;return(0,R.Z)(function*(){const t=yield e.syncEngine.Bi();for(const i of t){if(i===e.Rs)continue;const s=e.getItem(ym(e.persistenceKey,i));if(s){const a=Vl.Ts(i,s);a&&(e.gs=e.gs.insert(a.clientId,a))}}e.Fs();const r=e.storage.getItem(e.Cs);if(r){const i=e.Ms(r);i&&e.xs(i)}for(const i of e.ps)e.fs(i);e.ps=[],e.window.addEventListener("pagehide",()=>e.shutdown()),e.started=!0})()}writeSequenceNumber(e){this.setItem(this.ws,JSON.stringify(e))}getAllActiveQueryTargets(){return this.Os(this.gs)}isActiveQueryTarget(e){let t=!1;return this.gs.forEach((r,i)=>{i.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.Ns(e,"pending")}updateMutationState(e,t,r){this.Ns(e,t,r),this.Bs(e)}addLocalQueryTarget(e){let t="not-current";if(this.isActiveQueryTarget(e)){const r=this.storage.getItem(Md(this.persistenceKey,e));if(r){const i=Cu.Ts(e,r);i&&(t=i.state)}}return this.Ls.ds(e),this.Fs(),t}removeLocalQueryTarget(e){this.Ls.As(e),this.Fs()}isLocalQueryTarget(e){return this.Ls.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(Md(this.persistenceKey,e))}updateQueryState(e,t,r){this.ks(e,t,r)}handleUserChange(e,t,r){t.forEach(i=>{this.Bs(i)}),this.currentUser=e,r.forEach(i=>{this.addPendingMutation(i)})}setOnlineState(e){this.qs(e)}notifyBundleLoaded(e){this.Qs(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.Vs),this.removeItem(this.ys),this.started=!1)}getItem(e){const t=this.storage.getItem(e);return x("SharedClientState","READ",e,t),t}setItem(e,t){x("SharedClientState","SET",e,t),this.storage.setItem(e,t)}removeItem(e){x("SharedClientState","REMOVE",e),this.storage.removeItem(e)}fs(e){var t=this;const r=e;if(r.storageArea===this.storage){if(x("SharedClientState","EVENT",r.key,r.newValue),r.key===this.ys)return void Ae("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.si.enqueueRetryable((0,R.Z)(function*(){if(t.started){if(null!==r.key)if(t.Ss.test(r.key)){if(null==r.newValue){const i=t.Ks(r.key);return t.$s(i,null)}{const i=t.Us(r.key,r.newValue);if(i)return t.$s(i.clientId,i)}}else if(t.bs.test(r.key)){if(null!==r.newValue){const i=t.Ws(r.key,r.newValue);if(i)return t.Gs(i)}}else if(t.Ds.test(r.key)){if(null!==r.newValue){const i=t.zs(r.key,r.newValue);if(i)return t.js(i)}}else if(r.key===t.Cs){if(null!==r.newValue){const i=t.Ms(r.newValue);if(i)return t.xs(i)}}else if(r.key===t.ws){const i=function(a){let h=ot._e;if(null!=a)try{const d=JSON.parse(a);z("number"==typeof d),h=d}catch(d){Ae("SharedClientState","Failed to read sequence number from WebStorage",d)}return h}(r.newValue);i!==ot._e&&t.sequenceNumberHandler(i)}else if(r.key===t.vs){const i=t.Hs(r.newValue);yield Promise.all(i.map(s=>t.syncEngine.Js(s)))}}else t.ps.push(r)}))}}get Ls(){return this.gs.get(this.Rs)}Fs(){this.setItem(this.ys,this.Ls.Es())}Ns(e,t,r){const i=new Nl(this.currentUser,e,t,r),s=Im(this.persistenceKey,this.currentUser,e);this.setItem(s,i.Es())}Bs(e){const t=Im(this.persistenceKey,this.currentUser,e);this.removeItem(t)}qs(e){this.storage.setItem(this.Cs,JSON.stringify({clientId:this.Rs,onlineState:e}))}ks(e,t,r){const i=Md(this.persistenceKey,e),s=new Cu(e,t,r);this.setItem(i,s.Es())}Qs(e){const t=JSON.stringify(Array.from(e));this.setItem(this.vs,t)}Ks(e){const t=this.Ss.exec(e);return t?t[1]:null}Us(e,t){const r=this.Ks(e);return Vl.Ts(r,t)}Ws(e,t){const r=this.bs.exec(e),i=Number(r[1]);return Nl.Ts(new Ce(void 0!==r[2]?r[2]:null),i,t)}zs(e,t){const r=this.Ds.exec(e),i=Number(r[1]);return Cu.Ts(i,t)}Ms(e){return Ld.Ts(e)}Hs(e){return JSON.parse(e)}Gs(e){var t=this;return(0,R.Z)(function*(){if(e.user.uid===t.currentUser.uid)return t.syncEngine.Ys(e.batchId,e.state,e.error);x("SharedClientState",`Ignoring mutation for non-active user ${e.user.uid}`)})()}js(e){return this.syncEngine.Zs(e.targetId,e.state,e.error)}$s(e,t){const r=t?this.gs.insert(e,t):this.gs.remove(e),i=this.Os(this.gs),s=this.Os(r),a=[],h=[];return s.forEach(d=>{i.has(d)||a.push(d)}),i.forEach(d=>{s.has(d)||h.push(d)}),this.syncEngine.Xs(a,h).then(()=>{this.gs=r})}xs(e){this.gs.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}Os(e){let t=du();return e.forEach((r,i)=>{t=t.unionWith(i.activeTargetIds)}),t}}class vm{constructor(){this.eo=new Fd,this.no={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e){return this.eo.ds(e),this.no[e]||"not-current"}updateQueryState(e,t,r){this.no[e]=t}removeLocalQueryTarget(e){this.eo.As(e)}isLocalQueryTarget(e){return this.eo.activeTargetIds.has(e)}clearQueryState(e){delete this.no[e]}getAllActiveQueryTargets(){return this.eo.activeTargetIds}isActiveQueryTarget(e){return this.eo.activeTargetIds.has(e)}start(){return this.eo=new Fd,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class L_{ro(e){}shutdown(){}}class Tm{constructor(){this.io=()=>this.so(),this.oo=()=>this._o(),this.ao=[],this.uo()}ro(e){this.ao.push(e)}shutdown(){window.removeEventListener("online",this.io),window.removeEventListener("offline",this.oo)}uo(){window.addEventListener("online",this.io),window.addEventListener("offline",this.oo)}so(){x("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.ao)e(0)}_o(){x("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.ao)e(1)}static D(){return typeof window<"u"&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let Dl=null;function qd(){return null===Dl?Dl=268435456+Math.round(2147483648*Math.random()):Dl++,"0x"+Dl.toString(16)}const F_={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class U_{constructor(e){this.co=e.co,this.lo=e.lo}ho(e){this.Po=e}Io(e){this.To=e}onMessage(e){this.Eo=e}close(){this.lo()}send(e){this.co(e)}Ao(){this.Po()}Ro(e){this.To(e)}Vo(e){this.Eo(e)}}const nt="WebChannelConnection";class q_ extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const r=t.ssl?"https":"http",i=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.mo=r+"://"+t.host,this.fo=`projects/${i}/databases/${s}`,this.po="(default)"===this.databaseId.database?`project_id=${i}`:`project_id=${i}&database_id=${s}`}get yo(){return!1}wo(t,r,i,s,a){const h=qd(),d=this.So(t,r);x("RestConnection",`Sending RPC '${t}' ${h}:`,d,i);const m={"google-cloud-resource-prefix":this.fo,"x-goog-request-params":this.po};return this.bo(m,s,a),this.Do(t,d,m,i).then(g=>(x("RestConnection",`Received RPC '${t}' ${h}: `,g),g),g=>{throw je("RestConnection",`RPC '${t}' ${h} failed with error: `,g,"url: ",d,"request:",i),g})}Co(t,r,i,s,a,h){return this.wo(t,r,i,s,a)}bo(t,r,i){t["X-Goog-Api-Client"]="gl-js/ fire/"+Hn,t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),r&&r.headers.forEach((s,a)=>t[a]=s),i&&i.headers.forEach((s,a)=>t[a]=s)}So(t,r){return`${this.mo}/v1/${r}:${F_[t]}`}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Do(e,t,r,i){const s=qd();return new Promise((a,h)=>{const d=new Dh;d.setWithCredentials(!0),d.listenOnce(be.COMPLETE,()=>{try{switch(d.getLastErrorCode()){case Da.NO_ERROR:const g=d.getResponseJson();x(nt,`XHR for RPC '${e}' ${s} received:`,JSON.stringify(g)),a(g);break;case Da.TIMEOUT:x(nt,`RPC '${e}' ${s} timed out`),h(new b(P.DEADLINE_EXCEEDED,"Request time out"));break;case Da.HTTP_ERROR:const y=d.getStatus();if(x(nt,`RPC '${e}' ${s} failed with status:`,y,"response text:",d.getResponseText()),y>0){let T=d.getResponseJson();Array.isArray(T)&&(T=T[0]);const w=null==T?void 0:T.error;if(w&&w.status&&w.message){const k=function(V){const G=V.toLowerCase().replace(/_/g,"-");return Object.values(P).indexOf(G)>=0?G:P.UNKNOWN}(w.status);h(new b(k,w.message))}else h(new b(P.UNKNOWN,"Server responded with status "+d.getStatus()))}else h(new b(P.UNAVAILABLE,"Connection failed."));break;default:B()}}finally{x(nt,`RPC '${e}' ${s} completed.`)}});const m=JSON.stringify(i);x(nt,`RPC '${e}' ${s} sending request:`,i),d.send(t,"POST",m,r,15)})}vo(e,t,r){const i=qd(),s=[this.mo,"/","google.firestore.v1.Firestore","/",e,"/channel"],a=kh(),h=Ci(),d={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},m=this.longPollingOptions.timeoutSeconds;void 0!==m&&(d.longPollingTimeout=Math.round(1e3*m)),this.useFetchStreams&&(d.xmlHttpFactory=new Vh({})),this.bo(d.initMessageHeaders,t,r),d.encodeInitMessageHeaders=!0;const g=s.join("");x(nt,`Creating RPC '${e}' stream ${i}: ${g}`,d);const y=a.createWebChannel(g,d);let T=!1,w=!1;const k=new U_({co:V=>{w?x(nt,`Not sending because RPC '${e}' stream ${i} is closed:`,V):(T||(x(nt,`Opening RPC '${e}' stream ${i} transport.`),y.open(),T=!0),x(nt,`RPC '${e}' stream ${i} sending:`,V),y.send(V))},lo:()=>y.close()}),D=(V,G,$)=>{V.listen(G,j=>{try{$(j)}catch(W){setTimeout(()=>{throw W},0)}})};return D(y,br.EventType.OPEN,()=>{w||x(nt,`RPC '${e}' stream ${i} transport opened.`)}),D(y,br.EventType.CLOSE,()=>{w||(w=!0,x(nt,`RPC '${e}' stream ${i} transport closed`),k.Ro())}),D(y,br.EventType.ERROR,V=>{w||(w=!0,je(nt,`RPC '${e}' stream ${i} transport errored:`,V),k.Ro(new b(P.UNAVAILABLE,"The operation could not be completed")))}),D(y,br.EventType.MESSAGE,V=>{var G;if(!w){const $=V.data[0];z(!!$);const W=$.error||(null===(G=$[0])||void 0===G?void 0:G.error);if(W){x(nt,`RPC '${e}' stream ${i} received error:`,W);const ee=W.status;let X=function(kv){const Gg=Pe[kv];if(void 0!==Gg)return po(Gg)}(ee),Ze=W.message;void 0===X&&(X=P.INTERNAL,Ze="Unknown error status: "+ee+" with message "+W.message),w=!0,k.Ro(new b(X,Ze)),y.close()}else x(nt,`RPC '${e}' stream ${i} received:`,$),k.Vo($)}}),D(h,Nh.STAT_EVENT,V=>{V.stat===Zs.PROXY?x(nt,`RPC '${e}' stream ${i} detected buffering proxy`):V.stat===Zs.NOPROXY&&x(nt,`RPC '${e}' stream ${i} detected no buffering proxy`)}),setTimeout(()=>{k.Ao()},0),k}}function Em(){return typeof window<"u"?window:null}function Ol(){return typeof document<"u"?document:null}function bu(n){return new Qg(n,!0)}class Bd{constructor(e,t,r=1e3,i=1.5,s=6e4){this.si=e,this.timerId=t,this.Fo=r,this.Mo=i,this.xo=s,this.Oo=0,this.No=null,this.Bo=Date.now(),this.reset()}reset(){this.Oo=0}Lo(){this.Oo=this.xo}ko(e){this.cancel();const t=Math.floor(this.Oo+this.qo()),r=Math.max(0,Date.now()-this.Bo),i=Math.max(0,t-r);i>0&&x("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.Oo} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.No=this.si.enqueueAfterDelay(this.timerId,i,()=>(this.Bo=Date.now(),e())),this.Oo*=this.Mo,this.Oo<this.Fo&&(this.Oo=this.Fo),this.Oo>this.xo&&(this.Oo=this.xo)}Qo(){null!==this.No&&(this.No.skipDelay(),this.No=null)}cancel(){null!==this.No&&(this.No.cancel(),this.No=null)}qo(){return(Math.random()-.5)*this.Oo}}class Am{constructor(e,t,r,i,s,a,h,d){this.si=e,this.Ko=r,this.$o=i,this.connection=s,this.authCredentialsProvider=a,this.appCheckCredentialsProvider=h,this.listener=d,this.state=0,this.Uo=0,this.Wo=null,this.Go=null,this.stream=null,this.zo=new Bd(e,t)}jo(){return 1===this.state||5===this.state||this.Ho()}Ho(){return 2===this.state||3===this.state}start(){4!==this.state?this.auth():this.Jo()}stop(){var e=this;return(0,R.Z)(function*(){e.jo()&&(yield e.close(0))})()}Yo(){this.state=0,this.zo.reset()}Zo(){this.Ho()&&null===this.Wo&&(this.Wo=this.si.enqueueAfterDelay(this.Ko,6e4,()=>this.Xo()))}e_(e){this.t_(),this.stream.send(e)}Xo(){var e=this;return(0,R.Z)(function*(){if(e.Ho())return e.close(0)})()}t_(){this.Wo&&(this.Wo.cancel(),this.Wo=null)}n_(){this.Go&&(this.Go.cancel(),this.Go=null)}close(e,t){var r=this;return(0,R.Z)(function*(){r.t_(),r.n_(),r.zo.cancel(),r.Uo++,4!==e?r.zo.reset():t&&t.code===P.RESOURCE_EXHAUSTED?(Ae(t.toString()),Ae("Using maximum backoff delay to prevent overloading the backend."),r.zo.Lo()):t&&t.code===P.UNAUTHENTICATED&&3!==r.state&&(r.authCredentialsProvider.invalidateToken(),r.appCheckCredentialsProvider.invalidateToken()),null!==r.stream&&(r.r_(),r.stream.close(),r.stream=null),r.state=e,yield r.listener.Io(t)})()}r_(){}auth(){this.state=1;const e=this.i_(this.Uo),t=this.Uo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,i])=>{this.Uo===t&&this.s_(r,i)},r=>{e(()=>{const i=new b(P.UNKNOWN,"Fetching auth token failed: "+r.message);return this.o_(i)})})}s_(e,t){const r=this.i_(this.Uo);this.stream=this.__(e,t),this.stream.ho(()=>{r(()=>(this.state=2,this.Go=this.si.enqueueAfterDelay(this.$o,1e4,()=>(this.Ho()&&(this.state=3),Promise.resolve())),this.listener.ho()))}),this.stream.Io(i=>{r(()=>this.o_(i))}),this.stream.onMessage(i=>{r(()=>this.onMessage(i))})}Jo(){var e=this;this.state=5,this.zo.ko((0,R.Z)(function*(){e.state=0,e.start()}))}o_(e){return x("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}i_(e){return t=>{this.si.enqueueAndForget(()=>this.Uo===e?t():(x("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class B_ extends Am{constructor(e,t,r,i,s,a){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,i,a),this.serializer=s}__(e,t){return this.connection.vo("Listen",e,t)}onMessage(e){this.zo.reset();const t=function Xg(n,e){let t;if("targetChange"in e){const r="NO_CHANGE"===(m=e.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===m?1:"REMOVE"===m?2:"CURRENT"===m?3:"RESET"===m?4:B(),i=e.targetChange.targetIds||[],s=function(m,g){return m.useProto3Json?(z(void 0===g||"string"==typeof g),Me.fromBase64String(g||"")):(z(void 0===g||g instanceof Uint8Array),Me.fromUint8Array(g||new Uint8Array))}(n,e.targetChange.resumeToken),a=e.targetChange.cause,h=a&&function(m){const g=void 0===m.code?P.UNKNOWN:po(m.code);return new b(g,m.message||"")}(a);t=new Ip(r,i,s,h||null)}else if("documentChange"in e){const r=e.documentChange,i=Sn(n,r.document.name),s=Le(r.document.updateTime),a=r.document.createTime?Le(r.document.createTime):K.min(),h=new Ke({mapValue:{fields:r.document.fields}}),d=he.newFoundDocument(i,s,a,h);t=new vl(r.targetIds||[],r.removedTargetIds||[],d.key,d)}else if("documentDelete"in e){const r=e.documentDelete,i=Sn(n,r.document),s=r.readTime?Le(r.readTime):K.min(),a=he.newNoDocument(i,s);t=new vl([],r.removedTargetIds||[],a.key,a)}else if("documentRemove"in e){const r=e.documentRemove,i=Sn(n,r.document);t=new vl([],r.removedTargetIds||[],i,null)}else{if(!("filter"in e))return B();{const r=e.filter,{count:i=0,unchangedNames:s}=r,a=new yl(i,s);t=new yp(r.targetId,a)}}var m;return t}(this.serializer,e),r=function(s){if(!("targetChange"in s))return K.min();const a=s.targetChange;return a.targetIds&&a.targetIds.length?K.min():a.readTime?Le(a.readTime):K.min()}(e);return this.listener.a_(t,r)}u_(e){const t={};t.database=vu(this.serializer),t.addTarget=function(s,a){let h;const d=a.target;if(h=oo(d)?{documents:bp(s,d)}:{query:yd(s,d)},h.targetId=a.targetId,a.resumeToken.approximateByteSize()>0){h.resumeToken=Ap(s,a.resumeToken);const m=pd(s,a.expectedCount);null!==m&&(h.expectedCount=m)}else if(a.snapshotVersion.compareTo(K.min())>0){h.readTime=go(s,a.snapshotVersion.toTimestamp());const m=pd(s,a.expectedCount);null!==m&&(h.expectedCount=m)}return h}(this.serializer,e);const r=function t_(n,e){const t=function(i){switch(i){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return B()}}(e.purpose);return null==t?null:{"goog-listen-tags":t}}(0,e);r&&(t.labels=r),this.e_(t)}c_(e){const t={};t.database=vu(this.serializer),t.removeTarget=e,this.e_(t)}}class Z_ extends Am{constructor(e,t,r,i,s,a){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,i,a),this.serializer=s,this.l_=!1}get h_(){return this.l_}start(){this.l_=!1,this.lastStreamToken=void 0,super.start()}r_(){this.l_&&this.P_([])}__(e,t){return this.connection.vo("Write",e,t)}onMessage(e){if(z(!!e.streamToken),this.lastStreamToken=e.streamToken,this.l_){this.zo.reset();const t=function e_(n,e){return n&&n.length>0?(z(void 0!==e),n.map(t=>function(i,s){let a=Le(i.updateTime?i.updateTime:s);return a.isEqual(K.min())&&(a=Le(s)),new o(a,i.transformResults||[])}(t,e))):[]}(e.writeResults,e.commitTime),r=Le(e.commitTime);return this.listener.I_(r,t)}return z(!e.writeResults||0===e.writeResults.length),this.l_=!0,this.listener.T_()}E_(){const e={};e.database=vu(this.serializer),this.e_(e)}P_(e){const t={streamToken:this.lastStreamToken,writes:e.map(r=>Tu(this.serializer,r))};this.e_(t)}}class G_ extends class{}{constructor(e,t,r,i){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=i,this.d_=!1}A_(){if(this.d_)throw new b(P.FAILED_PRECONDITION,"The client has already been terminated.")}wo(e,t,r){return this.A_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,s])=>this.connection.wo(e,t,r,i,s)).catch(i=>{throw"FirebaseError"===i.name?(i.code===P.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),i):new b(P.UNKNOWN,i.toString())})}Co(e,t,r,i){return this.A_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,a])=>this.connection.Co(e,t,r,s,a,i)).catch(s=>{throw"FirebaseError"===s.name?(s.code===P.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new b(P.UNKNOWN,s.toString())})}terminate(){this.d_=!0}}class W_{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.V_=0,this.m_=null,this.f_=!0}g_(){0===this.V_&&(this.p_("Unknown"),this.m_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.m_=null,this.y_("Backend didn't respond within 10 seconds."),this.p_("Offline"),Promise.resolve())))}w_(e){"Online"===this.state?this.p_("Unknown"):(this.V_++,this.V_>=1&&(this.S_(),this.y_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.p_("Offline")))}set(e){this.S_(),this.V_=0,"Online"===e&&(this.f_=!1),this.p_(e)}p_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}y_(e){const t=`Could not reach Cloud Firestore backend. ${e}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.f_?(Ae(t),this.f_=!1):x("OnlineStateTracker",t)}S_(){null!==this.m_&&(this.m_.cancel(),this.m_=null)}}class K_{constructor(e,t,r,i,s){var a=this;this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.b_=[],this.D_=new Map,this.C_=new Set,this.v_=[],this.F_=s,this.F_.ro(h=>{r.enqueueAndForget((0,R.Z)(function*(){var d;Wr(a)&&(x("RemoteStore","Restarting streams for network reachability change."),yield(d=(0,R.Z)(function*(g){const y=M(g);y.C_.add(4),yield wo(y),y.M_.set("Unknown"),y.C_.delete(4),yield xu(y)}),function m(g){return d.apply(this,arguments)})(a))}))}),this.M_=new W_(r,i)}}function xu(n){return Gd.apply(this,arguments)}function Gd(){return Gd=(0,R.Z)(function*(n){if(Wr(n))for(const e of n.v_)yield e(!0)}),Gd.apply(this,arguments)}function wo(n){return zd.apply(this,arguments)}function zd(){return zd=(0,R.Z)(function*(n){for(const e of n.v_)yield e(!1)}),zd.apply(this,arguments)}function Ml(n,e){const t=M(n);t.D_.has(e.targetId)||(t.D_.set(e.targetId,e),jd(t)?Kd(t):Ro(t).Ho()&&Wd(t,e))}function ku(n,e){const t=M(n),r=Ro(t);t.D_.delete(e),r.Ho()&&wm(t,e),0===t.D_.size&&(r.Ho()?r.Zo():Wr(t)&&t.M_.set("Unknown"))}function Wd(n,e){if(n.x_.Oe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(K.min())>0){const t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}Ro(n).u_(e)}function wm(n,e){n.x_.Oe(e),Ro(n).c_(e)}function Kd(n){n.x_=new Kg({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),_t:e=>n.D_.get(e)||null,nt:()=>n.datastore.serializer.databaseId}),Ro(n).start(),n.M_.g_()}function jd(n){return Wr(n)&&!Ro(n).jo()&&n.D_.size>0}function Wr(n){return 0===M(n).C_.size}function Pm(n){n.x_=void 0}function j_(n){return $d.apply(this,arguments)}function $d(){return $d=(0,R.Z)(function*(n){n.D_.forEach((e,t)=>{Wd(n,e)})}),$d.apply(this,arguments)}function $_(n,e){return Hd.apply(this,arguments)}function Hd(){return Hd=(0,R.Z)(function*(n,e){Pm(n),jd(n)?(n.M_.w_(e),Kd(n)):n.M_.set("Unknown")}),Hd.apply(this,arguments)}function H_(n,e,t){return Qd.apply(this,arguments)}function Qd(){return Qd=(0,R.Z)(function*(n,e,t){if(n.M_.set("Online"),e instanceof Ip&&2===e.state&&e.cause)try{yield(r=(0,R.Z)(function*(s,a){const h=a.cause;for(const d of a.targetIds)s.D_.has(d)&&(yield s.remoteSyncer.rejectListen(d,h),s.D_.delete(d),s.x_.removeTarget(d))}),function i(s,a){return r.apply(this,arguments)})(n,e)}catch(r){x("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),r),yield Ll(n,r)}else if(e instanceof vl?n.x_.$e(e):e instanceof yp?n.x_.Je(e):n.x_.Ge(e),!t.isEqual(K.min()))try{const r=yield fm(n.localStore);t.compareTo(r)>=0&&(yield function(s,a){const h=s.x_.it(a);return h.targetChanges.forEach((d,m)=>{if(d.resumeToken.approximateByteSize()>0){const g=s.D_.get(m);g&&s.D_.set(m,g.withResumeToken(d.resumeToken,a))}}),h.targetMismatches.forEach((d,m)=>{const g=s.D_.get(d);if(!g)return;s.D_.set(d,g.withResumeToken(Me.EMPTY_BYTE_STRING,g.snapshotVersion)),wm(s,d);const y=new or(g.target,d,m,g.sequenceNumber);Wd(s,y)}),s.remoteSyncer.applyRemoteEvent(h)}(n,t))}catch(r){x("RemoteStore","Failed to raise snapshot:",r),yield Ll(n,r)}var r}),Qd.apply(this,arguments)}function Ll(n,e,t){return Yd.apply(this,arguments)}function Yd(){return Yd=(0,R.Z)(function*(n,e,t){if(!Mt(e))throw e;n.C_.add(1),yield wo(n),n.M_.set("Offline"),t||(t=()=>fm(n.localStore)),n.asyncQueue.enqueueRetryable((0,R.Z)(function*(){x("RemoteStore","Retrying IndexedDB access"),yield t(),n.C_.delete(1),yield xu(n)}))}),Yd.apply(this,arguments)}function Rm(n,e){return e().catch(t=>Ll(n,t,e))}function Po(n){return Jd.apply(this,arguments)}function Jd(){return Jd=(0,R.Z)(function*(n){const e=M(n),t=Kr(e);let r=e.b_.length>0?e.b_[e.b_.length-1].batchId:-1;for(;Q_(e);)try{const i=yield D_(e.localStore,r);if(null===i){0===e.b_.length&&t.Zo();break}r=i.batchId,Y_(e,i)}catch(i){yield Ll(e,i)}Sm(e)&&Cm(e)}),Jd.apply(this,arguments)}function Q_(n){return Wr(n)&&n.b_.length<10}function Y_(n,e){n.b_.push(e);const t=Kr(n);t.Ho()&&t.h_&&t.P_(e.mutations)}function Sm(n){return Wr(n)&&!Kr(n).jo()&&n.b_.length>0}function Cm(n){Kr(n).start()}function J_(n){return Xd.apply(this,arguments)}function Xd(){return Xd=(0,R.Z)(function*(n){Kr(n).E_()}),Xd.apply(this,arguments)}function X_(n){return ef.apply(this,arguments)}function ef(){return ef=(0,R.Z)(function*(n){const e=Kr(n);for(const t of n.b_)e.P_(t.mutations)}),ef.apply(this,arguments)}function ey(n,e,t){return tf.apply(this,arguments)}function tf(){return tf=(0,R.Z)(function*(n,e,t){const r=n.b_.shift(),i=fo.from(r,e,t);yield Rm(n,()=>n.remoteSyncer.applySuccessfulWrite(i)),yield Po(n)}),tf.apply(this,arguments)}function ty(n,e){return nf.apply(this,arguments)}function nf(){return nf=(0,R.Z)(function*(n,e){var t;e&&Kr(n).h_&&(yield(t=(0,R.Z)(function*(i,s){if(Il(h=s.code)&&h!==P.ABORTED){const a=i.b_.shift();Kr(i).Yo(),yield Rm(i,()=>i.remoteSyncer.rejectFailedWrite(a.batchId,s)),yield Po(i)}var h}),function r(i,s){return t.apply(this,arguments)})(n,e)),Sm(n)&&Cm(n)}),nf.apply(this,arguments)}function bm(n,e){return rf.apply(this,arguments)}function rf(){return rf=(0,R.Z)(function*(n,e){const t=M(n);t.asyncQueue.verifyOperationInProgress(),x("RemoteStore","RemoteStore received new credentials");const r=Wr(t);t.C_.add(3),yield wo(t),r&&t.M_.set("Unknown"),yield t.remoteSyncer.handleCredentialChange(e),t.C_.delete(3),yield xu(t)}),rf.apply(this,arguments)}function sf(n,e){return of.apply(this,arguments)}function of(){return of=(0,R.Z)(function*(n,e){const t=M(n);e?(t.C_.delete(2),yield xu(t)):e||(t.C_.add(2),yield wo(t),t.M_.set("Unknown"))}),of.apply(this,arguments)}function Ro(n){return n.O_||(n.O_=function(t,r,i){const s=M(t);return s.A_(),new B_(r,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(n.datastore,n.asyncQueue,{ho:j_.bind(null,n),Io:$_.bind(null,n),a_:H_.bind(null,n)}),n.v_.push(function(){var e=(0,R.Z)(function*(t){t?(n.O_.Yo(),jd(n)?Kd(n):n.M_.set("Unknown")):(yield n.O_.stop(),Pm(n))});return function(t){return e.apply(this,arguments)}}())),n.O_}function Kr(n){return n.N_||(n.N_=function(t,r,i){const s=M(t);return s.A_(),new Z_(r,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(n.datastore,n.asyncQueue,{ho:J_.bind(null,n),Io:ty.bind(null,n),T_:X_.bind(null,n),I_:ey.bind(null,n)}),n.v_.push(function(){var e=(0,R.Z)(function*(t){t?(n.N_.Yo(),yield Po(n)):(yield n.N_.stop(),n.b_.length>0&&(x("RemoteStore",`Stopping write stream with ${n.b_.length} pending writes`),n.b_=[]))});return function(t){return e.apply(this,arguments)}}())),n.N_}class af{constructor(e,t,r,i,s){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=i,this.removalCallback=s,this.deferred=new De,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(a=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,i,s){const a=Date.now()+r,h=new af(e,t,a,i,s);return h.start(r),h}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new b(P.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function So(n,e){if(Ae("AsyncQueue",`${e}: ${n}`),Mt(n))return new b(P.UNAVAILABLE,`${e}: ${n}`);throw n}class Co{constructor(e){this.comparator=e?(t,r)=>e(t,r)||O.comparator(t.key,r.key):(t,r)=>O.comparator(t.key,r.key),this.keyedMap=Gi(),this.sortedSet=new le(this.comparator)}static emptySet(e){return new Co(e.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof Co)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){const i=t.getNext().key,s=r.getNext().key;if(!i.isEqual(s))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){const r=new Co;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}}class xm{constructor(){this.B_=new le(O.comparator)}track(e){const t=e.doc.key,r=this.B_.get(t);r?0!==e.type&&3===r.type?this.B_=this.B_.insert(t,e):3===e.type&&1!==r.type?this.B_=this.B_.insert(t,{type:r.type,doc:e.doc}):2===e.type&&2===r.type?this.B_=this.B_.insert(t,{type:2,doc:e.doc}):2===e.type&&0===r.type?this.B_=this.B_.insert(t,{type:0,doc:e.doc}):1===e.type&&0===r.type?this.B_=this.B_.remove(t):1===e.type&&2===r.type?this.B_=this.B_.insert(t,{type:1,doc:r.doc}):0===e.type&&1===r.type?this.B_=this.B_.insert(t,{type:2,doc:e.doc}):B():this.B_=this.B_.insert(t,e)}L_(){const e=[];return this.B_.inorderTraversal((t,r)=>{e.push(r)}),e}}class bo{constructor(e,t,r,i,s,a,h,d,m){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=i,this.mutatedKeys=s,this.fromCache=a,this.syncStateChanged=h,this.excludesMetadataChanges=d,this.hasCachedResults=m}static fromInitialDocuments(e,t,r,i,s){const a=[];return t.forEach(h=>{a.push({type:0,doc:h})}),new bo(e,t,Co.emptySet(t),a,r,i,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Zi(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let i=0;i<t.length;i++)if(t[i].type!==r[i].type||!t[i].doc.isEqual(r[i].doc))return!1;return!0}}class ny{constructor(){this.k_=void 0,this.listeners=[]}}class ry{constructor(){this.queries=new tn(e=>uu(e),Zi),this.onlineState="Unknown",this.q_=new Set}}function uf(n,e){return cf.apply(this,arguments)}function cf(){return cf=(0,R.Z)(function*(n,e){const t=M(n),r=e.query;let i=!1,s=t.queries.get(r);if(s||(i=!0,s=new ny),i)try{s.k_=yield t.onListen(r)}catch(a){const h=So(a,`Initialization of query '${wn(e.query)}' failed`);return void e.onError(h)}t.queries.set(r,s),s.listeners.push(e),e.Q_(t.onlineState),s.k_&&e.K_(s.k_)&&df(t)}),cf.apply(this,arguments)}function lf(n,e){return hf.apply(this,arguments)}function hf(){return hf=(0,R.Z)(function*(n,e){const t=M(n),r=e.query;let i=!1;const s=t.queries.get(r);if(s){const a=s.listeners.indexOf(e);a>=0&&(s.listeners.splice(a,1),i=0===s.listeners.length)}if(i)return t.queries.delete(r),t.onUnlisten(r)}),hf.apply(this,arguments)}function iy(n,e){const t=M(n);let r=!1;for(const i of e){const a=t.queries.get(i.query);if(a){for(const h of a.listeners)h.K_(i)&&(r=!0);a.k_=i}}r&&df(t)}function sy(n,e,t){const r=M(n),i=r.queries.get(e);if(i)for(const s of i.listeners)s.onError(t);r.queries.delete(e)}function df(n){n.q_.forEach(e=>{e.next()})}class ff{constructor(e,t,r){this.query=e,this.U_=t,this.W_=!1,this.G_=null,this.onlineState="Unknown",this.options=r||{}}K_(e){if(!this.options.includeMetadataChanges){const r=[];for(const i of e.docChanges)3!==i.type&&r.push(i);e=new bo(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.W_?this.z_(e)&&(this.U_.next(e),t=!0):this.j_(e,this.onlineState)&&(this.H_(e),t=!0),this.G_=e,t}onError(e){this.U_.error(e)}Q_(e){this.onlineState=e;let t=!1;return this.G_&&!this.W_&&this.j_(this.G_,e)&&(this.H_(this.G_),t=!0),t}j_(e,t){return!e.fromCache||(!this.options.J_||!("Offline"!==t))&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}z_(e){return e.docChanges.length>0||!!(e.syncStateChanged||this.G_&&this.G_.hasPendingWrites!==e.hasPendingWrites)&&!0===this.options.includeMetadataChanges}H_(e){e=bo.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.W_=!0,this.U_.next(e)}}class oy{constructor(e,t){this.Y_=e,this.byteLength=t}Z_(){return"metadata"in this.Y_}}class km{constructor(e){this.serializer=e}hs(e){return Sn(this.serializer,e)}Ps(e){return e.metadata.exists?Cp(this.serializer,e.document,!1):he.newNoDocument(this.hs(e.metadata.name),this.Is(e.metadata.readTime))}Is(e){return Le(e)}}class ay{constructor(e,t,r){this.X_=e,this.localStore=t,this.serializer=r,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=Nm(e)}ea(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.Y_.namedQuery)this.queries.push(e.Y_.namedQuery);else if(e.Y_.documentMetadata){this.documents.push({metadata:e.Y_.documentMetadata}),e.Y_.documentMetadata.exists||++t;const r=ie.fromString(e.Y_.documentMetadata.name);this.collectionGroups.add(r.get(r.length-2))}else e.Y_.document&&(this.documents[this.documents.length-1].document=e.Y_.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}ta(e){const t=new Map,r=new km(this.serializer);for(const i of e)if(i.metadata.queries){const s=r.hs(i.metadata.name);for(const a of i.metadata.queries){const h=(t.get(a)||J()).add(s);t.set(a,h)}}return t}complete(){var e=this;return(0,R.Z)(function*(){const t=yield function O_(n,e,t,r){return Dd.apply(this,arguments)}(e.localStore,new km(e.serializer),e.documents,e.X_.id),r=e.ta(e.documents);for(const i of e.queries)yield M_(e.localStore,i,r.get(i.name));return e.progress.taskState="Success",{progress:e.progress,na:e.collectionGroups,ra:t}})()}}function Nm(n){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:n.totalDocuments,totalBytes:n.totalBytes}}class Vm{constructor(e){this.key=e}}class Dm{constructor(e){this.key=e}}class Om{constructor(e,t){this.query=e,this.ia=t,this.sa=null,this.hasCachedResults=!1,this.current=!1,this.oa=J(),this.mutatedKeys=J(),this._a=dl(e),this.aa=new Co(this._a)}get ua(){return this.ia}ca(e,t){const r=t?t.la:new xm,i=t?t.aa:this.aa;let s=t?t.mutatedKeys:this.mutatedKeys,a=i,h=!1;const d="F"===this.query.limitType&&i.size===this.query.limit?i.last():null,m="L"===this.query.limitType&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal((g,y)=>{const T=i.get(g),w=rr(this.query,y)?y:null,k=!!T&&this.mutatedKeys.has(T.key),D=!!w&&(w.hasLocalMutations||this.mutatedKeys.has(w.key)&&w.hasCommittedMutations);let V=!1;T&&w?T.data.isEqual(w.data)?k!==D&&(r.track({type:3,doc:w}),V=!0):this.ha(T,w)||(r.track({type:2,doc:w}),V=!0,(d&&this._a(w,d)>0||m&&this._a(w,m)<0)&&(h=!0)):!T&&w?(r.track({type:0,doc:w}),V=!0):T&&!w&&(r.track({type:1,doc:T}),V=!0,(d||m)&&(h=!0)),V&&(w?(a=a.add(w),s=D?s.add(g):s.delete(g)):(a=a.delete(g),s=s.delete(g)))}),null!==this.query.limit)for(;a.size>this.query.limit;){const g="F"===this.query.limitType?a.last():a.first();a=a.delete(g.key),s=s.delete(g.key),r.track({type:1,doc:g})}return{aa:a,la:r,Zi:h,mutatedKeys:s}}ha(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r){const i=this.aa;this.aa=e.aa,this.mutatedKeys=e.mutatedKeys;const s=e.la.L_();s.sort((m,g)=>function(T,w){const k=D=>{switch(D){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return B()}};return k(T)-k(w)}(m.type,g.type)||this._a(m.doc,g.doc)),this.Pa(r);const a=t?this.Ia():[],h=0===this.oa.size&&this.current?1:0,d=h!==this.sa;return this.sa=h,0!==s.length||d?{snapshot:new bo(this.query,e.aa,i,s,e.mutatedKeys,0===h,d,!1,!!r&&r.resumeToken.approximateByteSize()>0),Ta:a}:{Ta:a}}Q_(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({aa:this.aa,la:new xm,mutatedKeys:this.mutatedKeys,Zi:!1},!1)):{Ta:[]}}Ea(e){return!this.ia.has(e)&&!!this.aa.has(e)&&!this.aa.get(e).hasLocalMutations}Pa(e){e&&(e.addedDocuments.forEach(t=>this.ia=this.ia.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.ia=this.ia.delete(t)),this.current=e.current)}Ia(){if(!this.current)return[];const e=this.oa;this.oa=J(),this.aa.forEach(r=>{this.Ea(r.key)&&(this.oa=this.oa.add(r.key))});const t=[];return e.forEach(r=>{this.oa.has(r)||t.push(new Dm(r))}),this.oa.forEach(r=>{e.has(r)||t.push(new Vm(r))}),t}da(e){this.ia=e.ls,this.oa=J();const t=this.ca(e.documents);return this.applyChanges(t,!0)}Aa(){return bo.fromInitialDocuments(this.query,this.aa,this.mutatedKeys,0===this.sa,this.hasCachedResults)}}class uy{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}}class cy{constructor(e){this.key=e,this.Ra=!1}}class ly{constructor(e,t,r,i,s,a){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=i,this.currentUser=s,this.maxConcurrentLimboResolutions=a,this.Va={},this.ma=new tn(h=>uu(h),Zi),this.fa=new Map,this.ga=new Set,this.pa=new le(O.comparator),this.ya=new Map,this.wa=new Rd,this.Sa={},this.ba=new Map,this.Da=Xi.Nn(),this.onlineState="Unknown",this.Ca=void 0}get isPrimaryClient(){return!0===this.Ca}}function hy(n,e){return pf.apply(this,arguments)}function pf(){return pf=(0,R.Z)(function*(n,e){const t=Lf(n);let r,i;const s=t.ma.get(e);if(s)r=s.targetId,t.sharedClientState.addLocalQueryTarget(r),i=s.view.Aa();else{const a=yield Eo(t.localStore,He(e)),h=t.sharedClientState.addLocalQueryTarget(a.targetId);r=a.targetId,i=yield mf(t,e,r,"current"===h,a.resumeToken),t.isPrimaryClient&&Ml(t.remoteStore,a)}return i}),pf.apply(this,arguments)}function mf(n,e,t,r,i){return gf.apply(this,arguments)}function gf(){return gf=(0,R.Z)(function*(n,e,t,r,i){n.va=(y,T,w)=>{return(k=(0,R.Z)(function*(V,G,$,j){let W=G.view.ca($);W.Zi&&(W=yield kl(V.localStore,G.query,!1).then(({documents:Ze})=>G.view.ca(Ze,W)));const ee=j&&j.targetChanges.get(G.targetId),X=G.view.applyChanges(W,V.isPrimaryClient,ee);return Rf(V,G.targetId,X.Ta),X.snapshot}),function D(V,G,$,j){return k.apply(this,arguments)})(n,y,T,w);var k};const s=yield kl(n.localStore,e,!0),a=new Om(e,s.ls),h=a.ca(s.documents),d=yu.createSynthesizedTargetChangeForCurrentChange(t,r&&"Offline"!==n.onlineState,i),m=a.applyChanges(h,n.isPrimaryClient,d);Rf(n,t,m.Ta);const g=new uy(e,t,a);return n.ma.set(e,g),n.fa.has(t)?n.fa.get(t).push(e):n.fa.set(t,[e]),m.snapshot}),gf.apply(this,arguments)}function dy(n,e){return _f.apply(this,arguments)}function _f(){return _f=(0,R.Z)(function*(n,e){const t=M(n),r=t.ma.get(e),i=t.fa.get(r.targetId);if(i.length>1)return t.fa.set(r.targetId,i.filter(s=>!Zi(s,e))),void t.ma.delete(e);t.isPrimaryClient?(t.sharedClientState.removeLocalQueryTarget(r.targetId),t.sharedClientState.isActiveQueryTarget(r.targetId)||(yield Ao(t.localStore,r.targetId,!1).then(()=>{t.sharedClientState.clearQueryState(r.targetId),ku(t.remoteStore,r.targetId),xo(t,r.targetId)}).catch(pn))):(xo(t,r.targetId),yield Ao(t.localStore,r.targetId,!0))}),_f.apply(this,arguments)}function yf(){return yf=(0,R.Z)(function*(n,e,t){const r=Ff(n);try{const i=yield function(a,h){const d=M(a),m=pe.now(),g=h.reduce((w,k)=>w.add(k.key),J());let y,T;return d.persistence.runTransaction("Locally write mutations","readwrite",w=>{let k=Be(),D=J();return d.ss.getEntries(w,g).next(V=>{k=V,k.forEach((G,$)=>{$.isValidDocument()||(D=D.add(G))})}).next(()=>d.localDocuments.getOverlayedDocuments(w,k)).next(V=>{y=V;const G=[];for(const $ of h){const j=S($,y.get($.key).overlayedDocument);null!=j&&G.push(new U($.key,j,rl(j.value.mapValue),u.exists(!0)))}return d.mutationQueue.addMutationBatch(w,m,G,h)}).next(V=>{T=V;const G=V.applyToLocalDocumentSet(y,D);return d.documentOverlayCache.saveOverlays(w,V.batchId,G)})}).then(()=>({batchId:T.batchId,changes:co(y)}))}(r.localStore,e);r.sharedClientState.addPendingMutation(i.batchId),function(a,h,d){let m=a.Sa[a.currentUser.toKey()];m||(m=new le(Y)),m=m.insert(h,d),a.Sa[a.currentUser.toKey()]=m}(r,i.batchId,t),yield ar(r,i.changes),yield Po(r.remoteStore)}catch(i){const s=So(i,"Failed to persist write");t.reject(s)}}),yf.apply(this,arguments)}function Mm(n,e){return If.apply(this,arguments)}function If(){return If=(0,R.Z)(function*(n,e){const t=M(n);try{const r=yield function V_(n,e){const t=M(n),r=e.snapshotVersion;let i=t.ts;return t.persistence.runTransaction("Apply remote event","readwrite-primary",s=>{const a=t.ss.newChangeBuffer({trackRemovals:!0});i=t.ts;const h=[];e.targetChanges.forEach((g,y)=>{const T=i.get(y);if(!T)return;h.push(t.qr.removeMatchingKeys(s,g.removedDocuments,y).next(()=>t.qr.addMatchingKeys(s,g.addedDocuments,y)));let w=T.withSequenceNumber(s.currentSequenceNumber);var D,V,G;null!==e.targetMismatches.get(y)?w=w.withResumeToken(Me.EMPTY_BYTE_STRING,K.min()).withLastLimboFreeSnapshotVersion(K.min()):g.resumeToken.approximateByteSize()>0&&(w=w.withResumeToken(g.resumeToken,r)),i=i.insert(y,w),V=w,G=g,(0===(D=T).resumeToken.approximateByteSize()||V.snapshotVersion.toMicroseconds()-D.snapshotVersion.toMicroseconds()>=3e8||G.addedDocuments.size+G.modifiedDocuments.size+G.removedDocuments.size>0)&&h.push(t.qr.updateTargetData(s,w))});let d=Be(),m=J();if(e.documentUpdates.forEach(g=>{e.resolvedLimboDocuments.has(g)&&h.push(t.persistence.referenceDelegate.updateLimboDocument(s,g))}),h.push(pm(s,a,e.documentUpdates).next(g=>{d=g.us,m=g.cs})),!r.isEqual(K.min())){const g=t.qr.getLastRemoteSnapshotVersion(s).next(y=>t.qr.setTargetsMetadata(s,s.currentSequenceNumber,r));h.push(g)}return A.waitFor(h).next(()=>a.apply(s)).next(()=>t.localDocuments.getLocalViewOfDocuments(s,d,m)).next(()=>d)}).then(s=>(t.ts=i,s))}(t.localStore,e);e.targetChanges.forEach((i,s)=>{const a=t.ya.get(s);a&&(z(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1),i.addedDocuments.size>0?a.Ra=!0:i.modifiedDocuments.size>0?z(a.Ra):i.removedDocuments.size>0&&(z(a.Ra),a.Ra=!1))}),yield ar(t,r,e)}catch(r){yield pn(r)}}),If.apply(this,arguments)}function Lm(n,e,t){const r=M(n);if(r.isPrimaryClient&&0===t||!r.isPrimaryClient&&1===t){const i=[];r.ma.forEach((s,a)=>{const h=a.view.Q_(e);h.snapshot&&i.push(h.snapshot)}),function(a,h){const d=M(a);d.onlineState=h;let m=!1;d.queries.forEach((g,y)=>{for(const T of y.listeners)T.Q_(h)&&(m=!0)}),m&&df(d)}(r.eventManager,e),i.length&&r.Va.a_(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}function py(n,e,t){return vf.apply(this,arguments)}function vf(){return vf=(0,R.Z)(function*(n,e,t){const r=M(n);r.sharedClientState.updateQueryState(e,"rejected",t);const i=r.ya.get(e),s=i&&i.key;if(s){let a=new le(O.comparator);a=a.insert(s,he.newNoDocument(s,K.min()));const h=J().add(s),d=new _u(K.min(),new Map,new le(Y),a,h);yield Mm(r,d),r.pa=r.pa.remove(s),r.ya.delete(e),Sf(r)}else yield Ao(r.localStore,e,!1).then(()=>xo(r,e,t)).catch(pn)}),vf.apply(this,arguments)}function my(n,e){return Tf.apply(this,arguments)}function Tf(){return Tf=(0,R.Z)(function*(n,e){const t=M(n),r=e.batch.batchId;try{const i=yield function N_(n,e){const t=M(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{const i=e.batch.keys(),s=t.ss.newChangeBuffer({trackRemovals:!0});return function(h,d,m,g){const y=m.batch,T=y.keys();let w=A.resolve();return T.forEach(k=>{w=w.next(()=>g.getEntry(d,k)).next(D=>{const V=m.docVersions.get(k);z(null!==V),D.version.compareTo(V)<0&&(y.applyToRemoteDocument(D,m),D.isValidDocument()&&(D.setReadTime(m.commitVersion),g.addEntry(D)))})}),w.next(()=>h.mutationQueue.removeMutationBatch(d,y))}(t,r,e,s).next(()=>s.apply(r)).next(()=>t.mutationQueue.performConsistencyCheck(r)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(r,i,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(h){let d=J();for(let m=0;m<h.mutationResults.length;++m)h.mutationResults[m].transformResults.length>0&&(d=d.add(h.batch.mutations[m].key));return d}(e))).next(()=>t.localDocuments.getDocuments(r,i))})}(t.localStore,e);Pf(t,r,null),wf(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),yield ar(t,i)}catch(i){yield pn(i)}}),Tf.apply(this,arguments)}function gy(n,e,t){return Ef.apply(this,arguments)}function Ef(){return Ef=(0,R.Z)(function*(n,e,t){const r=M(n);try{const i=yield function(a,h){const d=M(a);return d.persistence.runTransaction("Reject batch","readwrite-primary",m=>{let g;return d.mutationQueue.lookupMutationBatch(m,h).next(y=>(z(null!==y),g=y.keys(),d.mutationQueue.removeMutationBatch(m,y))).next(()=>d.mutationQueue.performConsistencyCheck(m)).next(()=>d.documentOverlayCache.removeOverlaysForBatchId(m,g,h)).next(()=>d.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(m,g)).next(()=>d.localDocuments.getDocuments(m,g))})}(r.localStore,e);Pf(r,e,t),wf(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),yield ar(r,i)}catch(i){yield pn(i)}}),Ef.apply(this,arguments)}function Af(){return Af=(0,R.Z)(function*(n,e){const t=M(n);Wr(t.remoteStore)||x("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const r=yield function(a){const h=M(a);return h.persistence.runTransaction("Get highest unacknowledged batch id","readonly",d=>h.mutationQueue.getHighestUnacknowledgedBatchId(d))}(t.localStore);if(-1===r)return void e.resolve();const i=t.ba.get(r)||[];i.push(e),t.ba.set(r,i)}catch(r){const i=So(r,"Initialization of waitForPendingWrites() operation failed");e.reject(i)}}),Af.apply(this,arguments)}function wf(n,e){(n.ba.get(e)||[]).forEach(t=>{t.resolve()}),n.ba.delete(e)}function Pf(n,e,t){const r=M(n);let i=r.Sa[r.currentUser.toKey()];if(i){const s=i.get(e);s&&(t?s.reject(t):s.resolve(),i=i.remove(e)),r.Sa[r.currentUser.toKey()]=i}}function xo(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(const r of n.fa.get(e))n.ma.delete(r),t&&n.Va.Fa(r,t);n.fa.delete(e),n.isPrimaryClient&&n.wa.Rr(e).forEach(r=>{n.wa.containsKey(r)||Fm(n,r)})}function Fm(n,e){n.ga.delete(e.path.canonicalString());const t=n.pa.get(e);null!==t&&(ku(n.remoteStore,t),n.pa=n.pa.remove(e),n.ya.delete(t),Sf(n))}function Rf(n,e,t){for(const r of t)r instanceof Vm?(n.wa.addReference(r.key,e),yy(n,r)):r instanceof Dm?(x("SyncEngine","Document no longer in limbo: "+r.key),n.wa.removeReference(r.key,e),n.wa.containsKey(r.key)||Fm(n,r.key)):B()}function yy(n,e){const t=e.key,r=t.path.canonicalString();n.pa.get(t)||n.ga.has(r)||(x("SyncEngine","New document in limbo: "+t),n.ga.add(r),Sf(n))}function Sf(n){for(;n.ga.size>0&&n.pa.size<n.maxConcurrentLimboResolutions;){const e=n.ga.values().next().value;n.ga.delete(e);const t=new O(ie.fromString(e)),r=n.Da.next();n.ya.set(r,new cy(t)),n.pa=n.pa.insert(t,r),Ml(n.remoteStore,new or(He(Mr(t.path)),r,"TargetPurposeLimboResolution",ot._e))}}function ar(n,e,t){return Cf.apply(this,arguments)}function Cf(){return Cf=(0,R.Z)(function*(n,e,t){const r=M(n),i=[],s=[],a=[];var h;r.ma.isEmpty()||(r.ma.forEach((h,d)=>{a.push(r.va(d,e,t).then(m=>{if((m||t)&&r.isPrimaryClient&&r.sharedClientState.updateQueryState(d.targetId,null!=m&&m.fromCache?"not-current":"current"),m){i.push(m);const g=kd.Qi(d.targetId,m);s.push(g)}}))}),yield Promise.all(a),r.Va.a_(i),yield(h=(0,R.Z)(function*(m,g){const y=M(m);try{yield y.persistence.runTransaction("notifyLocalViewChanges","readwrite",T=>A.forEach(g,w=>A.forEach(w.ki,k=>y.persistence.referenceDelegate.addReference(T,w.targetId,k)).next(()=>A.forEach(w.qi,k=>y.persistence.referenceDelegate.removeReference(T,w.targetId,k)))))}catch(T){if(!Mt(T))throw T;x("LocalStore","Failed to update sequence numbers: "+T)}for(const T of g){const w=T.targetId;if(!T.fromCache){const k=y.ts.get(w),V=k.withLastLimboFreeSnapshotVersion(k.snapshotVersion);y.ts=y.ts.insert(w,V)}}}),function d(m,g){return h.apply(this,arguments)})(r.localStore,s))}),Cf.apply(this,arguments)}function Iy(n,e){return bf.apply(this,arguments)}function bf(){return bf=(0,R.Z)(function*(n,e){const t=M(n);if(!t.currentUser.isEqual(e)){x("SyncEngine","User change. New user:",e.toKey());const r=yield dm(t.localStore,e);t.currentUser=e,(s=t).ba.forEach(h=>{h.forEach(d=>{d.reject(new b(P.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),s.ba.clear(),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),yield ar(t,r._s)}var s}),bf.apply(this,arguments)}function vy(n,e){const t=M(n),r=t.ya.get(e);if(r&&r.Ra)return J().add(r.key);{let i=J();const s=t.fa.get(e);if(!s)return i;for(const a of s){const h=t.ma.get(a);i=i.unionWith(h.view.ua)}return i}}function Ty(n,e){return xf.apply(this,arguments)}function xf(){return xf=(0,R.Z)(function*(n,e){const t=M(n),r=yield kl(t.localStore,e.query,!0),i=e.view.da(r);return t.isPrimaryClient&&Rf(t,e.targetId,i.Ta),i}),xf.apply(this,arguments)}function Ey(n,e){return kf.apply(this,arguments)}function kf(){return kf=(0,R.Z)(function*(n,e){const t=M(n);return gm(t.localStore,e).then(r=>ar(t,r))}),kf.apply(this,arguments)}function Ay(n,e,t,r){return Nf.apply(this,arguments)}function Nf(){return Nf=(0,R.Z)(function*(n,e,t,r){const i=M(n),s=yield function(h,d){const m=M(h),g=M(m.mutationQueue);return m.persistence.runTransaction("Lookup mutation documents","readonly",y=>g.Cn(y,d).next(T=>T?m.localDocuments.getDocuments(y,T):A.resolve(null)))}(i.localStore,e);var d;null!==s?("pending"===t?yield Po(i.remoteStore):"acknowledged"===t||"rejected"===t?(Pf(i,e,r||null),wf(i,e),d=e,M(M(i.localStore).mutationQueue).Fn(d)):B(),yield ar(i,s)):x("SyncEngine","Cannot apply mutation batch with id: "+e)}),Nf.apply(this,arguments)}function Vf(){return Vf=(0,R.Z)(function*(n,e){const t=M(n);if(Lf(t),Ff(t),!0===e&&!0!==t.Ca){const r=t.sharedClientState.getAllActiveQueryTargets(),i=yield Um(t,r.toArray());t.Ca=!0,yield sf(t.remoteStore,!0);for(const s of i)Ml(t.remoteStore,s)}else if(!1===e&&!1!==t.Ca){const r=[];let i=Promise.resolve();t.fa.forEach((s,a)=>{t.sharedClientState.isLocalQueryTarget(a)?r.push(a):i=i.then(()=>(xo(t,a),Ao(t.localStore,a,!0))),ku(t.remoteStore,a)}),yield i,yield Um(t,r),function(a){const h=M(a);h.ya.forEach((d,m)=>{ku(h.remoteStore,m)}),h.wa.Vr(),h.ya=new Map,h.pa=new le(O.comparator)}(t),t.Ca=!1,yield sf(t.remoteStore,!1)}}),Vf.apply(this,arguments)}function Um(n,e,t){return Df.apply(this,arguments)}function Df(){return Df=(0,R.Z)(function*(n,e,t){const r=M(n),i=[],s=[];for(const a of e){let h;const d=r.fa.get(a);if(d&&0!==d.length){h=yield Eo(r.localStore,He(d[0]));for(const m of d){const g=r.ma.get(m),y=yield Ty(r,g);y.snapshot&&s.push(y.snapshot)}}else{const m=yield mm(r.localStore,a);h=yield Eo(r.localStore,m),yield mf(r,qm(m),a,!1,h.resumeToken)}i.push(h)}return r.Va.a_(s),i}),Df.apply(this,arguments)}function qm(n){return cl(n.path,n.collectionGroup,n.orderBy,n.filters,n.limit,"F",n.startAt,n.endAt)}function Py(n){return t=M(n).localStore,M(M(t).persistence).Bi();var t}function Ry(n,e,t,r){return Of.apply(this,arguments)}function Of(){return Of=(0,R.Z)(function*(n,e,t,r){const i=M(n);if(i.Ca)return void x("SyncEngine","Ignoring unexpected query state notification.");const s=i.fa.get(e);if(s&&s.length>0)switch(t){case"current":case"not-current":{const a=yield gm(i.localStore,cu(s[0])),h=_u.createSynthesizedRemoteEventForCurrentChange(e,"current"===t,Me.EMPTY_BYTE_STRING);yield ar(i,a,h);break}case"rejected":yield Ao(i.localStore,e,!0),xo(i,e,r);break;default:B()}}),Of.apply(this,arguments)}function Sy(n,e,t){return Mf.apply(this,arguments)}function Mf(){return Mf=(0,R.Z)(function*(n,e,t){const r=Lf(n);if(r.Ca){for(const i of e){if(r.fa.has(i)){x("SyncEngine","Adding an already active target "+i);continue}const s=yield mm(r.localStore,i),a=yield Eo(r.localStore,s);yield mf(r,qm(s),a.targetId,!1,a.resumeToken),Ml(r.remoteStore,a)}for(const i of t)r.fa.has(i)&&(yield Ao(r.localStore,i,!1).then(()=>{ku(r.remoteStore,i),xo(r,i)}).catch(pn))}}),Mf.apply(this,arguments)}function Lf(n){const e=M(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=Mm.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=vy.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=py.bind(null,e),e.Va.a_=iy.bind(null,e.eventManager),e.Va.Fa=sy.bind(null,e.eventManager),e}function Ff(n){const e=M(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=my.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=gy.bind(null,e),e}class Nu{constructor(){this.synchronizeTabs=!1}initialize(e){var t=this;return(0,R.Z)(function*(){t.serializer=bu(e.databaseInfo.databaseId),t.sharedClientState=t.createSharedClientState(e),t.persistence=t.createPersistence(e),yield t.persistence.start(),t.localStore=t.createLocalStore(e),t.gcScheduler=t.createGarbageCollectionScheduler(e,t.localStore),t.indexBackfillerScheduler=t.createIndexBackfillerScheduler(e,t.localStore)})()}createGarbageCollectionScheduler(e,t){return null}createIndexBackfillerScheduler(e,t){return null}createLocalStore(e){return hm(this.persistence,new lm,e.initialUser,this.serializer)}createPersistence(e){return new Sd(Cl.jr,this.serializer)}createSharedClientState(e){return new vm}terminate(){var e=this;return(0,R.Z)(function*(){e.gcScheduler&&e.gcScheduler.stop(),yield e.sharedClientState.shutdown(),yield e.persistence.shutdown()})()}}class Uf extends Nu{constructor(e,t,r){super(),this.xa=e,this.cacheSizeBytes=t,this.forceOwnership=r,this.synchronizeTabs=!1}initialize(e){var t=()=>super.initialize,r=this;return(0,R.Z)(function*(){yield t().call(r,e),yield r.xa.initialize(r,e),yield Ff(r.xa.syncEngine),yield Po(r.xa.remoteStore),yield r.persistence.mi(()=>(r.gcScheduler&&!r.gcScheduler.started&&r.gcScheduler.start(),r.indexBackfillerScheduler&&!r.indexBackfillerScheduler.started&&r.indexBackfillerScheduler.start(),Promise.resolve()))})()}createLocalStore(e){return hm(this.persistence,new lm,e.initialUser,this.serializer)}createGarbageCollectionScheduler(e,t){return new tm(this.persistence.referenceDelegate.garbageCollector,e.asyncQueue,t)}createIndexBackfillerScheduler(e,t){const r=new Wh(t,this.persistence);return new Di(e.asyncQueue,r)}createPersistence(e){const t=xd(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),r=void 0!==this.cacheSizeBytes?tt.withCacheSize(this.cacheSizeBytes):tt.DEFAULT;return new bd(this.synchronizeTabs,t,e.clientId,r,e.asyncQueue,Em(),Ol(),this.serializer,this.sharedClientState,!!this.forceOwnership)}createSharedClientState(e){return new vm}}class Bm extends Uf{constructor(e,t){super(e,t,!1),this.xa=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}initialize(e){var t=()=>super.initialize,r=this;return(0,R.Z)(function*(){yield t().call(r,e);const i=r.xa.syncEngine;r.sharedClientState instanceof Ud&&(r.sharedClientState.syncEngine={Ys:Ay.bind(null,i),Zs:Ry.bind(null,i),Xs:Sy.bind(null,i),Bi:Py.bind(null,i),Js:Ey.bind(null,i)},yield r.sharedClientState.start()),yield r.persistence.mi(function(){var s=(0,R.Z)(function*(a){yield function wy(n,e){return Vf.apply(this,arguments)}(r.xa.syncEngine,a),r.gcScheduler&&(a&&!r.gcScheduler.started?r.gcScheduler.start():a||r.gcScheduler.stop()),r.indexBackfillerScheduler&&(a&&!r.indexBackfillerScheduler.started?r.indexBackfillerScheduler.start():a||r.indexBackfillerScheduler.stop())});return function(a){return s.apply(this,arguments)}}())})()}createSharedClientState(e){const t=Em();if(!Ud.D(t))throw new b(P.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");const r=xd(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new Ud(t,e.asyncQueue,r,e.clientId,e.initialUser)}}class ko{initialize(e,t){var r=this;return(0,R.Z)(function*(){r.localStore||(r.localStore=e.localStore,r.sharedClientState=e.sharedClientState,r.datastore=r.createDatastore(t),r.remoteStore=r.createRemoteStore(t),r.eventManager=r.createEventManager(t),r.syncEngine=r.createSyncEngine(t,!e.synchronizeTabs),r.sharedClientState.onlineStateHandler=i=>Lm(r.syncEngine,i,1),r.remoteStore.remoteSyncer.handleCredentialChange=Iy.bind(null,r.syncEngine),yield sf(r.remoteStore,r.syncEngine.isPrimaryClient))})()}createEventManager(e){return new ry}createDatastore(e){const t=bu(e.databaseInfo.databaseId),r=new q_(e.databaseInfo);return new G_(e.authCredentials,e.appCheckCredentials,r,t)}createRemoteStore(e){return r=this.localStore,i=this.datastore,s=e.asyncQueue,a=t=>Lm(this.syncEngine,t,0),h=Tm.D()?new Tm:new L_,new K_(r,i,s,a,h);var r,i,s,a,h}createSyncEngine(e,t){return function(i,s,a,h,d,m,g){const y=new ly(i,s,a,h,d,m);return g&&(y.Ca=!0),y}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}terminate(){return(e=(0,R.Z)(function*(r){const i=M(r);x("RemoteStore","RemoteStore shutting down."),i.C_.add(5),yield wo(i),i.F_.shutdown(),i.M_.set("Unknown")}),function t(r){return e.apply(this,arguments)})(this.remoteStore);var e}}function Zm(n,e=10240){let t=0;return{read:()=>(0,R.Z)(function*(){if(t<n.byteLength){const r={value:n.slice(t,t+e),done:!1};return t+=e,r}return{done:!0}})(),cancel:()=>(0,R.Z)(function*(){})(),releaseLock(){},closed:Promise.resolve()}}class Fl{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.Oa(this.observer.next,e)}error(e){this.observer.error?this.Oa(this.observer.error,e):Ae("Uncaught Error in snapshot listener:",e.toString())}Na(){this.muted=!0}Oa(e,t){this.muted||setTimeout(()=>{this.muted||e(t)},0)}}class xy{constructor(e,t){this.Ba=e,this.serializer=t,this.metadata=new De,this.buffer=new Uint8Array,this.La=new TextDecoder("utf-8"),this.ka().then(r=>{r&&r.Z_()?this.metadata.resolve(r.Y_.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is\n             ${JSON.stringify(null==r?void 0:r.Y_)}`))},r=>this.metadata.reject(r))}close(){return this.Ba.cancel()}getMetadata(){var e=this;return(0,R.Z)(function*(){return e.metadata.promise})()}Ma(){var e=this;return(0,R.Z)(function*(){return yield e.getMetadata(),e.ka()})()}ka(){var e=this;return(0,R.Z)(function*(){const t=yield e.qa();if(null===t)return null;const r=e.La.decode(t),i=Number(r);isNaN(i)&&e.Qa(`length string (${r}) is not valid number`);const s=yield e.Ka(i);return new oy(JSON.parse(s),t.length+i)})()}$a(){return this.buffer.findIndex(e=>e==="{".charCodeAt(0))}qa(){var e=this;return(0,R.Z)(function*(){for(;e.$a()<0&&!(yield e.Ua()););if(0===e.buffer.length)return null;const t=e.$a();t<0&&e.Qa("Reached the end of bundle when a length string is expected.");const r=e.buffer.slice(0,t);return e.buffer=e.buffer.slice(t),r})()}Ka(e){var t=this;return(0,R.Z)(function*(){for(;t.buffer.length<e;)(yield t.Ua())&&t.Qa("Reached the end of bundle when more is expected.");const r=t.La.decode(t.buffer.slice(0,e));return t.buffer=t.buffer.slice(e),r})()}Qa(e){throw this.Ba.cancel(),new Error(`Invalid bundle format: ${e}`)}Ua(){var e=this;return(0,R.Z)(function*(){const t=yield e.Ba.read();if(!t.done){const r=new Uint8Array(e.buffer.length+t.value.length);r.set(e.buffer),r.set(t.value,e.buffer.length),e.buffer=r}return t.done})()}}class ky{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}lookup(e){var t=this;return(0,R.Z)(function*(){if(t.ensureCommitNotCalled(),t.mutations.length>0)throw new b(P.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");const r=yield(i=(0,R.Z)(function*(a,h){const d=M(a),m=vu(d.serializer)+"/documents",g={documents:h.map(k=>Iu(d.serializer,k))},y=yield d.Co("BatchGetDocuments",m,g,h.length),T=new Map;y.forEach(k=>{const D=function Jg(n,e){return"found"in e?function(r,i){z(!!i.found);const s=Sn(r,i.found.name),a=Le(i.found.updateTime),h=i.found.createTime?Le(i.found.createTime):K.min(),d=new Ke({mapValue:{fields:i.found.fields}});return he.newFoundDocument(s,a,h,d)}(n,e):"missing"in e?function(r,i){z(!!i.missing),z(!!i.readTime);const s=Sn(r,i.missing),a=Le(i.readTime);return he.newNoDocument(s,a)}(n,e):B()}(d.serializer,k);T.set(D.key.toString(),D)});const w=[];return h.forEach(k=>{const D=T.get(k.toString());z(!!D),w.push(D)}),w}),function s(a,h){return i.apply(this,arguments)})(t.datastore,e);var i;return r.forEach(i=>t.recordVersion(i)),r})()}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(r){this.lastWriteError=r}this.writtenDocs.add(e.toString())}delete(e){this.write(new sr(e,this.precondition(e))),this.writtenDocs.add(e.toString())}commit(){var e=this;return(0,R.Z)(function*(){if(e.ensureCommitNotCalled(),e.lastWriteError)throw e.lastWriteError;const t=e.readVersions;var r;e.mutations.forEach(r=>{t.delete(r.key.toString())}),t.forEach((r,i)=>{const s=O.fromPath(i);e.mutations.push(new Ki(s,e.precondition(s)))}),yield(r=(0,R.Z)(function*(s,a){const h=M(s),d=vu(h.serializer)+"/documents",m={writes:a.map(g=>Tu(h.serializer,g))};yield h.wo("Commit",d,m)}),function i(s,a){return r.apply(this,arguments)})(e.datastore,e.mutations),e.committed=!0})()}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw B();t=K.min()}const r=this.readVersions.get(e.key.toString());if(r){if(!t.isEqual(r))throw new b(P.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){const t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(K.min())?u.exists(!1):u.updateTime(t):u.none()}preconditionForUpdate(e){const t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(K.min()))throw new b(P.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return u.updateTime(t)}return u.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}class Ny{constructor(e,t,r,i,s){this.asyncQueue=e,this.datastore=t,this.options=r,this.updateFunction=i,this.deferred=s,this.Wa=r.maxAttempts,this.zo=new Bd(this.asyncQueue,"transaction_retry")}run(){this.Wa-=1,this.Ga()}Ga(){var e=this;this.zo.ko((0,R.Z)(function*(){const t=new ky(e.datastore),r=e.za(t);r&&r.then(i=>{e.asyncQueue.enqueueAndForget(()=>t.commit().then(()=>{e.deferred.resolve(i)}).catch(s=>{e.ja(s)}))}).catch(i=>{e.ja(i)})}))}za(e){try{const t=this.updateFunction(e);return!Yn(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}}ja(e){this.Wa>0&&this.Ha(e)?(this.Wa-=1,this.asyncQueue.enqueueAndForget(()=>(this.Ga(),Promise.resolve()))):this.deferred.reject(e)}Ha(e){if("FirebaseError"===e.name){const t=e.code;return"aborted"===t||"failed-precondition"===t||"already-exists"===t||!Il(t)}return!1}}class Vy{constructor(e,t,r,i){var s=this;this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=i,this.user=Ce.UNAUTHENTICATED,this.clientId=Bc.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(r,function(){var a=(0,R.Z)(function*(h){x("FirestoreClient","Received user=",h.uid),yield s.authCredentialListener(h),s.user=h});return function(h){return a.apply(this,arguments)}}()),this.appCheckCredentials.start(r,a=>(x("FirestoreClient","Received new app check token=",a),this.appCheckCredentialListener(a,this.user)))}getConfiguration(){var e=this;return(0,R.Z)(function*(){return{asyncQueue:e.asyncQueue,databaseInfo:e.databaseInfo,clientId:e.clientId,authCredentials:e.authCredentials,appCheckCredentials:e.appCheckCredentials,initialUser:e.user,maxConcurrentLimboResolutions:100}})()}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new b(P.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){var e=this;this.asyncQueue.enterRestrictedMode();const t=new De;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((0,R.Z)(function*(){try{e._onlineComponents&&(yield e._onlineComponents.terminate()),e._offlineComponents&&(yield e._offlineComponents.terminate()),e.authCredentials.shutdown(),e.appCheckCredentials.shutdown(),t.resolve()}catch(r){const i=So(r,"Failed to shutdown persistence");t.reject(i)}})),t.promise}}function Ul(n,e){return qf.apply(this,arguments)}function qf(){return qf=(0,R.Z)(function*(n,e){n.asyncQueue.verifyOperationInProgress(),x("FirestoreClient","Initializing OfflineComponentProvider");const t=yield n.getConfiguration();yield e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener(function(){var i=(0,R.Z)(function*(s){r.isEqual(s)||(yield dm(e.localStore,s),r=s)});return function(s){return i.apply(this,arguments)}}()),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=e}),qf.apply(this,arguments)}function Bf(n,e){return Zf.apply(this,arguments)}function Zf(){return Zf=(0,R.Z)(function*(n,e){n.asyncQueue.verifyOperationInProgress();const t=yield Gf(n);x("FirestoreClient","Initializing OnlineComponentProvider");const r=yield n.getConfiguration();yield e.initialize(t,r),n.setCredentialChangeListener(i=>bm(e.remoteStore,i)),n.setAppCheckTokenChangeListener((i,s)=>bm(e.remoteStore,s)),n._onlineComponents=e}),Zf.apply(this,arguments)}function Gm(n){return"FirebaseError"===n.name?n.code===P.FAILED_PRECONDITION||n.code===P.UNIMPLEMENTED:!(typeof DOMException<"u"&&n instanceof DOMException)||22===n.code||20===n.code||11===n.code}function Gf(n){return zf.apply(this,arguments)}function zf(){return zf=(0,R.Z)(function*(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){x("FirestoreClient","Using user provided OfflineComponentProvider");try{yield Ul(n,n._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!Gm(t))throw t;je("Error using user provided cache. Falling back to memory cache: "+t),yield Ul(n,new Nu)}}else x("FirestoreClient","Using default OfflineComponentProvider"),yield Ul(n,new Nu);return n._offlineComponents}),zf.apply(this,arguments)}function ql(n){return Wf.apply(this,arguments)}function Wf(){return Wf=(0,R.Z)(function*(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(x("FirestoreClient","Using user provided OnlineComponentProvider"),yield Bf(n,n._uninitializedComponentsProvider._online)):(x("FirestoreClient","Using default OnlineComponentProvider"),yield Bf(n,new ko))),n._onlineComponents}),Wf.apply(this,arguments)}function zm(n){return Gf(n).then(e=>e.persistence)}function No(n){return Gf(n).then(e=>e.localStore)}function Wm(n){return ql(n).then(e=>e.remoteStore)}function Kf(n){return ql(n).then(e=>e.syncEngine)}function Vo(n){return jf.apply(this,arguments)}function jf(){return jf=(0,R.Z)(function*(n){const e=yield ql(n),t=e.eventManager;return t.onListen=hy.bind(null,e.syncEngine),t.onUnlisten=dy.bind(null,e.syncEngine),t}),jf.apply(this,arguments)}function jm(n,e,t={}){const r=new De;return n.asyncQueue.enqueueAndForget((0,R.Z)(function*(){return function(s,a,h,d,m){const g=new Fl({next:T=>{a.enqueueAndForget(()=>lf(s,y));const w=T.docs.has(h);!w&&T.fromCache?m.reject(new b(P.UNAVAILABLE,"Failed to get document because the client is offline.")):w&&T.fromCache&&d&&"server"===d.source?m.reject(new b(P.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):m.resolve(T)},error:T=>m.reject(T)}),y=new ff(Mr(h.path),g,{includeMetadataChanges:!0,J_:!0});return uf(s,y)}(yield Vo(n),n.asyncQueue,e,t,r)})),r.promise}function $m(n,e,t={}){const r=new De;return n.asyncQueue.enqueueAndForget((0,R.Z)(function*(){return function(s,a,h,d,m){const g=new Fl({next:T=>{a.enqueueAndForget(()=>lf(s,y)),T.fromCache&&"server"===d.source?m.reject(new b(P.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):m.resolve(T)},error:T=>m.reject(T)}),y=new ff(h,g,{includeMetadataChanges:!0,J_:!0});return uf(s,y)}(yield Vo(n),n.asyncQueue,e,t,r)})),r.promise}function Hm(n){const e={};return void 0!==n.timeoutSeconds&&(e.timeoutSeconds=n.timeoutSeconds),e}const Qm=new Map;function $f(n,e,t){if(!t)throw new b(P.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function Ym(n,e,t,r){if(!0===e&&!0===r)throw new b(P.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function Jm(n){if(!O.isDocumentKey(n))throw new b(P.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function Xm(n){if(O.isDocumentKey(n))throw new b(P.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function Bl(n){if(void 0===n)return"undefined";if(null===n)return"null";if("string"==typeof n)return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if("number"==typeof n||"boolean"==typeof n)return""+n;if("object"==typeof n){if(n instanceof Array)return"an array";{const e=(r=n).constructor?r.constructor.name:null;return e?`a custom ${e} object`:"an object"}}var r;return"function"==typeof n?"a function":B()}function re(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new b(P.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=Bl(n);throw new b(P.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function eg(n,e){if(e<=0)throw new b(P.INVALID_ARGUMENT,`Function ${n}() requires a positive number, but it was: ${e}.`)}class tg{constructor(e){var t,r;if(void 0===e.host){if(void 0!==e.ssl)throw new b(P.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=null===(t=e.ssl)||void 0===t||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new b(P.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}Ym("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!(this.experimentalForceLongPolling||void 0!==e.experimentalAutoDetectLongPolling&&!e.experimentalAutoDetectLongPolling),this.experimentalLongPollingOptions=Hm(null!==(r=e.experimentalLongPollingOptions)&&void 0!==r?r:{}),function(s){if(void 0!==s.timeoutSeconds){if(isNaN(s.timeoutSeconds))throw new b(P.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (must not be NaN)`);if(s.timeoutSeconds<5)throw new b(P.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (minimum allowed value is 5)`);if(s.timeoutSeconds>30)throw new b(P.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&this.experimentalLongPollingOptions.timeoutSeconds===e.experimentalLongPollingOptions.timeoutSeconds&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class Vu{constructor(e,t,r,i){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new tg({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new b(P.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new b(P.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new tg(e),void 0!==e.credentials&&(this._authCredentials=function(r){if(!r)return new Fh;switch(r.type){case"firstParty":return new Bh(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new b(P.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const r=Qm.get(t);r&&(x("ComponentProvider","Removing Datastore"),Qm.delete(t),r.terminate())}(this),Promise.resolve()}}class Je{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new Je(this.firestore,e,this._query)}}class Te{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Cn(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Te(this.firestore,e,this._key)}}class Cn extends Je{constructor(e,t,r){super(e,t,Mr(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Te(this.firestore,null,new O(e))}withConverter(e){return new Cn(this.firestore,e,this._path)}}function rg(n,e,...t){if(n=(0,ce.m9)(n),$f("collection","path",e),n instanceof Vu){const r=ie.fromString(e,...t);return Xm(r),new Cn(n,null,r)}{if(!(n instanceof Te||n instanceof Cn))throw new b(P.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(ie.fromString(e,...t));return Xm(r),new Cn(n.firestore,null,r)}}function Zl(n,e,...t){if(n=(0,ce.m9)(n),1===arguments.length&&(e=Bc.newId()),$f("doc","path",e),n instanceof Vu){const r=ie.fromString(e,...t);return Jm(r),new Te(n,null,new O(r))}{if(!(n instanceof Te||n instanceof Cn))throw new b(P.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(ie.fromString(e,...t));return Jm(r),new Te(n.firestore,n instanceof Cn?n.converter:null,new O(r))}}function ig(n,e){return n=(0,ce.m9)(n),e=(0,ce.m9)(e),(n instanceof Te||n instanceof Cn)&&(e instanceof Te||e instanceof Cn)&&n.firestore===e.firestore&&n.path===e.path&&n.converter===e.converter}function Hf(n,e){return n=(0,ce.m9)(n),e=(0,ce.m9)(e),n instanceof Je&&e instanceof Je&&n.firestore===e.firestore&&Zi(n._query,e._query)&&n.converter===e.converter}class Wy{constructor(){this.Ja=Promise.resolve(),this.Ya=[],this.Za=!1,this.Xa=[],this.eu=null,this.tu=!1,this.nu=!1,this.ru=[],this.zo=new Bd(this,"async_queue_retry"),this.iu=()=>{const t=Ol();t&&x("AsyncQueue","Visibility state changed to "+t.visibilityState),this.zo.Qo()};const e=Ol();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.iu)}get isShuttingDown(){return this.Za}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.su(),this.ou(e)}enterRestrictedMode(e){if(!this.Za){this.Za=!0,this.nu=e||!1;const t=Ol();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.iu)}}enqueue(e){if(this.su(),this.Za)return new Promise(()=>{});const t=new De;return this.ou(()=>this.Za&&this.nu?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Ya.push(e),this._u()))}_u(){var e=this;return(0,R.Z)(function*(){if(0!==e.Ya.length){try{yield e.Ya[0](),e.Ya.shift(),e.zo.reset()}catch(t){if(!Mt(t))throw t;x("AsyncQueue","Operation failed with retryable error: "+t)}e.Ya.length>0&&e.zo.ko(()=>e._u())}})()}ou(e){const t=this.Ja.then(()=>(this.tu=!0,e().catch(r=>{throw this.eu=r,this.tu=!1,Ae("INTERNAL UNHANDLED ERROR: ",function(a){let h=a.message||"";return a.stack&&(h=a.stack.includes(a.message)?a.stack:a.message+"\n"+a.stack),h}(r)),r}).then(r=>(this.tu=!1,r))));return this.Ja=t,t}enqueueAfterDelay(e,t,r){this.su(),this.ru.indexOf(e)>-1&&(t=0);const i=af.createAndSchedule(this,e,t,r,s=>this.au(s));return this.Xa.push(i),i}su(){this.eu&&B()}verifyOperationInProgress(){}uu(){var e=this;return(0,R.Z)(function*(){let t;do{t=e.Ja,yield t}while(t!==e.Ja)})()}cu(e){for(const t of this.Xa)if(t.timerId===e)return!0;return!1}lu(e){return this.uu().then(()=>{this.Xa.sort((t,r)=>t.targetTimeMs-r.targetTimeMs);for(const t of this.Xa)if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.uu()})}hu(e){this.ru.push(e)}au(e){const t=this.Xa.indexOf(e);this.Xa.splice(t,1)}}function Qf(n){return function(t,r){if("object"!=typeof t||null===t)return!1;const i=t;for(const s of["next","error","complete"])if(s in i&&"function"==typeof i[s])return!0;return!1}(n)}class Ky{constructor(){this._progressObserver={},this._taskCompletionResolver=new De,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,r){this._progressObserver={next:e,error:t,complete:r}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}class Ie extends Vu{constructor(e,t,r,i){super(e,t,r,i),this.type="firestore",this._queue=new Wy,this._persistenceKey=(null==i?void 0:i.name)||"[DEFAULT]"}_terminate(){return this._firestoreClient||sg(this),this._firestoreClient.terminate()}}function ke(n){return n._firestoreClient||sg(n),n._firestoreClient.verifyNotTerminated(),n._firestoreClient}function sg(n){var e,t,r;const i=n._freezeSettings(),s=(d=(null===(e=n._app)||void 0===e?void 0:e.options.appId)||"",new Jc(n._databaseId,d,n._persistenceKey,(g=i).host,g.ssl,g.experimentalForceLongPolling,g.experimentalAutoDetectLongPolling,Hm(g.experimentalLongPollingOptions),g.useFetchStreams));var d,g;n._firestoreClient=new Vy(n._authCredentials,n._appCheckCredentials,n._queue,s),null!==(t=i.localCache)&&void 0!==t&&t._offlineComponentProvider&&null!==(r=i.localCache)&&void 0!==r&&r._onlineComponentProvider&&(n._firestoreClient._uninitializedComponentsProvider={_offlineKind:i.localCache.kind,_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider})}function og(n,e,t){const r=new De;return n.asyncQueue.enqueue((0,R.Z)(function*(){try{yield Ul(n,t),yield Bf(n,e),r.resolve()}catch(i){const s=i;if(!Gm(s))throw s;je("Error enabling indexeddb cache. Falling back to memory cache: "+s),r.reject(s)}})).then(()=>r.promise)}function ag(n){if(n._initialized||n._terminated)throw new b(P.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}class bn{constructor(e){this._byteString=e}static fromBase64String(e){try{return new bn(Me.fromBase64String(e))}catch(t){throw new b(P.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new bn(Me.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}class ur{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new b(P.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new me(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class ts{constructor(e){this._methodName=e}}class Gl{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new b(P.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new b(P.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return Y(this._lat,e._lat)||Y(this._long,e._long)}}const rI=/^__.*__$/;class iI{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return null!==this.fieldMask?new U(e,this.data,this.fieldMask,t,this.fieldTransforms):new Z(e,this.data,t,this.fieldTransforms)}}class ug{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new U(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function cg(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw B()}}class zl{constructor(e,t,r,i,s,a){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=i,void 0===s&&this.Pu(),this.fieldTransforms=s||[],this.fieldMask=a||[]}get path(){return this.settings.path}get Iu(){return this.settings.Iu}Tu(e){return new zl(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Eu(e){var t;const r=null===(t=this.path)||void 0===t?void 0:t.child(e),i=this.Tu({path:r,du:!1});return i.Au(e),i}Ru(e){var t;const r=null===(t=this.path)||void 0===t?void 0:t.child(e),i=this.Tu({path:r,du:!1});return i.Pu(),i}Vu(e){return this.Tu({path:void 0,du:!0})}mu(e){return jl(e,this.settings.methodName,this.settings.fu||!1,this.path,this.settings.gu)}contains(e){return void 0!==this.fieldMask.find(t=>e.isPrefixOf(t))||void 0!==this.fieldTransforms.find(t=>e.isPrefixOf(t.field))}Pu(){if(this.path)for(let e=0;e<this.path.length;e++)this.Au(this.path.get(e))}Au(e){if(0===e.length)throw this.mu("Document fields must not be empty");if(cg(this.Iu)&&rI.test(e))throw this.mu('Document fields cannot begin and end with "__"')}}class sI{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||bu(e)}pu(e,t,r,i=!1){return new zl({Iu:e,methodName:t,gu:r,path:me.emptyPath(),du:!1,fu:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function ns(n){const e=n._freezeSettings(),t=bu(n._databaseId);return new sI(n._databaseId,!!e.ignoreUndefinedProperties,t)}function Wl(n,e,t,r,i,s={}){const a=n.pu(s.merge||s.mergeFields?2:0,e,t,i);ep("Data must be an object, but it was:",a,r);const h=dg(r,a);let d,m;if(s.merge)d=new et(a.fieldMask),m=a.fieldTransforms;else if(s.mergeFields){const g=[];for(const y of s.mergeFields){const T=Mu(e,y,t);if(!a.contains(T))throw new b(P.INVALID_ARGUMENT,`Field '${T}' is specified in your field mask but missing from your input data.`);pg(g,T)||g.push(T)}d=new et(g),m=a.fieldTransforms.filter(y=>d.covers(y.field))}else d=null,m=a.fieldTransforms;return new iI(new Ke(h),d,m)}class Ou extends ts{_toFieldTransform(e){if(2!==e.Iu)throw e.mu(1===e.Iu?`${this._methodName}() can only appear at the top level of your update data`:`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof Ou}}function lg(n,e,t){return new zl({Iu:3,gu:e.settings.gu,methodName:n._methodName,du:t},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}class Yf extends ts{_toFieldTransform(e){return new zi(e.path,new Bt)}isEqual(e){return e instanceof Yf}}class oI extends ts{constructor(e,t){super(e),this.yu=t}_toFieldTransform(e){const t=lg(this,e,!0),r=this.yu.map(s=>rs(s,t)),i=new Rn(r);return new zi(e.path,i)}isEqual(e){return this===e}}class aI extends ts{constructor(e,t){super(e),this.yu=t}_toFieldTransform(e){const t=lg(this,e,!0),r=this.yu.map(s=>rs(s,t)),i=new ir(r);return new zi(e.path,i)}isEqual(e){return this===e}}class uI extends ts{constructor(e,t){super(e),this.wu=t}_toFieldTransform(e){const t=new qr(e.serializer,Ye(e.serializer,this.wu));return new zi(e.path,t)}isEqual(e){return this===e}}function Jf(n,e,t,r){const i=n.pu(1,e,t);ep("Data must be an object, but it was:",i,r);const s=[],a=Ke.empty();mn(r,(d,m)=>{const g=Kl(e,d,t);m=(0,ce.m9)(m);const y=i.Ru(g);if(m instanceof Ou)s.push(g);else{const T=rs(m,y);null!=T&&(s.push(g),a.set(g,T))}});const h=new et(s);return new ug(a,h,i.fieldTransforms)}function Xf(n,e,t,r,i,s){const a=n.pu(1,e,t),h=[Mu(e,r,t)],d=[i];if(s.length%2!=0)throw new b(P.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let T=0;T<s.length;T+=2)h.push(Mu(e,s[T])),d.push(s[T+1]);const m=[],g=Ke.empty();for(let T=h.length-1;T>=0;--T)if(!pg(m,h[T])){const w=h[T];let k=d[T];k=(0,ce.m9)(k);const D=a.Ru(w);if(k instanceof Ou)m.push(w);else{const V=rs(k,D);null!=V&&(m.push(w),g.set(w,V))}}const y=new et(m);return new ug(g,y,a.fieldTransforms)}function hg(n,e,t,r=!1){return rs(t,n.pu(r?4:3,e))}function rs(n,e){if(fg(n=(0,ce.m9)(n)))return ep("Unsupported field value:",e,n),dg(n,e);if(n instanceof ts)return function(r,i){if(!cg(i.Iu))throw i.mu(`${r._methodName}() can only be used with update() and set()`);if(!i.path)throw i.mu(`${r._methodName}() is not currently supported inside arrays`);const s=r._toFieldTransform(i);s&&i.fieldTransforms.push(s)}(n,e),null;if(void 0===n&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.du&&4!==e.Iu)throw e.mu("Nested arrays are not supported");return function(r,i){const s=[];let a=0;for(const h of r){let d=rs(h,i.Vu(a));null==d&&(d={nullValue:"NULL_VALUE"}),s.push(d),a++}return{arrayValue:{values:s}}}(n,e)}return function(r,i){if(null===(r=(0,ce.m9)(r)))return{nullValue:"NULL_VALUE"};if("number"==typeof r)return Ye(i.serializer,r);if("boolean"==typeof r)return{booleanValue:r};if("string"==typeof r)return{stringValue:r};if(r instanceof Date){const s=pe.fromDate(r);return{timestampValue:go(i.serializer,s)}}if(r instanceof pe){const s=new pe(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:go(i.serializer,s)}}if(r instanceof Gl)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof bn)return{bytesValue:Ap(i.serializer,r._byteString)};if(r instanceof Te){const s=i.databaseId,a=r.firestore._databaseId;if(!a.isEqual(s))throw i.mu(`Document reference is for database ${a.projectId}/${a.database} but should be for database ${s.projectId}/${s.database}`);return{referenceValue:md(r.firestore._databaseId||i.databaseId,r._key.path)}}throw i.mu(`Unsupported field value: ${Bl(r)}`)}(n,e)}function dg(n,e){const t={};return Hc(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):mn(n,(r,i)=>{const s=rs(i,e.Eu(r));null!=s&&(t[r]=s)}),{mapValue:{fields:t}}}function fg(n){return!("object"!=typeof n||null===n||n instanceof Array||n instanceof Date||n instanceof pe||n instanceof Gl||n instanceof bn||n instanceof Te||n instanceof ts)}function ep(n,e,t){if(!fg(t)||"object"!=typeof(i=t)||null===i||Object.getPrototypeOf(i)!==Object.prototype&&null!==Object.getPrototypeOf(i)){const r=Bl(t);throw e.mu("an object"===r?n+" a custom object":n+" "+r)}var i}function Mu(n,e,t){if((e=(0,ce.m9)(e))instanceof ur)return e._internalPath;if("string"==typeof e)return Kl(n,e);throw jl("Field path arguments must be of type string or ",n,!1,void 0,t)}const cI=new RegExp("[~\\*/\\[\\]]");function Kl(n,e,t){if(e.search(cI)>=0)throw jl(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new ur(...e.split("."))._internalPath}catch{throw jl(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function jl(n,e,t,r,i){const s=r&&!r.isEmpty(),a=void 0!==i;let h=`Function ${e}() called with invalid data`;t&&(h+=" (via `toFirestore()`)"),h+=". ";let d="";return(s||a)&&(d+=" (found",s&&(d+=` in field ${r}`),a&&(d+=` in document ${i}`),d+=")"),new b(P.INVALID_ARGUMENT,h+n+d)}function pg(n,e){return n.some(t=>t.isEqual(e))}class Lu{constructor(e,t,r,i,s){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=i,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new Te(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const e=new lI(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field($l("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class lI extends Lu{data(){return super.data()}}function $l(n,e){return"string"==typeof e?Kl(n,e):e instanceof ur?e._internalPath:e._delegate._internalPath}function mg(n){if("L"===n.limitType&&0===n.explicitOrderBy.length)throw new b(P.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class tp{}class Fu extends tp{}function jr(n,e,...t){let r=[];e instanceof tp&&r.push(e),r=r.concat(t),function(s){const a=s.filter(d=>d instanceof Do).length,h=s.filter(d=>d instanceof Uu).length;if(a>1||a>0&&h>0)throw new b(P.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(const i of r)n=i._apply(n);return n}class Uu extends Fu{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new Uu(e,t,r)}_apply(e){const t=this._parse(e);return Ig(e._query,t),new Je(e.firestore,e.converter,au(e._query,t))}_parse(e){const t=ns(e.firestore);return function(s,a,h,d,m,g,y){let T;if(m.isKeyField()){if("array-contains"===g||"array-contains-any"===g)throw new b(P.INVALID_ARGUMENT,`Invalid Query. You can't perform '${g}' queries on documentId().`);if("in"===g||"not-in"===g){yg(y,g);const w=[];for(const k of y)w.push(_g(d,s,k));T={arrayValue:{values:w}}}else T=_g(d,s,y)}else"in"!==g&&"not-in"!==g&&"array-contains-any"!==g||yg(y,g),T=hg(h,"where",y,"in"===g||"not-in"===g);return te.create(m,g,T)}(e._query,0,t,e.firestore._databaseId,this._field,this._op,this._value)}}class Do extends tp{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new Do(e,t)}_parse(e){const t=this._queryConstraints.map(r=>r._parse(e)).filter(r=>r.getFilters().length>0);return 1===t.length?t[0]:se.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return 0===t.getFilters().length?e:(function(i,s){let a=i;const h=s.getFlattenedFilters();for(const d of h)Ig(a,d),a=au(a,d)}(e._query,t),new Je(e.firestore,e.converter,au(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}class np extends Fu{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new np(e,t)}_apply(e){const t=function(i,s,a){if(null!==i.startAt)throw new b(P.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==i.endAt)throw new b(P.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new qi(s,a)}(e._query,this._field,this._direction);return new Je(e.firestore,e.converter,function(i,s){const a=i.explicitOrderBy.concat([s]);return new en(i.path,i.collectionGroup,a,i.filters.slice(),i.limit,i.limitType,i.startAt,i.endAt)}(e._query,t))}}class Hl extends Fu{constructor(e,t,r){super(),this.type=e,this._limit=t,this._limitType=r}static _create(e,t,r){return new Hl(e,t,r)}_apply(e){return new Je(e.firestore,e.converter,uo(e._query,this._limit,this._limitType))}}class Ql extends Fu{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new Ql(e,t,r)}_apply(e){const t=gg(e,this.type,this._docOrFields,this._inclusive);return new Je(e.firestore,e.converter,(s=t,new en((i=e._query).path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,s,i.endAt)));var i,s}}class Yl extends Fu{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new Yl(e,t,r)}_apply(e){const t=gg(e,this.type,this._docOrFields,this._inclusive);return new Je(e.firestore,e.converter,(s=t,new en((i=e._query).path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,i.startAt,s)));var i,s}}function gg(n,e,t,r){if(t[0]=(0,ce.m9)(t[0]),t[0]instanceof Lu)return function(s,a,h,d,m){if(!d)throw new b(P.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${h}().`);const g=[];for(const y of Lr(s))if(y.field.isKeyField())g.push(er(a,d.key));else{const T=d.data.field(y.field);if(eo(T))throw new b(P.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+y.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===T){const w=y.field.canonicalString();throw new b(P.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${w}' (used as the orderBy) does not exist.`)}g.push(T)}return new Tn(g,m)}(n._query,n.firestore._databaseId,e,t[0]._document,r);{const i=ns(n.firestore);return function(a,h,d,m,g,y){const T=a.explicitOrderBy;if(g.length>T.length)throw new b(P.INVALID_ARGUMENT,`Too many arguments provided to ${m}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const w=[];for(let k=0;k<g.length;k++){const D=g[k];if(T[k].field.isKeyField()){if("string"!=typeof D)throw new b(P.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${m}(), but got a ${typeof D}`);if(!nr(a)&&-1!==D.indexOf("/"))throw new b(P.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${m}() must be a plain document ID, but '${D}' contains a slash.`);const V=a.path.child(ie.fromString(D));if(!O.isDocumentKey(V))throw new b(P.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${m}() must result in a valid document path, but '${V}' is not because it contains an odd number of segments.`);const G=new O(V);w.push(er(h,G))}else{const V=hg(d,m,D);w.push(V)}}return new Tn(w,y)}(n._query,n.firestore._databaseId,i,e,t,r)}}function _g(n,e,t){if("string"==typeof(t=(0,ce.m9)(t))){if(""===t)throw new b(P.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!nr(e)&&-1!==t.indexOf("/"))throw new b(P.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const r=e.path.child(ie.fromString(t));if(!O.isDocumentKey(r))throw new b(P.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return er(n,new O(r))}if(t instanceof Te)return er(n,t._key);throw new b(P.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Bl(t)}.`)}function yg(n,e){if(!Array.isArray(n)||0===n.length)throw new b(P.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function Ig(n,e){const t=function(i,s){for(const a of i)for(const h of a.getFlattenedFilters())if(s.indexOf(h.op)>=0)return h.op;return null}(n.filters,function(i){switch(i){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(null!==t)throw new b(P.INVALID_ARGUMENT,t===e.op?`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`:`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}class rp{convertValue(e,t="none"){switch(yn(e)){case 0:return null;case 1:return e.booleanValue;case 2:return we(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Xt(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw B()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const r={};return mn(e,(i,s)=>{r[i]=this.convertValue(s,t)}),r}convertGeoPoint(e){return new Gl(we(e.latitude),we(e.longitude))}convertArray(e,t){return(e.values||[]).map(r=>this.convertValue(r,t))}convertServerTimestamp(e,t){switch(t){case"previous":const r=to(e);return null==r?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(Oi(e));default:return null}}convertTimestamp(e){const t=Lt(e);return new pe(t.seconds,t.nanos)}convertDocumentKey(e,t){const r=ie.fromString(e);z(Vp(r));const i=new gn(r.get(1),r.get(3)),s=new O(r.popFirst(5));return i.isEqual(t)||Ae(`Document ${s} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),s}}function Jl(n,e,t){let r;return r=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,r}class II extends rp{constructor(e){super(),this.firestore=e}convertBytes(e){return new bn(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Te(this.firestore,null,t)}}class is{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class cr extends Lu{constructor(e,t,r,i,s,a){super(e,t,r,i,a),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new qu(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const r=this._document.data.field($l("DocumentSnapshot.get",e));if(null!==r)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}}class qu extends cr{data(e={}){return super.data(e)}}class $r{constructor(e,t,r,i){this._firestore=e,this._userDataWriter=t,this._snapshot=i,this.metadata=new is(i.hasPendingWrites,i.fromCache),this.query=r}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new qu(this._firestore,this._userDataWriter,r.key,r,new is(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new b(P.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(i,s){if(i._snapshot.oldDocs.isEmpty()){let a=0;return i._snapshot.docChanges.map(h=>({type:"added",doc:new qu(i._firestore,i._userDataWriter,h.doc.key,h.doc,new is(i._snapshot.mutatedKeys.has(h.doc.key),i._snapshot.fromCache),i.query.converter),oldIndex:-1,newIndex:a++}))}{let a=i._snapshot.oldDocs;return i._snapshot.docChanges.filter(h=>s||3!==h.type).map(h=>{const d=new qu(i._firestore,i._userDataWriter,h.doc.key,h.doc,new is(i._snapshot.mutatedKeys.has(h.doc.key),i._snapshot.fromCache),i.query.converter);let m=-1,g=-1;return 0!==h.type&&(m=a.indexOf(h.doc.key),a=a.delete(h.doc.key)),1!==h.type&&(a=a.add(h.doc),g=a.indexOf(h.doc.key)),{type:TI(h.type),doc:d,oldIndex:m,newIndex:g}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function TI(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return B()}}function Tg(n,e){return n instanceof cr&&e instanceof cr?n._firestore===e._firestore&&n._key.isEqual(e._key)&&(null===n._document?null===e._document:n._document.isEqual(e._document))&&n._converter===e._converter:n instanceof $r&&e instanceof $r&&n._firestore===e._firestore&&Hf(n.query,e.query)&&n.metadata.isEqual(e.metadata)&&n._snapshot.isEqual(e._snapshot)}class Hr extends rp{constructor(e){super(),this.firestore=e}convertBytes(e){return new bn(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Te(this.firestore,null,t)}}function Eg(n,e,t){n=re(n,Te);const r=re(n.firestore,Ie),i=Jl(n.converter,e,t);return Oo(r,[Wl(ns(r),"setDoc",n._key,i,null!==n.converter,t).toMutation(n._key,u.none())])}function Ag(n,e,t,...r){n=re(n,Te);const i=re(n.firestore,Ie),s=ns(i);let a;return a="string"==typeof(e=(0,ce.m9)(e))||e instanceof ur?Xf(s,"updateDoc",n._key,e,t,r):Jf(s,"updateDoc",n._key,e),Oo(i,[a.toMutation(n._key,u.exists(!0))])}function wg(n,...e){var t,r,i;n=(0,ce.m9)(n);let s={includeMetadataChanges:!1},a=0;"object"!=typeof e[a]||Qf(e[a])||(s=e[a],a++);const h={includeMetadataChanges:s.includeMetadataChanges};if(Qf(e[a])){const y=e[a];e[a]=null===(t=y.next)||void 0===t?void 0:t.bind(y),e[a+1]=null===(r=y.error)||void 0===r?void 0:r.bind(y),e[a+2]=null===(i=y.complete)||void 0===i?void 0:i.bind(y)}let d,m,g;if(n instanceof Te)m=re(n.firestore,Ie),g=Mr(n._key.path),d={next:y=>{e[a]&&e[a](ip(m,n,y))},error:e[a+1],complete:e[a+2]};else{const y=re(n,Je);m=re(y.firestore,Ie),g=y._query;const T=new Hr(m);d={next:w=>{e[a]&&e[a](new $r(m,T,y,w))},error:e[a+1],complete:e[a+2]},mg(n._query)}return function(T,w,k,D){const V=new Fl(D),G=new ff(w,V,k);return T.asyncQueue.enqueueAndForget((0,R.Z)(function*(){return uf(yield Vo(T),G)})),()=>{V.Na(),T.asyncQueue.enqueueAndForget((0,R.Z)(function*(){return lf(yield Vo(T),G)}))}}(ke(m),g,h,d)}function Oo(n,e){return function(r,i){const s=new De;return r.asyncQueue.enqueueAndForget((0,R.Z)(function*(){return function fy(n,e,t){return yf.apply(this,arguments)}(yield Kf(r),i,s)})),s.promise}(ke(n),e)}function ip(n,e,t){const r=t.docs.get(e._key),i=new Hr(n);return new cr(n,i,e._key,r,new is(t.hasPendingWrites,t.fromCache),e.converter)}const UI={maxAttempts:5};class Pg{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=ns(e)}set(e,t,r){this._verifyNotCommitted();const i=Qr(e,this._firestore),s=Jl(i.converter,t,r),a=Wl(this._dataReader,"WriteBatch.set",i._key,s,null!==i.converter,r);return this._mutations.push(a.toMutation(i._key,u.none())),this}update(e,t,r,...i){this._verifyNotCommitted();const s=Qr(e,this._firestore);let a;return a="string"==typeof(t=(0,ce.m9)(t))||t instanceof ur?Xf(this._dataReader,"WriteBatch.update",s._key,t,r,i):Jf(this._dataReader,"WriteBatch.update",s._key,t),this._mutations.push(a.toMutation(s._key,u.exists(!0))),this}delete(e){this._verifyNotCommitted();const t=Qr(e,this._firestore);return this._mutations=this._mutations.concat(new sr(t._key,u.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new b(P.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function Qr(n,e){if((n=(0,ce.m9)(n)).firestore!==e)throw new b(P.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return n}class qI extends class{constructor(t,r){this._firestore=t,this._transaction=r,this._dataReader=ns(t)}get(t){const r=Qr(t,this._firestore),i=new II(this._firestore);return this._transaction.lookup([r._key]).then(s=>{if(!s||1!==s.length)return B();const a=s[0];if(a.isFoundDocument())return new Lu(this._firestore,i,a.key,a,r.converter);if(a.isNoDocument())return new Lu(this._firestore,i,r._key,null,r.converter);throw B()})}set(t,r,i){const s=Qr(t,this._firestore),a=Jl(s.converter,r,i),h=Wl(this._dataReader,"Transaction.set",s._key,a,null!==s.converter,i);return this._transaction.set(s._key,h),this}update(t,r,i,...s){const a=Qr(t,this._firestore);let h;return h="string"==typeof(r=(0,ce.m9)(r))||r instanceof ur?Xf(this._dataReader,"Transaction.update",a._key,r,i,s):Jf(this._dataReader,"Transaction.update",a._key,r),this._transaction.update(a._key,h),this}delete(t){const r=Qr(t,this._firestore);return this._transaction.delete(r._key),this}}{constructor(e,t){super(e,t),this._firestore=e}get(e){const t=Qr(e,this._firestore),r=new Hr(this._firestore);return super.get(e).then(i=>new cr(this._firestore,r,t._key,i._document,new is(!1,!1),t.converter))}}function op(n,e){if(void 0===e)return{merge:!1};if(void 0!==e.mergeFields&&void 0!==e.merge)throw new b("invalid-argument",`Invalid options passed to function ${n}(): You cannot specify both "merge" and "mergeFields".`);return e}function bg(){if(typeof Uint8Array>"u")throw new b("unimplemented","Uint8Arrays are not available in this environment.")}function xg(){if(!function ed(){return typeof atob<"u"}())throw new b("unimplemented","Blobs are unavailable in Firestore in this environment.")}!function(e,t=!0){Hn=ni.SDK_VERSION,(0,ni._registerComponent)(new Bo.wA("firestore",(r,{instanceIdentifier:i,options:s})=>{const a=r.getProvider("app").getImmediate(),h=new Ie(new qh(r.getProvider("auth-internal")),new Zh(r.getProvider("app-check-internal")),function(m,g){if(!Object.prototype.hasOwnProperty.apply(m.options,["projectId"]))throw new b(P.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new gn(m.options.projectId,g)}(a,i),a);return s=Object.assign({useFetchStreams:t},s),h._setSettings(s),h},"PUBLIC").setMultipleInstances(!0)),(0,ni.registerVersion)(Lc,"4.3.2",e),(0,ni.registerVersion)(Lc,"4.3.2","esm2017")}();class Bu{constructor(e){this._delegate=e}static fromBase64String(e){return xg(),new Bu(bn.fromBase64String(e))}static fromUint8Array(e){return bg(),new Bu(bn.fromUint8Array(e))}toBase64(){return xg(),this._delegate.toBase64()}toUint8Array(){return bg(),this._delegate.toUint8Array()}isEqual(e){return this._delegate.isEqual(e._delegate)}toString(){return"Blob(base64: "+this.toBase64()+")"}}function ap(n){return function QI(n,e){if("object"!=typeof n||null===n)return!1;const t=n;for(const r of e)if(r in t&&"function"==typeof t[r])return!0;return!1}(n,["next","error","complete"])}class YI{enableIndexedDbPersistence(e,t){return function $y(n,e){ag(n=re(n,Ie));const t=ke(n);if(t._uninitializedComponentsProvider)throw new b(P.FAILED_PRECONDITION,"SDK cache is already specified.");je("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const r=n._freezeSettings(),i=new ko;return og(t,i,new Uf(i,r.cacheSizeBytes,null==e?void 0:e.forceOwnership))}(e._delegate,{forceOwnership:t})}enableMultiTabIndexedDbPersistence(e){return function Hy(n){ag(n=re(n,Ie));const e=ke(n);if(e._uninitializedComponentsProvider)throw new b(P.FAILED_PRECONDITION,"SDK cache is already specified.");je("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const t=n._freezeSettings(),r=new ko;return og(e,r,new Bm(r,t.cacheSizeBytes))}(e._delegate)}clearIndexedDbPersistence(e){return function Qy(n){if(n._initialized&&!n._terminated)throw new b(P.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const e=new De;return n._queue.enqueueAndForgetEvenWhileRestricted((0,R.Z)(function*(){try{yield(t=(0,R.Z)(function*(i){if(!At.D())return Promise.resolve();const s=i+"main";yield At.delete(s)}),function r(i){return t.apply(this,arguments)})(xd(n._databaseId,n._persistenceKey)),e.resolve()}catch(t){e.reject(t)}var t})),e.promise}(e._delegate)}}class kg{constructor(e,t,r){this._delegate=t,this._persistenceProvider=r,this.INTERNAL={delete:()=>this.terminate()},e instanceof gn||(this._appCompat=e)}get _databaseId(){return this._delegate._databaseId}settings(e){const t=this._delegate._getSettings();!e.merge&&t.host!==e.host&&je("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),e.merge&&delete(e=Object.assign(Object.assign({},t),e)).merge,this._delegate._setSettings(e)}useEmulator(e,t,r={}){!function ng(n,e,t,r={}){var i;const s=(n=re(n,Vu))._getSettings(),a=`${e}:${t}`;if("firestore.googleapis.com"!==s.host&&s.host!==a&&je("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),n._setSettings(Object.assign(Object.assign({},s),{host:a,ssl:!1})),r.mockUserToken){let h,d;if("string"==typeof r.mockUserToken)h=r.mockUserToken,d=Ce.MOCK_USER;else{h=(0,ce.Sg)(r.mockUserToken,null===(i=n._app)||void 0===i?void 0:i.options.projectId);const m=r.mockUserToken.sub||r.mockUserToken.user_id;if(!m)throw new b(P.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");d=new Ce(m)}n._authCredentials=new Uh(new Fc(h,d))}}(this._delegate,e,t,r)}enableNetwork(){return function Jy(n){return function Dy(n){return n.asyncQueue.enqueue((0,R.Z)(function*(){const e=yield zm(n),t=yield Wm(n);return e.setNetworkEnabled(!0),function(i){const s=M(i);return s.C_.delete(0),xu(s)}(t)}))}(ke(n=re(n,Ie)))}(this._delegate)}disableNetwork(){return function Xy(n){return function Oy(n){return n.asyncQueue.enqueue((0,R.Z)(function*(){const e=yield zm(n),t=yield Wm(n);return e.setNetworkEnabled(!1),(r=(0,R.Z)(function*(s){const a=M(s);a.C_.add(0),yield wo(a),a.M_.set("Offline")}),function i(s){return r.apply(this,arguments)})(t);var r}))}(ke(n=re(n,Ie)))}(this._delegate)}enablePersistence(e){let t=!1,r=!1;return e&&(t=!!e.synchronizeTabs,r=!!e.experimentalForceOwningTab,Ym("synchronizeTabs",t,"experimentalForceOwningTab",r)),t?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,r)}clearPersistence(){return this._persistenceProvider.clearIndexedDbPersistence(this)}terminate(){return this._appCompat&&(this._appCompat._removeServiceInstance("firestore-compat"),this._appCompat._removeServiceInstance("firestore")),this._delegate._delete()}waitForPendingWrites(){return function Yy(n){return function(t){const r=new De;return t.asyncQueue.enqueueAndForget((0,R.Z)(function*(){return function _y(n,e){return Af.apply(this,arguments)}(yield Kf(t),r)})),r.promise}(ke(n=re(n,Ie)))}(this._delegate)}onSnapshotsInSync(e){return function xI(n,e){return function Fy(n,e){const t=new Fl(e);return n.asyncQueue.enqueueAndForget((0,R.Z)(function*(){return i=yield Vo(n),s=t,M(i).q_.add(s),void s.next();var i,s})),()=>{t.Na(),n.asyncQueue.enqueueAndForget((0,R.Z)(function*(){return i=yield Vo(n),s=t,void M(i).q_.delete(s);var i,s}))}}(ke(n=re(n,Ie)),Qf(e)?e:{next:e})}(this._delegate,e)}get app(){if(!this._appCompat)throw new b("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._appCompat}collection(e){try{return new Mo(this,rg(this._delegate,e))}catch(t){throw ut(t,"collection()","Firestore.collection()")}}doc(e){try{return new Zt(this,Zl(this._delegate,e))}catch(t){throw ut(t,"doc()","Firestore.doc()")}}collectionGroup(e){try{return new ct(this,function zy(n,e){if(n=re(n,Vu),$f("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new b(P.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new Je(n,null,(r=e,new en(ie.emptyPath(),r)));var r}(this._delegate,e))}catch(t){throw ut(t,"collectionGroup()","Firestore.collectionGroup()")}}runTransaction(e){return function BI(n,e,t){n=re(n,Ie);const r=Object.assign(Object.assign({},UI),t);return function(s){if(s.maxAttempts<1)throw new b(P.INVALID_ARGUMENT,"Max attempts must be at least 1")}(r),function(s,a,h){const d=new De;return s.asyncQueue.enqueueAndForget((0,R.Z)(function*(){const m=yield function Km(n){return ql(n).then(e=>e.datastore)}(s);new Ny(s.asyncQueue,m,h,a,d).run()})),d.promise}(ke(n),i=>e(new qI(n,i)),r)}(this._delegate,t=>e(new Ng(this,t)))}batch(){return ke(this._delegate),new Vg(new Pg(this._delegate,e=>Oo(this._delegate,e)))}loadBundle(e){return function eI(n,e){const t=ke(n=re(n,Ie)),r=new Ky;return function Uy(n,e,t,r){const i=function(a,h){let d;return d="string"==typeof a?mp().encode(a):a,g=function(g,y){if(g instanceof Uint8Array)return Zm(g,y);if(g instanceof ArrayBuffer)return Zm(new Uint8Array(g),y);if(g instanceof ReadableStream)return g.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(d),new xy(g,h);var g}(t,bu(e));n.asyncQueue.enqueueAndForget((0,R.Z)(function*(){!function Cy(n,e,t){const r=M(n);var i;(i=(0,R.Z)(function*(a,h,d){try{const m=yield h.getMetadata();if(yield function(k,D){const V=M(k),G=Le(D.createTime);return V.persistence.runTransaction("hasNewerBundle","readonly",$=>V.Kr.getBundleMetadata($,D.id)).then($=>!!$&&$.createTime.compareTo(G)>=0)}(a.localStore,m))return yield h.close(),d._completeWith({taskState:"Success",documentsLoaded:(k=m).totalDocuments,bytesLoaded:k.totalBytes,totalDocuments:k.totalDocuments,totalBytes:k.totalBytes}),Promise.resolve(new Set);d._updateProgress(Nm(m));const g=new ay(m,a.localStore,h.serializer);let y=yield h.Ma();for(;y;){const w=yield g.ea(y);w&&d._updateProgress(w),y=yield h.Ma()}const T=yield g.complete();return yield ar(a,T.ra,void 0),yield function(k,D){const V=M(k);return V.persistence.runTransaction("Save bundle","readwrite",G=>V.Kr.saveBundleMetadata(G,D))}(a.localStore,m),d._completeWith(T.progress),Promise.resolve(T.na)}catch(m){return je("SyncEngine",`Loading bundle failed with ${m}`),d._failWith(m),Promise.resolve(new Set)}var k}),function s(a,h,d){return i.apply(this,arguments)})(r,e,t).then(i=>{r.sharedClientState.notifyBundleLoaded(i)})}(yield Kf(n),i,r)}))}(t,n._databaseId,e,r),r}(this._delegate,e)}namedQuery(e){return function tI(n,e){return function qy(n,e){return n.asyncQueue.enqueue((0,R.Z)(function*(){return function(r,i){const s=M(r);return s.persistence.runTransaction("Get named query","readonly",a=>s.Kr.getNamedQuery(a,i))}(yield No(n),e)}))}(ke(n=re(n,Ie)),e).then(t=>t?new Je(n,null,t.query):null)}(this._delegate,e).then(t=>t?new ct(this,t):null)}}class eh extends rp{constructor(e){super(),this.firestore=e}convertBytes(e){return new Bu(new bn(e))}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return Zt.forKey(t,this.firestore,null)}}class Ng{constructor(e,t){this._firestore=e,this._delegate=t,this._userDataWriter=new eh(e)}get(e){const t=os(e);return this._delegate.get(t).then(r=>new Zu(this._firestore,new cr(this._firestore._delegate,this._userDataWriter,r._key,r._document,r.metadata,t.converter)))}set(e,t,r){const i=os(e);return r?(op("Transaction.set",r),this._delegate.set(i,t,r)):this._delegate.set(i,t),this}update(e,t,r,...i){const s=os(e);return 2===arguments.length?this._delegate.update(s,t):this._delegate.update(s,t,r,...i),this}delete(e){const t=os(e);return this._delegate.delete(t),this}}class Vg{constructor(e){this._delegate=e}set(e,t,r){const i=os(e);return r?(op("WriteBatch.set",r),this._delegate.set(i,t,r)):this._delegate.set(i,t),this}update(e,t,r,...i){const s=os(e);return 2===arguments.length?this._delegate.update(s,t):this._delegate.update(s,t,r,...i),this}delete(e){const t=os(e);return this._delegate.delete(t),this}commit(){return this._delegate.commit()}}class ss{constructor(e,t,r){this._firestore=e,this._userDataWriter=t,this._delegate=r}fromFirestore(e,t){const r=new qu(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,null);return this._delegate.fromFirestore(new Gu(this._firestore,r),null!=t?t:{})}toFirestore(e,t){return t?this._delegate.toFirestore(e,t):this._delegate.toFirestore(e)}static getInstance(e,t){const r=ss.INSTANCES;let i=r.get(e);i||(i=new WeakMap,r.set(e,i));let s=i.get(t);return s||(s=new ss(e,new eh(e),t),i.set(t,s)),s}}ss.INSTANCES=new WeakMap;class Zt{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new eh(e)}static forPath(e,t,r){if(e.length%2!=0)throw new b("invalid-argument",`Invalid document reference. Document references must have an even number of segments, but ${e.canonicalString()} has ${e.length}`);return new Zt(t,new Te(t._delegate,r,new O(e)))}static forKey(e,t,r){return new Zt(t,new Te(t._delegate,r,e))}get id(){return this._delegate.id}get parent(){return new Mo(this.firestore,this._delegate.parent)}get path(){return this._delegate.path}collection(e){try{return new Mo(this.firestore,rg(this._delegate,e))}catch(t){throw ut(t,"collection()","DocumentReference.collection()")}}isEqual(e){return(e=(0,ce.m9)(e))instanceof Te&&ig(this._delegate,e)}set(e,t){t=op("DocumentReference.set",t);try{return t?Eg(this._delegate,e,t):Eg(this._delegate,e)}catch(r){throw ut(r,"setDoc()","DocumentReference.set()")}}update(e,t,...r){try{return 1===arguments.length?Ag(this._delegate,e):Ag(this._delegate,e,t,...r)}catch(i){throw ut(i,"updateDoc()","DocumentReference.update()")}}delete(){return function CI(n){return Oo(re(n.firestore,Ie),[new sr(n._key,u.none())])}(this._delegate)}onSnapshot(...e){const t=Dg(e),r=Og(e,i=>new Zu(this.firestore,new cr(this.firestore._delegate,this._userDataWriter,i._key,i._document,i.metadata,this._delegate.converter)));return wg(this._delegate,t,r)}get(e){let t;return t="cache"===(null==e?void 0:e.source)?function AI(n){n=re(n,Te);const e=re(n.firestore,Ie),t=ke(e),r=new Hr(e);return function My(n,e){const t=new De;return n.asyncQueue.enqueueAndForget((0,R.Z)(function*(){return(r=(0,R.Z)(function*(s,a,h){try{const d=yield function(g,y){const T=M(g);return T.persistence.runTransaction("read document","readonly",w=>T.localDocuments.getDocument(w,y))}(s,a);d.isFoundDocument()?h.resolve(d):d.isNoDocument()?h.resolve(null):h.reject(new b(P.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(d){const m=So(d,`Failed to get document '${a} from cache`);h.reject(m)}}),function i(s,a,h){return r.apply(this,arguments)})(yield No(n),e,t);var r})),t.promise}(t,n._key).then(i=>new cr(e,r,n._key,i,new is(null!==i&&i.hasLocalMutations,!0),n.converter))}(this._delegate):"server"===(null==e?void 0:e.source)?function wI(n){n=re(n,Te);const e=re(n.firestore,Ie);return jm(ke(e),n._key,{source:"server"}).then(t=>ip(e,n,t))}(this._delegate):function EI(n){n=re(n,Te);const e=re(n.firestore,Ie);return jm(ke(e),n._key).then(t=>ip(e,n,t))}(this._delegate),t.then(r=>new Zu(this.firestore,new cr(this.firestore._delegate,this._userDataWriter,r._key,r._document,r.metadata,this._delegate.converter)))}withConverter(e){return new Zt(this.firestore,this._delegate.withConverter(e?ss.getInstance(this.firestore,e):null))}}function ut(n,e,t){return n.message=n.message.replace(e,t),n}function Dg(n){for(const e of n)if("object"==typeof e&&!ap(e))return e;return{}}function Og(n,e){var t,r;let i;return i=ap(n[0])?n[0]:ap(n[1])?n[1]:"function"==typeof n[0]?{next:n[0],error:n[1],complete:n[2]}:{next:n[1],error:n[2],complete:n[3]},{next:s=>{i.next&&i.next(e(s))},error:null===(t=i.error)||void 0===t?void 0:t.bind(i),complete:null===(r=i.complete)||void 0===r?void 0:r.bind(i)}}class Zu{constructor(e,t){this._firestore=e,this._delegate=t}get ref(){return new Zt(this._firestore,this._delegate.ref)}get id(){return this._delegate.id}get metadata(){return this._delegate.metadata}get exists(){return this._delegate.exists()}data(e){return this._delegate.data(e)}get(e,t){return this._delegate.get(e,t)}isEqual(e){return Tg(this._delegate,e._delegate)}}class Gu extends Zu{data(e){const t=this._delegate.data(e);return function Lh(n,e){n||B()}(void 0!==t),t}}class ct{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new eh(e)}where(e,t,r){try{return new ct(this.firestore,jr(this._delegate,function hI(n,e,t){const r=e,i=$l("where",n);return Uu._create(i,r,t)}(e,t,r)))}catch(i){throw ut(i,/(orderBy|where)\(\)/,"Query.$1()")}}orderBy(e,t){try{return new ct(this.firestore,jr(this._delegate,function dI(n,e="asc"){const t=e,r=$l("orderBy",n);return np._create(r,t)}(e,t)))}catch(r){throw ut(r,/(orderBy|where)\(\)/,"Query.$1()")}}limit(e){try{return new ct(this.firestore,jr(this._delegate,function fI(n){return eg("limit",n),Hl._create("limit",n,"F")}(e)))}catch(t){throw ut(t,"limit()","Query.limit()")}}limitToLast(e){try{return new ct(this.firestore,jr(this._delegate,function pI(n){return eg("limitToLast",n),Hl._create("limitToLast",n,"L")}(e)))}catch(t){throw ut(t,"limitToLast()","Query.limitToLast()")}}startAt(...e){try{return new ct(this.firestore,jr(this._delegate,function mI(...n){return Ql._create("startAt",n,!0)}(...e)))}catch(t){throw ut(t,"startAt()","Query.startAt()")}}startAfter(...e){try{return new ct(this.firestore,jr(this._delegate,function gI(...n){return Ql._create("startAfter",n,!1)}(...e)))}catch(t){throw ut(t,"startAfter()","Query.startAfter()")}}endBefore(...e){try{return new ct(this.firestore,jr(this._delegate,function _I(...n){return Yl._create("endBefore",n,!1)}(...e)))}catch(t){throw ut(t,"endBefore()","Query.endBefore()")}}endAt(...e){try{return new ct(this.firestore,jr(this._delegate,function yI(...n){return Yl._create("endAt",n,!0)}(...e)))}catch(t){throw ut(t,"endAt()","Query.endAt()")}}isEqual(e){return Hf(this._delegate,e._delegate)}get(e){let t;return t="cache"===(null==e?void 0:e.source)?function RI(n){n=re(n,Je);const e=re(n.firestore,Ie),t=ke(e),r=new Hr(e);return function Ly(n,e){const t=new De;return n.asyncQueue.enqueueAndForget((0,R.Z)(function*(){return(r=(0,R.Z)(function*(s,a,h){try{const d=yield kl(s,a,!0),m=new Om(a,d.ls),g=m.ca(d.documents),y=m.applyChanges(g,!1);h.resolve(y.snapshot)}catch(d){const m=So(d,`Failed to execute query '${a} against cache`);h.reject(m)}}),function i(s,a,h){return r.apply(this,arguments)})(yield No(n),e,t);var r})),t.promise}(t,n._query).then(i=>new $r(e,r,n,i))}(this._delegate):"server"===(null==e?void 0:e.source)?function SI(n){n=re(n,Je);const e=re(n.firestore,Ie),t=ke(e),r=new Hr(e);return $m(t,n._query,{source:"server"}).then(i=>new $r(e,r,n,i))}(this._delegate):function PI(n){n=re(n,Je);const e=re(n.firestore,Ie),t=ke(e),r=new Hr(e);return mg(n._query),$m(t,n._query).then(i=>new $r(e,r,n,i))}(this._delegate),t.then(r=>new up(this.firestore,new $r(this.firestore._delegate,this._userDataWriter,this._delegate,r._snapshot)))}onSnapshot(...e){const t=Dg(e),r=Og(e,i=>new up(this.firestore,new $r(this.firestore._delegate,this._userDataWriter,this._delegate,i._snapshot)));return wg(this._delegate,t,r)}withConverter(e){return new ct(this.firestore,this._delegate.withConverter(e?ss.getInstance(this.firestore,e):null))}}class XI{constructor(e,t){this._firestore=e,this._delegate=t}get type(){return this._delegate.type}get doc(){return new Gu(this._firestore,this._delegate.doc)}get oldIndex(){return this._delegate.oldIndex}get newIndex(){return this._delegate.newIndex}}class up{constructor(e,t){this._firestore=e,this._delegate=t}get query(){return new ct(this._firestore,this._delegate.query)}get metadata(){return this._delegate.metadata}get size(){return this._delegate.size}get empty(){return this._delegate.empty}get docs(){return this._delegate.docs.map(e=>new Gu(this._firestore,e))}docChanges(e){return this._delegate.docChanges(e).map(t=>new XI(this._firestore,t))}forEach(e,t){this._delegate.forEach(r=>{e.call(t,new Gu(this._firestore,r))})}isEqual(e){return Tg(this._delegate,e._delegate)}}class Mo extends ct{constructor(e,t){super(e,t),this.firestore=e,this._delegate=t}get id(){return this._delegate.id}get path(){return this._delegate.path}get parent(){const e=this._delegate.parent;return e?new Zt(this.firestore,e):null}doc(e){try{return new Zt(this.firestore,void 0===e?Zl(this._delegate):Zl(this._delegate,e))}catch(t){throw ut(t,"doc()","CollectionReference.doc()")}}add(e){return function bI(n,e){const t=re(n.firestore,Ie),r=Zl(n),i=Jl(n.converter,e);return Oo(t,[Wl(ns(n.firestore),"addDoc",r._key,i,null!==n.converter,{}).toMutation(r._key,u.exists(!1))]).then(()=>r)}(this._delegate,e).then(t=>new Zt(this.firestore,t))}isEqual(e){return ig(this._delegate,e._delegate)}withConverter(e){return new Mo(this.firestore,this._delegate.withConverter(e?ss.getInstance(this.firestore,e):null))}}function os(n){return re(n,Te)}class cp{constructor(...e){this._delegate=new ur(...e)}static documentId(){return new cp(me.keyField().canonicalString())}isEqual(e){return(e=(0,ce.m9)(e))instanceof ur&&this._delegate._internalPath.isEqual(e._internalPath)}}class as{constructor(e){this._delegate=e}static serverTimestamp(){const e=function GI(){return new Yf("serverTimestamp")}();return e._methodName="FieldValue.serverTimestamp",new as(e)}static delete(){const e=function ZI(){return new Ou("deleteField")}();return e._methodName="FieldValue.delete",new as(e)}static arrayUnion(...e){const t=function zI(...n){return new oI("arrayUnion",n)}(...e);return t._methodName="FieldValue.arrayUnion",new as(t)}static arrayRemove(...e){const t=function WI(...n){return new aI("arrayRemove",n)}(...e);return t._methodName="FieldValue.arrayRemove",new as(t)}static increment(e){const t=function KI(n){return new uI("increment",n)}(e);return t._methodName="FieldValue.increment",new as(t)}isEqual(e){return this._delegate.isEqual(e._delegate)}}const ev={Firestore:kg,GeoPoint:Gl,Timestamp:pe,Blob:Bu,Transaction:Ng,WriteBatch:Vg,DocumentReference:Zt,DocumentSnapshot:Zu,Query:ct,QueryDocumentSnapshot:Gu,QuerySnapshot:up,CollectionReference:Mo,FieldPath:cp,FieldValue:as,setLogLevel:function JI(n){!function Mh(n){gt.setLogLevel(n)}(n)},CACHE_SIZE_UNLIMITED:-1};function Mg(n,e){return function rv(n,e=Yu.z){return new us.y(t=>{let r;return null!=e?e.schedule(()=>{r=n.onSnapshot({includeMetadataChanges:!0},t)}):r=n.onSnapshot({includeMetadataChanges:!0},t),()=>{null!=r&&r()}})}(n,e)}function lp(n,e){return Mg(n,e).pipe((0,oe.U)(t=>({payload:t,type:"query"})))}!function nv(n){(function tv(n,e){n.INTERNAL.registerComponent(new Bo.wA("firestore-compat",t=>{const r=t.getProvider("app-compat").getImmediate(),i=t.getProvider("firestore").getImmediate();return e(r,i)},"PUBLIC").setServiceProps(Object.assign({},ev)))})(n,(e,t)=>new kg(e,t,new YI)),n.registerVersion("@firebase/firestore-compat","0.3.21")}(ti.Z);class Lg{constructor(e,t){(0,Fe.Z)(this,"ref",void 0),(0,Fe.Z)(this,"afs",void 0),this.ref=e,this.afs=t}set(e,t){return this.ref.set(e,t)}update(e){return this.ref.update(e)}delete(){return this.ref.delete()}collection(e,t){const r=this.ref.collection(e),{ref:i,query:s}=Bg(r,t);return new qg(i,s,this.afs)}snapshotChanges(){return function iv(n,e){return Mg(n,e).pipe((0,ei.O)(void 0),fs(),(0,oe.U)(t=>{const[r,i]=t;return i.exists?null!=r&&r.exists?{payload:i,type:"modified"}:{payload:i,type:"added"}:{payload:i,type:"removed"}}))}(this.ref,this.afs.schedulers.outsideAngular).pipe(Re.iC)}valueChanges(e={}){return this.snapshotChanges().pipe((0,oe.U)(({payload:t})=>e.idField?{...t.data(),[e.idField]:t.id}:t.data()))}get(e){return(0,Jr.D)(this.ref.get(e)).pipe(Re.iC)}}function th(n,e){return lp(n,e).pipe((0,ei.O)(void 0),fs(),(0,oe.U)(t=>{const[r,i]=t,s=i.payload.docChanges(),a=s.map(h=>({type:h.type,payload:h}));return r&&JSON.stringify(r.payload.metadata)!==JSON.stringify(i.payload.metadata)&&i.payload.docs.forEach((h,d)=>{const m=s.find(y=>y.doc.ref.isEqual(h.ref)),g=null==r?void 0:r.payload.docs.find(y=>y.ref.isEqual(h.ref));m&&JSON.stringify(m.doc.metadata)===JSON.stringify(h.metadata)||!m&&g&&JSON.stringify(g.metadata)===JSON.stringify(h.metadata)||a.push({type:"modified",payload:{oldIndex:d,newIndex:d,type:"modified",doc:h}})}),a}))}function Fg(n,e,t){return th(n,t).pipe((0,qo.R)((r,i)=>function sv(n,e,t){return e.forEach(r=>{t.indexOf(r.type)>-1&&(n=function ov(n,e){switch(e.type){case"added":if(!n[e.newIndex]||!n[e.newIndex].doc.ref.isEqual(e.doc.ref))return hp(n,e.newIndex,0,e);break;case"modified":if(null==n[e.oldIndex]||n[e.oldIndex].doc.ref.isEqual(e.doc.ref)){if(e.oldIndex!==e.newIndex){const t=n.slice();return t.splice(e.oldIndex,1),t.splice(e.newIndex,0,e),t}return hp(n,e.newIndex,1,e)}break;case"removed":if(n[e.oldIndex]&&n[e.oldIndex].doc.ref.isEqual(e.doc.ref))return hp(n,e.oldIndex,1)}return n}(n,r))}),n}(r,i.map(s=>s.payload),e),[]),(0,sh.x)(),(0,oe.U)(r=>r.map(i=>({type:i.type,payload:i}))))}function hp(n,e,t,...r){const i=n.slice();return i.splice(e,t,...r),i}function Ug(n){return(!n||0===n.length)&&(n=["added","removed","modified"]),n}class qg{constructor(e,t,r){(0,Fe.Z)(this,"ref",void 0),(0,Fe.Z)(this,"query",void 0),(0,Fe.Z)(this,"afs",void 0),this.ref=e,this.query=t,this.afs=r}stateChanges(e){let t=th(this.query,this.afs.schedulers.outsideAngular);return e&&e.length>0&&(t=t.pipe((0,oe.U)(r=>r.filter(i=>e.indexOf(i.type)>-1)))),t.pipe((0,ei.O)(void 0),fs(),(0,Xr.h)(([r,i])=>i.length>0||!r),(0,oe.U)(([,r])=>r),Re.iC)}auditTrail(e){return this.stateChanges(e).pipe((0,qo.R)((t,r)=>[...t,...r],[]))}snapshotChanges(e){const t=Ug(e);return Fg(this.query,t,this.afs.schedulers.outsideAngular).pipe(Re.iC)}valueChanges(e={}){return lp(this.query,this.afs.schedulers.outsideAngular).pipe((0,oe.U)(t=>t.payload.docs.map(r=>e.idField?{...r.data(),[e.idField]:r.id}:r.data())),Re.iC)}get(e){return(0,Jr.D)(this.query.get(e)).pipe(Re.iC)}add(e){return this.ref.add(e)}doc(e){return new Lg(this.ref.doc(e),this.afs)}}class av{constructor(e,t){(0,Fe.Z)(this,"query",void 0),(0,Fe.Z)(this,"afs",void 0),this.query=e,this.afs=t}stateChanges(e){return e&&0!==e.length?th(this.query,this.afs.schedulers.outsideAngular).pipe((0,oe.U)(t=>t.filter(r=>e.indexOf(r.type)>-1)),(0,Xr.h)(t=>t.length>0),Re.iC):th(this.query,this.afs.schedulers.outsideAngular).pipe(Re.iC)}auditTrail(e){return this.stateChanges(e).pipe((0,qo.R)((t,r)=>[...t,...r],[]))}snapshotChanges(e){const t=Ug(e);return Fg(this.query,t,this.afs.schedulers.outsideAngular).pipe(Re.iC)}valueChanges(e={}){return lp(this.query,this.afs.schedulers.outsideAngular).pipe((0,oe.U)(r=>r.payload.docs.map(i=>e.idField?{[e.idField]:i.id,...i.data()}:i.data())),Re.iC)}get(e){return(0,Jr.D)(this.query.get(e)).pipe(Re.iC)}}const uv=new p.OlP("angularfire2.enableFirestorePersistence"),cv=new p.OlP("angularfire2.firestore.persistenceSettings"),lv=new p.OlP("angularfire2.firestore.settings"),hv=new p.OlP("angularfire2.firestore.use-emulator");function Bg(n,e=(t=>t)){return{query:e(n),ref:n}}let dv=(()=>{var n;class e{constructor(r,i,s,a,h,d,m,g,y,T,w,k,D,V,G,$,j){(0,Fe.Z)(this,"schedulers",void 0),(0,Fe.Z)(this,"firestore",void 0),(0,Fe.Z)(this,"persistenceEnabled$",void 0),this.schedulers=m;const W=(0,Pt.on)(r,d,i),ee=y;T&&de(W,d,w,D,V,G,k,$),[this.firestore,this.persistenceEnabled$]=(0,Pt.cc)(`${W.name}.firestore`,"AngularFirestore",W.name,()=>{const X=d.runOutsideAngular(()=>W.firestore());if(a&&X.settings(a),ee&&X.useEmulator(...ee),s&&!(0,v.PM)(h)){const Ze=()=>{try{return(0,Jr.D)(X.enablePersistence(g||void 0).then(()=>!0,()=>!1))}catch(Gt){return typeof console<"u"&&console.warn(Gt),(0,lr.of)(!1)}};return[X,d.runOutsideAngular(Ze)]}return[X,(0,lr.of)(!1)]},[a,ee,s])}collection(r,i){let s;s="string"==typeof r?this.firestore.collection(r):r;const{ref:a,query:h}=Bg(s,i),d=this.schedulers.ngZone.run(()=>a);return new qg(d,h,this)}collectionGroup(r,i){const s=i||(h=>h),a=this.firestore.collectionGroup(r);return new av(s(a),this)}doc(r){let i;i="string"==typeof r?this.firestore.doc(r):r;const s=this.schedulers.ngZone.run(()=>i);return new Lg(s,this)}createId(){return this.firestore.collection("_").doc().id}}return n=e,(0,Fe.Z)(e,"\u0275fac",function(r){return new(r||n)(p.LFG(Pt.Dh),p.LFG(Pt.xv,8),p.LFG(uv,8),p.LFG(lv,8),p.LFG(p.Lbi),p.LFG(p.R0b),p.LFG(Re.HU),p.LFG(cv,8),p.LFG(hv,8),p.LFG(ge,8),p.LFG(ju,8),p.LFG(dr,8),p.LFG(ds,8),p.LFG(Fo,8),p.LFG($u,8),p.LFG(Hu,8),p.LFG(Re.Rf,8))}),(0,Fe.Z)(e,"\u0275prov",p.Yz7({token:n,factory:n.\u0275fac,providedIn:"any"})),e})(),fv=(()=>{var n;class e{constructor(r){this.fireStore=r}agregar(r,i){try{this.fireStore.collection(r).add(i)}catch(s){console.log(s)}}eliminar(r,i){try{this.fireStore.collection(r).doc(i).delete()}catch(s){console.log(s)}}modificar(r,i,s){try{this.fireStore.collection(r).doc(i).set(s)}catch(a){console.log(a)}}getDato(r,i){return this.fireStore.collection(r).doc(i).get()}getDatos(r){return this.fireStore.collection(r).snapshotChanges()}}return(n=e).\u0275fac=function(r){return new(r||n)(p.LFG(dv))},n.\u0275prov=p.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),e})();function pv(n,e){if(1&n){const t=p.EpF();p.TgZ(0,"tbody")(1,"tr")(2,"td"),p._uU(3),p.qZA(),p.TgZ(4,"td"),p._uU(5),p.ALo(6,"titlecase"),p.qZA(),p.TgZ(7,"td"),p._uU(8),p.qZA(),p.TgZ(9,"td"),p._uU(10),p.qZA(),p.TgZ(11,"td"),p._uU(12),p.ALo(13,"titlecase"),p.qZA(),p.TgZ(14,"td")(15,"ion-item-sliding")(16,"ion-item",33),p._UZ(17,"ion-icon",34),p.qZA(),p.TgZ(18,"ion-item-options",35)(19,"ion-item-option",36),p.NdJ("click",function(){const s=p.CHM(t).$implicit,a=p.oxw(2);return p.KtG(a.setOpen(!0,s.codigo_firebase))}),p._uU(20,"Modificar"),p.qZA(),p.TgZ(21,"ion-item-option",37),p.NdJ("click",function(){const s=p.CHM(t).$implicit,a=p.oxw(2);return p.KtG(a.eliminar(s.codigo_firebase))}),p._uU(22,"Eliminar"),p.qZA()()()()()()}if(2&n){const t=e.$implicit,r=p.oxw(2);p.xp6(3),p.Oqu(t.rut),p.xp6(2),p.Oqu(p.lcZ(6,6,t.nombre)),p.xp6(3),p.Oqu(t.email),p.xp6(2),p.Oqu(t.fechanac),p.xp6(2),p.Oqu(p.lcZ(13,8,t.perfil)),p.xp6(9),p.Q6J("disabled",t.rut==r.rut_usuario)}}function mv(n,e){if(1&n){const t=p.EpF();p.TgZ(0,"div")(1,"div",23)(2,"div",24)(3,"div",25)(4,"div",26)(5,"h3"),p._uU(6,"Usuarios Recientes"),p.qZA(),p.TgZ(7,"ion-button",27),p.NdJ("click",function(){p.CHM(t);const i=p.oxw();return p.KtG(i.setOpen(!0,""))}),p._UZ(8,"ion-icon",28),p.qZA()(),p.TgZ(9,"div",29)(10,"div",30)(11,"table",31)(12,"thead")(13,"tr")(14,"td"),p._uU(15,"RUT"),p.qZA(),p.TgZ(16,"td"),p._uU(17,"Nombre"),p.qZA(),p.TgZ(18,"td"),p._uU(19,"Correo"),p.qZA(),p.TgZ(20,"td"),p._uU(21,"Fecha Nacimiento"),p.qZA(),p.TgZ(22,"td"),p._uU(23,"Perfil"),p.qZA()()(),p.YNc(24,pv,23,10,"tbody",32),p.qZA()()()()()()()}if(2&n){const t=p.oxw();p.xp6(24),p.Q6J("ngForOf",t.usuarios)}}function gv(n,e){if(1&n){const t=p.EpF();p.TgZ(0,"tbody")(1,"tr")(2,"td"),p._uU(3),p.qZA(),p.TgZ(4,"td"),p._uU(5),p.qZA(),p.TgZ(6,"td"),p._uU(7),p.ALo(8,"titlecase"),p.qZA(),p.TgZ(9,"td")(10,"ion-item-sliding")(11,"ion-item",33),p._UZ(12,"ion-icon",34),p.qZA(),p.TgZ(13,"ion-item-options",35)(14,"ion-item-option",36),p.NdJ("click",function(){const s=p.CHM(t).$implicit,a=p.oxw(2);return p.KtG(a.setOpenAsignatura(!0,s.codigo))}),p._uU(15,"Modificar"),p.qZA(),p.TgZ(16,"ion-item-option",37),p.NdJ("click",function(){const s=p.CHM(t).$implicit,a=p.oxw(2);return p.KtG(a.eliminarAsig(s.codigo))}),p._uU(17,"Eliminar"),p.qZA()()()()()()}if(2&n){const t=e.$implicit,r=p.oxw(2);p.xp6(3),p.Oqu(t.codigo),p.xp6(2),p.Oqu(t.nombre),p.xp6(2),p.Oqu(p.lcZ(8,4,t.rut_profesor)),p.xp6(9),p.Q6J("disabled",t.codigo==r.rut_usuario)}}function _v(n,e){if(1&n){const t=p.EpF();p.TgZ(0,"div")(1,"div",23)(2,"div",24)(3,"div",25)(4,"div",26)(5,"h3"),p._uU(6,"Asignaturas Disponibles"),p.qZA(),p.TgZ(7,"ion-button",27),p.NdJ("click",function(){p.CHM(t);const i=p.oxw();return p.KtG(i.setOpenAsignatura(!0,""))}),p._UZ(8,"ion-icon",28),p.qZA()(),p.TgZ(9,"div",29)(10,"div",30)(11,"table",31)(12,"thead")(13,"tr")(14,"td"),p._uU(15,"Codigo"),p.qZA(),p.TgZ(16,"td"),p._uU(17,"Nombre"),p.qZA(),p.TgZ(18,"td"),p._uU(19,"Profesor"),p.qZA()()(),p.YNc(20,gv,18,6,"tbody",32),p.qZA()()()()()()()}if(2&n){const t=p.oxw();p.xp6(20),p.Q6J("ngForOf",t.asignaturas)}}function yv(n,e){if(1&n){const t=p.EpF();p.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-title",38),p._uU(3,"AGREGAR USUARIO"),p.qZA(),p.TgZ(4,"ion-buttons",39)(5,"ion-button",3),p.NdJ("click",function(){p.CHM(t);const i=p.oxw();return p.KtG(i.setOpen(!1,""))}),p._uU(6,"Cerrar"),p.qZA()(),p.TgZ(7,"ion-buttons",40)(8,"ion-button",41),p.NdJ("click",function(){p.CHM(t);const i=p.oxw();return p.KtG(i.agregar())}),p._uU(9,"Confirmar"),p.qZA()()()(),p.TgZ(10,"ion-content",42)(11,"form",43)(12,"ion-item")(13,"ion-label",44),p._uU(14,"RUT"),p.qZA(),p._UZ(15,"ion-input",45),p.qZA(),p.TgZ(16,"ion-item")(17,"ion-label",44),p._uU(18,"Nombre"),p.qZA(),p._UZ(19,"ion-input",46),p.qZA(),p.TgZ(20,"ion-item")(21,"ion-label",44),p._uU(22,"Correo"),p.qZA(),p._UZ(23,"ion-input",47),p.qZA(),p.TgZ(24,"ion-item")(25,"ion-label",44),p._uU(26,"Fecha Nacimiento"),p.qZA(),p._UZ(27,"ion-input",48),p.qZA(),p.TgZ(28,"ion-item",49)(29,"ion-label",44),p._uU(30,"Contrase\xf1a"),p.qZA(),p._UZ(31,"ion-input",50),p.qZA(),p.TgZ(32,"ion-item",49)(33,"ion-label",44),p._uU(34,"Confirmar contrase\xf1a"),p.qZA(),p._UZ(35,"ion-input",51),p.qZA(),p.TgZ(36,"ion-list",52)(37,"ion-item")(38,"ion-select",53)(39,"div",54),p._uU(40,"Seleccione un Perfil"),p.qZA(),p.TgZ(41,"ion-select-option",55),p._uU(42,"Alumno"),p.qZA(),p.TgZ(43,"ion-select-option",56),p._uU(44,"Profesor"),p.qZA(),p.TgZ(45,"ion-select-option",57),p._uU(46,"Admin"),p.qZA()()()()()()}if(2&n){const t=p.oxw();p.xp6(8),p.Q6J("disabled",t.registroUsuario.controls.pass1.value!=t.registroUsuario.controls.pass2.value||t.registroUsuario.invalid),p.xp6(3),p.Q6J("formGroup",t.registroUsuario)}}function Iv(n,e){if(1&n){const t=p.EpF();p.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-title",38),p._uU(3,"MODIFICAR USUARIO"),p.qZA(),p.TgZ(4,"ion-buttons",39)(5,"ion-button",3),p.NdJ("click",function(){p.CHM(t);const i=p.oxw().$implicit,s=p.oxw();return p.KtG(s.setOpen(!1,i.rut))}),p._uU(6,"Cerrar"),p.qZA()(),p.TgZ(7,"ion-buttons",40)(8,"ion-button",3),p.NdJ("click",function(){p.CHM(t);const i=p.oxw(2);return p.KtG(i.modificarFire())}),p._uU(9,"Confirmar"),p.qZA()()()(),p.TgZ(10,"ion-content",42)(11,"form",43)(12,"ion-item",58)(13,"ion-label",44),p._uU(14,"RUT"),p.qZA(),p._UZ(15,"ion-input",45),p.qZA(),p.TgZ(16,"ion-item")(17,"ion-label",44),p._uU(18,"Nombre"),p.qZA(),p._UZ(19,"ion-input",46),p.qZA(),p.TgZ(20,"ion-item")(21,"ion-label",44),p._uU(22,"Correo"),p.qZA(),p._UZ(23,"ion-input",47),p.qZA(),p.TgZ(24,"ion-item")(25,"ion-label",44),p._uU(26,"Fecha Nacimiento"),p.qZA(),p._UZ(27,"ion-input",48),p.qZA(),p.TgZ(28,"ion-item")(29,"ion-list",52)(30,"ion-item")(31,"ion-select",53)(32,"div",54),p._uU(33,"Seleccione un Perfil"),p.qZA(),p.TgZ(34,"ion-select-option",55),p._uU(35,"Alumno"),p.qZA(),p.TgZ(36,"ion-select-option",56),p._uU(37,"Profesor"),p.qZA(),p.TgZ(38,"ion-select-option",57),p._uU(39,"Admin"),p.qZA()()()()()()()}if(2&n){const t=p.oxw(2);p.xp6(11),p.Q6J("formGroup",t.usuario)}}function vv(n,e){if(1&n&&(p.TgZ(0,"ion-modal",20),p.YNc(1,Iv,40,1,"ng-template",21),p.qZA()),2&n){const t=p.oxw();p.Q6J("isOpen",t.isModalOpen)}}function Tv(n,e){if(1&n&&(p.TgZ(0,"ion-select-option",62),p._uU(1),p.qZA()),2&n){const t=e.$implicit;p.s9C("value",t.rut),p.xp6(1),p.hij(" ",t.rut," ")}}function Ev(n,e){if(1&n){const t=p.EpF();p.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-title",38),p._uU(3,"AGREGAR ASIGNATURA"),p.qZA(),p.TgZ(4,"ion-buttons",39)(5,"ion-button",3),p.NdJ("click",function(){p.CHM(t);const i=p.oxw();return p.KtG(i.setOpenAsignatura(!1,""))}),p._uU(6,"Cerrar"),p.qZA()(),p.TgZ(7,"ion-buttons",40)(8,"ion-button",41),p.NdJ("click",function(){p.CHM(t);const i=p.oxw();return p.KtG(i.guardarAsig())}),p._uU(9,"Confirmar"),p.qZA()()()(),p.TgZ(10,"ion-content",42)(11,"form",43)(12,"ion-item")(13,"ion-label",44),p._uU(14,"Codigo"),p.qZA(),p._UZ(15,"ion-input",59),p.qZA(),p.TgZ(16,"ion-item")(17,"ion-label",44),p._uU(18,"Nombre"),p.qZA(),p._UZ(19,"ion-input",46),p.qZA(),p.TgZ(20,"ion-item")(21,"ion-list")(22,"ion-item")(23,"ion-select",60),p.YNc(24,Tv,2,2,"ion-select-option",61),p.qZA()()()()()()}if(2&n){const t=p.oxw();p.xp6(8),p.Q6J("disabled",t.registroAsignatura.invalid),p.xp6(3),p.Q6J("formGroup",t.registroAsignatura),p.xp6(13),p.Q6J("ngForOf",t.filtrarProfes())}}function Av(n,e){if(1&n&&(p.TgZ(0,"ion-select-option",62),p._uU(1),p.qZA()),2&n){const t=e.$implicit;p.s9C("value",t.nombre),p.xp6(1),p.hij(" ",t.nombre," ")}}function wv(n,e){if(1&n){const t=p.EpF();p.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-title",38),p._uU(3,"MODIFICAR ASIGNATURA"),p.qZA(),p.TgZ(4,"ion-buttons",39)(5,"ion-button",3),p.NdJ("click",function(){p.CHM(t);const i=p.oxw().$implicit,s=p.oxw();return p.KtG(s.setOpenAsignatura(!1,i.codigo))}),p._uU(6,"Cerrar"),p.qZA()(),p.TgZ(7,"ion-buttons",40)(8,"ion-button",63),p.NdJ("click",function(){p.CHM(t);const i=p.oxw(2);return p.KtG(i.modificarAsig())}),p._uU(9,"Confirmar"),p.qZA()()()(),p.TgZ(10,"ion-content",42)(11,"form",43)(12,"ion-item",58)(13,"ion-label",44),p._uU(14,"Codigo"),p.qZA(),p._UZ(15,"ion-input",59),p.qZA(),p.TgZ(16,"ion-item")(17,"ion-label",44),p._uU(18,"Nombre"),p.qZA(),p._UZ(19,"ion-input",46),p.qZA(),p.TgZ(20,"ion-item")(21,"ion-list")(22,"ion-item")(23,"ion-select",64),p.YNc(24,Av,2,2,"ion-select-option",61),p.qZA()()()()()()}if(2&n){const t=p.oxw(2);p.xp6(8),p.Q6J("disabled",t.registroAsignatura.invalid),p.xp6(3),p.Q6J("formGroup",t.registroAsignatura),p.xp6(13),p.Q6J("ngForOf",t.filtrarProfes())}}function Pv(n,e){if(1&n&&(p.TgZ(0,"ion-modal",20),p.YNc(1,wv,25,3,"ng-template",21),p.qZA()),2&n){const t=p.oxw();p.Q6J("isOpen",t.isAsigOpen)}}let Rv=(()=>{var n;class e{constructor(r,i,s,a,h,d,m,g,y,T,w){this.cStorage=r,this.uStorage=i,this.aRoute=s,this.uService=a,this.menuCtrl=h,this.toastController=d,this.modalCtrl=m,this.router=g,this.aService=y,this.alertController=T,this.fireService=w,this.registroUsuario=new q.cw({rut:new q.NI("",[q.kI.required,q.kI.pattern("[0-9]{1,2}\\.[0-9]{3}\\.[0-9]{3}-[0-9kK]{1}"),Zg]),nombre:new q.NI("",[q.kI.required,q.kI.minLength(3)]),email:new q.NI("",[q.kI.email,q.kI.required,q.kI.pattern("^(.+)@(duocuc\\.cl|profesor\\.duoc\\.cl|duoc\\.cl)$")]),fechanac:new q.NI("",q.kI.required),perfil:new q.NI("Alumno",q.kI.required),pass1:new q.NI("",[q.kI.required,q.kI.minLength(6),q.kI.maxLength(20),q.kI.pattern("(?=.*d)(?=.*[a-z])(?=.*[A-Z]).{8,}")]),pass2:new q.NI("",[q.kI.required,q.kI.minLength(6),q.kI.maxLength(20),q.kI.pattern("(?=.*d)(?=.*[a-z])(?=.*[A-Z]).{8,}")])}),this.usuario=new q.cw({rut:new q.NI("",[q.kI.required,q.kI.pattern("[0-9]{1,2}\\.[0-9]{3}\\.[0-9]{3}-[0-9kK]{1}"),Zg]),nombre:new q.NI("",[q.kI.required,q.kI.minLength(3)]),email:new q.NI("",[q.kI.email,q.kI.required,q.kI.pattern("^(.+)@(duocuc\\.cl|profesor\\.duoc\\.cl|duoc\\.cl)$")]),fechanac:new q.NI("",q.kI.required),perfil:new q.NI("",q.kI.required),pass1:new q.NI("",[q.kI.required,q.kI.minLength(6),q.kI.maxLength(20),q.kI.pattern("(?=.*d)(?=.*[a-z])(?=.*[A-Z]).{8,}")]),pass2:new q.NI("",[q.kI.required,q.kI.minLength(6),q.kI.maxLength(20),q.kI.pattern("(?=.*d)(?=.*[a-z])(?=.*[A-Z]).{8,}")]),codigo_firebase:new q.NI("",q.kI.required)}),this.registroAsignatura=new q.cw({codigo:new q.NI("",[q.kI.required,q.kI.minLength(7),q.kI.pattern("^[A-Z]{3}[0-9]{4}$")]),nombre:new q.NI("",[q.kI.required,q.kI.minLength(6)]),rut_profesor:new q.NI("",[q.kI.required,q.kI.minLength(3)])}),this.boton_modificar=!0,this.boton_modificarAsig=!0,this.nombre_usuario="",this.nomBuscar="",this.rut_usuario="",this.cantidad_usuarios=0,this.alumnos=0,this.lista_usuarios=[],this.profesores=0,this.clases=0,this.usuarios=[],this.asignaturas=[],this.KEY="usuarios",this.KEYA="asignaturas",this.KEYC="clases",this.isModalOpen=!1,this.agreOpen=!1,this.isAsigOpen=!1,this.asigOpen=!1,this.isAsignaturas=!1}ngOnInit(){var r=this;return(0,R.Z)(function*(){yield r.listarAsig(),r.nombre_usuario=r.aRoute.snapshot.paramMap.get("nombre")||"",r.cantidad_usuarios=r.usuarios.length,r.lista_usuarios=r.usuarios,r.contar(),r.cargarUsuarios();const i=r.usuarios.find(s=>s.nombre===r.nombre_usuario);i?(r.rut_usuario=i.rut,console.log("rut usuario logged-in:",r.rut_usuario)):console.error("Usuario no encontrado con nombre:",r.nombre_usuario)})()}esAsignatura(){this.isAsignaturas=!0}noAsignatura(){this.isAsignaturas=!1}listar(){var r=this;return(0,R.Z)(function*(){r.usuarios=yield r.uStorage.listar(r.KEY)})()}filtrarProfes(){return this.usuarios.filter(i=>"profesor"===i.perfil)}modificar(){var r=this;return(0,R.Z)(function*(){var s=r.usuario.controls.perfil.value||"",a=r.usuario.controls.nombre.value||"";a=a.trim().replace(/\s+/g,""),r.usuario.controls.email.setValue("alumno"==s?a+"@duocuc.cl":"profesor"==s?a+"@profesor.duoc.cl":a+"@duoc.cl"),(yield r.uStorage.modificar(r.usuario.value,r.KEY))&&(r.mostrarToast("bottom","Usuario modificado!",3e3),yield r.listar(),yield r.contar(),r.boton_modificar=!0,r.isModalOpen=!1)})()}setOpen(r,i){var s=this;return(0,R.Z)(function*(){""==i?s.agreOpen=r:(s.isModalOpen=r,yield s.buscar(i))})()}setOpenAsignatura(r,i){var s=this;return(0,R.Z)(function*(){""==i?(s.asigOpen=r,s.registroAsignatura.reset()):(s.isAsigOpen=r,yield s.buscarAsig(i))})()}back(){this.router.navigate(["/login"])}contar(){this.alumnos=this.usuarios.filter(r=>"alumno"===r.perfil).length,this.profesores=this.usuarios.filter(r=>"profesor"===r.perfil).length,this.clases=this.cStorage.listar(this.KEYC).catch.length}openMenu(){this.menuCtrl.enable(!0,"menu"),this.menuCtrl.open("menu")}mostrarToast(r,i,s){var a=this;return(0,R.Z)(function*(){yield(yield a.toastController.create({message:i,duration:s,position:r})).present()})()}listarAsig(){var r=this;return(0,R.Z)(function*(){r.asignaturas=yield r.aService.listar(r.KEYA)})()}buscarAsig(r){var i=this;return(0,R.Z)(function*(){var s=yield i.aService.buscarAsig(r,i.KEYA);s?(i.registroAsignatura.setValue(s),i.boton_modificarAsig=!1):console.log("La asignatura no fue encontrada.")})()}guardarAsig(){var r=this;return(0,R.Z)(function*(){(yield r.aService.agregar(r.registroAsignatura.value,r.KEYA))?(r.mostrarToast("middle","Asignatura agregada!",3e3),r.registroAsignatura.reset(),yield r.listarAsig(),r.asigOpen=!1):r.mostrarToast("middle","Error al agregar asignatura.",3e3)})()}modificarAsig(){var r=this;return(0,R.Z)(function*(){console.log("Antes de modificar en modificarAsig:",r.registroAsignatura.value);var i=yield r.aService.modificar(r.registroAsignatura.value,r.KEYA);console.log("Respuesta de modificar en modificarAsig:",i),i?(r.mostrarToast("top","Asignatura modificada!",3e3),yield r.listarAsig(),r.registroAsignatura.reset(),r.boton_modificarAsig=!0,r.isAsigOpen=!1):r.mostrarToast("middle","Error al modificar asignatura.",3e3)})()}eliminarAsig(r){var i=this;return(0,R.Z)(function*(){var a;yield(yield i.alertController.create({header:"Confirmar eliminaci\xf3n",message:"\xbfEst\xe1s seguro de que deseas eliminar esta asignatura?",buttons:[{text:"Cancelar",role:"cancel",cssClass:"secondary",handler:()=>{}},{text:"Eliminar",handler:(a=(0,R.Z)(function*(){yield i.aService.eliminar(r,i.KEYA),yield i.listarAsig(),i.mostrarToast("top","Asignatura eliminada!",3e3)}),function(){return a.apply(this,arguments)})}]})).present()})()}logout(){var r=this;return(0,R.Z)(function*(){r.uStorage.logout()})()}agregar(){const r=this.registroUsuario.controls.fechanac.value||"",i=new Date,s=new Date(r);i.getFullYear()-s.getFullYear()<17?this.mostrarToast("bottom","Debe ser igual a o mayor de 17 a\xf1os para registrarse.",3e3):null!==this.fireService.agregar("usuarios",this.registroUsuario.value)?(this.mostrarToast("middle","Usuario agregado!",3e3),this.registroUsuario.reset(),this.cargarUsuarios(),this.agreOpen=!1):this.mostrarToast("middle","Error al agregar usuario.",3e3)}modificarFire(){this.fireService.modificar("usuarios",this.usuario.controls.codigo_firebase.value||"",this.usuario.value)}buscar(r){this.fireService.getDato("usuarios",r).subscribe(i=>{let s=i.data();s.codigo_firebase=r,this.usuario.setValue(s)})}eliminar(r){this.fireService.eliminar("usuarios",r)}cargarUsuarios(){var r;null===(r=this.fireService.getDatos("usuarios"))||void 0===r||r.subscribe(i=>{this.usuarios=[];for(let s of i){let a=s.payload.doc.data();a.codigo_firebase=s.payload.doc.id,this.usuarios.push(a)}})}}return(n=e).\u0275fac=function(r){return new(r||n)(p.Y36(Lo.A),p.Y36(dp.r),p.Y36(lt.gz),p.Y36(Yr.i),p.Y36(C._q),p.Y36(C.yF),p.Y36(C.IN),p.Y36(lt.F0),p.Y36(fp.c),p.Y36(C.Br),p.Y36(fv))},n.\u0275cmp=p.Xpm({type:n,selectors:[["app-admin"]],decls:67,vars:11,consts:[["menuId","menu","contentId","main-content"],[1,"ion-padding"],[1,"sidebar-menu"],[3,"click"],["name","home"],["name","book-outline"],[3,"fullscreen"],["id","main-content",1,"ion-page"],[1,"sidebar-title"],["slot","start","fill","clear","color","light",3,"click"],["name","menu"],[1,"user-wrapper"],["src","assets/images/favicon.png","width","40px","height","40px",3,"click"],[1,"cards"],[1,"card-single"],[1,"las","la-users"],["id","trabajos-card",1,"card-single"],[1,"las","la-clipboard-list"],[1,"las","la-user-tie"],[4,"ngIf"],[1,"modalModi",3,"isOpen"],["class","modiTemplate"],["class","modalModi",3,"isOpen",4,"ngFor","ngForOf"],[1,"recientes-grid"],[1,"trabajos"],[1,"card"],[1,"card-header"],["fill","clear","color","danger",3,"click"],["name","add-outline"],[1,"card-body"],[1,"tabla-responsiva"],["width","100%","id","tabla"],[4,"ngFor","ngForOf"],["color","favorite2"],["name","arrow-back-outline"],["side","end"],["color","favorite",3,"click"],["color","danger",3,"disabled","click"],[1,"modiTitle"],["slot","start"],["slot","end"],["type","submit",3,"disabled","click"],[1,"ion-paddinga"],[3,"formGroup"],["position","stacked"],["type","text","formControlName","rut"],["type","text","formControlName","nombre"],["type","text","formControlName","email"],["type","date","formControlName","fechanac"],[1,"inputReg"],["type","password","placeholder","Ingrese su contrase\xf1a","formControlName","pass1",1,"contrase\xf1a"],["type","password","placeholder","Reingrese su contrase\xf1a","formControlName","pass2",1,"contrase\xf1a"],[1,"perfilSelect"],["placeholder","Perfil de Usuario","formControlName","perfil"],["slot","label"],["value","alumno"],["value","profesor"],["value","admin"],["disabled","true"],["type","text","formControlName","codigo"],["label","Profesor","formControlName","rut_profesor"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],[3,"disabled","click"],["label","Profesor","formControlName","profesor"]],template:function(r,i){1&r&&(p.TgZ(0,"ion-menu",0)(1,"ion-header")(2,"ion-toolbar")(3,"ion-title"),p._uU(4,"VerifyU"),p.qZA()()(),p.TgZ(5,"ion-content",1)(6,"div",2)(7,"ul")(8,"li")(9,"span",3),p.NdJ("click",function(){return i.noAsignatura()}),p._UZ(10,"ion-icon",4),p._uU(11,"Inicio"),p.qZA()(),p.TgZ(12,"li")(13,"span",3),p.NdJ("click",function(){return i.esAsignatura()}),p._UZ(14,"ion-icon",5),p._uU(15,"Asignaturas"),p.qZA()()()()()(),p.TgZ(16,"ion-content",6)(17,"div",7)(18,"header")(19,"h2",8)(20,"ion-button",9),p.NdJ("click",function(){return i.openMenu()}),p._UZ(21,"ion-icon",10),p.qZA()(),p.TgZ(22,"div",11)(23,"img",12),p.NdJ("click",function(){return i.logout()}),p.qZA(),p.TgZ(24,"div")(25,"h4"),p._uU(26,"VerifyU"),p.qZA(),p.TgZ(27,"small"),p._uU(28),p.qZA()()()(),p.TgZ(29,"main")(30,"div",13)(31,"div",14)(32,"div")(33,"h1"),p._uU(34),p.qZA(),p.TgZ(35,"span"),p._uU(36,"Alumnos"),p.qZA()(),p.TgZ(37,"div"),p._UZ(38,"span",15),p.qZA()(),p.TgZ(39,"div",16)(40,"div")(41,"h1"),p._uU(42),p.qZA(),p.TgZ(43,"span"),p._uU(44,"Profesores"),p.qZA()(),p.TgZ(45,"div"),p._UZ(46,"span",17),p.qZA()(),p.TgZ(47,"div",14)(48,"div")(49,"h1"),p._uU(50),p.qZA(),p.TgZ(51,"span"),p._uU(52,"Clases"),p.qZA()(),p.TgZ(53,"div"),p._UZ(54,"span",18),p.qZA()()(),p.YNc(55,mv,25,1,"div",19),p.YNc(56,_v,21,1,"div",19),p.qZA()(),p._uU(57," /* MODAL AGREGAR */ "),p.TgZ(58,"ion-modal",20),p.YNc(59,yv,47,2,"ng-template",21),p.qZA(),p._uU(60," /* MODAL MODIFICAR */ "),p.YNc(61,vv,2,1,"ion-modal",22),p._uU(62," /* PAGINA ASIGNATURAS */ /* AGREGAR ASIGNATURAS */ "),p.TgZ(63,"ion-modal",20),p.YNc(64,Ev,25,3,"ng-template",21),p.qZA(),p._uU(65," /* MODIFICAR ASIGNATURAS */ "),p.YNc(66,Pv,2,1,"ion-modal",22),p.qZA()),2&r&&(p.xp6(16),p.Q6J("fullscreen",!0),p.xp6(12),p.hij("\xa1Bienvenido ",i.nombre_usuario,"!"),p.xp6(6),p.Oqu(i.alumnos),p.xp6(8),p.Oqu(i.profesores),p.xp6(8),p.Oqu(i.clases),p.xp6(5),p.Q6J("ngIf",0==i.isAsignaturas),p.xp6(1),p.Q6J("ngIf",1==i.isAsignaturas),p.xp6(2),p.Q6J("isOpen",i.agreOpen),p.xp6(3),p.Q6J("ngForOf",i.usuarios),p.xp6(2),p.Q6J("isOpen",i.asigOpen),p.xp6(3),p.Q6J("ngForOf",i.asignaturas))},dependencies:[v.sg,v.O5,q._Y,q.JJ,q.JL,C.YG,C.Sm,C.W2,C.Gu,C.gu,C.pK,C.Ie,C.u8,C.IK,C.td,C.Q$,C.q_,C.z0,C.t9,C.n0,C.wd,C.sr,C.ki,C.QI,C.j9,q.sg,q.u,v.rS],styles:["ion-content[_ngcontent-%COMP%]{--background:rgb(205,0,0)}ion-content[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}*[_ngcontent-%COMP%]{overflow:auto;padding:0;margin:0;box-sizing:border-box;list-style-type:none;text-decoration:none}ion-item-sliding[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]{background:white}ion-menu[_ngcontent-%COMP%]::part(backdrop){background-color:#000}ion-menu[_ngcontent-%COMP%]::part(container){border-radius:0 20px 20px 0;box-shadow:8px 0 32px #ffffffc0}.main-content[_ngcontent-%COMP%]   header[_ngcontent-%COMP%]   .user-wrapper[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{color:#323232;margin:0;font-size:1.3rem;font-weight:600;text-decoration:none}header[_ngcontent-%COMP%]{background:#fff;display:flex;justify-content:space-between;padding:1rem 1.5rem;box-shadow:2px 2px 5px #0003;position:fixed;width:100%;top:0;z-index:100;transition:left .3s,width .3s}header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{color:#222}header[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:1.7rem;padding-right:1rem}.user-wrapper[_ngcontent-%COMP%]{display:flex;align-items:center}.user-wrapper[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{border-radius:50%;margin-right:1rem}.user-wrapper[_ngcontent-%COMP%]   small[_ngcontent-%COMP%]{display:inline-block;color:#8390a2}.admin[_ngcontent-%COMP%]{--background:white;--color:black}main[_ngcontent-%COMP%]{margin-top:75px;padding:2rem 1.5rem;background:#ff0000;background:linear-gradient(to left bottom,gray,white);min-height:calc(100vh - 80px)}header[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{color:#000}.cards[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(3,1fr);grid-gap:2rem;margin-top:1rem}.card-single[_ngcontent-%COMP%]{display:flex;justify-content:space-between;background:#fff;color:#000;padding:2rem;border-radius:2px;font-size:2rem}card-single[_ngcontent-%COMP%]:hover   div[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{color:#d62626}card-single[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:first-child   span[_ngcontent-%COMP%]{color:#8390a2;font-size:1rem}card-single[_ngcontent-%COMP%]:hover{background:#d62626}card-single[_ngcontent-%COMP%]:hover   h1[_ngcontent-%COMP%], card-single[_ngcontent-%COMP%]:hover   div[_ngcontent-%COMP%]:first-child   span[_ngcontent-%COMP%], card-single[_ngcontent-%COMP%]:hover   div[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{color:#fff}.recientes-grid[_ngcontent-%COMP%]{margin-top:3.5rem;display:grid;grid-gap:2rem;grid-template-columns:100%}.card[_ngcontent-%COMP%]{background:#fff;border-radius:5px}.card-header[_ngcontent-%COMP%]{padding:1rem}card-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;color:#000;align-items:center;border-bottom:1px solid #f0f0f0}card-header[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{background:#d62626;border-radius:10px;color:#fff;font-size:.8rem;padding:.5rem 1rem;border:1px solid #d62626}table[_ngcontent-%COMP%]{border-collapse:collapse}thead[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{border-top:1px solid #f0f0f0;border-bottom:2px solid #f0f0f0}thead[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{font-weight:700}td[_ngcontent-%COMP%]{padding:.5rem 1rem;font-size:.9rem;color:#222}tr[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]:last-child{display:flex;align-items:center}tabla-responsiva[_ngcontent-%COMP%]{width:100%;overflow-y:auto}.usuario[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:.5rem .7rem}@media only screen and (max-width: 1200px){header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:none}}@media only screen and (max-width: 960px){.cards[_ngcontent-%COMP%]{grid-template-columns:repeat(3,1fr)}.recientes-grid[_ngcontent-%COMP%]{grid-template-columns:100%}header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{display:flex;align-items:center}header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:inline-block;background:#d62626;padding-right:0rem;margin-right:1rem;height:40px;width:40px;border-radius:50%;color:#fff;display:flex;align-items:center;justify-content:center!important}header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{text-align:center;padding-right:0rem}header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:1.1rem}.main-content[_ngcontent-%COMP%]{width:100%;margin-left:0rem}header[_ngcontent-%COMP%]{width:100%!important;left:0!important}}form[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]{--background:rgba(0,0,0,.132)}form[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{font-weight:700;text-shadow:-1px -1px 0 #000,1px -1px 0 #000,-1px 1px 0 #000,1px 1px 0 #000;color:#fff}@media only screen and (max-width: 560px){.cards[_ngcontent-%COMP%]{grid-template-columns:100%}ion-menu[_ngcontent-%COMP%]   ion-header[_ngcontent-%COMP%]{background:red}ion-menu[_ngcontent-%COMP%]   ion-title[_ngcontent-%COMP%]{color:#fff;font:3rem;font-weight:700;display:flex;align-items:center;justify-content:center;text-align:center}.sidebar-menu[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{width:100%;margin-bottom:1.7rem;padding-left:1rem}.sidebar-menu[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{padding-left:1rem;display:block;color:#000;font-size:1.1rem;font-weight:700;text-decoration:none}.sidebar-menu[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:hover{background:#ff0000;color:#fff;border-radius:30px 0 0 30px}.sidebar-menu[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:first-child{font-size:1.5rem;padding-right:1rem}ion-item-sliding[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]{min-width:200px}.ion-padding[_ngcontent-%COMP%]{--background:rgb(255,0,0);--background:linear-gradient(360deg,rgba(255,0,0,1)10%,rgba(255,255,255,1)10%,rgba(198,198,198,0)100%);color:#fff}.ion-padding[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]{margin-bottom:5%}.ion-paddinga[_ngcontent-%COMP%]{--background:rgb(170,170,170)}.ion-paddinga[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]{margin-bottom:5%}.ion-paddinga[_ngcontent-%COMP%]   ion-list[_ngcontent-%COMP%]{background:rgba(255,255,255,0)}.ion-paddinga[_ngcontent-%COMP%]   .modalModi[_ngcontent-%COMP%]{background:white;background:linear-gradient(#350000,rgba(255,255,255,.245) 90%);transition-property:background;transition-timing-function:ease-in-out;transition-duration:1s;transition-delay:.1s;padding:0;border:0;margin:0}.ion-paddinga[_ngcontent-%COMP%]   .modalModi[_ngcontent-%COMP%]   ion-content[_ngcontent-%COMP%]{--background:linear-gradient(rgba(255,175,175,.585),rgba(255,203,185,.558),rgba(249,248,248,.749));--color:white}.ion-paddinga[_ngcontent-%COMP%]   .modalModi[_ngcontent-%COMP%]   ion-title[_ngcontent-%COMP%]{justify-items:center;align-items:center;text-align:center;color:tomato;font-weight:700}.ion-paddinga[_ngcontent-%COMP%]   .modalModi[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]{align-items:center;text-align:center;justify-content:center;--background:white;--color:black;--font-weight:bold}.ion-paddinga[_ngcontent-%COMP%]   .modalModi[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]{align-items:center;text-align:center;justify-content:center;padding:0;color:#000;--background:transparent}.ion-paddinga[_ngcontent-%COMP%]   #inputBuscar[_ngcontent-%COMP%]{width:30%;height:-moz-fit-content;height:fit-content;border-bottom:1px solid black}}"]}),e})();function Zg(n){return n.value?function Sv(n){const e=(n=n.replace(/\./g,"").replace(/-/g,"").trim()).slice(-1).toUpperCase();let t=parseInt(n.slice(0,-1),10),r=0,i=2;for(;t>0;)r+=t%10*i,t=Math.floor(t/10),i=7===i?2:i+1;const s=11-r%11;return e===(11===s?"0":10===s?"K":s.toString())}(n.value)?null:{rutInvalido:!0}:null}const Cv=[{path:"",component:Rv}];let bv=(()=>{var n;class e{}return(n=e).\u0275fac=function(r){return new(r||n)},n.\u0275mod=p.oAB({type:n}),n.\u0275inj=p.cJS({imports:[lt.Bz.forChild(Cv),lt.Bz]}),e})(),xv=(()=>{var n;class e{}return(n=e).\u0275fac=function(r){return new(r||n)},n.\u0275mod=p.oAB({type:n}),n.\u0275inj=p.cJS({imports:[v.ez,q.u5,C.Pc,bv,q.UX]}),e})()},8290:(zg,zu,H)=>{H.r(zu);var v=H(5861),q=H(3106),C=H(9058),lt=H(534),R=H(7879),p=H(7582),Lo=H(4537);const Yr={FACEBOOK:"facebook.com",GITHUB:"github.com",GOOGLE:"google.com",PASSWORD:"password",PHONE:"phone",TWITTER:"twitter.com"};const Wu=function Pt(){return{"admin-restricted-operation":"This operation is restricted to administrators only.","argument-error":"","app-not-authorized":"This app, identified by the domain where it's hosted, is not authorized to use Firebase Authentication with the provided API key. Review your key configuration in the Google API console.","app-not-installed":"The requested mobile application corresponding to the identifier (Android package name or iOS bundle ID) provided is not installed on this device.","captcha-check-failed":"The reCAPTCHA response token provided is either invalid, expired, already used or the domain associated with it does not match the list of whitelisted domains.","code-expired":"The SMS code has expired. Please re-send the verification code to try again.","cordova-not-ready":"Cordova framework is not ready.","cors-unsupported":"This browser is not supported.","credential-already-in-use":"This credential is already associated with a different user account.","custom-token-mismatch":"The custom token corresponds to a different audience.","requires-recent-login":"This operation is sensitive and requires recent authentication. Log in again before retrying this request.","dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK.","dynamic-link-not-activated":"Please activate Dynamic Links in the Firebase Console and agree to the terms and conditions.","email-change-needs-verification":"Multi-factor users must always have a verified email.","email-already-in-use":"The email address is already in use by another account.","emulator-config-failed":'Auth instance has already been used to make a network call. Auth can no longer be configured to use the emulator. Try calling "connectAuthEmulator()" sooner.',"expired-action-code":"The action code has expired.","cancelled-popup-request":"This operation has been cancelled due to another conflicting popup being opened.","internal-error":"An internal AuthError has occurred.","invalid-app-credential":"The phone verification request contains an invalid application verifier. The reCAPTCHA token response is either invalid or expired.","invalid-app-id":"The mobile app identifier is not registed for the current project.","invalid-user-token":"This user's credential isn't valid for this project. This can happen if the user's token has been tampered with, or if the user isn't for the project associated with this API key.","invalid-auth-event":"An internal AuthError has occurred.","invalid-verification-code":"The SMS verification code used to create the phone auth credential is invalid. Please resend the verification code sms and be sure to use the verification code provided by the user.","invalid-continue-uri":"The continue URL provided in the request is invalid.","invalid-cordova-configuration":"The following Cordova plugins must be installed to enable OAuth sign-in: cordova-plugin-buildinfo, cordova-universal-links-plugin, cordova-plugin-browsertab, cordova-plugin-inappbrowser and cordova-plugin-customurlscheme.","invalid-custom-token":"The custom token format is incorrect. Please check the documentation.","invalid-dynamic-link-domain":"The provided dynamic link domain is not configured or authorized for the current project.","invalid-email":"The email address is badly formatted.","invalid-emulator-scheme":"Emulator URL must start with a valid scheme (http:// or https://).","invalid-api-key":"Your API key is invalid, please check you have copied it correctly.","invalid-cert-hash":"The SHA-1 certificate hash provided is invalid.","invalid-credential":"The supplied auth credential is malformed or has expired.","invalid-message-payload":"The email template corresponding to this action contains invalid characters in its message. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-multi-factor-session":"The request does not contain a valid proof of first factor successful sign-in.","invalid-oauth-provider":"EmailAuthProvider is not supported for this operation. This operation only supports OAuth providers.","invalid-oauth-client-id":"The OAuth client ID provided is either invalid or does not match the specified API key.","unauthorized-domain":"This domain is not authorized for OAuth operations for your Firebase project. Edit the list of authorized domains from the Firebase console.","invalid-action-code":"The action code is invalid. This can happen if the code is malformed, expired, or has already been used.","wrong-password":"The password is invalid or the user does not have a password.","invalid-persistence-type":"The specified persistence type is invalid. It can only be local, session or none.","invalid-phone-number":"The format of the phone number provided is incorrect. Please enter the phone number in a format that can be parsed into E.164 format. E.164 phone numbers are written in the format [+][country code][subscriber number including area code].","invalid-provider-id":"The specified provider ID is invalid.","invalid-recipient-email":"The email corresponding to this action failed to send as the provided recipient email address is invalid.","invalid-sender":"The email template corresponding to this action contains an invalid sender email or name. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-verification-id":"The verification ID used to create the phone auth credential is invalid.","invalid-tenant-id":"The Auth instance's tenant ID is invalid.","login-blocked":"Login blocked by user-provided method: {$originalMessage}","missing-android-pkg-name":"An Android Package Name must be provided if the Android App is required to be installed.","auth-domain-config-required":"Be sure to include authDomain when calling firebase.initializeApp(), by following the instructions in the Firebase console.","missing-app-credential":"The phone verification request is missing an application verifier assertion. A reCAPTCHA response token needs to be provided.","missing-verification-code":"The phone auth credential was created with an empty SMS verification code.","missing-continue-uri":"A continue URL must be provided in the request.","missing-iframe-start":"An internal AuthError has occurred.","missing-ios-bundle-id":"An iOS Bundle ID must be provided if an App Store ID is provided.","missing-or-invalid-nonce":"The request does not contain a valid nonce. This can occur if the SHA-256 hash of the provided raw nonce does not match the hashed nonce in the ID token payload.","missing-password":"A non-empty password must be provided","missing-multi-factor-info":"No second factor identifier is provided.","missing-multi-factor-session":"The request is missing proof of first factor successful sign-in.","missing-phone-number":"To send verification codes, provide a phone number for the recipient.","missing-verification-id":"The phone auth credential was created with an empty verification ID.","app-deleted":"This instance of FirebaseApp has been deleted.","multi-factor-info-not-found":"The user does not have a second factor matching the identifier provided.","multi-factor-auth-required":"Proof of ownership of a second factor is required to complete sign-in.","account-exists-with-different-credential":"An account already exists with the same email address but different sign-in credentials. Sign in using a provider associated with this email address.","network-request-failed":"A network AuthError (such as timeout, interrupted connection or unreachable host) has occurred.","no-auth-event":"An internal AuthError has occurred.","no-such-provider":"User was not linked to an account with the given provider.","null-user":"A null user object was provided as the argument for an operation which requires a non-null user object.","operation-not-allowed":"The given sign-in provider is disabled for this Firebase project. Enable it in the Firebase console, under the sign-in method tab of the Auth section.","operation-not-supported-in-this-environment":'This operation is not supported in the environment this application is running on. "location.protocol" must be http, https or chrome-extension and web storage must be enabled.',"popup-blocked":"Unable to establish a connection with the popup. It may have been blocked by the browser.","popup-closed-by-user":"The popup has been closed by the user before finalizing the operation.","provider-already-linked":"User can only be linked to one identity for the given provider.","quota-exceeded":"The project's quota for this operation has been exceeded.","redirect-cancelled-by-user":"The redirect operation has been cancelled by the user before finalizing.","redirect-operation-pending":"A redirect sign-in operation is already pending.","rejected-credential":"The request contains malformed or mismatching credentials.","second-factor-already-in-use":"The second factor is already enrolled on this account.","maximum-second-factor-count-exceeded":"The maximum allowed number of second factors on a user has been exceeded.","tenant-id-mismatch":"The provided tenant ID does not match the Auth instance's tenant ID",timeout:"The operation has timed out.","user-token-expired":"The user's credential is no longer valid. The user must sign in again.","too-many-requests":"We have blocked all requests from this device due to unusual activity. Try again later.","unauthorized-continue-uri":"The domain of the continue URL is not whitelisted.  Please whitelist the domain in the Firebase console.","unsupported-first-factor":"Enrolling a second factor or signing in with a multi-factor account requires sign-in with a supported first factor.","unsupported-persistence-type":"The current environment does not support the specified persistence type.","unsupported-tenant-operation":"This operation is not supported in a multi-tenant context.","unverified-email":"The operation requires a verified email.","user-cancelled":"The user did not grant your application the permissions it requested.","user-not-found":"There is no user record corresponding to this identifier. The user may have been deleted.","user-disabled":"The user account has been disabled by an administrator.","user-mismatch":"The supplied credentials do not correspond to the previously signed in user.","user-signed-out":"","weak-password":"The password must be 6 characters long or more.","web-storage-unsupported":"This browser is not supported or 3rd party cookies and data may be disabled.","already-initialized":"initializeAuth() has already been called with different options. To avoid this error, call initializeAuth() with the same options as when it was originally called, or call getAuth() to return the already initialized instance.","missing-recaptcha-token":"The reCAPTCHA token is missing when sending request to the backend.","invalid-recaptcha-token":"The reCAPTCHA token is invalid when sending request to the backend.","invalid-recaptcha-action":"The reCAPTCHA action is invalid when sending request to the backend.","recaptcha-not-enabled":"reCAPTCHA Enterprise integration is not enabled for this project.","missing-client-type":"The reCAPTCHA client type is missing when sending request to the backend.","missing-recaptcha-version":"The reCAPTCHA version is missing when sending request to the backend.","invalid-req-type":"Invalid request parameters.","invalid-recaptcha-version":"The reCAPTCHA version is invalid when sending request to the backend.","unsupported-password-policy-schema-version":"The password policy received from the backend uses a schema version that is not supported by this version of the Firebase SDK.","password-does-not-meet-requirements":"The password does not meet the requirements."}},lr=function nh(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}},us=new C.LL("auth","Firebase",{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}),cs=new R.Yd("@firebase/auth");function It(c,...o){cs.logLevel<=R.in.ERROR&&cs.error(`Auth (${lt.SDK_VERSION}): ${c}`,...o)}function oe(c,...o){throw hs(c,...o)}function Ge(c,...o){return hs(c,...o)}function Ku(c,o,u){const l=Object.assign(Object.assign({},lr()),{[o]:u});return new C.LL("auth","Firebase",l).create(o,{appName:c.name})}function hr(c,o,u){if(!(o instanceof u))throw u.name!==o.constructor.name&&oe(c,"argument-error"),Ku(c,"argument-error",`Type of ${o.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function hs(c,...o){if("string"!=typeof c){const u=o[0],l=[...o.slice(1)];return l[0]&&(l[0].appName=c.name),c._errorFactory.create(u,...l)}return us.create(c,...o)}function N(c,o,...u){if(!c)throw hs(o,...u)}function Rt(c){const o="INTERNAL ASSERTION FAILED: "+c;throw It(o),new Error(o)}function ht(c,o){c||Rt(o)}function xn(){var c;return typeof self<"u"&&(null===(c=self.location)||void 0===c?void 0:c.href)||""}function Xr(){return"http:"===rh()||"https:"===rh()}function rh(){var c;return typeof self<"u"&&(null===(c=self.location)||void 0===c?void 0:c.protocol)||null}class dr{constructor(o,u){this.shortDelay=o,this.longDelay=u,ht(u>o,"Short delay should be less than long delay!"),this.isMobile=(0,C.uI)()||(0,C.b$)()}get(){return function ih(){return!(typeof navigator<"u"&&navigator&&"onLine"in navigator&&"boolean"==typeof navigator.onLine&&(Xr()||(0,C.ru)()||"connection"in navigator))||navigator.onLine}()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}function ds(c,o){ht(c.emulator,"Emulator should always be set here");const{url:u}=c.emulator;return o?`${u}${o.startsWith("/")?o.slice(1):o}`:u}class Fo{static initialize(o,u,l){this.fetchImpl=o,u&&(this.headersImpl=u),l&&(this.responseImpl=l)}static fetch(){return this.fetchImpl?this.fetchImpl:typeof self<"u"&&"fetch"in self?self.fetch:typeof globalThis<"u"&&globalThis.fetch?globalThis.fetch:typeof fetch<"u"?fetch:void Rt("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:typeof self<"u"&&"Headers"in self?self.Headers:typeof globalThis<"u"&&globalThis.Headers?globalThis.Headers:typeof Headers<"u"?Headers:void Rt("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:typeof self<"u"&&"Response"in self?self.Response:typeof globalThis<"u"&&globalThis.Response?globalThis.Response:typeof Response<"u"?Response:void Rt("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const $u={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"},Hu=new dr(3e4,6e4);function de(c,o){return c.tenantId&&!o.tenantId?Object.assign(Object.assign({},o),{tenantId:c.tenantId}):o}function ge(c,o,u,l){return Qu.apply(this,arguments)}function Qu(){return(Qu=(0,v.Z)(function*(c,o,u,l,f={}){return Yu(c,f,(0,v.Z)(function*(){let _={},I={};l&&("GET"===o?I=l:_={body:JSON.stringify(l)});const E=(0,C.xO)(Object.assign({key:c.config.apiKey},I)).slice(1),S=yield c._getAdditionalHeaders();return S["Content-Type"]="application/json",c.languageCode&&(S["X-Firebase-Locale"]=c.languageCode),Fo.fetch()(fs(c,c.config.apiHost,u,E),Object.assign({method:o,headers:S,referrerPolicy:"no-referrer"},_))}))})).apply(this,arguments)}function Yu(c,o,u){return ei.apply(this,arguments)}function ei(){return(ei=(0,v.Z)(function*(c,o,u){c._canInitEmulator=!1;const l=Object.assign(Object.assign({},$u),o);try{const f=new sh(c),_=yield Promise.race([u(),f.promise]);f.clearNetworkTimeout();const I=yield _.json();if("needConfirmation"in I)throw ti(c,"account-exists-with-different-credential",I);if(_.ok&&!("errorMessage"in I))return I;{const E=_.ok?I.errorMessage:I.error.message,[S,L]=E.split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===S)throw ti(c,"credential-already-in-use",I);if("EMAIL_EXISTS"===S)throw ti(c,"email-already-in-use",I);if("USER_DISABLED"===S)throw ti(c,"user-disabled",I);const Z=l[S]||S.toLowerCase().replace(/[_\s]+/g,"-");if(L)throw Ku(c,Z,L);oe(c,Z)}}catch(f){if(f instanceof C.ZR)throw f;oe(c,"network-request-failed",{message:String(f)})}})).apply(this,arguments)}function zt(c,o,u,l){return Uo.apply(this,arguments)}function Uo(){return(Uo=(0,v.Z)(function*(c,o,u,l,f={}){const _=yield ge(c,o,u,l,f);return"mfaPendingCredential"in _&&oe(c,"multi-factor-auth-required",{_serverResponse:_}),_})).apply(this,arguments)}function fs(c,o,u,l){const f=`${o}${u}?${l}`;return c.config.emulator?ds(c.config,f):`${c.config.apiScheme}://${f}`}function qo(c){switch(c){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class sh{constructor(o){this.auth=o,this.timer=null,this.promise=new Promise((u,l)=>{this.timer=setTimeout(()=>l(Ge(this.auth,"network-request-failed")),Hu.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function ti(c,o,u){const l={appName:c.name};u.email&&(l.email=u.email),u.phoneNumber&&(l.phoneNumber=u.phoneNumber);const f=Ge(c,o,l);return f.customData._tokenResponse=u,f}function ni(c){return void 0!==c&&void 0!==c.getResponse}function Bo(c){return void 0!==c&&void 0!==c.enterprise}class vt{constructor(o){if(this.siteKey="",this.recaptchaEnforcementState=[],void 0===o.recaptchaKey)throw new Error("recaptchaKey undefined");this.siteKey=o.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=o.recaptchaEnforcementState}getProviderEnforcementState(o){if(!this.recaptchaEnforcementState||0===this.recaptchaEnforcementState.length)return null;for(const u of this.recaptchaEnforcementState)if(u.provider&&u.provider===o)return qo(u.enforcementState);return null}isProviderEnabled(o){return"ENFORCE"===this.getProviderEnforcementState(o)||"AUDIT"===this.getProviderEnforcementState(o)}}function Zo(){return(Zo=(0,v.Z)(function*(c){return(yield ge(c,"GET","/v1/recaptchaParams")).recaptchaSiteKey||""})).apply(this,arguments)}function dt(c,o){return F.apply(this,arguments)}function F(){return(F=(0,v.Z)(function*(c,o){return ge(c,"GET","/v2/recaptchaConfig",de(c,o))})).apply(this,arguments)}function Q(){return(Q=(0,v.Z)(function*(c,o){return ge(c,"POST","/v1/accounts:delete",o)})).apply(this,arguments)}function kn(){return(kn=(0,v.Z)(function*(c,o){return ge(c,"POST","/v1/accounts:update",o)})).apply(this,arguments)}function ri(){return(ri=(0,v.Z)(function*(c,o){return ge(c,"POST","/v1/accounts:lookup",o)})).apply(this,arguments)}function ii(c){if(c)try{const o=new Date(Number(c));if(!isNaN(o.getTime()))return o.toUTCString()}catch{}}function Ue(){return(Ue=(0,v.Z)(function*(c,o=!1){const u=(0,C.m9)(c),l=yield u.getIdToken(o),f=Se(l);N(f&&f.exp&&f.auth_time&&f.iat,u.auth,"internal-error");const _="object"==typeof f.firebase?f.firebase:void 0,I=null==_?void 0:_.sign_in_provider;return{claims:f,token:l,authTime:ii(fr(f.auth_time)),issuedAtTime:ii(fr(f.iat)),expirationTime:ii(fr(f.exp)),signInProvider:I||null,signInSecondFactor:(null==_?void 0:_.sign_in_second_factor)||null}})).apply(this,arguments)}function fr(c){return 1e3*Number(c)}function Se(c){const[o,u,l]=c.split(".");if(void 0===o||void 0===u||void 0===l)return It("JWT malformed, contained fewer than 3 sections"),null;try{const f=(0,C.tV)(u);return f?JSON.parse(f):(It("Failed to decode base64 JWT payload"),null)}catch(f){return It("Caught error parsing JWT payload as JSON",null==f?void 0:f.toString()),null}}function Wt(c,o){return ms.apply(this,arguments)}function ms(){return(ms=(0,v.Z)(function*(c,o,u=!1){if(u)return o;try{return yield o}catch(l){throw l instanceof C.ZR&&function zo({code:c}){return"auth/user-disabled"===c||"auth/user-token-expired"===c}(l)&&c.auth.currentUser===c&&(yield c.auth.signOut()),l}})).apply(this,arguments)}class Ju{constructor(o){this.user=o,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(o){var u;if(o){const l=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),l}{this.errorBackoff=3e4;const f=(null!==(u=this.user.stsTokenManager.expirationTime)&&void 0!==u?u:0)-Date.now()-3e5;return Math.max(0,f)}}schedule(o=!1){var u=this;if(!this.isRunning)return;const l=this.getInterval(o);this.timerId=setTimeout((0,v.Z)(function*(){yield u.iteration()}),l)}iteration(){var o=this;return(0,v.Z)(function*(){try{yield o.user.getIdToken(!0)}catch(u){return void("auth/network-request-failed"===(null==u?void 0:u.code)&&o.schedule(!0))}o.schedule()})()}}class ze{constructor(o,u){this.createdAt=o,this.lastLoginAt=u,this._initializeTime()}_initializeTime(){this.lastSignInTime=ii(this.lastLoginAt),this.creationTime=ii(this.createdAt)}_copy(o){this.createdAt=o.createdAt,this.lastLoginAt=o.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}function si(c){return Nn.apply(this,arguments)}function Nn(){return Nn=(0,v.Z)(function*(c){var o;const u=c.auth,l=yield c.getIdToken(),f=yield Wt(c,function oh(c,o){return ri.apply(this,arguments)}(u,{idToken:l}));N(null==f?void 0:f.users.length,u,"internal-error");const _=f.users[0];c._notifyReloadListener(_);const I=null!==(o=_.providerUserInfo)&&void 0!==o&&o.length?function uh(c){return c.map(o=>{var{providerId:u}=o,l=(0,p._T)(o,["providerId"]);return{providerId:u,uid:l.rawId||"",displayName:l.displayName||null,email:l.email||null,phoneNumber:l.phoneNumber||null,photoURL:l.photoUrl||null}})}(_.providerUserInfo):[],E=function Wo(c,o){return[...c.filter(l=>!o.some(f=>f.providerId===l.providerId)),...o]}(c.providerData,I),Z=!!c.isAnonymous&&!(c.email&&_.passwordHash||null!=E&&E.length),U={uid:_.localId,displayName:_.displayName||null,photoURL:_.photoUrl||null,email:_.email||null,emailVerified:_.emailVerified||!1,phoneNumber:_.phoneNumber||null,tenantId:_.tenantId||null,providerData:E,metadata:new ze(_.createdAt,_.lastLoginAt),isAnonymous:Z};Object.assign(c,U)}),Nn.apply(this,arguments)}function ft(){return(ft=(0,v.Z)(function*(c){const o=(0,C.m9)(c);yield si(o),yield o.auth._persistUserIfCurrent(o),o.auth._notifyListenersIfCurrent(o)})).apply(this,arguments)}function rn(){return(rn=(0,v.Z)(function*(c,o){const u=yield Yu(c,{},(0,v.Z)(function*(){const l=(0,C.xO)({grant_type:"refresh_token",refresh_token:o}).slice(1),{tokenApiHost:f,apiKey:_}=c.config,I=fs(c,f,"/v1/token",`key=${_}`),E=yield c._getAdditionalHeaders();return E["Content-Type"]="application/x-www-form-urlencoded",Fo.fetch()(I,{method:"POST",headers:E,body:l})}));return{accessToken:u.access_token,expiresIn:u.expires_in,refreshToken:u.refresh_token}})).apply(this,arguments)}class pr{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(o){N(o.idToken,"internal-error"),N(typeof o.idToken<"u","internal-error"),N(typeof o.refreshToken<"u","internal-error");const u="expiresIn"in o&&typeof o.expiresIn<"u"?Number(o.expiresIn):function nn(c){const o=Se(c);return N(o,"internal-error"),N(typeof o.exp<"u","internal-error"),N(typeof o.iat<"u","internal-error"),Number(o.exp)-Number(o.iat)}(o.idToken);this.updateTokensAndExpiration(o.idToken,o.refreshToken,u)}getToken(o,u=!1){var l=this;return(0,v.Z)(function*(){return N(!l.accessToken||l.refreshToken,o,"user-token-expired"),u||!l.accessToken||l.isExpired?l.refreshToken?(yield l.refresh(o,l.refreshToken),l.accessToken):null:l.accessToken})()}clearRefreshToken(){this.refreshToken=null}refresh(o,u){var l=this;return(0,v.Z)(function*(){const{accessToken:f,refreshToken:_,expiresIn:I}=yield function ch(c,o){return rn.apply(this,arguments)}(o,u);l.updateTokensAndExpiration(f,_,Number(I))})()}updateTokensAndExpiration(o,u,l){this.refreshToken=u||null,this.accessToken=o||null,this.expirationTime=Date.now()+1e3*l}static fromJSON(o,u){const{refreshToken:l,accessToken:f,expirationTime:_}=u,I=new pr;return l&&(N("string"==typeof l,"internal-error",{appName:o}),I.refreshToken=l),f&&(N("string"==typeof f,"internal-error",{appName:o}),I.accessToken=f),_&&(N("number"==typeof _,"internal-error",{appName:o}),I.expirationTime=_),I}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(o){this.accessToken=o.accessToken,this.refreshToken=o.refreshToken,this.expirationTime=o.expirationTime}_clone(){return Object.assign(new pr,this.toJSON())}_performRefresh(){return Rt("not implemented")}}function St(c,o){N("string"==typeof c||typeof c>"u","internal-error",{appName:o})}class sn{constructor(o){var{uid:u,auth:l,stsTokenManager:f}=o,_=(0,p._T)(o,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new Ju(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=u,this.auth=l,this.stsTokenManager=f,this.accessToken=f.accessToken,this.displayName=_.displayName||null,this.email=_.email||null,this.emailVerified=_.emailVerified||!1,this.phoneNumber=_.phoneNumber||null,this.photoURL=_.photoURL||null,this.isAnonymous=_.isAnonymous||!1,this.tenantId=_.tenantId||null,this.providerData=_.providerData?[..._.providerData]:[],this.metadata=new ze(_.createdAt||void 0,_.lastLoginAt||void 0)}getIdToken(o){var u=this;return(0,v.Z)(function*(){const l=yield Wt(u,u.stsTokenManager.getToken(u.auth,o));return N(l,u.auth,"internal-error"),u.accessToken!==l&&(u.accessToken=l,yield u.auth._persistUserIfCurrent(u),u.auth._notifyListenersIfCurrent(u)),l})()}getIdTokenResult(o){return function ah(c){return Ue.apply(this,arguments)}(this,o)}reload(){return function gs(c){return ft.apply(this,arguments)}(this)}_assign(o){this!==o&&(N(this.uid===o.uid,this.auth,"internal-error"),this.displayName=o.displayName,this.photoURL=o.photoURL,this.email=o.email,this.emailVerified=o.emailVerified,this.phoneNumber=o.phoneNumber,this.isAnonymous=o.isAnonymous,this.tenantId=o.tenantId,this.providerData=o.providerData.map(u=>Object.assign({},u)),this.metadata._copy(o.metadata),this.stsTokenManager._assign(o.stsTokenManager))}_clone(o){const u=new sn(Object.assign(Object.assign({},this),{auth:o,stsTokenManager:this.stsTokenManager._clone()}));return u.metadata._copy(this.metadata),u}_onReload(o){N(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=o,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(o){this.reloadListener?this.reloadListener(o):this.reloadUserInfo=o}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}_updateTokensIfNecessary(o,u=!1){var l=this;return(0,v.Z)(function*(){let f=!1;o.idToken&&o.idToken!==l.stsTokenManager.accessToken&&(l.stsTokenManager.updateFromServerResponse(o),f=!0),u&&(yield si(l)),yield l.auth._persistUserIfCurrent(l),f&&l.auth._notifyListenersIfCurrent(l)})()}delete(){var o=this;return(0,v.Z)(function*(){const u=yield o.getIdToken();return yield Wt(o,function Go(c,o){return Q.apply(this,arguments)}(o.auth,{idToken:u})),o.stsTokenManager.clearRefreshToken(),o.auth.signOut()})()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(o=>Object.assign({},o)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(o,u){var l,f,_,I,E,S,L,Z;const U=null!==(l=u.displayName)&&void 0!==l?l:void 0,ye=null!==(f=u.email)&&void 0!==f?f:void 0,yt=null!==(_=u.phoneNumber)&&void 0!==_?_:void 0,Wi=null!==(I=u.photoURL)&&void 0!==I?I:void 0,sr=null!==(E=u.tenantId)&&void 0!==E?E:void 0,Ki=null!==(S=u._redirectEventId)&&void 0!==S?S:void 0,ho=null!==(L=u.createdAt)&&void 0!==L?L:void 0,fo=null!==(Z=u.lastLoginAt)&&void 0!==Z?Z:void 0,{uid:ji,emailVerified:_l,isAnonymous:yl,providerData:Pe,stsTokenManager:ne}=u;N(ji&&ne,o,"internal-error");const Il=pr.fromJSON(this.name,ne);N("string"==typeof ji,o,"internal-error"),St(U,o.name),St(ye,o.name),N("boolean"==typeof _l,o,"internal-error"),N("boolean"==typeof yl,o,"internal-error"),St(yt,o.name),St(Wi,o.name),St(sr,o.name),St(Ki,o.name),St(ho,o.name),St(fo,o.name);const po=new sn({uid:ji,auth:o,email:ye,emailVerified:_l,displayName:U,isAnonymous:yl,photoURL:Wi,phoneNumber:yt,tenantId:sr,stsTokenManager:Il,createdAt:ho,lastLoginAt:fo});return Pe&&Array.isArray(Pe)&&(po.providerData=Pe.map(mo=>Object.assign({},mo))),Ki&&(po._redirectEventId=Ki),po}static _fromIdTokenResponse(o,u,l=!1){return(0,v.Z)(function*(){const f=new pr;f.updateFromServerResponse(u);const _=new sn({uid:u.localId,auth:o,stsTokenManager:f,isAnonymous:l});return yield si(_),_})()}}const Xu=new Map;function Xe(c){ht(c instanceof Function,"Expected a class definition");let o=Xu.get(c);return o?(ht(o instanceof c,"Instance stored in cache mismatched with class"),o):(o=new c,Xu.set(c,o),o)}const on=(()=>{class c{constructor(){this.type="NONE",this.storage={}}_isAvailable(){return(0,v.Z)(function*(){return!0})()}_set(u,l){var f=this;return(0,v.Z)(function*(){f.storage[u]=l})()}_get(u){var l=this;return(0,v.Z)(function*(){const f=l.storage[u];return void 0===f?null:f})()}_remove(u){var l=this;return(0,v.Z)(function*(){delete l.storage[u]})()}_addListener(u,l){}_removeListener(u,l){}}return c.type="NONE",c})();function Kt(c,o,u){return`firebase:${c}:${o}:${u}`}class an{constructor(o,u,l){this.persistence=o,this.auth=u,this.userKey=l;const{config:f,name:_}=this.auth;this.fullUserKey=Kt(this.userKey,f.apiKey,_),this.fullPersistenceKey=Kt("persistence",f.apiKey,_),this.boundEventHandler=u._onStorageEvent.bind(u),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(o){return this.persistence._set(this.fullUserKey,o.toJSON())}getCurrentUser(){var o=this;return(0,v.Z)(function*(){const u=yield o.persistence._get(o.fullUserKey);return u?sn._fromJSON(o.auth,u):null})()}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}setPersistence(o){var u=this;return(0,v.Z)(function*(){if(u.persistence===o)return;const l=yield u.getCurrentUser();return yield u.removeCurrentUser(),u.persistence=o,l?u.setCurrentUser(l):void 0})()}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static create(o,u,l="authUser"){return(0,v.Z)(function*(){if(!u.length)return new an(Xe(on),o,l);const f=(yield Promise.all(u.map(function(){var L=(0,v.Z)(function*(Z){if(yield Z._isAvailable())return Z});return function(Z){return L.apply(this,arguments)}}()))).filter(L=>L);let _=f[0]||Xe(on);const I=Kt(l,o.config.apiKey,o.name);let E=null;for(const L of u)try{const Z=yield L._get(I);if(Z){const U=sn._fromJSON(o,Z);L!==_&&(E=U),_=L;break}}catch{}const S=f.filter(L=>L._shouldAllowMigration);return _._shouldAllowMigration&&S.length?(_=S[0],E&&(yield _._set(I,E.toJSON())),yield Promise.all(u.map(function(){var L=(0,v.Z)(function*(Z){if(Z!==_)try{yield Z._remove(I)}catch{}});return function(Z){return L.apply(this,arguments)}}())),new an(_,o,l)):new an(_,o,l)})()}}function _s(c){const o=c.toLowerCase();if(o.includes("opera/")||o.includes("opr/")||o.includes("opios/"))return"Opera";if(tc(o))return"IEMobile";if(o.includes("msie")||o.includes("trident/"))return"IE";if(o.includes("edge/"))return"Edge";if(Ko(o))return"Firefox";if(o.includes("silk/"))return"Silk";if(nc(o))return"Blackberry";if(rc(o))return"Webos";if(jo(o))return"Safari";if((o.includes("chrome/")||mr(o))&&!o.includes("edge/"))return"Chrome";if(jt(o))return"Android";{const l=c.match(/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/);if(2===(null==l?void 0:l.length))return l[1]}return"Other"}function Ko(c=(0,C.z$)()){return/firefox\//i.test(c)}function jo(c=(0,C.z$)()){const o=c.toLowerCase();return o.includes("safari/")&&!o.includes("chrome/")&&!o.includes("crios/")&&!o.includes("android")}function mr(c=(0,C.z$)()){return/crios\//i.test(c)}function tc(c=(0,C.z$)()){return/iemobile/i.test(c)}function jt(c=(0,C.z$)()){return/android/i.test(c)}function nc(c=(0,C.z$)()){return/blackberry/i.test(c)}function rc(c=(0,C.z$)()){return/webos/i.test(c)}function $t(c=(0,C.z$)()){return/iphone|ipad|ipod/i.test(c)||/macintosh/i.test(c)&&/mobile/i.test(c)}function Ho(c=(0,C.z$)()){return $t(c)||jt(c)||rc(c)||nc(c)||/windows phone/i.test(c)||tc(c)}function oi(c,o=[]){let u;switch(c){case"Browser":u=_s((0,C.z$)());break;case"Worker":u=`${_s((0,C.z$)())}-${c}`;break;default:u=c}const l=o.length?o.join(","):"FirebaseCore-web";return`${u}/JsCore/${lt.SDK_VERSION}/${l}`}class Qo{constructor(o){this.auth=o,this.queue=[]}pushCallback(o,u){const l=_=>new Promise((I,E)=>{try{I(o(_))}catch(S){E(S)}});l.onAbort=u,this.queue.push(l);const f=this.queue.length-1;return()=>{this.queue[f]=()=>Promise.resolve()}}runMiddleware(o){var u=this;return(0,v.Z)(function*(){if(u.auth.currentUser===o)return;const l=[];try{for(const f of u.queue)yield f(o),f.onAbort&&l.push(f.onAbort)}catch(f){l.reverse();for(const _ of l)try{_()}catch{}throw u.auth._errorFactory.create("login-blocked",{originalMessage:null==f?void 0:f.message})}})()}}function ai(){return(ai=(0,v.Z)(function*(c,o={}){return ge(c,"GET","/v2/passwordPolicy",de(c,o))})).apply(this,arguments)}class oc{constructor(o){var u,l,f,_;const I=o.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=null!==(u=I.minPasswordLength)&&void 0!==u?u:6,I.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=I.maxPasswordLength),void 0!==I.containsLowercaseCharacter&&(this.customStrengthOptions.containsLowercaseLetter=I.containsLowercaseCharacter),void 0!==I.containsUppercaseCharacter&&(this.customStrengthOptions.containsUppercaseLetter=I.containsUppercaseCharacter),void 0!==I.containsNumericCharacter&&(this.customStrengthOptions.containsNumericCharacter=I.containsNumericCharacter),void 0!==I.containsNonAlphanumericCharacter&&(this.customStrengthOptions.containsNonAlphanumericCharacter=I.containsNonAlphanumericCharacter),this.enforcementState=o.enforcementState,"ENFORCEMENT_STATE_UNSPECIFIED"===this.enforcementState&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=null!==(f=null===(l=o.allowedNonAlphanumericCharacters)||void 0===l?void 0:l.join(""))&&void 0!==f?f:"",this.forceUpgradeOnSignin=null!==(_=o.forceUpgradeOnSignin)&&void 0!==_&&_,this.schemaVersion=o.schemaVersion}validatePassword(o){var u,l,f,_,I,E;const S={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(o,S),this.validatePasswordCharacterOptions(o,S),S.isValid&&(S.isValid=null===(u=S.meetsMinPasswordLength)||void 0===u||u),S.isValid&&(S.isValid=null===(l=S.meetsMaxPasswordLength)||void 0===l||l),S.isValid&&(S.isValid=null===(f=S.containsLowercaseLetter)||void 0===f||f),S.isValid&&(S.isValid=null===(_=S.containsUppercaseLetter)||void 0===_||_),S.isValid&&(S.isValid=null===(I=S.containsNumericCharacter)||void 0===I||I),S.isValid&&(S.isValid=null===(E=S.containsNonAlphanumericCharacter)||void 0===E||E),S}validatePasswordLengthOptions(o,u){const l=this.customStrengthOptions.minPasswordLength,f=this.customStrengthOptions.maxPasswordLength;l&&(u.meetsMinPasswordLength=o.length>=l),f&&(u.meetsMaxPasswordLength=o.length<=f)}validatePasswordCharacterOptions(o,u){let l;this.updatePasswordCharacterOptionsStatuses(u,!1,!1,!1,!1);for(let f=0;f<o.length;f++)l=o.charAt(f),this.updatePasswordCharacterOptionsStatuses(u,l>="a"&&l<="z",l>="A"&&l<="Z",l>="0"&&l<="9",this.allowedNonAlphanumericCharacters.includes(l))}updatePasswordCharacterOptionsStatuses(o,u,l,f,_){this.customStrengthOptions.containsLowercaseLetter&&(o.containsLowercaseLetter||(o.containsLowercaseLetter=u)),this.customStrengthOptions.containsUppercaseLetter&&(o.containsUppercaseLetter||(o.containsUppercaseLetter=l)),this.customStrengthOptions.containsNumericCharacter&&(o.containsNumericCharacter||(o.containsNumericCharacter=f)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(o.containsNonAlphanumericCharacter||(o.containsNonAlphanumericCharacter=_))}}class ac{constructor(o,u,l,f){this.app=o,this.heartbeatServiceProvider=u,this.appCheckServiceProvider=l,this.config=f,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Xo(this),this.idTokenSubscription=new Xo(this),this.beforeStateQueue=new Qo(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=us,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=o.name,this.clientVersion=f.sdkClientVersion}_initializeWithPersistence(o,u){var l=this;return u&&(this._popupRedirectResolver=Xe(u)),this._initializationPromise=this.queue((0,v.Z)(function*(){var f,_;if(!l._deleted&&(l.persistenceManager=yield an.create(l,o),!l._deleted)){if(null!==(f=l._popupRedirectResolver)&&void 0!==f&&f._shouldInitProactively)try{yield l._popupRedirectResolver._initialize(l)}catch{}yield l.initializeCurrentUser(u),l.lastNotifiedUid=(null===(_=l.currentUser)||void 0===_?void 0:_.uid)||null,!l._deleted&&(l._isInitialized=!0)}})),this._initializationPromise}_onStorageEvent(){var o=this;return(0,v.Z)(function*(){if(o._deleted)return;const u=yield o.assertedPersistence.getCurrentUser();if(o.currentUser||u){if(o.currentUser&&u&&o.currentUser.uid===u.uid)return o._currentUser._assign(u),void(yield o.currentUser.getIdToken());yield o._updateCurrentUser(u,!0)}})()}initializeCurrentUser(o){var u=this;return(0,v.Z)(function*(){var l;const f=yield u.assertedPersistence.getCurrentUser();let _=f,I=!1;if(o&&u.config.authDomain){yield u.getOrInitRedirectPersistenceManager();const E=null===(l=u.redirectUser)||void 0===l?void 0:l._redirectEventId,S=null==_?void 0:_._redirectEventId,L=yield u.tryRedirectSignIn(o);(!E||E===S)&&null!=L&&L.user&&(_=L.user,I=!0)}if(!_)return u.directlySetCurrentUser(null);if(!_._redirectEventId){if(I)try{yield u.beforeStateQueue.runMiddleware(_)}catch(E){_=f,u._popupRedirectResolver._overrideRedirectResult(u,()=>Promise.reject(E))}return _?u.reloadAndSetCurrentUserOrClear(_):u.directlySetCurrentUser(null)}return N(u._popupRedirectResolver,u,"argument-error"),yield u.getOrInitRedirectPersistenceManager(),u.redirectUser&&u.redirectUser._redirectEventId===_._redirectEventId?u.directlySetCurrentUser(_):u.reloadAndSetCurrentUserOrClear(_)})()}tryRedirectSignIn(o){var u=this;return(0,v.Z)(function*(){let l=null;try{l=yield u._popupRedirectResolver._completeRedirectFn(u,o,!0)}catch{yield u._setRedirectUser(null)}return l})()}reloadAndSetCurrentUserOrClear(o){var u=this;return(0,v.Z)(function*(){try{yield si(o)}catch(l){if("auth/network-request-failed"!==(null==l?void 0:l.code))return u.directlySetCurrentUser(null)}return u.directlySetCurrentUser(o)})()}useDeviceLanguage(){this.languageCode=function ju(){if(typeof navigator>"u")return null;const c=navigator;return c.languages&&c.languages[0]||c.language||null}()}_delete(){var o=this;return(0,v.Z)(function*(){o._deleted=!0})()}updateCurrentUser(o){var u=this;return(0,v.Z)(function*(){const l=o?(0,C.m9)(o):null;return l&&N(l.auth.config.apiKey===u.config.apiKey,u,"invalid-user-token"),u._updateCurrentUser(l&&l._clone(u))})()}_updateCurrentUser(o,u=!1){var l=this;return(0,v.Z)(function*(){if(!l._deleted)return o&&N(l.tenantId===o.tenantId,l,"tenant-id-mismatch"),u||(yield l.beforeStateQueue.runMiddleware(o)),l.queue((0,v.Z)(function*(){yield l.directlySetCurrentUser(o),l.notifyAuthListeners()}))})()}signOut(){var o=this;return(0,v.Z)(function*(){return yield o.beforeStateQueue.runMiddleware(null),(o.redirectPersistenceManager||o._popupRedirectResolver)&&(yield o._setRedirectUser(null)),o._updateCurrentUser(null,!0)})()}setPersistence(o){var u=this;return this.queue((0,v.Z)(function*(){yield u.assertedPersistence.setPersistence(Xe(o))}))}_getRecaptchaConfig(){return null==this.tenantId?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}validatePassword(o){var u=this;return(0,v.Z)(function*(){u._getPasswordPolicyInternal()||(yield u._updatePasswordPolicy());const l=u._getPasswordPolicyInternal();return l.schemaVersion!==u.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(u._errorFactory.create("unsupported-password-policy-schema-version",{})):l.validatePassword(o)})()}_getPasswordPolicyInternal(){return null===this.tenantId?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}_updatePasswordPolicy(){var o=this;return(0,v.Z)(function*(){const u=yield function Yo(c){return ai.apply(this,arguments)}(o),l=new oc(u);null===o.tenantId?o._projectPasswordPolicy=l:o._tenantPasswordPolicies[o.tenantId]=l})()}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(o){this._errorFactory=new C.LL("auth","Firebase",o())}onAuthStateChanged(o,u,l){return this.registerStateListener(this.authStateSubscription,o,u,l)}beforeAuthStateChanged(o,u){return this.beforeStateQueue.pushCallback(o,u)}onIdTokenChanged(o,u,l){return this.registerStateListener(this.idTokenSubscription,o,u,l)}authStateReady(){return new Promise((o,u)=>{if(this.currentUser)o();else{const l=this.onAuthStateChanged(()=>{l(),o()},u)}})}toJSON(){var o;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:null===(o=this._currentUser)||void 0===o?void 0:o.toJSON()}}_setRedirectUser(o,u){var l=this;return(0,v.Z)(function*(){const f=yield l.getOrInitRedirectPersistenceManager(u);return null===o?f.removeCurrentUser():f.setCurrentUser(o)})()}getOrInitRedirectPersistenceManager(o){var u=this;return(0,v.Z)(function*(){if(!u.redirectPersistenceManager){const l=o&&Xe(o)||u._popupRedirectResolver;N(l,u,"argument-error"),u.redirectPersistenceManager=yield an.create(u,[Xe(l._redirectPersistence)],"redirectUser"),u.redirectUser=yield u.redirectPersistenceManager.getCurrentUser()}return u.redirectPersistenceManager})()}_redirectUserForId(o){var u=this;return(0,v.Z)(function*(){var l,f;return u._isInitialized&&(yield u.queue((0,v.Z)(function*(){}))),(null===(l=u._currentUser)||void 0===l?void 0:l._redirectEventId)===o?u._currentUser:(null===(f=u.redirectUser)||void 0===f?void 0:f._redirectEventId)===o?u.redirectUser:null})()}_persistUserIfCurrent(o){var u=this;return(0,v.Z)(function*(){if(o===u.currentUser)return u.queue((0,v.Z)(function*(){return u.directlySetCurrentUser(o)}))})()}_notifyListenersIfCurrent(o){o===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var o,u;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const l=null!==(u=null===(o=this.currentUser)||void 0===o?void 0:o.uid)&&void 0!==u?u:null;this.lastNotifiedUid!==l&&(this.lastNotifiedUid=l,this.authStateSubscription.next(this.currentUser))}registerStateListener(o,u,l,f){if(this._deleted)return()=>{};const _="function"==typeof u?u:u.next.bind(u);let I=!1;const E=this._isInitialized?Promise.resolve():this._initializationPromise;if(N(E,this,"internal-error"),E.then(()=>{I||_(this.currentUser)}),"function"==typeof u){const S=o.addObserver(u,l,f);return()=>{I=!0,S()}}{const S=o.addObserver(u);return()=>{I=!0,S()}}}directlySetCurrentUser(o){var u=this;return(0,v.Z)(function*(){u.currentUser&&u.currentUser!==o&&u._currentUser._stopProactiveRefresh(),o&&u.isProactiveRefreshEnabled&&o._startProactiveRefresh(),u.currentUser=o,o?yield u.assertedPersistence.setCurrentUser(o):yield u.assertedPersistence.removeCurrentUser()})()}queue(o){return this.operations=this.operations.then(o,o),this.operations}get assertedPersistence(){return N(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(o){!o||this.frameworks.includes(o)||(this.frameworks.push(o),this.frameworks.sort(),this.clientVersion=oi(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}_getAdditionalHeaders(){var o=this;return(0,v.Z)(function*(){var u;const l={"X-Client-Version":o.clientVersion};o.app.options.appId&&(l["X-Firebase-gmpid"]=o.app.options.appId);const f=yield null===(u=o.heartbeatServiceProvider.getImmediate({optional:!0}))||void 0===u?void 0:u.getHeartbeatsHeader();f&&(l["X-Firebase-Client"]=f);const _=yield o._getAppCheckToken();return _&&(l["X-Firebase-AppCheck"]=_),l})()}_getAppCheckToken(){var o=this;return(0,v.Z)(function*(){var u;const l=yield null===(u=o.appCheckServiceProvider.getImmediate({optional:!0}))||void 0===u?void 0:u.getToken();return null!=l&&l.error&&function ls(c,...o){cs.logLevel<=R.in.WARN&&cs.warn(`Auth (${lt.SDK_VERSION}): ${c}`,...o)}(`Error while retrieving App Check token: ${l.error}`),null==l?void 0:l.token})()}}function _e(c){return(0,C.m9)(c)}class Xo{constructor(o){this.auth=o,this.observer=null,this.addObserver=(0,C.ne)(u=>this.observer=u)}get next(){return N(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}function ui(c){return new Promise((o,u)=>{const l=document.createElement("script");l.setAttribute("src",c),l.onload=o,l.onerror=f=>{const _=Ge("internal-error");_.customData=f,u(_)},l.type="text/javascript",l.charset="UTF-8",function uc(){var c,o;return null!==(o=null===(c=document.getElementsByTagName("head"))||void 0===c?void 0:c[0])&&void 0!==o?o:document}().appendChild(l)})}function ea(c){return`__${c}${Math.floor(1e6*Math.random())}`}class ys{constructor(o){this.type="recaptcha-enterprise",this.auth=_e(o)}verify(o="verify",u=!1){var l=this;return(0,v.Z)(function*(){function _(){return _=(0,v.Z)(function*(E){if(!u){if(null==E.tenantId&&null!=E._agentRecaptchaConfig)return E._agentRecaptchaConfig.siteKey;if(null!=E.tenantId&&void 0!==E._tenantRecaptchaConfigs[E.tenantId])return E._tenantRecaptchaConfigs[E.tenantId].siteKey}return new Promise(function(){var S=(0,v.Z)(function*(L,Z){dt(E,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(U=>{if(void 0!==U.recaptchaKey){const ye=new vt(U);return null==E.tenantId?E._agentRecaptchaConfig=ye:E._tenantRecaptchaConfigs[E.tenantId]=ye,L(ye.siteKey)}Z(new Error("recaptcha Enterprise site key undefined"))}).catch(U=>{Z(U)})});return function(L,Z){return S.apply(this,arguments)}}())}),_.apply(this,arguments)}function I(E,S,L){const Z=window.grecaptcha;Bo(Z)?Z.enterprise.ready(()=>{Z.enterprise.execute(E,{action:o}).then(U=>{S(U)}).catch(()=>{S("NO_RECAPTCHA")})}):L(Error("No reCAPTCHA enterprise script loaded."))}return new Promise((E,S)=>{(function f(E){return _.apply(this,arguments)})(l.auth).then(L=>{if(!u&&Bo(window.grecaptcha))I(L,E,S);else{if(typeof window>"u")return void S(new Error("RecaptchaVerifier is only supported in browser"));ui("https://www.google.com/recaptcha/enterprise.js?render="+L).then(()=>{I(L,E,S)}).catch(Z=>{S(Z)})}}).catch(L=>{S(L)})})})()}}function Ne(c,o,u){return Ve.apply(this,arguments)}function Ve(){return(Ve=(0,v.Z)(function*(c,o,u,l=!1){const f=new ys(c);let _;try{_=yield f.verify(u)}catch{_=yield f.verify(u,!0)}const I=Object.assign({},o);return Object.assign(I,l?{captchaResp:_}:{captchaResponse:_}),Object.assign(I,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(I,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),I})).apply(this,arguments)}function Vn(c,o,u,l){return ci.apply(this,arguments)}function ci(){return ci=(0,v.Z)(function*(c,o,u,l){var f;if(null!==(f=c._getRecaptchaConfig())&&void 0!==f&&f.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const _=yield Ne(c,o,u,"getOobCode"===u);return l(c,_)}return l(c,o).catch(function(){var _=(0,v.Z)(function*(I){if("auth/missing-recaptcha-token"===I.code){console.log(`${u} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const E=yield Ne(c,o,u,"getOobCode"===u);return l(c,E)}return Promise.reject(I)});return function(I){return _.apply(this,arguments)}}())}),ci.apply(this,arguments)}function hc(c){const o=c.indexOf(":");return o<0?"":c.substr(0,o+1)}function gr(c){if(!c)return null;const o=Number(c);return isNaN(o)?null:o}class un{constructor(o,u){this.providerId=o,this.signInMethod=u}toJSON(){return Rt("not implemented")}_getIdTokenResponse(o){return Rt("not implemented")}_linkToIdToken(o,u){return Rt("not implemented")}_getReauthenticationResolver(o){return Rt("not implemented")}}function ia(c,o){return sa.apply(this,arguments)}function sa(){return(sa=(0,v.Z)(function*(c,o){return ge(c,"POST","/v1/accounts:resetPassword",de(c,o))})).apply(this,arguments)}function hi(c,o){return di.apply(this,arguments)}function di(){return(di=(0,v.Z)(function*(c,o){return ge(c,"POST","/v1/accounts:update",o)})).apply(this,arguments)}function Is(){return(Is=(0,v.Z)(function*(c,o){return ge(c,"POST","/v1/accounts:update",de(c,o))})).apply(this,arguments)}function mh(c,o){return Dn.apply(this,arguments)}function Dn(){return(Dn=(0,v.Z)(function*(c,o){return zt(c,"POST","/v1/accounts:signInWithPassword",de(c,o))})).apply(this,arguments)}function fi(c,o){return vs.apply(this,arguments)}function vs(){return(vs=(0,v.Z)(function*(c,o){return ge(c,"POST","/v1/accounts:sendOobCode",de(c,o))})).apply(this,arguments)}function _r(){return(_r=(0,v.Z)(function*(c,o){return fi(c,o)})).apply(this,arguments)}function gh(c,o){return aa.apply(this,arguments)}function aa(){return(aa=(0,v.Z)(function*(c,o){return fi(c,o)})).apply(this,arguments)}function yr(c,o){return ua.apply(this,arguments)}function ua(){return(ua=(0,v.Z)(function*(c,o){return fi(c,o)})).apply(this,arguments)}function Ht(){return(Ht=(0,v.Z)(function*(c,o){return fi(c,o)})).apply(this,arguments)}function Ir(){return(Ir=(0,v.Z)(function*(c,o){return zt(c,"POST","/v1/accounts:signInWithEmailLink",de(c,o))})).apply(this,arguments)}function On(){return(On=(0,v.Z)(function*(c,o){return zt(c,"POST","/v1/accounts:signInWithEmailLink",de(c,o))})).apply(this,arguments)}class vr extends un{constructor(o,u,l,f=null){super("password",l),this._email=o,this._password=u,this._tenantId=f}static _fromEmailAndPassword(o,u){return new vr(o,u,"password")}static _fromEmailAndCode(o,u,l=null){return new vr(o,u,"emailLink",l)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(o){const u="string"==typeof o?JSON.parse(o):o;if(null!=u&&u.email&&null!=u&&u.password){if("password"===u.signInMethod)return this._fromEmailAndPassword(u.email,u.password);if("emailLink"===u.signInMethod)return this._fromEmailAndCode(u.email,u.password,u.tenantId)}return null}_getIdTokenResponse(o){var u=this;return(0,v.Z)(function*(){switch(u.signInMethod){case"password":return Vn(o,{returnSecureToken:!0,email:u._email,password:u._password,clientType:"CLIENT_TYPE_WEB"},"signInWithPassword",mh);case"emailLink":return function fc(c,o){return Ir.apply(this,arguments)}(o,{email:u._email,oobCode:u._password});default:oe(o,"internal-error")}})()}_linkToIdToken(o,u){var l=this;return(0,v.Z)(function*(){switch(l.signInMethod){case"password":return hi(o,{idToken:u,returnSecureToken:!0,email:l._email,password:l._password});case"emailLink":return function pc(c,o){return On.apply(this,arguments)}(o,{idToken:u,email:l._email,oobCode:l._password});default:oe(o,"internal-error")}})()}_getReauthenticationResolver(o){return this._getIdTokenResponse(o)}}function ve(c,o){return Ts.apply(this,arguments)}function Ts(){return(Ts=(0,v.Z)(function*(c,o){return zt(c,"POST","/v1/accounts:signInWithIdp",de(c,o))})).apply(this,arguments)}class rt extends un{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(o){const u=new rt(o.providerId,o.signInMethod);return o.idToken||o.accessToken?(o.idToken&&(u.idToken=o.idToken),o.accessToken&&(u.accessToken=o.accessToken),o.nonce&&!o.pendingToken&&(u.nonce=o.nonce),o.pendingToken&&(u.pendingToken=o.pendingToken)):o.oauthToken&&o.oauthTokenSecret?(u.accessToken=o.oauthToken,u.secret=o.oauthTokenSecret):oe("argument-error"),u}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(o){const u="string"==typeof o?JSON.parse(o):o,{providerId:l,signInMethod:f}=u,_=(0,p._T)(u,["providerId","signInMethod"]);if(!l||!f)return null;const I=new rt(l,f);return I.idToken=_.idToken||void 0,I.accessToken=_.accessToken||void 0,I.secret=_.secret,I.nonce=_.nonce,I.pendingToken=_.pendingToken||null,I}_getIdTokenResponse(o){return ve(o,this.buildRequest())}_linkToIdToken(o,u){const l=this.buildRequest();return l.idToken=u,ve(o,l)}_getReauthenticationResolver(o){const u=this.buildRequest();return u.autoCreate=!1,ve(o,u)}buildRequest(){const o={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)o.pendingToken=this.pendingToken;else{const u={};this.idToken&&(u.id_token=this.idToken),this.accessToken&&(u.access_token=this.accessToken),this.secret&&(u.oauth_token_secret=this.secret),u.providerId=this.providerId,this.nonce&&!this.pendingToken&&(u.nonce=this.nonce),o.postBody=(0,C.xO)(u)}return o}}function mi(){return(mi=(0,v.Z)(function*(c,o){return ge(c,"POST","/v1/accounts:sendVerificationCode",de(c,o))})).apply(this,arguments)}function Es(){return(Es=(0,v.Z)(function*(c,o){return zt(c,"POST","/v1/accounts:signInWithPhoneNumber",de(c,o))})).apply(this,arguments)}function _i(){return(_i=(0,v.Z)(function*(c,o){const u=yield zt(c,"POST","/v1/accounts:signInWithPhoneNumber",de(c,o));if(u.temporaryProof)throw ti(c,"account-exists-with-different-credential",u);return u})).apply(this,arguments)}const ca={USER_NOT_FOUND:"user-not-found"};function Tr(){return(Tr=(0,v.Z)(function*(c,o){return zt(c,"POST","/v1/accounts:signInWithPhoneNumber",de(c,Object.assign(Object.assign({},o),{operation:"REAUTH"})),ca)})).apply(this,arguments)}class Tt extends un{constructor(o){super("phone","phone"),this.params=o}static _fromVerification(o,u){return new Tt({verificationId:o,verificationCode:u})}static _fromTokenResponse(o,u){return new Tt({phoneNumber:o,temporaryProof:u})}_getIdTokenResponse(o){return function gc(c,o){return Es.apply(this,arguments)}(o,this._makeVerificationRequest())}_linkToIdToken(o,u){return function gi(c,o){return _i.apply(this,arguments)}(o,Object.assign({idToken:u},this._makeVerificationRequest()))}_getReauthenticationResolver(o){return function la(c,o){return Tr.apply(this,arguments)}(o,this._makeVerificationRequest())}_makeVerificationRequest(){const{temporaryProof:o,phoneNumber:u,verificationId:l,verificationCode:f}=this.params;return o&&u?{temporaryProof:o,phoneNumber:u}:{sessionInfo:l,code:f}}toJSON(){const o={providerId:this.providerId};return this.params.phoneNumber&&(o.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(o.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(o.verificationCode=this.params.verificationCode),this.params.verificationId&&(o.verificationId=this.params.verificationId),o}static fromJSON(o){"string"==typeof o&&(o=JSON.parse(o));const{verificationId:u,verificationCode:l,phoneNumber:f,temporaryProof:_}=o;return l||u||f||_?new Tt({verificationId:u,verificationCode:l,phoneNumber:f,temporaryProof:_}):null}}class Mn{constructor(o){var u,l,f,_,I,E;const S=(0,C.zd)((0,C.pd)(o)),L=null!==(u=S.apiKey)&&void 0!==u?u:null,Z=null!==(l=S.oobCode)&&void 0!==l?l:null,U=function _c(c){switch(c){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}(null!==(f=S.mode)&&void 0!==f?f:null);N(L&&Z&&U,"argument-error"),this.apiKey=L,this.operation=U,this.code=Z,this.continueUrl=null!==(_=S.continueUrl)&&void 0!==_?_:null,this.languageCode=null!==(I=S.languageCode)&&void 0!==I?I:null,this.tenantId=null!==(E=S.tenantId)&&void 0!==E?E:null}static parseLink(o){const u=function yh(c){const o=(0,C.zd)((0,C.pd)(c)).link,u=o?(0,C.zd)((0,C.pd)(o)).deep_link_id:null,l=(0,C.zd)((0,C.pd)(c)).deep_link_id;return(l?(0,C.zd)((0,C.pd)(l)).link:null)||l||u||o||c}(o);try{return new Mn(u)}catch{return null}}}let yi=(()=>{class c{constructor(){this.providerId=c.PROVIDER_ID}static credential(u,l){return vr._fromEmailAndPassword(u,l)}static credentialWithLink(u,l){const f=Mn.parseLink(l);return N(f,"argument-error"),vr._fromEmailAndCode(u,f.code,f.tenantId)}}return c.PROVIDER_ID="password",c.EMAIL_PASSWORD_SIGN_IN_METHOD="password",c.EMAIL_LINK_SIGN_IN_METHOD="emailLink",c})();class Ct{constructor(o){this.providerId=o,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(o){this.defaultLanguageCode=o}setCustomParameters(o){return this.customParameters=o,this}getCustomParameters(){return this.customParameters}}class Ln extends Ct{constructor(){super(...arguments),this.scopes=[]}addScope(o){return this.scopes.includes(o)||this.scopes.push(o),this}getScopes(){return[...this.scopes]}}class Fn extends Ln{static credentialFromJSON(o){const u="string"==typeof o?JSON.parse(o):o;return N("providerId"in u&&"signInMethod"in u,"argument-error"),rt._fromParams(u)}credential(o){return this._credential(Object.assign(Object.assign({},o),{nonce:o.rawNonce}))}_credential(o){return N(o.idToken||o.accessToken,"argument-error"),rt._fromParams(Object.assign(Object.assign({},o),{providerId:this.providerId,signInMethod:this.providerId}))}static credentialFromResult(o){return Fn.oauthCredentialFromTaggedObject(o)}static credentialFromError(o){return Fn.oauthCredentialFromTaggedObject(o.customData||{})}static oauthCredentialFromTaggedObject({_tokenResponse:o}){if(!o)return null;const{oauthIdToken:u,oauthAccessToken:l,oauthTokenSecret:f,pendingToken:_,nonce:I,providerId:E}=o;if(!l&&!f&&!u&&!_||!E)return null;try{return new Fn(E)._credential({idToken:u,accessToken:l,nonce:I,pendingToken:_})}catch{return null}}}let yc=(()=>{class c extends Ln{constructor(){super("facebook.com")}static credential(u){return rt._fromParams({providerId:c.PROVIDER_ID,signInMethod:c.FACEBOOK_SIGN_IN_METHOD,accessToken:u})}static credentialFromResult(u){return c.credentialFromTaggedObject(u)}static credentialFromError(u){return c.credentialFromTaggedObject(u.customData||{})}static credentialFromTaggedObject({_tokenResponse:u}){if(!u||!("oauthAccessToken"in u)||!u.oauthAccessToken)return null;try{return c.credential(u.oauthAccessToken)}catch{return null}}}return c.FACEBOOK_SIGN_IN_METHOD="facebook.com",c.PROVIDER_ID="facebook.com",c})(),Er=(()=>{class c extends Ln{constructor(){super("google.com"),this.addScope("profile")}static credential(u,l){return rt._fromParams({providerId:c.PROVIDER_ID,signInMethod:c.GOOGLE_SIGN_IN_METHOD,idToken:u,accessToken:l})}static credentialFromResult(u){return c.credentialFromTaggedObject(u)}static credentialFromError(u){return c.credentialFromTaggedObject(u.customData||{})}static credentialFromTaggedObject({_tokenResponse:u}){if(!u)return null;const{oauthIdToken:l,oauthAccessToken:f}=u;if(!l&&!f)return null;try{return c.credential(l,f)}catch{return null}}}return c.GOOGLE_SIGN_IN_METHOD="google.com",c.PROVIDER_ID="google.com",c})(),da=(()=>{class c extends Ln{constructor(){super("github.com")}static credential(u){return rt._fromParams({providerId:c.PROVIDER_ID,signInMethod:c.GITHUB_SIGN_IN_METHOD,accessToken:u})}static credentialFromResult(u){return c.credentialFromTaggedObject(u)}static credentialFromError(u){return c.credentialFromTaggedObject(u.customData||{})}static credentialFromTaggedObject({_tokenResponse:u}){if(!u||!("oauthAccessToken"in u)||!u.oauthAccessToken)return null;try{return c.credential(u.oauthAccessToken)}catch{return null}}}return c.GITHUB_SIGN_IN_METHOD="github.com",c.PROVIDER_ID="github.com",c})();class bt extends un{constructor(o,u){super(o,o),this.pendingToken=u}_getIdTokenResponse(o){return ve(o,this.buildRequest())}_linkToIdToken(o,u){const l=this.buildRequest();return l.idToken=u,ve(o,l)}_getReauthenticationResolver(o){const u=this.buildRequest();return u.autoCreate=!1,ve(o,u)}toJSON(){return{signInMethod:this.signInMethod,providerId:this.providerId,pendingToken:this.pendingToken}}static fromJSON(o){const u="string"==typeof o?JSON.parse(o):o,{providerId:l,signInMethod:f,pendingToken:_}=u;return l&&f&&_&&l===f?new bt(l,_):null}static _create(o,u){return new bt(o,u)}buildRequest(){return{requestUri:"http://localhost",returnSecureToken:!0,pendingToken:this.pendingToken}}}class Ar extends Ct{constructor(o){N(o.startsWith("saml."),"argument-error"),super(o)}static credentialFromResult(o){return Ar.samlCredentialFromTaggedObject(o)}static credentialFromError(o){return Ar.samlCredentialFromTaggedObject(o.customData||{})}static credentialFromJSON(o){const u=bt.fromJSON(o);return N(u,"argument-error"),u}static samlCredentialFromTaggedObject({_tokenResponse:o}){if(!o)return null;const{pendingToken:u,providerId:l}=o;if(!u||!l)return null;try{return bt._create(l,u)}catch{return null}}}let Ic=(()=>{class c extends Ln{constructor(){super("twitter.com")}static credential(u,l){return rt._fromParams({providerId:c.PROVIDER_ID,signInMethod:c.TWITTER_SIGN_IN_METHOD,oauthToken:u,oauthTokenSecret:l})}static credentialFromResult(u){return c.credentialFromTaggedObject(u)}static credentialFromError(u){return c.credentialFromTaggedObject(u.customData||{})}static credentialFromTaggedObject({_tokenResponse:u}){if(!u)return null;const{oauthAccessToken:l,oauthTokenSecret:f}=u;if(!l||!f)return null;try{return c.credential(l,f)}catch{return null}}}return c.TWITTER_SIGN_IN_METHOD="twitter.com",c.PROVIDER_ID="twitter.com",c})();function vc(c,o){return ws.apply(this,arguments)}function ws(){return(ws=(0,v.Z)(function*(c,o){return zt(c,"POST","/v1/accounts:signUp",de(c,o))})).apply(this,arguments)}class it{constructor(o){this.user=o.user,this.providerId=o.providerId,this._tokenResponse=o._tokenResponse,this.operationType=o.operationType}static _fromIdTokenResponse(o,u,l,f=!1){return(0,v.Z)(function*(){const _=yield sn._fromIdTokenResponse(o,l,f),I=Tc(l);return new it({user:_,providerId:I,_tokenResponse:l,operationType:u})})()}static _forOperation(o,u,l){return(0,v.Z)(function*(){yield o._updateTokensIfNecessary(l,!0);const f=Tc(l);return new it({user:o,providerId:f,_tokenResponse:l,operationType:u})})()}}function Tc(c){return c.providerId?c.providerId:"phoneNumber"in c?"phone":null}function Et(){return(Et=(0,v.Z)(function*(c){var o;const u=_e(c);if(yield u._initializationPromise,null!==(o=u.currentUser)&&void 0!==o&&o.isAnonymous)return new it({user:u.currentUser,providerId:null,operationType:"signIn"});const l=yield vc(u,{returnSecureToken:!0}),f=yield it._fromIdTokenResponse(u,"signIn",l,!0);return yield u._updateCurrentUser(f.user),f})).apply(this,arguments)}class Bn extends C.ZR{constructor(o,u,l,f){var _;super(u.code,u.message),this.operationType=l,this.user=f,Object.setPrototypeOf(this,Bn.prototype),this.customData={appName:o.name,tenantId:null!==(_=o.tenantId)&&void 0!==_?_:void 0,_serverResponse:u.customData._serverResponse,operationType:l}}static _fromErrorAndOperation(o,u,l,f){return new Bn(o,u,l,f)}}function Ii(c,o,u,l){return("reauthenticate"===o?u._getReauthenticationResolver(c):u._getIdTokenResponse(c)).catch(_=>{throw"auth/multi-factor-auth-required"===_.code?Bn._fromErrorAndOperation(c,_,o,l):_})}function fa(c){return new Set(c.map(({providerId:o})=>o).filter(o=>!!o))}function wr(){return wr=(0,v.Z)(function*(c,o){const u=(0,C.m9)(c);yield Ps(!0,u,o);const{providerUserInfo:l}=yield function ps(c,o){return kn.apply(this,arguments)}(u.auth,{idToken:yield u.getIdToken(),deleteProvider:[o]}),f=fa(l||[]);return u.providerData=u.providerData.filter(_=>f.has(_.providerId)),f.has("phone")||(u.phoneNumber=null),yield u.auth._persistUserIfCurrent(u),u}),wr.apply(this,arguments)}function Zn(c,o){return Gn.apply(this,arguments)}function Gn(){return(Gn=(0,v.Z)(function*(c,o,u=!1){const l=yield Wt(c,o._linkToIdToken(c.auth,yield c.getIdToken()),u);return it._forOperation(c,"link",l)})).apply(this,arguments)}function Ps(c,o,u){return Rs.apply(this,arguments)}function Rs(){return(Rs=(0,v.Z)(function*(c,o,u){yield si(o);const f=!1===c?"provider-already-linked":"no-such-provider";N(fa(o.providerData).has(u)===c,o.auth,f)})).apply(this,arguments)}function Ec(c,o){return pa.apply(this,arguments)}function pa(){return(pa=(0,v.Z)(function*(c,o,u=!1){const{auth:l}=c,f="reauthenticate";try{const _=yield Wt(c,Ii(l,f,o,c),u);N(_.idToken,l,"internal-error");const I=Se(_.idToken);N(I,l,"internal-error");const{sub:E}=I;return N(c.uid===E,l,"user-mismatch"),it._forOperation(c,f,_)}catch(_){throw"auth/user-not-found"===(null==_?void 0:_.code)&&oe(l,"user-mismatch"),_}})).apply(this,arguments)}function Ac(c,o){return ma.apply(this,arguments)}function ma(){return(ma=(0,v.Z)(function*(c,o,u=!1){const l="signIn",f=yield Ii(c,l,o),_=yield it._fromIdTokenResponse(c,l,f);return u||(yield c._updateCurrentUser(_.user)),_})).apply(this,arguments)}function cn(c,o){return xt.apply(this,arguments)}function xt(){return(xt=(0,v.Z)(function*(c,o){return Ac(_e(c),o)})).apply(this,arguments)}function ga(c,o){return Ss.apply(this,arguments)}function Ss(){return(Ss=(0,v.Z)(function*(c,o){const u=(0,C.m9)(c);return yield Ps(!1,u,o.providerId),Zn(u,o)})).apply(this,arguments)}function _a(c,o){return ln.apply(this,arguments)}function ln(){return(ln=(0,v.Z)(function*(c,o){return Ec((0,C.m9)(c),o)})).apply(this,arguments)}function ya(){return(ya=(0,v.Z)(function*(c,o){return zt(c,"POST","/v1/accounts:signInWithCustomToken",de(c,o))})).apply(this,arguments)}function Ia(){return Ia=(0,v.Z)(function*(c,o){const u=_e(c),l=yield function Ih(c,o){return ya.apply(this,arguments)}(u,{token:o,returnSecureToken:!0}),f=yield it._fromIdTokenResponse(u,"signIn",l);return yield u._updateCurrentUser(f.user),f}),Ia.apply(this,arguments)}class Pr{constructor(o,u){this.factorId=o,this.uid=u.mfaEnrollmentId,this.enrollmentTime=new Date(u.enrolledAt).toUTCString(),this.displayName=u.displayName}static _fromServerResponse(o,u){return"phoneInfo"in u?Cs._fromServerResponse(o,u):"totpInfo"in u?vi._fromServerResponse(o,u):oe(o,"internal-error")}}class Cs extends Pr{constructor(o){super("phone",o),this.phoneNumber=o.phoneInfo}static _fromServerResponse(o,u){return new Cs(u)}}class vi extends Pr{constructor(o){super("totp",o)}static _fromServerResponse(o,u){return new vi(u)}}function Rr(c,o,u){var l;N((null===(l=u.url)||void 0===l?void 0:l.length)>0,c,"invalid-continue-uri"),N(typeof u.dynamicLinkDomain>"u"||u.dynamicLinkDomain.length>0,c,"invalid-dynamic-link-domain"),o.continueUrl=u.url,o.dynamicLinkDomain=u.dynamicLinkDomain,o.canHandleCodeInApp=u.handleCodeInApp,u.iOS&&(N(u.iOS.bundleId.length>0,c,"missing-ios-bundle-id"),o.iOSBundleId=u.iOS.bundleId),u.android&&(N(u.android.packageName.length>0,c,"missing-android-pkg-name"),o.androidInstallApp=u.android.installApp,o.androidMinimumVersionCode=u.android.minimumVersion,o.androidPackageName=u.android.packageName)}function bs(c){return xs.apply(this,arguments)}function xs(){return(xs=(0,v.Z)(function*(c){const o=_e(c);o._getPasswordPolicyInternal()&&(yield o._updatePasswordPolicy())})).apply(this,arguments)}function va(){return(va=(0,v.Z)(function*(c,o,u){const l=_e(c),f={requestType:"PASSWORD_RESET",email:o,clientType:"CLIENT_TYPE_WEB"};u&&Rr(l,f,u),yield Vn(l,f,"getOobCode",gh)})).apply(this,arguments)}function Ta(){return Ta=(0,v.Z)(function*(c,o,u){yield ia((0,C.m9)(c),{oobCode:o,newPassword:u}).catch(function(){var l=(0,v.Z)(function*(f){throw"auth/password-does-not-meet-requirements"===f.code&&bs(c),f});return function(f){return l.apply(this,arguments)}}())}),Ta.apply(this,arguments)}function zn(){return zn=(0,v.Z)(function*(c,o){yield function oa(c,o){return Is.apply(this,arguments)}((0,C.m9)(c),{oobCode:o})}),zn.apply(this,arguments)}function Ti(c,o){return Ei.apply(this,arguments)}function Ei(){return(Ei=(0,v.Z)(function*(c,o){const u=(0,C.m9)(c),l=yield ia(u,{oobCode:o}),f=l.requestType;switch(N(f,u,"internal-error"),f){case"EMAIL_SIGNIN":break;case"VERIFY_AND_CHANGE_EMAIL":N(l.newEmail,u,"internal-error");break;case"REVERT_SECOND_FACTOR_ADDITION":N(l.mfaInfo,u,"internal-error");default:N(l.email,u,"internal-error")}let _=null;return l.mfaInfo&&(_=Pr._fromServerResponse(_e(u),l.mfaInfo)),{data:{email:("VERIFY_AND_CHANGE_EMAIL"===l.requestType?l.newEmail:l.email)||null,previousEmail:("VERIFY_AND_CHANGE_EMAIL"===l.requestType?l.email:l.newEmail)||null,multiFactorInfo:_},operation:f}})).apply(this,arguments)}function Wn(){return(Wn=(0,v.Z)(function*(c,o){const{data:u}=yield Ti((0,C.m9)(c),o);return u.email})).apply(this,arguments)}function Ea(){return(Ea=(0,v.Z)(function*(c,o,u){const l=_e(c),I=yield Vn(l,{returnSecureToken:!0,email:o,password:u,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",vc).catch(S=>{throw"auth/password-does-not-meet-requirements"===S.code&&bs(c),S}),E=yield it._fromIdTokenResponse(l,"signIn",I);return yield l._updateCurrentUser(E.user),E})).apply(this,arguments)}function Aa(){return(Aa=(0,v.Z)(function*(c,o,u){const l=_e(c),f={requestType:"EMAIL_SIGNIN",email:o,clientType:"CLIENT_TYPE_WEB"};(function _(I,E){N(E.handleCodeInApp,l,"argument-error"),E&&Rr(l,I,E)})(f,u),yield Vn(l,f,"getOobCode",yr)})).apply(this,arguments)}function Ns(){return(Ns=(0,v.Z)(function*(c,o,u){const l=(0,C.m9)(c),f=yi.credentialWithLink(o,u||xn());return N(f._tenantId===(l.tenantId||null),l,"tenant-id-mismatch"),cn(l,f)})).apply(this,arguments)}function Vs(){return(Vs=(0,v.Z)(function*(c,o){return ge(c,"POST","/v1/accounts:createAuthUri",de(c,o))})).apply(this,arguments)}function Os(){return Os=(0,v.Z)(function*(c,o){const l={identifier:o,continueUri:Xr()?xn():"http://localhost"},{signinMethods:f}=yield function Sc(c,o){return Vs.apply(this,arguments)}((0,C.m9)(c),l);return f||[]}),Os.apply(this,arguments)}function Ms(){return Ms=(0,v.Z)(function*(c,o){const u=(0,C.m9)(c),f={requestType:"VERIFY_EMAIL",idToken:yield c.getIdToken()};o&&Rr(u.auth,f,o);const{email:_}=yield function dc(c,o){return _r.apply(this,arguments)}(u.auth,f);_!==c.email&&(yield c.reload())}),Ms.apply(this,arguments)}function Ls(){return Ls=(0,v.Z)(function*(c,o,u){const l=(0,C.m9)(c),_={requestType:"VERIFY_AND_CHANGE_EMAIL",idToken:yield c.getIdToken(),newEmail:o};u&&Rr(l.auth,_,u);const{email:I}=yield function _h(c,o){return Ht.apply(this,arguments)}(l.auth,_);I!==c.email&&(yield c.reload())}),Ls.apply(this,arguments)}function Kn(){return(Kn=(0,v.Z)(function*(c,o){return ge(c,"POST","/v1/accounts:update",o)})).apply(this,arguments)}function wi(){return wi=(0,v.Z)(function*(c,{displayName:o,photoURL:u}){if(void 0===o&&void 0===u)return;const l=(0,C.m9)(c),_={idToken:yield l.getIdToken(),displayName:o,photoUrl:u,returnSecureToken:!0},I=yield Wt(l,function wa(c,o){return Kn.apply(this,arguments)}(l.auth,_));l.displayName=I.displayName||null,l.photoURL=I.photoUrl||null;const E=l.providerData.find(({providerId:S})=>"password"===S);E&&(E.displayName=l.displayName,E.photoURL=l.photoURL),yield l._updateTokensIfNecessary(I)}),wi.apply(this,arguments)}function Pi(c,o,u){return Pa.apply(this,arguments)}function Pa(){return(Pa=(0,v.Z)(function*(c,o,u){const{auth:l}=c,_={idToken:yield c.getIdToken(),returnSecureToken:!0};o&&(_.email=o),u&&(_.password=u);const I=yield Wt(c,hi(l,_));yield c._updateTokensIfNecessary(I,!0)})).apply(this,arguments)}class Nt{constructor(o,u,l={}){this.isNewUser=o,this.providerId=u,this.profile=l}}class Ra extends Nt{constructor(o,u,l,f){super(o,u,l),this.username=f}}class kc extends Nt{constructor(o,u){super(o,"facebook.com",u)}}class Sa extends Ra{constructor(o,u){super(o,"github.com",u,"string"==typeof(null==u?void 0:u.login)?null==u?void 0:u.login:null)}}class Ca extends Nt{constructor(o,u){super(o,"google.com",u)}}class Nc extends Ra{constructor(o,u,l){super(o,"twitter.com",u,l)}}function Us(c){const{user:o,_tokenResponse:u}=c;return o.isAnonymous&&!u?{providerId:null,isNewUser:!1,profile:null}:function xc(c){var o,u;if(!c)return null;const{providerId:l}=c,f=c.rawUserInfo?JSON.parse(c.rawUserInfo):{},_=c.isNewUser||"identitytoolkit#SignupNewUserResponse"===c.kind;if(!l&&null!=c&&c.idToken){const I=null===(u=null===(o=Se(c.idToken))||void 0===o?void 0:o.firebase)||void 0===u?void 0:u.sign_in_provider;if(I)return new Nt(_,"anonymous"!==I&&"custom"!==I?I:null)}if(!l)return null;switch(l){case"facebook.com":return new kc(_,f);case"github.com":return new Sa(_,f);case"google.com":return new Ca(_,f);case"twitter.com":return new Nc(_,f,c.screenName||null);case"custom":case"anonymous":return new Nt(_,null);default:return new Nt(_,l,f)}}(u)}class jn{constructor(o,u,l){this.type=o,this.credential=u,this.user=l}static _fromIdtoken(o,u){return new jn("enroll",o,u)}static _fromMfaPendingCredential(o){return new jn("signin",o)}toJSON(){return{multiFactorSession:{["enroll"===this.type?"idToken":"pendingCredential"]:this.credential}}}static fromJSON(o){var u,l;if(null!=o&&o.multiFactorSession){if(null!==(u=o.multiFactorSession)&&void 0!==u&&u.pendingCredential)return jn._fromMfaPendingCredential(o.multiFactorSession.pendingCredential);if(null!==(l=o.multiFactorSession)&&void 0!==l&&l.idToken)return jn._fromIdtoken(o.multiFactorSession.idToken)}return null}}class st{constructor(o,u,l){this.session=o,this.hints=u,this.signInResolver=l}static _fromError(o,u){const l=_e(o),f=u.customData._serverResponse,_=(f.mfaInfo||[]).map(E=>Pr._fromServerResponse(l,E));N(f.mfaPendingCredential,l,"internal-error");const I=jn._fromMfaPendingCredential(f.mfaPendingCredential);return new st(I,_,function(){var E=(0,v.Z)(function*(S){const L=yield S._process(l,I);delete f.mfaInfo,delete f.mfaPendingCredential;const Z=Object.assign(Object.assign({},f),{idToken:L.idToken,refreshToken:L.refreshToken});switch(u.operationType){case"signIn":const U=yield it._fromIdTokenResponse(l,u.operationType,Z);return yield l._updateCurrentUser(U.user),U;case"reauthenticate":return N(u.user,l,"internal-error"),it._forOperation(u.user,u.operationType,Z);default:oe(l,"internal-error")}});return function(S){return E.apply(this,arguments)}}())}resolveSignIn(o){var u=this;return(0,v.Z)(function*(){return u.signInResolver(o)})()}}class Ri{constructor(o){this.user=o,this.enrolledFactors=[],o._onReload(u=>{u.mfaInfo&&(this.enrolledFactors=u.mfaInfo.map(l=>Pr._fromServerResponse(o.auth,l)))})}static _fromUser(o){return new Ri(o)}getSession(){var o=this;return(0,v.Z)(function*(){return jn._fromIdtoken(yield o.user.getIdToken(),o.user)})()}enroll(o,u){var l=this;return(0,v.Z)(function*(){const f=o,_=yield l.getSession(),I=yield Wt(l.user,f._process(l.user.auth,_,u));return yield l.user._updateTokensIfNecessary(I),l.user.reload()})()}unenroll(o){var u=this;return(0,v.Z)(function*(){const l="string"==typeof o?o:o.uid,f=yield u.user.getIdToken();try{const _=yield Wt(u.user,function Mc(c,o){return ge(c,"POST","/v2/accounts/mfaEnrollment:withdraw",de(c,o))}(u.user.auth,{idToken:f,mfaEnrollmentId:l}));u.enrolledFactors=u.enrolledFactors.filter(({uid:I})=>I!==l),yield u.user._updateTokensIfNecessary(_),yield u.user.reload()}catch(_){throw _}})()}}const dn=new WeakMap,Si="__sak";class Dt{constructor(o,u){this.storageRetriever=o,this.type=u}_isAvailable(){try{return this.storage?(this.storage.setItem(Si,"1"),this.storage.removeItem(Si),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(o,u){return this.storage.setItem(o,JSON.stringify(u)),Promise.resolve()}_get(o){const u=this.storage.getItem(o);return Promise.resolve(u?JSON.parse(u):null)}_remove(o){return this.storage.removeItem(o),Promise.resolve()}get storage(){return this.storageRetriever()}}const fn=(()=>{class c extends Dt{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(u,l)=>this.onStorageEvent(u,l),this.listeners={},this.localCache={},this.pollTimer=null,this.safariLocalStorageNotSynced=function mt(){const c=(0,C.z$)();return jo(c)||$t(c)}()&&function sc(){try{return!(!window||window===window.top)}catch{return!1}}(),this.fallbackToPolling=Ho(),this._shouldAllowMigration=!0}forAllChangedKeys(u){for(const l of Object.keys(this.listeners)){const f=this.storage.getItem(l),_=this.localCache[l];f!==_&&u(l,_,f)}}onStorageEvent(u,l=!1){if(!u.key)return void this.forAllChangedKeys((E,S,L)=>{this.notifyListeners(E,L)});const f=u.key;if(l?this.detachListener():this.stopPolling(),this.safariLocalStorageNotSynced){const E=this.storage.getItem(f);if(u.newValue!==E)null!==u.newValue?this.storage.setItem(f,u.newValue):this.storage.removeItem(f);else if(this.localCache[f]===u.newValue&&!l)return}const _=()=>{const E=this.storage.getItem(f);!l&&this.localCache[f]===E||this.notifyListeners(f,E)},I=this.storage.getItem(f);!function ic(){return(0,C.w1)()&&10===document.documentMode}()||I===u.newValue||u.newValue===u.oldValue?_():setTimeout(_,10)}notifyListeners(u,l){this.localCache[u]=l;const f=this.listeners[u];if(f)for(const _ of Array.from(f))_(l&&JSON.parse(l))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((u,l,f)=>{this.onStorageEvent(new StorageEvent("storage",{key:u,oldValue:l,newValue:f}),!0)})},1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(u,l){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[u]||(this.listeners[u]=new Set,this.localCache[u]=this.storage.getItem(u)),this.listeners[u].add(l)}_removeListener(u,l){this.listeners[u]&&(this.listeners[u].delete(l),0===this.listeners[u].size&&delete this.listeners[u]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}_set(u,l){var f=()=>super._set,_=this;return(0,v.Z)(function*(){yield f().call(_,u,l),_.localCache[u]=JSON.stringify(l)})()}_get(u){var l=()=>super._get,f=this;return(0,v.Z)(function*(){const _=yield l().call(f,u);return f.localCache[u]=JSON.stringify(_),_})()}_remove(u){var l=()=>super._remove,f=this;return(0,v.Z)(function*(){yield l().call(f,u),delete f.localCache[u]})()}}return c.type="LOCAL",c})(),Qt=(()=>{class c extends Dt{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(u,l){}_removeListener(u,l){}}return c.type="SESSION",c})();let kh=(()=>{class c{constructor(u){this.eventTarget=u,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(u){const l=this.receivers.find(_=>_.isListeningto(u));if(l)return l;const f=new c(u);return this.receivers.push(f),f}isListeningto(u){return this.eventTarget===u}handleEvent(u){var l=this;return(0,v.Z)(function*(){const f=u,{eventId:_,eventType:I,data:E}=f.data,S=l.handlersMap[I];if(null==S||!S.size)return;f.ports[0].postMessage({status:"ack",eventId:_,eventType:I});const L=Array.from(S).map(function(){var U=(0,v.Z)(function*(ye){return ye(f.origin,E)});return function(ye){return U.apply(this,arguments)}}()),Z=yield function Cr(c){return Promise.all(c.map(function(){var o=(0,v.Z)(function*(u){try{return{fulfilled:!0,value:yield u}}catch(l){return{fulfilled:!1,reason:l}}});return function(u){return o.apply(this,arguments)}}()))}(L);f.ports[0].postMessage({status:"done",eventId:_,eventType:I,response:Z})})()}_subscribe(u,l){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[u]||(this.handlersMap[u]=new Set),this.handlersMap[u].add(l)}_unsubscribe(u,l){this.handlersMap[u]&&l&&this.handlersMap[u].delete(l),(!l||0===this.handlersMap[u].size)&&delete this.handlersMap[u],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}return c.receivers=[],c})();function Ci(c="",o=10){let u="";for(let l=0;l<o;l++)u+=Math.floor(10*Math.random());return c+u}class Da{constructor(o){this.target=o,this.handlers=new Set}removeMessageHandler(o){o.messageChannel&&(o.messageChannel.port1.removeEventListener("message",o.onMessage),o.messageChannel.port1.close()),this.handlers.delete(o)}_send(o,u,l=50){var f=this;return(0,v.Z)(function*(){const _=typeof MessageChannel<"u"?new MessageChannel:null;if(!_)throw new Error("connection_unavailable");let I,E;return new Promise((S,L)=>{const Z=Ci("",20);_.port1.start();const U=setTimeout(()=>{L(new Error("unsupported_event"))},l);E={messageChannel:_,onMessage(ye){const yt=ye;if(yt.data.eventId===Z)switch(yt.data.status){case"ack":clearTimeout(U),I=setTimeout(()=>{L(new Error("timeout"))},3e3);break;case"done":clearTimeout(I),S(yt.data.response);break;default:clearTimeout(U),clearTimeout(I),L(new Error("invalid_response"))}}},f.handlers.add(E),_.port1.addEventListener("message",E.onMessage),f.target.postMessage({eventType:o,eventId:Z,data:u},[_.port2])}).finally(()=>{E&&f.removeMessageHandler(E)})})()}}function be(){return window}function Zs(){return typeof be().WorkerGlobalScope<"u"&&"function"==typeof be().importScripts}function br(){return(br=(0,v.Z)(function*(){if(null==navigator||!navigator.serviceWorker)return null;try{return(yield navigator.serviceWorker.ready).active}catch{return null}})).apply(this,arguments)}const $n="firebaseLocalStorageDb",Ce="firebaseLocalStorage",Hn="fbase_key";class gt{constructor(o){this.request=o}toPromise(){return new Promise((o,u)=>{this.request.addEventListener("success",()=>{o(this.request.result)}),this.request.addEventListener("error",()=>{u(this.request.error)})})}}function Yt(c,o){return c.transaction([Ce],o?"readwrite":"readonly").objectStore(Ce)}function x(){const c=indexedDB.open($n,1);return new Promise((o,u)=>{c.addEventListener("error",()=>{u(c.error)}),c.addEventListener("upgradeneeded",()=>{const l=c.result;try{l.createObjectStore(Ce,{keyPath:Hn})}catch(f){u(f)}}),c.addEventListener("success",(0,v.Z)(function*(){const l=c.result;l.objectStoreNames.contains(Ce)?o(l):(l.close(),yield function Mh(){const c=indexedDB.deleteDatabase($n);return new gt(c).toPromise()}(),o(yield x()))}))})}function Ae(c,o,u){return je.apply(this,arguments)}function je(){return(je=(0,v.Z)(function*(c,o,u){const l=Yt(c,!0).put({[Hn]:o,value:u});return new gt(l).toPromise()})).apply(this,arguments)}function B(){return(B=(0,v.Z)(function*(c,o){const u=Yt(c,!1).get(o),l=yield new gt(u).toPromise();return void 0===l?null:l.value})).apply(this,arguments)}function z(c,o){const u=Yt(c,!0).delete(o);return new gt(u).toPromise()}const b=(()=>{class c{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}_openDb(){var u=this;return(0,v.Z)(function*(){return u.db||(u.db=yield x()),u.db})()}_withRetries(u){var l=this;return(0,v.Z)(function*(){let f=0;for(;;)try{const _=yield l._openDb();return yield u(_)}catch(_){if(f++>3)throw _;l.db&&(l.db.close(),l.db=void 0)}})()}initializeServiceWorkerMessaging(){var u=this;return(0,v.Z)(function*(){return Zs()?u.initializeReceiver():u.initializeSender()})()}initializeReceiver(){var u=this;return(0,v.Z)(function*(){u.receiver=kh._getInstance(function Oh(){return Zs()?self:null}()),u.receiver._subscribe("keyChanged",function(){var l=(0,v.Z)(function*(f,_){return{keyProcessed:(yield u._poll()).includes(_.key)}});return function(f,_){return l.apply(this,arguments)}}()),u.receiver._subscribe("ping",function(){var l=(0,v.Z)(function*(f,_){return["keyChanged"]});return function(f,_){return l.apply(this,arguments)}}())})()}initializeSender(){var u=this;return(0,v.Z)(function*(){var l,f;if(u.activeServiceWorker=yield function Vh(){return br.apply(this,arguments)}(),!u.activeServiceWorker)return;u.sender=new Da(u.activeServiceWorker);const _=yield u.sender._send("ping",{},800);_&&null!==(l=_[0])&&void 0!==l&&l.fulfilled&&null!==(f=_[0])&&void 0!==f&&f.value.includes("keyChanged")&&(u.serviceWorkerReceiverAvailable=!0)})()}notifyServiceWorker(u){var l=this;return(0,v.Z)(function*(){if(l.sender&&l.activeServiceWorker&&function Dh(){var c;return(null===(c=null==navigator?void 0:navigator.serviceWorker)||void 0===c?void 0:c.controller)||null}()===l.activeServiceWorker)try{yield l.sender._send("keyChanged",{key:u},l.serviceWorkerReceiverAvailable?800:50)}catch{}})()}_isAvailable(){return(0,v.Z)(function*(){try{if(!indexedDB)return!1;const u=yield x();return yield Ae(u,Si,"1"),yield z(u,Si),!0}catch{}return!1})()}_withPendingWrite(u){var l=this;return(0,v.Z)(function*(){l.pendingWrites++;try{yield u()}finally{l.pendingWrites--}})()}_set(u,l){var f=this;return(0,v.Z)(function*(){return f._withPendingWrite((0,v.Z)(function*(){return yield f._withRetries(_=>Ae(_,u,l)),f.localCache[u]=l,f.notifyServiceWorker(u)}))})()}_get(u){var l=this;return(0,v.Z)(function*(){const f=yield l._withRetries(_=>function Oa(c,o){return B.apply(this,arguments)}(_,u));return l.localCache[u]=f,f})()}_remove(u){var l=this;return(0,v.Z)(function*(){return l._withPendingWrite((0,v.Z)(function*(){return yield l._withRetries(f=>z(f,u)),delete l.localCache[u],l.notifyServiceWorker(u)}))})()}_poll(){var u=this;return(0,v.Z)(function*(){const l=yield u._withRetries(I=>{const E=Yt(I,!1).getAll();return new gt(E).toPromise()});if(!l)return[];if(0!==u.pendingWrites)return[];const f=[],_=new Set;for(const{fbase_key:I,value:E}of l)_.add(I),JSON.stringify(u.localCache[I])!==JSON.stringify(E)&&(u.notifyListeners(I,E),f.push(I));for(const I of Object.keys(u.localCache))u.localCache[I]&&!_.has(I)&&(u.notifyListeners(I,null),f.push(I));return f})()}notifyListeners(u,l){this.localCache[u]=l;const f=this.listeners[u];if(f)for(const _ of Array.from(f))_(l)}startPolling(){var u=this;this.stopPolling(),this.pollTimer=setInterval((0,v.Z)(function*(){return u._poll()}),800)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(u,l){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[u]||(this.listeners[u]=new Set,this._get(u)),this.listeners[u].add(l)}_removeListener(u,l){this.listeners[u]&&(this.listeners[u].delete(l),0===this.listeners[u].size&&delete this.listeners[u]),0===Object.keys(this.listeners).length&&this.stopPolling()}}return c.type="LOCAL",c})(),Gs=1e12;class Bh{constructor(o){this.auth=o,this.counter=Gs,this._widgets=new Map}render(o,u){const l=this.counter;return this._widgets.set(l,new Uc(o,this.auth.name,u||{})),this.counter++,l}reset(o){var u;const l=o||Gs;null===(u=this._widgets.get(l))||void 0===u||u.delete(),this._widgets.delete(l)}getResponse(o){var u;return(null===(u=this._widgets.get(o||Gs))||void 0===u?void 0:u.getResponse())||""}execute(o){var u=this;return(0,v.Z)(function*(){var l;return null===(l=u._widgets.get(o||Gs))||void 0===l||l.execute(),""})()}}class Uc{constructor(o,u,l){this.params=l,this.timerId=null,this.deleted=!1,this.responseToken=null,this.clickHandler=()=>{this.execute()};const f="string"==typeof o?document.getElementById(o):o;N(f,"argument-error",{appName:u}),this.container=f,this.isVisible="invisible"!==this.params.size,this.isVisible?this.execute():this.container.addEventListener("click",this.clickHandler)}getResponse(){return this.checkIfDeleted(),this.responseToken}delete(){this.checkIfDeleted(),this.deleted=!0,this.timerId&&(clearTimeout(this.timerId),this.timerId=null),this.container.removeEventListener("click",this.clickHandler)}execute(){this.checkIfDeleted(),!this.timerId&&(this.timerId=window.setTimeout(()=>{this.responseToken=function Zh(c){const o=[],u="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let l=0;l<c;l++)o.push(u.charAt(Math.floor(62*Math.random())));return o.join("")}(50);const{callback:o,"expired-callback":u}=this.params;if(o)try{o(this.responseToken)}catch{}this.timerId=window.setTimeout(()=>{if(this.timerId=null,this.responseToken=null,u)try{u()}catch{}this.isVisible&&this.execute()},6e4)},500))}checkIfDeleted(){if(this.deleted)throw new Error("reCAPTCHA mock was already deleted!")}}const qc=ea("rcb"),Gh=new dr(3e4,6e4);class Y{constructor(){var o;this.hostLanguage="",this.counter=0,this.librarySeparatelyLoaded=!(null===(o=be().grecaptcha)||void 0===o||!o.render)}load(o,u=""){return N(function xr(c){return c.length<=6&&/^\s*[a-zA-Z0-9\-]*\s*$/.test(c)}(u),o,"argument-error"),this.shouldResolveImmediately(u)&&ni(be().grecaptcha)?Promise.resolve(be().grecaptcha):new Promise((l,f)=>{const _=be().setTimeout(()=>{f(Ge(o,"network-request-failed"))},Gh.get());be()[qc]=()=>{be().clearTimeout(_),delete be()[qc];const E=be().grecaptcha;if(!E||!ni(E))return void f(Ge(o,"internal-error"));const S=E.render;E.render=(L,Z)=>{const U=S(L,Z);return this.counter++,U},this.hostLanguage=u,l(E)},ui(`https://www.google.com/recaptcha/api.js??${(0,C.xO)({onload:qc,render:"explicit",hl:u})}`).catch(()=>{clearTimeout(_),f(Ge(o,"internal-error"))})})}clearedOneInstance(){this.counter--}shouldResolveImmediately(o){var u;return!(null===(u=be().grecaptcha)||void 0===u||!u.render)&&(o===this.hostLanguage||this.counter>0||this.librarySeparatelyLoaded)}}class Zc{load(o){return(0,v.Z)(function*(){return new Bh(o)})()}clearedOneInstance(){}}const pe="recaptcha",K={theme:"light",type:"image"};class bi{constructor(o,u,l=Object.assign({},K)){this.parameters=l,this.type=pe,this.destroyed=!1,this.widgetId=null,this.tokenChangeListeners=new Set,this.renderPromise=null,this.recaptcha=null,this.auth=_e(o),this.isInvisible="invisible"===this.parameters.size,N(typeof document<"u",this.auth,"operation-not-supported-in-this-environment");const f="string"==typeof u?document.getElementById(u):u;N(f,this.auth,"argument-error"),this.container=f,this.parameters.callback=this.makeTokenCallback(this.parameters.callback),this._recaptchaLoader=this.auth.settings.appVerificationDisabledForTesting?new Zc:new Y,this.validateStartingState()}verify(){var o=this;return(0,v.Z)(function*(){o.assertNotDestroyed();const u=yield o.render(),l=o.getAssertedRecaptcha();return l.getResponse(u)||new Promise(_=>{const I=E=>{E&&(o.tokenChangeListeners.delete(I),_(E))};o.tokenChangeListeners.add(I),o.isInvisible&&l.execute(u)})})()}render(){try{this.assertNotDestroyed()}catch(o){return Promise.reject(o)}return this.renderPromise||(this.renderPromise=this.makeRenderPromise().catch(o=>{throw this.renderPromise=null,o})),this.renderPromise}_reset(){this.assertNotDestroyed(),null!==this.widgetId&&this.getAssertedRecaptcha().reset(this.widgetId)}clear(){this.assertNotDestroyed(),this.destroyed=!0,this._recaptchaLoader.clearedOneInstance(),this.isInvisible||this.container.childNodes.forEach(o=>{this.container.removeChild(o)})}validateStartingState(){N(!this.parameters.sitekey,this.auth,"argument-error"),N(this.isInvisible||!this.container.hasChildNodes(),this.auth,"argument-error"),N(typeof document<"u",this.auth,"operation-not-supported-in-this-environment")}makeTokenCallback(o){return u=>{if(this.tokenChangeListeners.forEach(l=>l(u)),"function"==typeof o)o(u);else if("string"==typeof o){const l=be()[o];"function"==typeof l&&l(u)}}}assertNotDestroyed(){N(!this.destroyed,this.auth,"internal-error")}makeRenderPromise(){var o=this;return(0,v.Z)(function*(){if(yield o.init(),!o.widgetId){let u=o.container;if(!o.isInvisible){const l=document.createElement("div");u.appendChild(l),u=l}o.widgetId=o.getAssertedRecaptcha().render(u,o.parameters)}return o.widgetId})()}init(){var o=this;return(0,v.Z)(function*(){N(Xr()&&!Zs(),o.auth,"internal-error"),yield function ie(){let c=null;return new Promise(o=>{"complete"!==document.readyState?(c=()=>o(),window.addEventListener("load",c)):o()}).catch(o=>{throw c&&window.removeEventListener("load",c),o})}(),o.recaptcha=yield o._recaptchaLoader.load(o.auth,o.auth.languageCode||void 0);const u=yield function ce(c){return Zo.apply(this,arguments)}(o.auth);N(u,o.auth,"internal-error"),o.parameters.sitekey=u})()}getAssertedRecaptcha(){return N(this.recaptcha,this.auth,"internal-error"),this.recaptcha}}class Ma{constructor(o,u){this.verificationId=o,this.onConfirmation=u}confirm(o){const u=Tt._fromVerification(this.verificationId,o);return this.onConfirmation(u)}}function O(){return(O=(0,v.Z)(function*(c,o,u){const l=_e(c),f=yield Ot(l,o,(0,C.m9)(u));return new Ma(f,_=>cn(l,_))})).apply(this,arguments)}function xi(){return(xi=(0,v.Z)(function*(c,o,u){const l=(0,C.m9)(c);yield Ps(!1,l,"phone");const f=yield Ot(l.auth,o,(0,C.m9)(u));return new Ma(f,_=>ga(l,_))})).apply(this,arguments)}function La(){return(La=(0,v.Z)(function*(c,o,u){const l=(0,C.m9)(c),f=yield Ot(l.auth,o,(0,C.m9)(u));return new Ma(f,_=>_a(l,_))})).apply(this,arguments)}function Ot(c,o,u){return Fa.apply(this,arguments)}function Fa(){return Fa=(0,v.Z)(function*(c,o,u){var l;const f=yield u.verify();try{let _;if(N("string"==typeof f,c,"argument-error"),N(u.type===pe,c,"argument-error"),_="string"==typeof o?{phoneNumber:o}:o,"session"in _){const I=_.session;if("phoneNumber"in _)return N("enroll"===I.type,c,"internal-error"),(yield function ae(c,o){return ge(c,"POST","/v2/accounts/mfaEnrollment:start",de(c,o))}(c,{idToken:I.credential,phoneEnrollmentInfo:{phoneNumber:_.phoneNumber,recaptchaToken:f}})).phoneSessionInfo.sessionInfo;{N("signin"===I.type,c,"internal-error");const E=(null===(l=_.multiFactorHint)||void 0===l?void 0:l.uid)||_.multiFactorUid;return N(E,c,"missing-multi-factor-info"),(yield function De(c,o){return ge(c,"POST","/v2/accounts/mfaSignIn:start",de(c,o))}(c,{mfaPendingCredential:I.credential,mfaEnrollmentId:E,phoneSignInInfo:{recaptchaToken:f}})).phoneResponseInfo.sessionInfo}}{const{sessionInfo:I}=yield function mc(c,o){return mi.apply(this,arguments)}(c,{phoneNumber:_.phoneNumber,recaptchaToken:f});return I}}finally{u._reset()}}),Fa.apply(this,arguments)}function zs(){return(zs=(0,v.Z)(function*(c,o){yield Zn((0,C.m9)(c),o)})).apply(this,arguments)}let Vr=(()=>{class c{constructor(u){this.providerId=c.PROVIDER_ID,this.auth=_e(u)}verifyPhoneNumber(u,l){return Ot(this.auth,u,(0,C.m9)(l))}static credential(u,l){return Tt._fromVerification(u,l)}static credentialFromResult(u){return c.credentialFromTaggedObject(u)}static credentialFromError(u){return c.credentialFromTaggedObject(u.customData||{})}static credentialFromTaggedObject({_tokenResponse:u}){if(!u)return null;const{phoneNumber:l,temporaryProof:f}=u;return l&&f?Tt._fromTokenResponse(l,f):null}}return c.PROVIDER_ID="phone",c.PHONE_SIGN_IN_METHOD="phone",c})();function Oe(c,o){return o?Xe(o):(N(c._popupRedirectResolver,c,"argument-error"),c._popupRedirectResolver)}class ki extends un{constructor(o){super("custom","custom"),this.params=o}_getIdTokenResponse(o){return ve(o,this._buildIdpRequest())}_linkToIdToken(o,u){return ve(o,this._buildIdpRequest(u))}_getReauthenticationResolver(o){return ve(o,this._buildIdpRequest())}_buildIdpRequest(o){const u={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return o&&(u.idToken=o),u}}function Gc(c){return Ac(c.auth,new ki(c),c.bypassAuthState)}function zc(c){const{auth:o,user:u}=c;return N(u,o,"internal-error"),Ec(u,new ki(c),c.bypassAuthState)}function pn(c){return Ni.apply(this,arguments)}function Ni(){return(Ni=(0,v.Z)(function*(c){const{auth:o,user:u}=c;return N(u,o,"internal-error"),Zn(u,new ki(c),c.bypassAuthState)})).apply(this,arguments)}class A{constructor(o,u,l,f,_=!1){this.auth=o,this.resolver=l,this.user=f,this.bypassAuthState=_,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(u)?u:[u]}execute(){var o=this;return new Promise(function(){var u=(0,v.Z)(function*(l,f){o.pendingPromise={resolve:l,reject:f};try{o.eventManager=yield o.resolver._initialize(o.auth),yield o.onExecution(),o.eventManager.registerConsumer(o)}catch(_){o.reject(_)}});return function(l,f){return u.apply(this,arguments)}}())}onAuthEvent(o){var u=this;return(0,v.Z)(function*(){const{urlResponse:l,sessionId:f,postBody:_,tenantId:I,error:E,type:S}=o;if(E)return void u.reject(E);const L={auth:u.auth,requestUri:l,sessionId:f,tenantId:I||void 0,postBody:_||void 0,user:u.user,bypassAuthState:u.bypassAuthState};try{u.resolve(yield u.getIdpTask(S)(L))}catch(Z){u.reject(Z)}})()}onError(o){this.reject(o)}getIdpTask(o){switch(o){case"signInViaPopup":case"signInViaRedirect":return Gc;case"linkViaPopup":case"linkViaRedirect":return pn;case"reauthViaPopup":case"reauthViaRedirect":return zc;default:oe(this.auth,"internal-error")}}resolve(o){ht(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(o),this.unregisterAndCleanUp()}reject(o){ht(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(o),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const Ws=new dr(2e3,1e4);function Ua(){return(Ua=(0,v.Z)(function*(c,o,u){const l=_e(c);hr(c,o,Ct);const f=Oe(l,u);return new Ks(l,"signInViaPopup",o,f).executeNotNull()})).apply(this,arguments)}function Mt(){return(Mt=(0,v.Z)(function*(c,o,u){const l=(0,C.m9)(c);hr(l.auth,o,Ct);const f=Oe(l.auth,u);return new Ks(l.auth,"reauthViaPopup",o,f,l).executeNotNull()})).apply(this,arguments)}function Jt(){return(Jt=(0,v.Z)(function*(c,o,u){const l=(0,C.m9)(c);hr(l.auth,o,Ct);const f=Oe(l.auth,u);return new Ks(l.auth,"linkViaPopup",o,f,l).executeNotNull()})).apply(this,arguments)}let Ks=(()=>{class c extends A{constructor(u,l,f,_,I){super(u,l,_,I),this.provider=f,this.authWindow=null,this.pollId=null,c.currentPopupAction&&c.currentPopupAction.cancel(),c.currentPopupAction=this}executeNotNull(){var u=this;return(0,v.Z)(function*(){const l=yield u.execute();return N(l,u.auth,"internal-error"),l})()}onExecution(){var u=this;return(0,v.Z)(function*(){ht(1===u.filter.length,"Popup operations only handle one event");const l=Ci();u.authWindow=yield u.resolver._openPopup(u.auth,u.provider,u.filter[0],l),u.authWindow.associatedEvent=l,u.resolver._originValidation(u.auth).catch(f=>{u.reject(f)}),u.resolver._isIframeWebStorageSupported(u.auth,f=>{f||u.reject(Ge(u.auth,"web-storage-unsupported"))}),u.pollUserCancellation()})()}get eventId(){var u;return(null===(u=this.authWindow)||void 0===u?void 0:u.associatedEvent)||null}cancel(){this.reject(Ge(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,c.currentPopupAction=null}pollUserCancellation(){const u=()=>{var l,f;this.pollId=null!==(f=null===(l=this.authWindow)||void 0===l?void 0:l.window)&&void 0!==f&&f.closed?window.setTimeout(()=>{this.pollId=null,this.reject(Ge(this.auth,"popup-closed-by-user"))},8e3):window.setTimeout(u,Ws.get())};u()}}return c.currentPopupAction=null,c})();const qa="pendingRedirect",Di=new Map;class Wh extends A{constructor(o,u,l=!1){super(o,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],u,void 0,l),this.eventId=null}execute(){var o=()=>super.execute,u=this;return(0,v.Z)(function*(){let l=Di.get(u.auth._key());if(!l){try{const _=(yield function ot(c,o){return Yn.apply(this,arguments)}(u.resolver,u.auth))?yield o().call(u):null;l=()=>Promise.resolve(_)}catch(f){l=()=>Promise.reject(f)}Di.set(u.auth._key(),l)}return u.bypassAuthState||Di.set(u.auth._key(),()=>Promise.resolve(null)),l()})()}onAuthEvent(o){var u=()=>super.onAuthEvent,l=this;return(0,v.Z)(function*(){if("signInViaRedirect"===o.type)return u().call(l,o);if("unknown"!==o.type){if(o.eventId){const f=yield l.auth._redirectUserForId(o.eventId);if(f)return l.user=f,u().call(l,o);l.resolve(null)}}else l.resolve(null)})()}onExecution(){return(0,v.Z)(function*(){})()}cleanUp(){}}function Yn(){return(Yn=(0,v.Z)(function*(c,o){const u=wt(o),l=Za(c);if(!(yield l._isAvailable()))return!1;const f="true"===(yield l._get(u));return yield l._remove(u),f})).apply(this,arguments)}function Jn(c,o){return js.apply(this,arguments)}function js(){return(js=(0,v.Z)(function*(c,o){return Za(c)._set(wt(o),"true")})).apply(this,arguments)}function Ba(c,o){Di.set(c._key(),o)}function Za(c){return Xe(c._redirectPersistence)}function wt(c){return Kt(qa,c.config.apiKey,c.name)}function Wc(c,o,u){return function $s(c,o,u){return Hs.apply(this,arguments)}(c,o,u)}function Hs(){return(Hs=(0,v.Z)(function*(c,o,u){const l=_e(c);hr(c,o,Ct),yield l._initializationPromise;const f=Oe(l,u);return yield Jn(f,l),f._openRedirect(l,o,"signInViaRedirect")})).apply(this,arguments)}function Kh(c,o,u){return function jh(c,o,u){return Ga.apply(this,arguments)}(c,o,u)}function Ga(){return(Ga=(0,v.Z)(function*(c,o,u){const l=(0,C.m9)(c);hr(l.auth,o,Ct),yield l.auth._initializationPromise;const f=Oe(l.auth,u);yield Jn(f,l.auth);const _=yield Kc(l);return f._openRedirect(l.auth,o,"reauthViaRedirect",_)})).apply(this,arguments)}function $h(c,o,u){return function Hh(c,o,u){return za.apply(this,arguments)}(c,o,u)}function za(){return(za=(0,v.Z)(function*(c,o,u){const l=(0,C.m9)(c);hr(l.auth,o,Ct),yield l.auth._initializationPromise;const f=Oe(l.auth,u);yield Ps(!1,l,o.providerId),yield Jn(f,l.auth);const _=yield Kc(l);return f._openRedirect(l.auth,o,"linkViaRedirect",_)})).apply(this,arguments)}function Wa(){return(Wa=(0,v.Z)(function*(c,o){return yield _e(c)._initializationPromise,Qs(c,o,!1)})).apply(this,arguments)}function Qs(c,o){return Ka.apply(this,arguments)}function Ka(){return(Ka=(0,v.Z)(function*(c,o,u=!1){const l=_e(c),f=Oe(l,o),I=yield new Wh(l,f,u).execute();return I&&!u&&(delete I.user._redirectEventId,yield l._persistUserIfCurrent(I.user),yield l._setRedirectUser(null,o)),I})).apply(this,arguments)}function Kc(c){return ja.apply(this,arguments)}function ja(){return(ja=(0,v.Z)(function*(c){const o=Ci(`${c.uid}:::`);return c._redirectEventId=o,yield c.auth._setRedirectUser(c),yield c.auth._persistUserIfCurrent(c),o})).apply(this,arguments)}class jc{constructor(o){this.auth=o,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(o){this.consumers.add(o),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,o)&&(this.sendToConsumer(this.queuedRedirectEvent,o),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(o){this.consumers.delete(o)}onEvent(o){if(this.hasEventBeenHandled(o))return!1;let u=!1;return this.consumers.forEach(l=>{this.isEventForConsumer(o,l)&&(u=!0,this.sendToConsumer(o,l),this.saveEventToCache(o))}),this.hasHandledPotentialRedirect||!function Jh(c){switch(c.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return $a(c);default:return!1}}(o)||(this.hasHandledPotentialRedirect=!0,u||(this.queuedRedirectEvent=o,u=!0)),u}sendToConsumer(o,u){var l;if(o.error&&!$a(o)){const f=(null===(l=o.error.code)||void 0===l?void 0:l.split("auth/")[1])||"internal-error";u.onError(Ge(this.auth,f))}else u.onAuthEvent(o)}isEventForConsumer(o,u){const l=null===u.eventId||!!o.eventId&&o.eventId===u.eventId;return u.filter.includes(o.type)&&l}hasEventBeenHandled(o){return Date.now()-this.lastProcessedEventTime>=6e5&&this.cachedEventUids.clear(),this.cachedEventUids.has($c(o))}saveEventToCache(o){this.cachedEventUids.add($c(o)),this.lastProcessedEventTime=Date.now()}}function $c(c){return[c.type,c.eventId,c.sessionId,c.tenantId].filter(o=>o).join("-")}function $a({type:c,error:o}){return"unknown"===c&&"auth/no-auth-event"===(null==o?void 0:o.code)}function Ha(c){return Ys.apply(this,arguments)}function Ys(){return(Ys=(0,v.Z)(function*(c,o={}){return ge(c,"GET","/v1/projects",o)})).apply(this,arguments)}const Xh=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,Qa=/^https?/;function Js(){return(Js=(0,v.Z)(function*(c){if(c.config.emulator)return;const{authorizedDomains:o}=yield Ha(c);for(const u of o)try{if(mn(u))return}catch{}oe(c,"unauthorized-domain")})).apply(this,arguments)}function mn(c){const o=xn(),{protocol:u,hostname:l}=new URL(o);if(c.startsWith("chrome-extension://")){const I=new URL(c);return""===I.hostname&&""===l?"chrome-extension:"===u&&c.replace("chrome-extension://","")===o.replace("chrome-extension://",""):"chrome-extension:"===u&&I.hostname===l}if(!Qa.test(u))return!1;if(Xh.test(c))return l===c;const f=c.replace(/\./g,"\\.");return new RegExp("^(.+\\."+f+"|"+f+")$","i").test(l)}const Hc=new dr(3e4,6e4);function le(){const c=be().___jsl;if(null!=c&&c.H)for(const o of Object.keys(c.H))if(c.H[o].r=c.H[o].r||[],c.H[o].L=c.H[o].L||[],c.H[o].r=[...c.H[o].L],c.CP)for(let u=0;u<c.CP.length;u++)c.CP[u]=null}let xe=null;const Qc=new dr(5e3,15e3),Dr="__/auth/iframe",et="emulator/auth/iframe",Yc={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},ed=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function Me(c){const o=c.config;N(o.authDomain,c,"auth-domain-config-required");const u=o.emulator?ds(o,et):`https://${c.config.authDomain}/${Dr}`,l={apiKey:o.apiKey,appName:c.name,v:lt.SDK_VERSION},f=ed.get(c.config.apiHost);f&&(l.eid=f);const _=c._getFrameworks();return _.length&&(l.fw=_.join(",")),`${u}?${(0,C.xO)(l).slice(1)}`}function Lt(){return Lt=(0,v.Z)(function*(c){const o=yield function ue(c){return xe=xe||function Xs(c){return new Promise((o,u)=>{var l,f,_;function I(){le(),gapi.load("gapi.iframes",{callback:()=>{o(gapi.iframes.getContext())},ontimeout:()=>{le(),u(Ge(c,"network-request-failed"))},timeout:Hc.get()})}if(null!==(f=null===(l=be().gapi)||void 0===l?void 0:l.iframes)&&void 0!==f&&f.Iframe)o(gapi.iframes.getContext());else{if(null===(_=be().gapi)||void 0===_||!_.load){const E=ea("iframefcb");return be()[E]=()=>{gapi.load?I():u(Ge(c,"network-request-failed"))},ui(`https://apis.google.com/js/api.js?onload=${E}`).catch(S=>u(S))}I()}}).catch(o=>{throw xe=null,o})}(c),xe}(c),u=be().gapi;return N(u,c,"internal-error"),o.open({where:document.body,url:Me(c),messageHandlersFilter:u.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:Yc,dontclear:!0},l=>new Promise(function(){var f=(0,v.Z)(function*(_,I){yield l.restyle({setHideOnLeave:!1});const E=Ge(c,"network-request-failed"),S=be().setTimeout(()=>{I(E)},Qc.get());function L(){be().clearTimeout(S),_(l)}l.ping(L).then(L,()=>{I(E)})});return function(_,I){return f.apply(this,arguments)}}()))}),Lt.apply(this,arguments)}const we={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"};class Jc{constructor(o){this.window=o,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}const no="__/auth/handler",yn="emulator/auth/handler",Ft=encodeURIComponent("fac");function Xn(c,o,u,l,f,_){return Ut.apply(this,arguments)}function Ut(){return(Ut=(0,v.Z)(function*(c,o,u,l,f,_){N(c.config.authDomain,c,"auth-domain-config-required"),N(c.config.apiKey,c,"invalid-api-key");const I={apiKey:c.config.apiKey,appName:c.name,authType:u,redirectUrl:l,v:lt.SDK_VERSION,eventId:f};if(o instanceof Ct){o.setDefaultLanguage(c.languageCode),I.providerId=o.providerId||"",(0,C.xb)(o.getCustomParameters())||(I.customParameters=JSON.stringify(o.getCustomParameters()));for(const[Z,U]of Object.entries(_||{}))I[Z]=U}if(o instanceof Ln){const Z=o.getScopes().filter(U=>""!==U);Z.length>0&&(I.scopes=Z.join(","))}c.tenantId&&(I.tid=c.tenantId);const E=I;for(const Z of Object.keys(E))void 0===E[Z]&&delete E[Z];const S=yield c._getAppCheckToken(),L=S?`#${Ft}=${encodeURIComponent(S)}`:"";return`${function Xc({config:c}){return c.emulator?ds(c,yn):`https://${c.authDomain}/${no}`}(c)}?${(0,C.xO)(E).slice(1)}${L}`})).apply(this,arguments)}const In="webStorageSupport",Mi=class Ya{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=Qt,this._completeRedirectFn=Qs,this._overrideRedirectResult=Ba}_openPopup(o,u,l,f){var _=this;return(0,v.Z)(function*(){var I;ht(null===(I=_.eventManagers[o._key()])||void 0===I?void 0:I.manager,"_initialize() not called before _openPopup()");const E=yield Xn(o,u,l,xn(),f);return function gn(c,o,u,l=500,f=600){const _=Math.max((window.screen.availHeight-f)/2,0).toString(),I=Math.max((window.screen.availWidth-l)/2,0).toString();let E="";const S=Object.assign(Object.assign({},we),{width:l.toString(),height:f.toString(),top:_,left:I}),L=(0,C.z$)().toLowerCase();u&&(E=mr(L)?"_blank":u),Ko(L)&&(o=o||"http://localhost",S.scrollbars="yes");const Z=Object.entries(S).reduce((ye,[yt,Wi])=>`${ye}${yt}=${Wi},`,"");if(function lh(c=(0,C.z$)()){var o;return $t(c)&&!(null===(o=window.navigator)||void 0===o||!o.standalone)}(L)&&"_self"!==E)return function _n(c,o){const u=document.createElement("a");u.href=c,u.target=o;const l=document.createEvent("MouseEvent");l.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),u.dispatchEvent(l)}(o||"",E),new Jc(null);const U=window.open(o||"",E,Z);N(U,c,"popup-blocked");try{U.focus()}catch{}return new Jc(U)}(o,E,Ci())})()}_openRedirect(o,u,l,f){var _=this;return(0,v.Z)(function*(){return yield _._originValidation(o),function Nh(c){be().location.href=c}(yield Xn(o,u,l,xn(),f)),new Promise(()=>{})})()}_initialize(o){const u=o._key();if(this.eventManagers[u]){const{manager:f,promise:_}=this.eventManagers[u];return f?Promise.resolve(f):(ht(_,"If manager is not set, promise should be"),_)}const l=this.initAndGetManager(o);return this.eventManagers[u]={promise:l},l.catch(()=>{delete this.eventManagers[u]}),l}initAndGetManager(o){var u=this;return(0,v.Z)(function*(){const l=yield function td(c){return Lt.apply(this,arguments)}(o),f=new jc(o);return l.register("authEvent",_=>(N(null==_?void 0:_.authEvent,o,"invalid-auth-event"),{status:f.onEvent(_.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),u.eventManagers[o._key()]={manager:f},u.iframes[o._key()]=l,f})()}_isIframeWebStorageSupported(o,u){this.iframes[o._key()].send(In,{type:In},f=>{var _;const I=null===(_=null==f?void 0:f[0])||void 0===_?void 0:_[In];void 0!==I&&u(!!I),oe(o,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(o){const u=o._key();return this.originValidationPromises[u]||(this.originValidationPromises[u]=function qe(c){return Js.apply(this,arguments)}(o)),this.originValidationPromises[u]}get _shouldInitProactively(){return Ho()||jo()||$t()}};class er{constructor(o){this.factorId=o}_process(o,u,l){switch(u.type){case"enroll":return this._finalizeEnroll(o,u.credential,l);case"signin":return this._finalizeSignIn(o,u.credential);default:return Rt("unexpected MultiFactorSessionType")}}}class Li extends er{constructor(o){super("phone"),this.credential=o}static _fromCredential(o){return new Li(o)}_finalizeEnroll(o,u,l){return function xh(c,o){return ge(c,"POST","/v2/accounts/mfaEnrollment:finalize",de(c,o))}(o,{idToken:u,displayName:l,phoneVerificationInfo:this.credential._makeVerificationRequest()})}_finalizeSignIn(o,u){return function Fc(c,o){return ge(c,"POST","/v2/accounts/mfaSignIn:finalize",de(c,o))}(o,{mfaPendingCredential:u,phoneVerificationInfo:this.credential._makeVerificationRequest()})}}let Fi=(()=>{class c{constructor(){}static assertion(u){return Li._fromCredential(u)}}return c.FACTOR_ID="phone",c})();var Ja="@firebase/auth";class rd{constructor(o){this.auth=o,this.internalListeners=new Map}getUid(){var o;return this.assertAuthConfigured(),(null===(o=this.auth.currentUser)||void 0===o?void 0:o.uid)||null}getToken(o){var u=this;return(0,v.Z)(function*(){return u.assertAuthConfigured(),yield u.auth._initializationPromise,u.auth.currentUser?{accessToken:yield u.auth.currentUser.getIdToken(o)}:null})()}addAuthTokenListener(o){if(this.assertAuthConfigured(),this.internalListeners.has(o))return;const u=this.auth.onIdTokenChanged(l=>{o((null==l?void 0:l.stsTokenManager.accessToken)||null)});this.internalListeners.set(o,u),this.updateProactiveRefresh()}removeAuthTokenListener(o){this.assertAuthConfigured();const u=this.internalListeners.get(o);u&&(this.internalListeners.delete(o),u(),this.updateProactiveRefresh())}assertAuthConfigured(){N(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}function En(){return window}(0,C.Pz)("authIdTokenMaxAge"),function nl(c){(0,lt._registerComponent)(new Lo.wA("auth",(o,{options:u})=>{const l=o.getProvider("app").getImmediate(),f=o.getProvider("heartbeat"),_=o.getProvider("app-check-internal"),{apiKey:I,authDomain:E}=l.options;N(I&&!I.includes(":"),"invalid-api-key",{appName:l.name});const S={apiKey:I,authDomain:E,clientPlatform:c,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:oi(c)},L=new ac(l,f,_,S);return function cc(c,o){const u=(null==o?void 0:o.persistence)||[],l=(Array.isArray(u)?u:[u]).map(Xe);null!=o&&o.errorMap&&c._updateErrorMap(o.errorMap),c._initializeWithPersistence(l,null==o?void 0:o.popupRedirectResolver)}(L,u),L},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((o,u,l)=>{o.getProvider("auth-internal").initialize()})),(0,lt._registerComponent)(new Lo.wA("auth-internal",o=>{const u=_e(o.getProvider("auth").getImmediate());return new rd(u)},"PRIVATE").setInstantiationMode("EXPLICIT")),(0,lt.registerVersion)(Ja,"1.3.2",function tl(c){switch(c){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";default:return}}(c)),(0,lt.registerVersion)(Ja,"1.3.2","esm2017")}("Browser");function io(){return io=(0,v.Z)(function*(c,o,u){var l;const{BuildInfo:f}=En();ht(o.sessionId,"AuthEvent did not contain a session ID");const _=yield function eu(c){return so.apply(this,arguments)}(o.sessionId),I={};return $t()?I.ibi=f.packageName:jt()?I.apn=f.packageName:oe(c,"operation-not-supported-in-this-environment"),f.displayName&&(I.appDisplayName=f.displayName),I.sessionId=_,Xn(c,u,o.type,void 0,null!==(l=o.eventId)&&void 0!==l?l:void 0,I)}),io.apply(this,arguments)}function se(){return(se=(0,v.Z)(function*(c){const{BuildInfo:o}=En(),u={};$t()?u.iosBundleId=o.packageName:jt()?u.androidPackageName=o.packageName:oe(c,"operation-not-supported-in-this-environment"),yield Ha(c,u)})).apply(this,arguments)}function Bi(){return(Bi=(0,v.Z)(function*(c,o,u){const{cordova:l}=En();let f=()=>{};try{yield new Promise((_,I)=>{let E=null;function S(){var U;_();const ye=null===(U=l.plugins.browsertab)||void 0===U?void 0:U.close;"function"==typeof ye&&ye(),"function"==typeof(null==u?void 0:u.close)&&u.close()}function L(){E||(E=window.setTimeout(()=>{I(Ge(c,"redirect-cancelled-by-user"))},2e3))}function Z(){"visible"===(null==document?void 0:document.visibilityState)&&L()}o.addPassiveListener(S),document.addEventListener("resume",L,!1),jt()&&document.addEventListener("visibilitychange",Z,!1),f=()=>{o.removePassiveListener(S),document.removeEventListener("resume",L,!1),document.removeEventListener("visibilitychange",Z,!1),E&&window.clearTimeout(E)}})}finally{f()}})).apply(this,arguments)}function so(){return(so=(0,v.Z)(function*(c){const o=function sl(c){if(ht(/[0-9a-zA-Z]+/.test(c),"Can only convert alpha-numeric strings"),typeof TextEncoder<"u")return(new TextEncoder).encode(c);const o=new ArrayBuffer(c.length),u=new Uint8Array(o);for(let l=0;l<c.length;l++)u[l]=c.charCodeAt(l);return u}(c),u=yield crypto.subtle.digest("SHA-256",o);return Array.from(new Uint8Array(u)).map(f=>f.toString(16).padStart(2,"0")).join("")})).apply(this,arguments)}class od extends jc{constructor(){super(...arguments),this.passiveListeners=new Set,this.initPromise=new Promise(o=>{this.resolveInialized=o})}addPassiveListener(o){this.passiveListeners.add(o)}removePassiveListener(o){this.passiveListeners.delete(o)}resetRedirect(){this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1}onEvent(o){return this.resolveInialized(),this.passiveListeners.forEach(u=>u(o)),super.onEvent(o)}initialized(){var o=this;return(0,v.Z)(function*(){yield o.initPromise})()}}function tu(c){return nu.apply(this,arguments)}function nu(){return(nu=(0,v.Z)(function*(c){const o=yield ru()._get(iu(c));return o&&(yield ru()._remove(iu(c))),o})).apply(this,arguments)}function cd(){const c=[];for(let u=0;u<20;u++){const l=Math.floor(62*Math.random());c.push("1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ".charAt(l))}return c.join("")}function ru(){return Xe(fn)}function iu(c){return Kt("authEvent",c.config.apiKey,c.name)}function An(c){if(null==c||!c.includes("?"))return{};const[o,...u]=c.split("?");return(0,C.zd)(u.join("?"))}const ul=class ao{constructor(){this._redirectPersistence=Qt,this._shouldInitProactively=!0,this.eventManagers=new Map,this.originValidationPromises={},this._completeRedirectFn=Qs,this._overrideRedirectResult=Ba}_initialize(o){var u=this;return(0,v.Z)(function*(){const l=o._key();let f=u.eventManagers.get(l);return f||(f=new od(o),u.eventManagers.set(l,f),u.attachCallbackListeners(o,f)),f})()}_openPopup(o){oe(o,"operation-not-supported-in-this-environment")}_openRedirect(o,u,l,f){var _=this;return(0,v.Z)(function*(){!function il(c){var o,u,l,f,_,I,E,S,L,Z;const U=En();N("function"==typeof(null===(o=null==U?void 0:U.universalLinks)||void 0===o?void 0:o.subscribe),c,"invalid-cordova-configuration",{missingPlugin:"cordova-universal-links-plugin-fix"}),N(typeof(null===(u=null==U?void 0:U.BuildInfo)||void 0===u?void 0:u.packageName)<"u",c,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-buildInfo"}),N("function"==typeof(null===(_=null===(f=null===(l=null==U?void 0:U.cordova)||void 0===l?void 0:l.plugins)||void 0===f?void 0:f.browsertab)||void 0===_?void 0:_.openUrl),c,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-browsertab"}),N("function"==typeof(null===(S=null===(E=null===(I=null==U?void 0:U.cordova)||void 0===I?void 0:I.plugins)||void 0===E?void 0:E.browsertab)||void 0===S?void 0:S.isAvailable),c,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-browsertab"}),N("function"==typeof(null===(Z=null===(L=null==U?void 0:U.cordova)||void 0===L?void 0:L.InAppBrowser)||void 0===Z?void 0:Z.open),c,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-inappbrowser"})}(o);const I=yield _._initialize(o);yield I.initialized(),I.resetRedirect(),function $e(){Di.clear()}(),yield _._originValidation(o);const E=function ad(c,o,u=null){return{type:o,eventId:u,urlResponse:null,sessionId:cd(),postBody:null,tenantId:c.tenantId,error:Ge(c,"no-auth-event")}}(o,l,f);yield function ud(c,o){return ru()._set(iu(c),o)}(o,E);const S=yield function sd(c,o,u){return io.apply(this,arguments)}(o,E,u),L=yield function Or(c){const{cordova:o}=En();return new Promise(u=>{o.plugins.browsertab.isAvailable(l=>{let f=null;l?o.plugins.browsertab.openUrl(c):f=o.InAppBrowser.open(c,function $o(c=(0,C.z$)()){return/(iPad|iPhone|iPod).*OS 7_\d/i.test(c)||/(iPad|iPhone|iPod).*OS 8_\d/i.test(c)}()?"_blank":"_system","location=yes"),u(f)})})}(S);return function Xa(c,o,u){return Bi.apply(this,arguments)}(o,I,L)})()}_isIframeWebStorageSupported(o,u){throw new Error("Method not implemented.")}_originValidation(o){const u=o._key();return this.originValidationPromises[u]||(this.originValidationPromises[u]=function te(c){return se.apply(this,arguments)}(o)),this.originValidationPromises[u]}attachCallbackListeners(o,u){const{universalLinks:l,handleOpenURL:f,BuildInfo:_}=En(),I=setTimeout((0,v.Z)(function*(){yield tu(o),u.onEvent(ou())}),500),E=function(){var Z=(0,v.Z)(function*(U){clearTimeout(I);const ye=yield tu(o);let yt=null;ye&&null!=U&&U.url&&(yt=function al(c,o){var u,l;const f=function tr(c){const o=An(c),u=o.link?decodeURIComponent(o.link):void 0,l=An(u).link,f=o.deep_link_id?decodeURIComponent(o.deep_link_id):void 0;return An(f).link||f||l||u||c}(o);if(f.includes("/__/auth/callback")){const _=An(f),I=_.firebaseError?function su(c){try{return JSON.parse(c)}catch{return null}}(decodeURIComponent(_.firebaseError)):null,E=null===(l=null===(u=null==I?void 0:I.code)||void 0===u?void 0:u.split("auth/"))||void 0===l?void 0:l[1],S=E?Ge(E):null;return S?{type:c.type,eventId:c.eventId,tenantId:c.tenantId,error:S,urlResponse:null,sessionId:null,postBody:null}:{type:c.type,eventId:c.eventId,tenantId:c.tenantId,sessionId:c.sessionId,urlResponse:f,postBody:null}}return null}(ye,U.url)),u.onEvent(yt||ou())});return function(ye){return Z.apply(this,arguments)}}();typeof l<"u"&&"function"==typeof l.subscribe&&l.subscribe(null,E);const S=f,L=`${_.packageName.toLowerCase()}://`;En().handleOpenURL=function(){var Z=(0,v.Z)(function*(U){if(U.toLowerCase().startsWith(L)&&E({url:U}),"function"==typeof S)try{S(U)}catch(ye){console.error(ye)}});return function(U){return Z.apply(this,arguments)}}()}};function ou(){return{type:"unknown",eventId:null,sessionId:null,urlResponse:null,postBody:null,tenantId:null,error:Ge("no-auth-event")}}function nr(){var c;return(null===(c=null==self?void 0:self.location)||void 0===c?void 0:c.protocol)||null}function He(c=(0,C.z$)()){return!("file:"!==nr()&&"ionic:"!==nr()&&"capacitor:"!==nr()||!c.toLowerCase().match(/iphone|ipad|ipod|android/))}function uu(){try{const c=self.localStorage,o=Ci();if(c)return c.setItem(o,"1"),c.removeItem(o),!function Zi(c=(0,C.z$)()){return function au(){return(0,C.w1)()&&11===(null==document?void 0:document.documentMode)}()||function uo(c=(0,C.z$)()){return/Edge\/\d+/.test(c)}(c)}()||(0,C.hl)()}catch{return wn()&&(0,C.hl)()}return!1}function wn(){return typeof global<"u"&&"WorkerGlobalScope"in global&&"importScripts"in global}function rr(){return(function Lr(){return"http:"===nr()||"https:"===nr()}()||(0,C.ru)()||He())&&!function hl(){return(0,C.b$)()||(0,C.UG)()}()&&uu()&&!wn()}function cu(){return He()&&typeof document<"u"}function lu(){return(lu=(0,v.Z)(function*(){return!!cu()&&new Promise(c=>{const o=setTimeout(()=>{c(!1)},1e3);document.addEventListener("deviceready",()=>{clearTimeout(o),c(!0)})})})).apply(this,arguments)}const at={LOCAL:"local",NONE:"none",SESSION:"session"},Be=N,hu="persistence";function co(c){return _t.apply(this,arguments)}function _t(){return(_t=(0,v.Z)(function*(c){yield c._initializationPromise;const o=Fr(),u=Kt(hu,c.config.apiKey,c.name);o&&o.setItem(u,c._getPersistence())})).apply(this,arguments)}function Fr(){var c;try{return(null===(c=function tn(){return typeof window<"u"?window:null}())||void 0===c?void 0:c.sessionStorage)||null}catch{return null}}const ld=N;class Pn{constructor(){this.browserResolver=Xe(Mi),this.cordovaResolver=Xe(ul),this.underlyingResolver=null,this._redirectPersistence=Qt,this._completeRedirectFn=Qs,this._overrideRedirectResult=Ba}_initialize(o){var u=this;return(0,v.Z)(function*(){return yield u.selectUnderlyingResolver(),u.assertedUnderlyingResolver._initialize(o)})()}_openPopup(o,u,l,f){var _=this;return(0,v.Z)(function*(){return yield _.selectUnderlyingResolver(),_.assertedUnderlyingResolver._openPopup(o,u,l,f)})()}_openRedirect(o,u,l,f){var _=this;return(0,v.Z)(function*(){return yield _.selectUnderlyingResolver(),_.assertedUnderlyingResolver._openRedirect(o,u,l,f)})()}_isIframeWebStorageSupported(o,u){this.assertedUnderlyingResolver._isIframeWebStorageSupported(o,u)}_originValidation(o){return this.assertedUnderlyingResolver._originValidation(o)}get _shouldInitProactively(){return cu()||this.browserResolver._shouldInitProactively}get assertedUnderlyingResolver(){return ld(this.underlyingResolver,"internal-error"),this.underlyingResolver}selectUnderlyingResolver(){var o=this;return(0,v.Z)(function*(){if(o.underlyingResolver)return;const u=yield function dl(){return lu.apply(this,arguments)}();o.underlyingResolver=u?o.cordovaResolver:o.browserResolver})()}}function J(c){return c.unwrap()}function du(c){return fu(c)}function fu(c){const{_tokenResponse:o}=c instanceof C.ZR?c.customData:c;if(!o)return null;if(!(c instanceof C.ZR)&&"temporaryProof"in o&&"phoneNumber"in o)return Vr.credentialFromResult(c);const u=o.providerId;if(!u||u===Yr.PASSWORD)return null;let l;switch(u){case Yr.GOOGLE:l=Er;break;case Yr.FACEBOOK:l=yc;break;case Yr.GITHUB:l=da;break;case Yr.TWITTER:l=Ic;break;default:const{oauthIdToken:f,oauthAccessToken:_,oauthTokenSecret:I,pendingToken:E,nonce:S}=o;return _||I||f||E?E?u.startsWith("saml.")?bt._create(u,E):rt._fromParams({providerId:u,signInMethod:u,pendingToken:E,idToken:f,accessToken:_}):new Fn(u).credential({idToken:f,accessToken:_,rawNonce:S}):null}return c instanceof C.ZR?l.credentialFromError(c):l.credentialFromResult(c)}function Ye(c,o){return o.catch(u=>{throw u instanceof C.ZR&&function pl(c,o){var u;const l=null===(u=o.customData)||void 0===u?void 0:u._tokenResponse;if("auth/multi-factor-auth-required"===(null==o?void 0:o.code))o.resolver=new dd(c,function xa(c,o){var u;const l=(0,C.m9)(c),f=o;return N(o.customData.operationType,l,"argument-error"),N(null===(u=f.customData._serverResponse)||void 0===u?void 0:u.mfaPendingCredential,l,"argument-error"),st._fromError(l,f)}(c,o));else if(l){const f=fu(o),_=o;f&&(_.credential=f,_.tenantId=l.tenantId||void 0,_.email=l.email||void 0,_.phoneNumber=l.phoneNumber||void 0)}}(c,u),u}).then(u=>{const f=u.user;return{operationType:u.operationType,credential:du(u),additionalUserInfo:Us(u),user:qt.getOrCreate(f)}})}function Ur(c,o){return pu.apply(this,arguments)}function pu(){return(pu=(0,v.Z)(function*(c,o){const u=yield o;return{verificationId:u.verificationId,confirm:l=>Ye(c,u.confirm(l))}})).apply(this,arguments)}class dd{constructor(o,u){this.resolver=u,this.auth=function hd(c){return c.wrapped()}(o)}get session(){return this.resolver.session}get hints(){return this.resolver.hints}resolveSignIn(o){return Ye(J(this.auth),this.resolver.resolveSignIn(o))}}class qt{constructor(o){this._delegate=o,this.multiFactor=function ka(c){const o=(0,C.m9)(c);return dn.has(o)||dn.set(o,Ri._fromUser(o)),dn.get(o)}(o)}static getOrCreate(o){return qt.USER_MAP.has(o)||qt.USER_MAP.set(o,new qt(o)),qt.USER_MAP.get(o)}delete(){return this._delegate.delete()}reload(){return this._delegate.reload()}toJSON(){return this._delegate.toJSON()}getIdTokenResult(o){return this._delegate.getIdTokenResult(o)}getIdToken(o){return this._delegate.getIdToken(o)}linkAndRetrieveDataWithCredential(o){return this.linkWithCredential(o)}linkWithCredential(o){var u=this;return(0,v.Z)(function*(){return Ye(u.auth,ga(u._delegate,o))})()}linkWithPhoneNumber(o,u){var l=this;return(0,v.Z)(function*(){return Ur(l.auth,function kr(c,o,u){return xi.apply(this,arguments)}(l._delegate,o,u))})()}linkWithPopup(o){var u=this;return(0,v.Z)(function*(){return Ye(u.auth,function zh(c,o,u){return Jt.apply(this,arguments)}(u._delegate,o,Pn))})()}linkWithRedirect(o){var u=this;return(0,v.Z)(function*(){return yield co(_e(u.auth)),$h(u._delegate,o,Pn)})()}reauthenticateAndRetrieveDataWithCredential(o){return this.reauthenticateWithCredential(o)}reauthenticateWithCredential(o){var u=this;return(0,v.Z)(function*(){return Ye(u.auth,_a(u._delegate,o))})()}reauthenticateWithPhoneNumber(o,u){return Ur(this.auth,function Qn(c,o,u){return La.apply(this,arguments)}(this._delegate,o,u))}reauthenticateWithPopup(o){return Ye(this.auth,function Vi(c,o,u){return Mt.apply(this,arguments)}(this._delegate,o,Pn))}reauthenticateWithRedirect(o){var u=this;return(0,v.Z)(function*(){return yield co(_e(u.auth)),Kh(u._delegate,o,Pn)})()}sendEmailVerification(o){return function kt(c,o){return Ms.apply(this,arguments)}(this._delegate,o)}unlink(o){var u=this;return(0,v.Z)(function*(){return yield function fe(c,o){return wr.apply(this,arguments)}(u._delegate,o),u})()}updateEmail(o){return function Fs(c,o){return Pi((0,C.m9)(c),o,null)}(this._delegate,o)}updatePassword(o){return function bc(c,o){return Pi((0,C.m9)(c),null,o)}(this._delegate,o)}updatePhoneNumber(o){return function Nr(c,o){return zs.apply(this,arguments)}(this._delegate,o)}updateProfile(o){return function Cc(c,o){return wi.apply(this,arguments)}(this._delegate,o)}verifyBeforeUpdateEmail(o,u){return function wh(c,o,u){return Ls.apply(this,arguments)}(this._delegate,o,u)}get emailVerified(){return this._delegate.emailVerified}get isAnonymous(){return this._delegate.isAnonymous}get metadata(){return this._delegate.metadata}get phoneNumber(){return this._delegate.phoneNumber}get providerData(){return this._delegate.providerData}get refreshToken(){return this._delegate.refreshToken}get tenantId(){return this._delegate.tenantId}get displayName(){return this._delegate.displayName}get email(){return this._delegate.email}get photoURL(){return this._delegate.photoURL}get providerId(){return this._delegate.providerId}get uid(){return this._delegate.uid}get auth(){return this._delegate.auth}}qt.USER_MAP=new WeakMap;const Bt=N;let Rn=(()=>{class c{constructor(u,l){if(this.app=u,l.isInitialized())return this._delegate=l.getImmediate(),void this.linkUnderlyingAuth();const{apiKey:f}=u.options;Bt(f,"invalid-api-key",{appName:u.name}),Bt(f,"invalid-api-key",{appName:u.name});const _=typeof window<"u"?Pn:void 0;this._delegate=l.initialize({options:{persistence:ir(f,u.name),popupRedirectResolver:_}}),this._delegate._updateErrorMap(Wu),this.linkUnderlyingAuth()}get emulatorConfig(){return this._delegate.emulatorConfig}get currentUser(){return this._delegate.currentUser?qt.getOrCreate(this._delegate.currentUser):null}get languageCode(){return this._delegate.languageCode}set languageCode(u){this._delegate.languageCode=u}get settings(){return this._delegate.settings}get tenantId(){return this._delegate.tenantId}set tenantId(u){this._delegate.tenantId=u}useDeviceLanguage(){this._delegate.useDeviceLanguage()}signOut(){return this._delegate.signOut()}useEmulator(u,l){!function lc(c,o,u){const l=_e(c);N(l._canInitEmulator,l,"emulator-config-failed"),N(/^https?:\/\//.test(o),l,"invalid-emulator-scheme");const f=!(null==u||!u.disableWarnings),_=hc(o),{host:I,port:E}=function ph(c){const o=hc(c),u=/(\/\/)?([^?#/]+)/.exec(c.substr(o.length));if(!u)return{host:"",port:null};const l=u[2].split("@").pop()||"",f=/^(\[[^\]]+\])(:|$)/.exec(l);if(f){const _=f[1];return{host:_,port:gr(l.substr(_.length+1))}}{const[_,I]=l.split(":");return{host:_,port:gr(I)}}}(o);l.config.emulator={url:`${_}//${I}${null===E?"":`:${E}`}/`},l.settings.appVerificationDisabledForTesting=!0,l.emulatorConfig=Object.freeze({host:I,port:E,protocol:_.replace(":",""),options:Object.freeze({disableWarnings:f})}),f||function li(){function c(){const o=document.createElement("p"),u=o.style;o.innerText="Running in emulator mode. Do not use with production credentials.",u.position="fixed",u.width="100%",u.backgroundColor="#ffffff",u.border=".1em solid #000000",u.color="#b50000",u.bottom="0px",u.left="0px",u.margin="0px",u.zIndex="10000",u.textAlign="center",o.classList.add("firebase-emulator-warning"),document.body.appendChild(o)}typeof console<"u"&&"function"==typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&("loading"===document.readyState?window.addEventListener("DOMContentLoaded",c):c())}()}(this._delegate,u,l)}applyActionCode(u){return function ks(c,o){return zn.apply(this,arguments)}(this._delegate,u)}checkActionCode(u){return Ti(this._delegate,u)}confirmPasswordReset(u,l){return function Th(c,o,u){return Ta.apply(this,arguments)}(this._delegate,u,l)}createUserWithEmailAndPassword(u,l){var f=this;return(0,v.Z)(function*(){return Ye(f._delegate,function Ai(c,o,u){return Ea.apply(this,arguments)}(f._delegate,u,l))})()}fetchProvidersForEmail(u){return this.fetchSignInMethodsForEmail(u)}fetchSignInMethodsForEmail(u){return function Ds(c,o){return Os.apply(this,arguments)}(this._delegate,u)}isSignInWithEmailLink(u){return function Eh(c,o){const u=Mn.parseLink(o);return"EMAIL_SIGNIN"===(null==u?void 0:u.operation)}(0,u)}getRedirectResult(){var u=this;return(0,v.Z)(function*(){Bt(rr(),u._delegate,"operation-not-supported-in-this-environment");const l=yield function Qh(c,o){return Wa.apply(this,arguments)}(u._delegate,Pn);return l?Ye(u._delegate,Promise.resolve(l)):{credential:null,user:null}})()}addFrameworkForLogging(u){!function en(c,o){_e(c)._logFramework(o)}(this._delegate,u)}onAuthStateChanged(u,l,f){const{next:_,error:I,complete:E}=mu(u,l,f);return this._delegate.onAuthStateChanged(_,I,E)}onIdTokenChanged(u,l,f){const{next:_,error:I,complete:E}=mu(u,l,f);return this._delegate.onIdTokenChanged(_,I,E)}sendSignInLinkToEmail(u,l){return function Rc(c,o,u){return Aa.apply(this,arguments)}(this._delegate,u,l)}sendPasswordResetEmail(u,l){return function vh(c,o,u){return va.apply(this,arguments)}(this._delegate,u,l||void 0)}setPersistence(u){var l=this;return(0,v.Z)(function*(){let f;switch(function Gi(c,o){Be(Object.values(at).includes(o),c,"invalid-persistence-type"),(0,C.b$)()?Be(o!==at.SESSION,c,"unsupported-persistence-type"):(0,C.UG)()?Be(o===at.NONE,c,"unsupported-persistence-type"):wn()?Be(o===at.NONE||o===at.LOCAL&&(0,C.hl)(),c,"unsupported-persistence-type"):Be(o===at.NONE||uu(),c,"unsupported-persistence-type")}(l._delegate,u),u){case at.SESSION:f=Qt;break;case at.LOCAL:f=(yield Xe(b)._isAvailable())?b:fn;break;case at.NONE:f=on;break;default:return oe("argument-error",{appName:l._delegate.name})}return l._delegate.setPersistence(f)})()}signInAndRetrieveDataWithCredential(u){return this.signInWithCredential(u)}signInAnonymously(){return Ye(this._delegate,function qn(c){return Et.apply(this,arguments)}(this._delegate))}signInWithCredential(u){return Ye(this._delegate,cn(this._delegate,u))}signInWithCustomToken(u){return Ye(this._delegate,function wc(c,o){return Ia.apply(this,arguments)}(this._delegate,u))}signInWithEmailAndPassword(u,l){return Ye(this._delegate,function Ee(c,o,u){return cn((0,C.m9)(c),yi.credential(o,u)).catch(function(){var l=(0,v.Z)(function*(f){throw"auth/password-does-not-meet-requirements"===f.code&&bs(c),f});return function(f){return l.apply(this,arguments)}}())}(this._delegate,u,l))}signInWithEmailLink(u,l){return Ye(this._delegate,function Ah(c,o,u){return Ns.apply(this,arguments)}(this._delegate,u,l))}signInWithPhoneNumber(u,l){return Ur(this._delegate,function me(c,o,u){return O.apply(this,arguments)}(this._delegate,u,l))}signInWithPopup(u){var l=this;return(0,v.Z)(function*(){return Bt(rr(),l._delegate,"operation-not-supported-in-this-environment"),Ye(l._delegate,function At(c,o,u){return Ua.apply(this,arguments)}(l._delegate,u,Pn))})()}signInWithRedirect(u){var l=this;return(0,v.Z)(function*(){return Bt(rr(),l._delegate,"operation-not-supported-in-this-environment"),yield co(l._delegate),Wc(l._delegate,u,Pn)})()}updateCurrentUser(u){return this._delegate.updateCurrentUser(u)}verifyPasswordResetCode(u){return function Pc(c,o){return Wn.apply(this,arguments)}(this._delegate,u)}unwrap(){return this._delegate}_delete(){return this._delegate._delete()}linkUnderlyingAuth(){this._delegate.wrapped=()=>this}}return c.Persistence=at,c})();function mu(c,o,u){let l=c;"function"!=typeof c&&({next:l,error:o,complete:u}=c);const f=l;return{next:I=>f(I&&qt.getOrCreate(I)),error:o,complete:u}}function ir(c,o){const u=function fl(c,o){const u=Fr();if(!u)return[];const l=Kt(hu,c,o);switch(u.getItem(l)){case at.NONE:return[on];case at.LOCAL:return[b,Qt];case at.SESSION:return[Qt];default:return[]}}(c,o);if(typeof self<"u"&&!u.includes(b)&&u.push(b),typeof window<"u")for(const l of[fn,Qt])u.includes(l)||u.push(l);return u.includes(on)||u.push(on),u}class lo{constructor(){this.providerId="phone",this._delegate=new Vr(J(q.Z.auth()))}static credential(o,u){return Vr.credential(o,u)}verifyPhoneNumber(o,u){return this._delegate.verifyPhoneNumber(o,u)}unwrap(){return this._delegate}}lo.PHONE_SIGN_IN_METHOD=Vr.PHONE_SIGN_IN_METHOD,lo.PROVIDER_ID=Vr.PROVIDER_ID;const qr=N;class ml{constructor(o,u,l=q.Z.app()){var f;qr(null===(f=l.options)||void 0===f?void 0:f.apiKey,"invalid-api-key",{appName:l.name}),this._delegate=new bi(l.auth(),o,u),this.type=this._delegate.type}clear(){this._delegate.clear()}render(){return this._delegate.render()}verify(){return this._delegate.verify()}}!function zi(c){c.INTERNAL.registerComponent(new Lo.wA("auth-compat",o=>{const u=o.getProvider("app-compat").getImmediate(),l=o.getProvider("auth");return new Rn(u,l)},"PUBLIC").setServiceProps({ActionCodeInfo:{Operation:{EMAIL_SIGNIN:"EMAIL_SIGNIN",PASSWORD_RESET:"PASSWORD_RESET",RECOVER_EMAIL:"RECOVER_EMAIL",REVERT_SECOND_FACTOR_ADDITION:"REVERT_SECOND_FACTOR_ADDITION",VERIFY_AND_CHANGE_EMAIL:"VERIFY_AND_CHANGE_EMAIL",VERIFY_EMAIL:"VERIFY_EMAIL"}},EmailAuthProvider:yi,FacebookAuthProvider:yc,GithubAuthProvider:da,GoogleAuthProvider:Er,OAuthProvider:Fn,SAMLAuthProvider:Ar,PhoneAuthProvider:lo,PhoneMultiFactorGenerator:Fi,RecaptchaVerifier:ml,TwitterAuthProvider:Ic,Auth:Rn,AuthCredential:un,Error:C.ZR}).setInstantiationMode("LAZY").setMultipleInstances(!1)),c.registerVersion("@firebase/auth-compat","0.4.8")}(q.Z)}}]);